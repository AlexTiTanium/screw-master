{"version":3,"mappings":"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","names":["round","value","precision","multiplier","Vector2","x","y","scalar","v","s","a","b","min2","max2","minVal","maxVal","min","max","length","angle","dx","dy","alpha","v1","v2","array","offset","center","c","throttleMap","throttle","fun","delay","scope","timerId","throttledFunction","args","callFun","latestArgs","Lock","NakedPromise","executor","capturedResolve","capturedReject","resolve","reject","URLParams","url","name","fallback","type","items","paramsString","paramsNumber","paramsBoolean","item","split","k","limitFPS","fps","Ticker","gsap","getPixiRunnerData","runner","Prioritiser","runners","getter","getItem","result","plugin","data","runnerName","priority","runner2","plugin1","index1","plugin2","index2","promiseRunner","promiseAllRunner","promises","AssetMonitor","sizes","acc","size","state","FPSMonitor","id","trackTail","clampedDelta","timeNow","frameFPS","ended","now","ch","chSample","fpsPercentile1","fpsPercentile5","fpsPercentile95","fpsPercentile99","stats","delta","delta2","raw","seg","count","frameTime","windowMs","fw","duration","samples","sorted","pick","p","rank","gpuTextureFormatSize","glTextureFormatSize","GPUMonitor","renderer","textureCount","totalSize","texture","sizeInMb","currentTextures","glTextures","textureSystem","gpuData","webTexture","res","ANALYTICS_TIMER","MAX_FRAME_DT","START_TRACKING_AFTER","PerformanceTrackerClass","trackFunction","addSelf","warningFunction","options","_a","key","event","gpu","segmentSnapshots","nowTs","sessionSnapshot","snap","session","perfData","MIN_DELTA","w","rAF","frameCount","startTime","SAMPLE_DURATION_MS","HARD_TIMEOUT_MS","finish","elapsed","estimate","step","t","best","diff","hz","d","cooldownMs","last","currentMb","used","limit","ratio","PerformanceTracker","Application","config","PluginClass","nameToRegister","classPlugins","pluginClass","pluginName","ticker","SystemRunner","Plugin","app","formatTextures","assets","_b","assetData","tags","baseTexture","loadTexturesWrapper","loadTextures","ExtensionType","loadAsset","loader","loadWebFontWrapper","loadWebFont","validWeights","weights","r","atlasResolver","extension","format","Resolver","spritesheetHash","firstLoad","originalLoad","Assets","originalBackgroundLoad","mainOverride","urls","manifest","bundle","asset","frameName","urlToSpritesheetMap","convertToList","spriteSheet","overrideAssetLoad","onProgress","originalResult","returnValue","_","Spritesheet","Cache","newUrls","progressSize","u","mappedRes","warnings","deprecation","version","message","ignoreDepth","stack","window","undefined","LIBVERSION","EMPTY","UNKNOWN","FUNC_TYPE","UNDEF_TYPE","OBJ_TYPE","STR_TYPE","MAJOR","MODEL","NAME","TYPE","VENDOR","VERSION","ARCHITECTURE","CONSOLE","MOBILE","TABLET","SMARTTV","WEARABLE","EMBEDDED","UA_MAX_LENGTH","AMAZON","APPLE","ASUS","BLACKBERRY","BROWSER","CHROME","EDGE","FIREFOX","GOOGLE","HONOR","HUAWEI","LENOVO","LG","MICROSOFT","MOTOROLA","NVIDIA","ONEPLUS","OPERA","OPPO","SAMSUNG","SHARP","SONY","XIAOMI","ZEBRA","FACEBOOK","CHROMIUM_OS","MAC_OS","SUFFIX_BROWSER","extend","regexes","extensions","mergedRegexes","i","enumerize","arr","enums","has","str1","str2","lowerize","str","majorize","trim","len","rgxMapper","ua","arrays","j","q","matches","match","regex","props","strMapper","map","oldSafariMap","windowsVersionMap","UAParser","_navigator","_ua","_uach","_rgxmap","_isSelfNav","_browser","_cpu","_device","_engine","_os","module","exports","$","parser","prop","this","StorageType","StorageType2","autoDetectStorage","storage","isIPhone6","query","Device","isGalaxyS5","isKindle","isSafari18Dot4","major","minor","isSafari18","DeviceClass","funcs","cachedRes","splitMatches","tests","isVersion","query2","cacheType","test","userAgent","isMacOS","touchCheck","ResourcePlugin","utils.supported","paths","path","aliases","KeyBindingCollection","binding","list","index","KeyboardPlugin","e","bindings","allDownBindings","bind","action","singleKey","allowHold","currentHoldTime","dt","element","isDown","key2","TouchInput","source","enabled","bubble","autoDetectResolution","autoDetectAntialias","autoDetectTransparency","canvas","gl","debugInfo","transparent","sub","StagePlugin","Container","autoDetectRenderer","resizeDefault","h","ResizePlugin","Signal","stageView","parent","width2","height2","width","height","stage","originalDisplay","needsHiding","EventSystem","point","resolutionMultiplier","canvasWidth","canvasHeight","canvasStyleWidth","canvasStyleHeight","isPortrait","transformPoint","force","newOrientation","isCorrectOrientation","rendererWidth","rendererHeight","EmptyScreen","History","Bar","bg","frame","bar","mask","Graphics","Sprite","LoaderScreen","TransitionManager","transitionData","defaults","cleanedData","from","to","both","transition","rest","mapping","currentId","nextId","checkAndReturn","AlphaTransition","_container","current","_current","next","ScreenGroup","screenData","Class","async","lastScreen","nextScreen","omitFromHistory","previousInstance","screenSessionData","skipNavigationEntry","transitionOptions","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","loadingScreenDelay","applyLoaderAsOverlay","loaderOptions","loaderScreenClass","loadBeforeTransition","autoManageContainers","currentData","nextData","firstRun","isEmptyScreen","shouldRemoveScreen","loadPromise","loadComplete","loadBefore","_a2","_b2","vs","screen","LoaderScreenClass","loadCompleteCallback","timeoutId","manifests","screenPromises","manifestProgress","assetProgress","promiseProgress","totalProgress","preloadData","progress","promise","ScreensPlugin","layers","config2","layer","screenId","isClass","screenClass","screenOptions","isAsync","resizer","group","screens","aspectResize","minWidth","minHeight","fixCanvasSize","aspectRatio","scaleX","scaleY","scale","URLParams$1","BaseScreen","_options","_dt","_w","_Runner","argsLength","func","src","Runner","ID32","q1","q2","q3","q4","idValue","UIDs","_Entity","components","component","signals","staticComp","comp","Entity","Pool","ClassType","initialSize","total","PoolGroupClass","pool","object","PoolGroup","ctors","DefineEntity","Constructor","curr","entityClass","createEntity","entity","_View2DComponent","View2DComponent","Entity2D","Signals","signalName","Time","SmoothTime","deltaTime","Group","children","f","generateQueries","systemClass","system","queryName","queryConfig","queryComponents","Query","world","callbackfn","entityId","matchesComponents","matchesNotComponents","matchesOrComponents","ids","QueryManager","componentID","notComponentID","orComponentIDs","orNames","setID","orId","component2","Scene","rKey","entitiesToRemove","_View2DSystem","opts","startHook","RenderContainer","endHook","camera","zoom","sx","sy","ent","view","newLayer","depth","view2d","layerName","View2DSystem","Scene2D","entities","parts","registerPart","part","getPart","hasPart","simplePlate","slidingCover","boardWalnutSquare","boardOakHorizontal","boardOakVertical","boardBirchSquare","boardMahoganySquare","boardPineHorizontal","SCREW_RADIUS","isCircleInBox","radius","box","isPointInPolygon","polygon","inside","n","pi","pj","isCircleInPolygon","isScrewInBounds","screwPosition","collision","PLAY_AREA","localToWorld","localPosition","isPartInPlayArea","halfWidth","halfHeight","leftEdge","rightEdge","topEdge","bottomEdge","getPartBoundsInfo","validateScrewPlacement","screw","partInstance","screwIndex","partIndex","partDef","boundsDesc","getPartDimensions","partId","points","xs","ys","formatExceededBounds","info","validatePartPlayAreaBounds","boundsInfo","exceeded","pos","validatePartInstance","errors","boundsError","usedPositions","screwError","posKey","msg","validateTrayCapacities","level","tray","validateLevelParts","layerCounts","partResult","validateWinCondition","targetPartIndex","validateLevel","partsResult","appendLevelResults","levelResult","error","warning","validateRegionLevelContents","region","levelIds","validateRegion","levelContents","loadRegion","response","errorMessages","getLevelByIndex","ScrewColor","defineComponent","ComponentImpl","ScrewComponent","PartComponent","TrayComponent","BufferTrayComponent","GameStateComponent","ScrewEntity","PartEntity","TrayEntity","BufferTrayEntity","gameVisualRegistry","getGameVisual","SHORT_SCREW_ASSET_MAP","LONG_SCREW_ASSET_MAP","TRAY_ASSET_MAP","PLACEHOLDER_ASSET_MAP","TRAY_WIDTH","PLACEHOLDER_DISPLAY_WIDTH","PLACEHOLDER_SPACING","PLACEHOLDER_Y","placeholderRegistry","getTrayPlaceholders","createScrewEntity","assetAlias","sprite","createPartEntity","createTrayEntity","capacity","displayOrder","trayTexture","placeholderTexture","loadTrayTextures","createTrayEntityWithComponent","setupTraySprite","setupPlaceholders","color","traySprite","placeholders","totalWidth","startX","placeholder","createBufferTrayEntity","GameStateEntity","BaseSystem","callback","_typeHint","TRAY_FRAME_LAYOUT","getSlotWorldPosition","slotIndex","getCoverPositionForBucket","BUFFER_TRAY_LAYOUT","TRAY_DISPLAY_POSITIONS","TRAY_HIDDEN_Y","TRAY_SPAWN_X","SLOT_DISPLAY_WIDTH","COLORED_TRAY_SLOT_SPACING","COLORED_TRAY_Y_OFFSET","getTraySlotPosition","trayEntity","isBuffer","trayCapacity","slot","fallbackSlot","getTraySlotTargetPosition","trayPosition","GameEventBus","handler","handlers","gameEvents","animationLayer","coloredTrayLayer","registerAnimationLayer","registerColoredTrayLayer","getAnimationLayer","getColoredTrayLayer","clearLayerRegistry","GAME_LAYOUT","currentTick","loggingEnabled","gameTick","category","TrayManagementSystem","screwComponent","trayEntityId","trayComponent","inFlightToThisTray","trayUID","uid","fullTray","fullTrayComponent","sortedTrays","nextHiddenTray","traysToShift","aOrder","bOrder","trayComp","currentDisplayOrder","shiftPromises","revealPromise","allPromises","newOrder","nextComp","newDisplayOrder","eventName","_time","ScrewPlacementSystem","animating","busy","coloredTarget","bufferTarget","bufferTray","buffer","inBuffer","inFlight","bufferUid","matchingTray","target","screwEntity","coloredTrays","screws","trayUid","inFlightCount","ScrewInteractionSystem","input","placementSystem","bufferFull","traysAnimating","traysBusy","entity2d","trayColor","gameStateEntity","TRAY_SLOT_SCALE","BUFFER_SLOT_SCALE","POP_OUT_HEIGHT","POP_OUT_SCALE","REMOVAL_ARC_HEIGHT","TRANSFER_ARC_HEIGHT","bezierPosition","p0","p1","p2","invT","AnimatorBase","ctx","timeline","params","updatePosition","ScrewRemovalAnimator","targetTray","screwEntity2D","visual","startPos","targetPos","endScale","longTexture","start","end","arcHeight","flightStartY","expected","dX","dY","ScrewTransferAnimator","TrayHideAnimator","entity2D","screwsInTray","trayView","screwVisual","localX","localY","TrayShiftAnimator","deltaX","targetX","screw2D","TrayRevealAnimator","AnimationSystem","AutoTransferSystem","transferring","screwIds","screwId","screwUid","bufferIndex","WinConditionSystem","gameState","winType","setupErrorCapture","reason","getTestParams","seedParam","levelParam","isTestMode","SKIP_PROPERTIES","UID_REF_PROPERTIES","shouldSkipProperty","extractPropertyValue","nested","serializeObjectValue","obj","include","extractUid","o","serializeComponent","extractComponents","getEntityBounds","serializeEntity","getAllEntities","sceneRef","getSystemNames","scene","createECSAccess","getEntities","getEntity","frameCounter","simpleHash","hash","char","entityToHashString","rot","vis","componentsStr","createRenderSignatureGenerator","getSceneState","getSystems","timestamp","currentFrame","sortedEntities","aId","bId","hashInput","MAX_RECORDED_ACTIONS","recordedActions","recordAction","tick","entry","getRecordedActions","findEntity","targetId","getEntityComponent","componentName","executeSetPosition","executeSetComponent","executeSetVisible","visible","executeDestroyEntity","executePause","executeResume","executeTick","deltaMs","executePointerEvent","eventType","button","rect","screenX","screenY","executeKeyEvent","code","dispatchEntityAction","dispatchPointerAction","dispatchInputAction","pointerResult","dispatchAction","getScene","getCanvas","entityResult","inputResult","createActionExecutor","err","MAX_LOGS","capturedLogs","originalConsole","isInitialized","safeStringify","getCurrentTick","addLog","initConsoleCapture","getCapturedLogs","clearCapturedLogs","getOriginalConsole","getPixiRenderer","getApp","__vitePreload","bootstrap$1","getPixiStage","captureScreenshot","snapshotDisplayObject","displayObject","maxDepth","snapshot","tex","child","childSnapshot","countDisplayObjects","captureRenderState","displayTree","sceneState","sig","renderState","collectBugReport","description","screenshot","consoleLogs","userActions","report","submitBugReport","currentModal","createModalOverlay","overlay","createModalContent","content","createModalTitle","title","createDescriptionTextarea","textarea","createButton","text","isPrimary","createButtonContainer","container","createStatusMessage","status","showStatus","isError","closeModal","showBugReportModal","buttonContainer","cancelButton","submitButton","statusMessage","STORAGE_KEY","DEFAULT_WIDTH","DEFAULT_HEIGHT","HEADER_HEIGHT","FOOTER_HEIGHT","loadState","saved","saveState","createContainer","createHeader","header","createHeaderTitle","createHeaderButtons","buttons","createHeaderButton","symbol","onClick","createLogArea","logArea","createFooter","footer","createFooterButton","createLogLine","line","prefix","setupDragging","isDragging","dragOffsetX","dragOffsetY","startDrag","clientX","clientY","moveDrag","newX","newY","maxX","maxY","endDrag","touch","setupKeyboardShortcut","createLogDisplayManager","logLines","setupConsoleIntegration","logManager","original","prevLog","prevWarn","prevError","createDebugConsole","headerTitle","headerButtons","minimizeBtn","closeBtn","copyBtn","originalText","clearBtn","reportBtn","tickCounterRef","createTickAccess","registerTickCounter","createActionMethods","executeAction","act","actions","results","createSnapshotMethods","createLifecycleMethods","ecsAccess","sceneName","sceneInstance","defineStateGetters","harness","createInitialState","createHarness","initTestHarness","markGameReady","TickSystem","GameScene","entityContainer","bgTexture","background","puzzleBase","coverTexture","coverPos","cover","frameTexture","trayConfigs","isVisible","displayPosition","position","regionPath","levelIndex","totalScrews","sum","sortedParts","partWorldPosition","partEntity","partWidth","partHeight","screwWorldPosition","partIds","bundleName","_deltaTime","GameScreen","APP_CONFIG","bootstrap","configurePlugins","mountToDOM","showInitialScreen","application","debugConsole","main","appDiv"],"ignoreList":[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62],"sources":["../../node_modules/@play-co/commons/dist/maths/Math.mjs","../../node_modules/@play-co/commons/dist/maths/vector/Vector2.mjs","../../node_modules/@play-co/commons/dist/time/throttle.mjs","../../node_modules/@play-co/commons/dist/utils/Lock.mjs","../../node_modules/@play-co/commons/dist/utils/NakedPromise.mjs","../../node_modules/@play-co/commons/dist/url/URLParams.mjs","../../node_modules/@play-co/astro/dist/utils/system/time/limitFPS.mjs","../../node_modules/@play-co/astro/dist/core/app/Prioritiser.mjs","../../node_modules/@play-co/astro/dist/utils/runners/promiseRunner.mjs","../../node_modules/@play-co/astro/dist/utils/system/monitor/AssetMonitor.mjs","../../node_modules/@play-co/astro/dist/utils/system/monitor/FPSMonitor.mjs","../../node_modules/@play-co/astro/dist/utils/system/monitor/GPUMonitor.mjs","../../node_modules/@play-co/astro/dist/utils/system/monitor/PerformanceTracker.mjs","../../node_modules/@play-co/astro/dist/core/app/Application.mjs","../../node_modules/@play-co/astro/dist/core/app/Plugin.mjs","../../node_modules/@play-co/astro/dist/core/asset/utils/formatTextures.mjs","../../node_modules/@play-co/astro/dist/core/asset/plugins/loadTexture.mjs","../../node_modules/@play-co/astro/dist/core/asset/plugins/loadWebFont.mjs","../../node_modules/@play-co/astro/dist/core/asset/plugins/spineParser.mjs","../../node_modules/@play-co/astro/dist/core/asset/overrideAssetLoad.mjs","../../node_modules/@play-co/astro/dist/utils/logging/deprecation.mjs","../../node_modules/ua-parser-js/src/ua-parser.js","../../node_modules/@play-co/astro/dist/utils/system/detections/autoDetectStorage.mjs","../../node_modules/@play-co/astro/dist/utils/system/devices/deviceQueries.mjs","../../node_modules/@play-co/astro/dist/utils/system/devices/Device.mjs","../../node_modules/@play-co/astro/dist/core/asset/ResourcePlugin.mjs","../../node_modules/@play-co/astro/dist/input/KeyboardPlugin.mjs","../../node_modules/@play-co/astro/dist/input/touch/TouchInput.mjs","../../node_modules/@play-co/astro/dist/utils/system/detections/autoDetectResolution.mjs","../../node_modules/@play-co/astro/dist/utils/system/detections/autoDetectAntialias.mjs","../../node_modules/@play-co/astro/dist/utils/system/detections/autoDetectTransparency.mjs","../../node_modules/@play-co/astro/dist/stage/StagePlugin.mjs","../../node_modules/@play-co/astro/dist/stage/resize/resizeDefault.mjs","../../node_modules/@play-co/astro/dist/stage/resize/ResizePlugin.mjs","../../node_modules/@play-co/astro/dist/screens/EmptyScreen.mjs","../../node_modules/@play-co/astro/dist/screens/History.mjs","../../node_modules/@play-co/astro/dist/screens/temp-ui/Bar.mjs","../../node_modules/@play-co/astro/dist/screens/loader/LoaderScreen.mjs","../../node_modules/@play-co/astro/dist/screens/TransitionManager.mjs","../../node_modules/@play-co/astro/dist/screens/transitions/AlphaTransition.mjs","../../node_modules/@play-co/astro/dist/screens/ScreenGroup.mjs","../../node_modules/@play-co/astro/dist/screens/ScreensPlugin.mjs","../../node_modules/@play-co/astro/dist/stage/resize/gameResize.mjs","../../node_modules/@play-co/astro/dist/index.mjs","../../src/ui/screens/BaseScreen.ts","../../node_modules/@play-co/odie/dist/utils/Runner.mjs","../../node_modules/@play-co/odie/dist/core/queries/ID32.mjs","../../node_modules/@play-co/odie/dist/core/Entity.mjs","../../node_modules/@play-co/odie/dist/core/pool/Pool.mjs","../../node_modules/@play-co/odie/dist/core/pool/PoolGroup.mjs","../../node_modules/@play-co/odie/dist/core/EntityUtils.mjs","../../node_modules/@play-co/odie/dist/2d/core/view/View2DComponent.mjs","../../node_modules/@play-co/odie/dist/2d/core/Entity2D.mjs","../../node_modules/@play-co/odie/dist/utils/Signals.mjs","../../node_modules/@play-co/odie/dist/utils/Time.mjs","../../node_modules/@play-co/odie/dist/utils/SmoothTime.mjs","../../node_modules/@play-co/odie/dist/core/groups/Group.mjs","../../node_modules/@play-co/odie/dist/core/queries/QueryHelpers.mjs","../../node_modules/@play-co/odie/dist/core/queries/Query.mjs","../../node_modules/@play-co/odie/dist/core/queries/QueryManager.mjs","../../node_modules/@play-co/odie/dist/core/Scene.mjs","../../node_modules/@play-co/odie/dist/2d/core/view/View2DSystem.mjs","../../node_modules/@play-co/odie/dist/2d/core/Scene2D.mjs","../../src/shared/parts/registry.ts","../../src/shared/parts/definitions/simple-plate.ts","../../src/shared/parts/definitions/sliding-cover.ts","../../src/shared/parts/definitions/board-walnut-square.ts","../../src/shared/parts/definitions/board-oak-horizontal.ts","../../src/shared/parts/definitions/board-oak-vertical.ts","../../src/shared/parts/definitions/board-birch-square.ts","../../src/shared/parts/definitions/board-mahogany-square.ts","../../src/shared/parts/definitions/board-pine-horizontal.ts","../../src/shared/utils/geometry.ts","../../src/shared/utils/playArea.ts","../../src/shared/levels/loader.ts","../../src/shared/types/parts.types.ts","../../src/shared/ecs/defineComponent.ts","../../src/scenes/game/components/ScrewComponent.ts","../../src/scenes/game/components/PartComponent.ts","../../src/scenes/game/components/TrayComponent.ts","../../src/scenes/game/components/BufferTrayComponent.ts","../../src/scenes/game/components/GameStateComponent.ts","../../src/scenes/game/entities/ScrewEntity.ts","../../src/scenes/game/entities/PartEntity.ts","../../src/scenes/game/entities/TrayEntity.ts","../../src/scenes/game/entities/BufferTrayEntity.ts","../../src/scenes/game/factories/game-factories.ts","../../src/scenes/game/entities/GameStateEntity.ts","../../src/scenes/game/systems/BaseSystem.ts","../../src/scenes/game/utils/trayFrameLayout.ts","../../src/scenes/game/utils/bufferTrayLayout.ts","../../src/scenes/game/utils/trayPositions.ts","../../src/scenes/game/utils/GameEventBus.ts","../../src/scenes/game/utils/layerRegistry.ts","../../src/scenes/game/utils/gameLayout.ts","../../src/scenes/game/utils/GameTick.ts","../../src/scenes/game/systems/TrayManagementSystem.ts","../../src/scenes/game/systems/ScrewPlacementSystem.ts","../../src/scenes/game/systems/ScrewInteractionSystem.ts","../../src/scenes/game/systems/animation/types.ts","../../src/scenes/game/systems/animation/bezier.ts","../../src/scenes/game/systems/animation/AnimatorBase.ts","../../src/scenes/game/systems/animation/ScrewRemovalAnimator.ts","../../src/scenes/game/systems/animation/ScrewTransferAnimator.ts","../../src/scenes/game/systems/animation/TrayHideAnimator.ts","../../src/scenes/game/systems/animation/TrayShiftAnimator.ts","../../src/scenes/game/systems/animation/TrayRevealAnimator.ts","../../src/scenes/game/systems/AnimationSystem.ts","../../src/scenes/game/systems/AutoTransferSystem.ts","../../src/scenes/game/systems/WinConditionSystem.ts","../../src/shared/debug/errorCapture.ts","../../src/shared/debug/urlParams.ts","../../src/shared/debug/harness/ecsAccess.ts","../../src/shared/debug/harness/renderSignature.ts","../../src/shared/debug/harness/actionDsl.ts","../../src/shared/debug/consoleCapture.ts","../../src/shared/debug/bugReport.ts","../../src/shared/debug/ui/debugConsole.ts","../../src/shared/debug/index.ts","../../src/scenes/game/systems/TickSystem.ts","../../src/scenes/game/GameScene.ts","../../src/ui/screens/GameScreen.ts","../../src/app/config.ts","../../src/app/bootstrap.ts","../../src/main.ts"],"sourcesContent":["function clamp(value, min, max) {\n  return Math.max(min, Math.min(max, value));\n}\nfunction euclideanModulo(n, m) {\n  return (n % m + m) % m;\n}\nfunction mapLinear(x, a1, a2, b1, b2) {\n  return b1 + (x - a1) * (b2 - b1) / (a2 - a1);\n}\nfunction lerp(x, y, t) {\n  return (1 - t) * x + t * y;\n}\nfunction smoothstep(x, min, max) {\n  if (x <= min)\n    return 0;\n  if (x >= max)\n    return 1;\n  x = (x - min) / (max - min);\n  return x * x * (3 - 2 * x);\n}\nfunction smootherstep(x, min, max) {\n  if (x <= min)\n    return 0;\n  if (x >= max)\n    return 1;\n  x = (x - min) / (max - min);\n  return x * x * x * (x * (x * 6 - 15) + 10);\n}\nfunction smallestAngle(angle, targetAngle) {\n  angle %= Math.PI * 2;\n  if (angle < 0)\n    angle += Math.PI * 2;\n  const difference1 = targetAngle - angle;\n  const difference2 = targetAngle + Math.PI * 2 - angle;\n  const difference3 = targetAngle - Math.PI * 2 - angle;\n  const absDifference1 = Math.abs(difference1);\n  const absDifference2 = Math.abs(difference2);\n  const absDifference3 = Math.abs(difference3);\n  let difference = difference1;\n  if (absDifference2 < absDifference1 && absDifference2 < absDifference3) {\n    difference = difference2;\n  } else if (absDifference3 < absDifference1 && absDifference3 < absDifference2) {\n    difference = difference3;\n  }\n  return difference;\n}\nfunction round(value, precision) {\n  const multiplier = Math.pow(10, precision || 0);\n  return Math.round(value * multiplier) / multiplier;\n}\nfunction floor(value, precision) {\n  const multiplier = Math.pow(10, precision || 0);\n  return Math.floor(value * multiplier) / multiplier;\n}\nfunction containRange(value, bounds) {\n  if (value > bounds)\n    return value - bounds;\n  if (value < 0)\n    return value + bounds;\n  return value;\n}\nfunction containAngle(radians) {\n  return euclideanModulo(radians, Math.PI * 2);\n}\nfunction rotatePoint(point, angle) {\n  const cos = Math.cos(angle);\n  const sin = Math.sin(angle);\n  const x = cos * point.x - sin * point.y;\n  const y = cos * point.y + sin * point.x;\n  point.x = x;\n  point.y = y;\n}\nfunction aabbIntersect(rect1, rect2) {\n  return rect1.x < rect2.x + rect2.width && rect1.x + rect1.width > rect2.x && rect1.y < rect2.y + rect2.height && rect1.y + rect1.height > rect2.y;\n}\nfunction nextPow2(v) {\n  v += v === 0 ? 1 : 0;\n  --v;\n  v |= v >>> 1;\n  v |= v >>> 2;\n  v |= v >>> 4;\n  v |= v >>> 8;\n  v |= v >>> 16;\n  return v + 1;\n}\nfunction log2(v) {\n  let r = (v > 65535 ? 1 : 0) << 4;\n  v >>>= r;\n  let shift = (v > 255 ? 1 : 0) << 3;\n  v >>>= shift;\n  r |= shift;\n  shift = (v > 15 ? 1 : 0) << 2;\n  v >>>= shift;\n  r |= shift;\n  shift = (v > 3 ? 1 : 0) << 1;\n  v >>>= shift;\n  r |= shift;\n  return r | v >> 1;\n}\nexport {\n  aabbIntersect,\n  clamp,\n  containAngle,\n  containRange,\n  euclideanModulo,\n  floor,\n  lerp,\n  log2,\n  mapLinear,\n  nextPow2,\n  rotatePoint,\n  round,\n  smallestAngle,\n  smootherstep,\n  smoothstep\n};\n//# sourceMappingURL=Math.mjs.map\n","class Vector2 {\n  /**\n   * Constructs a new Vector2 with the given x and y coordinates. If no arguments are provided, the vector is initialized to (0, 0).\n   *\n   * @param x The x coordinate. Defaults to 0.\n   * @param y The y coordinate. Defaults to 0.\n   */\n  constructor(x, y) {\n    this.x = x || 0;\n    this.y = y || 0;\n  }\n  /**\n   * Gets the width component of the vector, which is equivalent to its x coordinate.\n   */\n  get width() {\n    return this.x;\n  }\n  /**\n   * Sets the width component of the vector, which is equivalent to its x coordinate.\n   */\n  set width(value) {\n    this.x = value;\n  }\n  /**\n   * Gets the height component of the vector, which is equivalent to its y coordinate.\n   */\n  get height() {\n    return this.y;\n  }\n  /**\n   * Sets the height component of the vector, which is equivalent to its y coordinate.\n   */\n  set height(value) {\n    this.y = value;\n  }\n  /**\n   * Sets both the x and y coordinates of the vector to the given scalar.\n   *\n   * @param scalar The scalar to set both coordinates to.\n   * @returns This vector after setting the new coordinates.\n   */\n  setScalar(scalar) {\n    this.x = scalar;\n    this.y = scalar;\n    return this;\n  }\n  /**\n   * Sets the x and y coordinates of the vector.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   * @returns This vector after setting the new coordinates.\n   */\n  set(x, y) {\n    this.x = x;\n    this.y = y;\n    return this;\n  }\n  /**\n   * Creates a new Vector2 with the same x and y coordinates as this one.\n   *\n   * @returns A new Vector2 with the same coordinates as this one.\n   */\n  clone() {\n    return new Vector2(this.x, this.y);\n  }\n  /**\n   * Copies the x and y coordinates from another vector to this one.\n   *\n   * @param v The vector to copy coordinates from.\n   * @returns This vector after copying the coordinates.\n   */\n  copy(v) {\n    this.x = v.x;\n    this.y = v.y;\n    return this;\n  }\n  /**\n   * Adds the x and y coordinates of another vector to this one.\n   *\n   * @param v The vector to add to this one.\n   * @returns This vector after adding the other vector's coordinates.\n   */\n  add(v) {\n    this.x += v.x;\n    this.y += v.y;\n    return this;\n  }\n  /**\n   * Adds a scalar to both the x and y coordinates of this vector.\n   *\n   * @param scalar The scalar to add.\n   * @returns This vector after adding the scalar.\n   */\n  addScalar(s) {\n    this.x += s;\n    this.y += s;\n    return this;\n  }\n  /**\n   * Adds the x and y coordinates of two other vectors to this one.\n   *\n   * @param v1 The first vector to add.\n   * @param v2 The second vector to add.\n   * @returns This vector after adding the other vectors' coordinates.\n   */\n  addVectors(a, b) {\n    this.x = a.x + b.x;\n    this.y = a.y + b.y;\n    return this;\n  }\n  /**\n   * Adds a scaled version of another vector to this one.\n   *\n   * @param v The vector to scale and add.\n   * @param scale The amount to scale the other vector by.\n   * @returns This vector after adding the scaled vector.\n   */\n  addScaledVector(v, s) {\n    this.x += v.x * s;\n    this.y += v.y * s;\n    return this;\n  }\n  /**\n   * Subtracts the x and y coordinates of another vector from this one.\n   *\n   * @param v The vector to subtract.\n   * @returns This vector after subtracting the other vector's coordinates.\n   */\n  sub(v) {\n    this.x -= v.x;\n    this.y -= v.y;\n    return this;\n  }\n  /**\n   * Subtracts a scalar from both the x and y coordinates of this vector.\n   *\n   * @param scalar The scalar to subtract.\n   * @returns This vector after subtracting the scalar.\n   */\n  subScalar(s) {\n    this.x -= s;\n    this.y -= s;\n    return this;\n  }\n  /**\n   * Subtracts the x and y coordinates of the second vector from the first one and sets the result to this vector.\n   *\n   * @param a The vector to subtract from.\n   * @param b The vector to subtract.\n   * @returns This vector after subtracting the second vector's coordinates from the first one.\n   */\n  subVectors(a, b) {\n    this.x = a.x - b.x;\n    this.y = a.y - b.y;\n    return this;\n  }\n  /**\n   * Multiplies the x and y coordinates of this vector by the corresponding coordinates of another vector.\n   *\n   * @param v The vector to multiply by.\n   * @returns This vector after multiplying by the other vector's coordinates.\n   */\n  multiply(v) {\n    this.x *= v.x;\n    this.y *= v.y;\n    return this;\n  }\n  /**\n   * Multiplies the x and y coordinates of this vector by a scalar.\n   *\n   * @param scalar The scalar to multiply by.\n   * @returns This vector after multiplying by the scalar.\n   */\n  multiplyScalar(scalar) {\n    this.x *= scalar;\n    this.y *= scalar;\n    return this;\n  }\n  /**\n   * Divides the x and y coordinates of this vector by the corresponding coordinates of another vector.\n   *\n   * @param v The vector to divide by.\n   * @returns This vector after dividing by the other vector's coordinates.\n   */\n  divide(v) {\n    this.x /= v.x;\n    this.y /= v.y;\n    return this;\n  }\n  /**\n   * Divides the x and y coordinates of this vector by a scalar.\n   *\n   * @param scalar The scalar to divide by.\n   * @returns This vector after dividing by the scalar.\n   */\n  divideScalar(scalar) {\n    return this.multiplyScalar(1 / scalar);\n  }\n  /**\n   * Sets each component of this vector to be the minimum of its current value and the value of the same component in the given vector.\n   *\n   * @param v The vector to compare with.\n   * @returns This vector after applying the operation.\n   */\n  min(v) {\n    this.x = Math.min(this.x, v.x);\n    this.y = Math.min(this.y, v.y);\n    return this;\n  }\n  /**\n   * Sets each component of this vector to be the maximum of its current value and the value of the same component in the given vector.\n   *\n   * @param v The vector to compare with.\n   * @returns This vector after applying the operation.\n   */\n  max(v) {\n    this.x = Math.max(this.x, v.x);\n    this.y = Math.max(this.y, v.y);\n    return this;\n  }\n  /**\n   * Clamps this vector to be within the range of the min and max vectors.\n   *\n   * @param min The minimum vector.\n   * @param max The maximum vector.\n   * @returns This vector after applying the operation.\n   */\n  clamp(min2, max2) {\n    this.x = Math.max(min2.x, Math.min(max2.x, this.x));\n    this.y = Math.max(min2.y, Math.min(max2.y, this.y));\n    return this;\n  }\n  /**\n   * Clamps this vector to be within the range of the min and max scalars.\n   *\n   * @param min The minimum scalar.\n   * @param max The maximum scalar.\n   * @returns This vector after applying the operation.\n   */\n  clampScalar(minVal, maxVal) {\n    min.set(minVal, minVal);\n    max.set(maxVal, maxVal);\n    return this.clamp(min, max);\n  }\n  /**\n   * Clamps the length of this vector to be within the range of the min and max lengths.\n   *\n   * @param min The minimum length.\n   * @param max The maximum length.\n   * @returns This vector after applying the operation.\n   */\n  clampLength(min2, max2) {\n    const length = this.length();\n    return this.divideScalar(length || 1).multiplyScalar(Math.max(min2, Math.min(max2, length)));\n  }\n  /**\n   * Floors each component of this vector.\n   *\n   * @returns This vector after applying the operation.\n   */\n  floor() {\n    this.x = Math.floor(this.x);\n    this.y = Math.floor(this.y);\n    return this;\n  }\n  /**\n   * Ceils each component of this vector.\n   *\n   * @returns This vector after applying the operation.\n   */\n  ceil() {\n    this.x = Math.ceil(this.x);\n    this.y = Math.ceil(this.y);\n    return this;\n  }\n  /**\n   * Rounds each component of this vector.\n   *\n   * @returns This vector after applying the operation.\n   */\n  round() {\n    this.x = Math.round(this.x);\n    this.y = Math.round(this.y);\n    return this;\n  }\n  /**\n   * Rounds each component of this vector towards zero.\n   *\n   * @returns This vector after applying the operation.\n   */\n  roundToZero() {\n    this.x = this.x < 0 ? Math.ceil(this.x) : Math.floor(this.x);\n    this.y = this.y < 0 ? Math.ceil(this.y) : Math.floor(this.y);\n    return this;\n  }\n  /**\n   * Negates each component of this vector, effectively flipping its direction.\n   *\n   * @returns This vector after applying the operation.\n   */\n  negate() {\n    this.x = -this.x;\n    this.y = -this.y;\n    return this;\n  }\n  /**\n   * Calculates and returns the dot product of this vector and another one.\n   *\n   * @param v The other vector.\n   * @returns The dot product of the two vectors.\n   */\n  dot(v) {\n    return this.x * v.x + this.y * v.y;\n  }\n  /**\n   * Calculates and returns the cross product of this vector and another one.\n   *\n   * @param v The other vector.\n   * @returns The cross product of the two vectors.\n   */\n  cross(v) {\n    return this.x * v.y - this.y * v.x;\n  }\n  /**\n   * Calculates and returns the squared length (magnitude) of this vector.\n   *\n   * @returns The squared length of this vector.\n   */\n  lengthSq() {\n    return this.x * this.x + this.y * this.y;\n  }\n  /**\n   * Calculates and returns the length (magnitude) of this vector.\n   *\n   * @returns The length of this vector.\n   */\n  length() {\n    return Math.sqrt(this.x * this.x + this.y * this.y);\n  }\n  /**\n   * Calculates and returns the Manhattan length (sum of the absolute values of its components) of this vector.\n   *\n   * @returns The Manhattan length of this vector.\n   */\n  manhattanLength() {\n    return Math.abs(this.x) + Math.abs(this.y);\n  }\n  /**\n   * Normalizes this vector (makes it have a length of 1) in-place.\n   *\n   * @returns This vector after normalization.\n   */\n  normalize() {\n    return this.divideScalar(this.length() || 1);\n  }\n  /**\n   * Calculates and returns the angle (in radians) between this vector and the x-axis.\n   *\n   * @returns The angle between this vector and the x-axis.\n   */\n  angle() {\n    let angle = Math.atan2(this.y, this.x);\n    if (angle < 0)\n      angle += 2 * Math.PI;\n    return angle;\n  }\n  /**\n   * Calculates and returns the Euclidean distance between this vector and another one.\n   *\n   * @param v The other vector.\n   * @returns The distance between this vector and the other one.\n   */\n  distanceTo(v) {\n    return Math.sqrt(this.distanceToSquared(v));\n  }\n  /**\n   * Calculates and returns the squared Euclidean distance between this vector and another one.\n   *\n   * @param v The other vector.\n   * @returns The squared distance between this vector and the other one.\n   */\n  distanceToSquared(v) {\n    const dx = this.x - v.x;\n    const dy = this.y - v.y;\n    return dx * dx + dy * dy;\n  }\n  /**\n   * Calculates and returns the Manhattan distance (sum of the absolute differences of their coordinates) between this vector and another one.\n   *\n   * @param v The other vector.\n   * @returns The Manhattan distance between this vector and the other one.\n   */\n  manhattanDistanceTo(v) {\n    return Math.abs(this.x - v.x) + Math.abs(this.y - v.y);\n  }\n  /**\n   * Sets the length (magnitude) of this vector to the given value, while preserving its direction.\n   *\n   * @param length The new length.\n   * @returns This vector after changing its length.\n   */\n  setLength(length) {\n    return this.normalize().multiplyScalar(length);\n  }\n  /**\n   * Linearly interpolates between this vector and another one.\n   *\n   * @param v The other vector.\n   * @param alpha The interpolation factor. 0 will leave the vector unchanged, and 1 will set the vector to be equal to the other vector.\n   * @returns This vector after the interpolation.\n   */\n  lerp(v, alpha) {\n    this.x += (v.x - this.x) * alpha;\n    this.y += (v.y - this.y) * alpha;\n    return this;\n  }\n  /**\n   * Linearly interpolates between two vectors and sets the result to this vector.\n   *\n   * @param v1 The first vector.\n   * @param v2 The second vector.\n   * @param alpha The interpolation factor. 0 will set the vector to be equal to the first vector, and 1 will set the vector to be equal to the second vector.\n   * @returns This vector after the interpolation.\n   */\n  lerpVectors(v1, v2, alpha) {\n    return this.subVectors(v2, v1).multiplyScalar(alpha).add(v1);\n  }\n  /**\n   * Checks if this vector is equal to another one.\n   *\n   * @param v The other vector.\n   * @returns True if the vectors are equal, false otherwise.\n   */\n  equals(v) {\n    return v.x === this.x && v.y === this.y;\n  }\n  /**\n   * Sets the components of this vector from an array.\n   *\n   * @param array The array containing the new values.\n   * @param offset (Optional) An offset into the array. The first component will be set to array[offset], and the second component will be set to array[offset + 1]. If the offset is not given, it is assumed to be 0.\n   * @returns This vector after setting the new values.\n   */\n  fromArray(array, offset) {\n    if (offset === void 0)\n      offset = 0;\n    this.x = array[offset];\n    this.y = array[offset + 1];\n    return this;\n  }\n  /**\n   * Returns an array containing the components of this vector.\n   *\n   * @param array (Optional) The array to put the values into. If this is not provided, a new array will be created.\n   * @param offset (Optional) An offset into the array. The first component will be stored in array[offset], and the second component will be stored in array[offset + 1]. If the offset is not given, it is assumed to be 0.\n   * @returns The array containing the components of this vector.\n   */\n  toArray(array, offset) {\n    if (array === void 0)\n      array = [];\n    if (offset === void 0)\n      offset = 0;\n    array[offset] = this.x;\n    array[offset + 1] = this.y;\n    return array;\n  }\n  /**\n   * Rotates this vector around a point in the counter-clockwise direction.\n   *\n   * @param center The point to rotate around.\n   * @param angle The angle to rotate by, in radians.\n   * @returns This vector after the rotation.\n   */\n  rotateAround(center, angle) {\n    const c = Math.cos(angle);\n    const s = Math.sin(angle);\n    const x = this.x - center.x;\n    const y = this.y - center.y;\n    this.x = x * c - y * s + center.x;\n    this.y = x * s + y * c + center.y;\n    return this;\n  }\n}\nconst min = new Vector2();\nconst max = new Vector2();\nexport {\n  Vector2\n};\n//# sourceMappingURL=Vector2.mjs.map\n","const throttleMap = /* @__PURE__ */ new Map();\nfunction throttle(fun, delay = 100, scope) {\n  if (!throttleMap.has(fun)) {\n    let timerId = null;\n    const throttledFunction = (...args) => {\n      throttleMap.get(fun).args = args;\n      if (timerId)\n        return;\n      const callFun = () => {\n        timerId = null;\n        const latestArgs = throttleMap.get(fun).args;\n        if (scope) {\n          fun.call(scope, ...latestArgs);\n        } else {\n          fun(...latestArgs);\n        }\n      };\n      if (delay === 0) {\n        callFun();\n      } else {\n        timerId = setTimeout(callFun, delay);\n      }\n    };\n    throttleMap.set(fun, { throttledFunction, args: null });\n  }\n  return throttleMap.get(fun).throttledFunction;\n}\nexport {\n  throttle\n};\n//# sourceMappingURL=throttle.mjs.map\n","class Lock {\n  constructor() {\n    this._locked = false;\n  }\n  /**\n   * Getter for the `_locked` property.\n   *\n   * @returns The current lock state.\n   */\n  get locked() {\n    return this._locked;\n  }\n  /**\n   * Tries to acquire the lock. If the lock is already acquired, it returns false.\n   * Otherwise, it acquires the lock and returns true.\n   *\n   * @returns True if the lock was successfully acquired, false otherwise.\n   */\n  lock() {\n    if (this._locked) {\n      return false;\n    }\n    this._locked = true;\n    return true;\n  }\n  /**\n   * Releases the lock.\n   */\n  unlock() {\n    this._locked = false;\n  }\n}\nexport {\n  Lock\n};\n//# sourceMappingURL=Lock.mjs.map\n","class NakedPromise extends Promise {\n  /**\n   * Creates a new NakedPromise.\n   *\n   * @param executor A callback used to initialize the promise. This callback is passed two arguments:\n   * a resolve callback used to resolve the promise with a value or the result of another promise,\n   * and a reject callback used to reject the promise with a reason.\n   */\n  constructor(executor) {\n    let capturedResolve = void 0;\n    let capturedReject = void 0;\n    super((resolve, reject) => {\n      capturedResolve = resolve;\n      capturedReject = reject;\n      executor == null ? void 0 : executor(resolve, reject);\n    });\n    this.resolve = capturedResolve;\n    this.reject = capturedReject;\n  }\n}\nexport {\n  NakedPromise\n};\n//# sourceMappingURL=NakedPromise.mjs.map\n","class URLParams {\n  constructor(url) {\n    this._params = this._getParams(url ?? location.search);\n  }\n  /**\n   * Gets a parameter by name returning the same type as the fallback type.\n   *\n   * @param key - Name of parameter to get\n   */\n  get(name, fallback) {\n    const type = typeof fallback;\n    if (type === \"number\")\n      return this.getNumber(name, fallback);\n    if (type === \"boolean\")\n      return this.getBoolean(name, fallback);\n    return this.getString(name, fallback);\n  }\n  /**\n   * Get URL parameter as string\n   *\n   * @param name - Name of the parameter\n   * @param fallback - Fallback if not found\n   */\n  getString(name, fallback) {\n    return this._params.paramsString.has(name) ? this._params.paramsString.get(name) : fallback;\n  }\n  /**\n   * Get URL parameter as number\n   *\n   * @param name - Name of the parameter\n   * @param fallback - Fallback if not found\n   */\n  getNumber(name, fallback) {\n    return this._params.paramsNumber.has(name) ? this._params.paramsNumber.get(name) : fallback;\n  }\n  /**\n   * Get URL parameter as boolean\n   *\n   * @param name - Name of the parameter\n   * @param fallback - Fallback if not found\n   */\n  getBoolean(name, fallback) {\n    return this._params.paramsBoolean.has(name) ? this._params.paramsBoolean.get(name) : fallback;\n  }\n  /**\n   * Gets all URL parameters as strings\n   *\n   * @returns An object containing all the params by name\n   */\n  getAll() {\n    return this._params.paramsString;\n  }\n  /**\n   * Get url params and converts all them to string, number and boolean\n   * Done this way to prevent a situation where a parameter is '01' and the app wants exactly like\n   * that as string, but if that gets automatically parsed to a number, then becomes '1'.\n   * That could be done at 'get' time, but is faster to pre-parse all of them at once.\n   *\n   * @returns An object containing all values parsed as string, number and boolean.\n   */\n  _getParams(url) {\n    const items = url.slice(url.indexOf(\"?\") + 1).split(\"&\");\n    const paramsString = /* @__PURE__ */ new Map();\n    const paramsNumber = /* @__PURE__ */ new Map();\n    const paramsBoolean = /* @__PURE__ */ new Map();\n    for (const item of items) {\n      const split = item.split(\"=\");\n      const k = split[0];\n      const v = split[1] ?? \"true\";\n      paramsString.set(k, v);\n      paramsNumber.set(k, Number(v));\n      paramsBoolean.set(k, v.toLowerCase() !== \"false\");\n    }\n    return { paramsString, paramsNumber, paramsBoolean };\n  }\n}\nexport {\n  URLParams\n};\n//# sourceMappingURL=URLParams.mjs.map\n","import { gsap } from \"gsap\";\nimport { Ticker } from \"pixi.js\";\nfunction limitFPS(fps = 60) {\n  Ticker.shared.maxFPS = fps;\n  Ticker.system.maxFPS = fps;\n  gsap.ticker.fps(fps);\n}\nexport {\n  limitFPS\n};\n//# sourceMappingURL=limitFPS.mjs.map\n","function getPixiRunnerData(runner) {\n  return { name: runner[\"_name\"], items: runner.items };\n}\nclass Prioritiser {\n  constructor(runners, getter, getItem) {\n    this._priorities = [];\n    this._result = {\n      priority: \"after\",\n      runner: \"start\",\n      plugin1: null,\n      plugin2: null\n    };\n    this._runners = runners;\n    this._getRunner = getter;\n    this._getItem = getItem || ((item) => item);\n  }\n  /** returns the chaining functions. */\n  get prioritise() {\n    if (!this._runnerChain) {\n      this._buildChain();\n    }\n    return this._runnerChain;\n  }\n  /** running this will apply the priorities to the runners */\n  applyPrioritise() {\n    this._priorities.forEach((result) => {\n      this._prioritise(result);\n    });\n  }\n  /** builds out the chaining functions that make prioritising easier. */\n  _buildChain() {\n    this._actionChain = {\n      before: (plugin, data) => {\n        this._result.priority = \"before\";\n        this._result.plugin2 = { item: plugin, data };\n        this._priorities.push({\n          ...this._result\n        });\n      },\n      after: (plugin, data) => {\n        this._result.priority = \"after\";\n        this._result.plugin2 = { item: plugin, data };\n        this._priorities.push({\n          ...this._result\n        });\n      },\n      first: () => {\n        this._result.priority = \"first\";\n        this._priorities.push({\n          ...this._result\n        });\n      },\n      last: () => {\n        this._result.priority = \"last\";\n        this._priorities.push({\n          ...this._result\n        });\n      }\n    };\n    const runners = this._runners;\n    this._runnerChain = this._runnerChain ?? runners.reduce(\n      (b, runner) => {\n        const runnerName = this._getRunner(runner).name;\n        b[runnerName] = (plugin, data) => {\n          this._result.plugin1 = { item: plugin, data };\n          this._result.runner = runnerName;\n          return this._actionChain;\n        };\n        return b;\n      },\n      {}\n    );\n  }\n  _prioritise(priority) {\n    const runner = this._runners.find((runner2) => this._getRunner(runner2).name === priority.runner);\n    if (!runner) return;\n    const plugin1 = this._getItem(priority.plugin1.item, priority.plugin1.data);\n    const items = this._getRunner(runner).items;\n    const index1 = items.indexOf(plugin1);\n    if (index1 === -1) return;\n    items.splice(index1, 1);\n    if (priority.priority === \"first\") {\n      items.unshift(plugin1);\n    } else if (priority.priority === \"last\") {\n      items.push(plugin1);\n    } else {\n      const plugin2 = this._getItem(priority.plugin2.item, priority.plugin2.data);\n      const index2 = items.indexOf(plugin2);\n      if (index2 === -1) return;\n      if (priority.priority === \"before\") {\n        items.splice(index2, 0, plugin1);\n      } else if (priority.priority === \"after\") {\n        items.splice(index2 + 1, 0, plugin1);\n      }\n    }\n  }\n}\nexport {\n  Prioritiser,\n  getPixiRunnerData\n};\n//# sourceMappingURL=Prioritiser.mjs.map\n","async function promiseRunner(runner) {\n  const { items, name } = runner;\n  for (const item of items) {\n    await item[name]();\n  }\n}\nasync function promiseAllRunner(runner) {\n  const promises = [];\n  const { items, name } = runner;\n  for (const item of items) {\n    promises.push(item[name]());\n  }\n  await Promise.all(promises);\n}\nexport {\n  promiseAllRunner,\n  promiseRunner\n};\n//# sourceMappingURL=promiseRunner.mjs.map\n","class AssetMonitor {\n  constructor() {\n    this.blockingAssetsTrackingState = {\n      state: \"blockingAssets\",\n      size: 0,\n      startTime: performance.now(),\n      endTime: 0,\n      count: 0\n    };\n    this.gameAssetsTrackingState = { state: \"gameAssets\", size: 0, count: 0 };\n    this.currentAssetState = \"blockingAssets\";\n  }\n  start() {\n    this.blockingAssetsTrackingState.startTime = performance.now();\n  }\n  getState() {\n    return {\n      blockingAssetsCount: this.blockingAssetsTrackingState.count,\n      blockingAssetsSize: this.blockingAssetsTrackingState.size,\n      blockingAssetsTime: this.blockingAssetsTrackingState.endTime && this.blockingAssetsTrackingState.startTime ? this.blockingAssetsTrackingState.endTime - this.blockingAssetsTrackingState.startTime : 0,\n      gameAssetsCount: this.gameAssetsTrackingState.count,\n      gameAssetsSize: this.gameAssetsTrackingState.size,\n      allAssetsSize: this.blockingAssetsTrackingState.size + this.gameAssetsTrackingState.size,\n      allAssetsCount: this.blockingAssetsTrackingState.count + this.gameAssetsTrackingState.count\n    };\n  }\n  /** Track asset loading progress */\n  trackAsset(sizes) {\n    if (this.currentAssetState === \"blockingAssets\") {\n      this.blockingAssetsTrackingState.count += sizes.length;\n      this.blockingAssetsTrackingState.size += sizes.reduce((acc, size) => acc + size, 0);\n    } else {\n      this.gameAssetsTrackingState.count += sizes.length;\n      this.gameAssetsTrackingState.size += sizes.reduce((acc, size) => acc + size, 0);\n    }\n  }\n  /** Switch the current asset state */\n  switchAssetState(state) {\n    if (this.currentAssetState === \"blockingAssets\" && state === \"gameAssets\") {\n      this.blockingAssetsTrackingState.endTime = performance.now();\n      this.gameAssetsTrackingState.startTime = this.blockingAssetsTrackingState.endTime;\n    }\n    this.currentAssetState = state;\n  }\n}\nexport {\n  AssetMonitor\n};\n//# sourceMappingURL=AssetMonitor.mjs.map\n","class FPSMonitor {\n  constructor(id, trackTail = true) {\n    this._TAIL_WINDOW_SECONDS = 3;\n    this._SESSION_FPS_SAMPLE_MAX = 5e3;\n    this._SEGMENT_FPS_SAMPLE_MAX = 1e3;\n    this._realtime = {\n      stdDevCount: 0,\n      stdDevMean: 0,\n      stdDevSquared: 0,\n      ticks: 0,\n      fpsTime: 0\n    };\n    this.id = id;\n    this.startTime = performance.now();\n    this.perf = { stdDevCount: 0, stdDevMean: 0, stdDevSquared: 0, ticks: 0, fpsTime: 0 };\n    this.fpsSamples = [];\n    this.fpsSampleCount = 0;\n    this.worstWindowFPS = Infinity;\n    this.trackTail = trackTail;\n    if (trackTail) this.frameWindow = [];\n  }\n  update(clampedDelta, timeNow) {\n    const frameFPS = Math.min(1e3 / clampedDelta, 60);\n    if (this.id === \"session\") {\n      this._updateVariance(clampedDelta, this._realtime);\n      this._updateFPS(clampedDelta, this._realtime);\n    }\n    this._updateVariance(clampedDelta, this.perf);\n    this._updateFPS(clampedDelta, this.perf);\n    this.addFPSSample(this, frameFPS);\n    if (this.trackTail && this.frameWindow) this.updateRollingWindow(timeNow, this);\n  }\n  getStats(ended, now = performance.now()) {\n    const fps = this._getFPS(this.perf);\n    const ch = this._getVariance(this.perf);\n    const chSample = this._getVarianceSample(this.perf);\n    const { fpsPercentile1, fpsPercentile5, fpsPercentile95, fpsPercentile99 } = this._computePercentiles(\n      this.fpsSamples\n    );\n    return {\n      id: this.id,\n      startTime: this.startTime,\n      endTime: ended ? now : void 0,\n      durationMs: now - this.startTime,\n      frames: this.perf.ticks,\n      fps,\n      choppiness: ch,\n      choppinessSample: chSample,\n      fpsPercentile1,\n      fpsPercentile5,\n      fpsPercentile95,\n      fpsPercentile99,\n      tailFPS: this.trackTail && isFinite(this.worstWindowFPS) ? this.worstWindowFPS : void 0,\n      active: !ended\n    };\n  }\n  resetRealTimeStats() {\n    this._realtime.fpsTime = 0;\n    this._realtime.stdDevCount = 0;\n    this._realtime.stdDevMean = 0;\n    this._realtime.stdDevSquared = 0;\n    this._realtime.ticks = 0;\n  }\n  /** The average FPS (frames per second) */\n  get fps() {\n    return this._getFPS(this.perf);\n  }\n  /** The realtime FPS (frames per second) */\n  get realtimeFPS() {\n    return this._getFPS(this._realtime);\n  }\n  /** The average DT variance */\n  get choppiness() {\n    return this._getVariance(this.perf);\n  }\n  /** The average DT sample variance */\n  get choppinessSample() {\n    return this._getVarianceSample(this.perf);\n  }\n  /** The realtime DT variance */\n  get realtimeChoppiness() {\n    return this._getVariance(this._realtime);\n  }\n  /** The realtime DT sample variance */\n  get realtimeChoppinessSample() {\n    return this._getVarianceSample(this._realtime);\n  }\n  /** The average tail FPS */\n  get tailFPS() {\n    return isFinite(this.worstWindowFPS) ? this.worstWindowFPS : void 0;\n  }\n  /** The average rolling window size in seconds */\n  get tailWindowSeconds() {\n    return this._TAIL_WINDOW_SECONDS;\n  }\n  // https://en.wikipedia.org/wiki/Algorithms_for_calculating_variance#Welford's_online_algorithm\n  _updateVariance(value, stats) {\n    stats.stdDevCount++;\n    const delta = value - stats.stdDevMean;\n    stats.stdDevMean += delta / stats.stdDevCount;\n    const delta2 = value - stats.stdDevMean;\n    stats.stdDevSquared += delta * delta2;\n  }\n  _getVariance(stats) {\n    if (stats.stdDevCount === 0) return 0;\n    return stats.stdDevSquared / stats.stdDevCount;\n  }\n  _getVarianceSample(stats) {\n    if (stats.stdDevCount === 0) return 0;\n    return stats.stdDevSquared / (stats.stdDevCount - 1);\n  }\n  _updateFPS(delta, stats) {\n    stats.fpsTime += delta;\n    stats.ticks++;\n  }\n  _getFPS(stats) {\n    if (stats.ticks === 0) return 0;\n    const raw = 1e3 / (stats.fpsTime / stats.ticks);\n    return Math.min(raw, 60);\n  }\n  /** Reservoir sample add for a segment (Algorithm R) */\n  addFPSSample(seg, fps) {\n    seg.fpsSampleCount++;\n    const count = seg.fpsSampleCount;\n    const max = seg.id === \"session\" ? this._SESSION_FPS_SAMPLE_MAX : this._SEGMENT_FPS_SAMPLE_MAX;\n    if (seg.fpsSamples.length < max) {\n      seg.fpsSamples.push(fps);\n    } else {\n      const r = Math.floor(Math.random() * count);\n      if (r < max) seg.fpsSamples[r] = fps;\n    }\n  }\n  /** Update per-segment rolling window FPS (worst window) if tail tracking enabled. */\n  updateRollingWindow(frameTime, seg) {\n    const windowMs = this._TAIL_WINDOW_SECONDS * 1e3;\n    const fw = seg.frameWindow;\n    fw.push({ t: frameTime });\n    while (fw.length && frameTime - fw[0].t > windowMs) fw.shift();\n    if (fw.length > 1) {\n      const duration = frameTime - fw[0].t;\n      if (duration > 0) {\n        const fps = Math.min((fw.length - 1) / (duration / 1e3), 60);\n        if (fps < seg.worstWindowFPS) seg.worstWindowFPS = fps;\n      }\n    }\n  }\n  /** Compute percentile (1..99) using nearest-rank on a sorted copy of sample set */\n  _computePercentiles(samples) {\n    if (!samples.length) {\n      return { fpsPercentile1: 0, fpsPercentile5: 0, fpsPercentile95: 0, fpsPercentile99: 0 };\n    }\n    const sorted = [...samples].sort((a, b) => a - b);\n    const pick = (p) => {\n      const rank = Math.min(sorted.length, Math.max(1, Math.ceil(p / 100 * sorted.length)));\n      return sorted[rank - 1];\n    };\n    return {\n      fpsPercentile1: pick(1),\n      fpsPercentile5: pick(5),\n      fpsPercentile95: pick(95),\n      fpsPercentile99: pick(99)\n    };\n  }\n}\nexport {\n  FPSMonitor\n};\n//# sourceMappingURL=FPSMonitor.mjs.map\n","import { round } from \"@play-co/commons\";\nconst gpuTextureFormatSize = {\n  r8unorm: 1,\n  r8snorm: 1,\n  r8uint: 1,\n  r8sint: 1,\n  r16uint: 2,\n  r16sint: 2,\n  r16float: 2,\n  rg8unorm: 2,\n  rg8snorm: 2,\n  rg8uint: 2,\n  rg8sint: 2,\n  r32float: 4,\n  r32uint: 4,\n  r32sint: 4,\n  rg16uint: 4,\n  rg16sint: 4,\n  rg16float: 4,\n  rgba8unorm: 4,\n  \"rgba8unorm-srgb\": 4,\n  rgba8snorm: 4,\n  rgba8uint: 4,\n  rgba8sint: 4,\n  bgra8unorm: 4,\n  \"bgra8unorm-srgb\": 4,\n  rgb10a2unorm: 4,\n  rg11b10ufloat: 4,\n  rgb9e5ufloat: 4,\n  rg32float: 8,\n  rg32uint: 8,\n  rg32sint: 8,\n  rgba16uint: 8,\n  rgba16sint: 8,\n  rgba16float: 8,\n  rgba32float: 16,\n  rgba32uint: 16,\n  rgba32sint: 16,\n  depth16unorm: 2,\n  depth24plus: 3,\n  \"depth24plus-stencil8\": 4,\n  depth32float: 4,\n  stencil8: 1,\n  \"depth32float-stencil8\": 5\n};\nconst glTextureFormatSize = {\n  6408: 4,\n  6407: 3,\n  33319: 2,\n  6403: 1,\n  36249: 4,\n  36248: 3,\n  33320: 2,\n  36244: 1,\n  6406: 1,\n  6409: 1,\n  6410: 2,\n  6402: 1,\n  34041: 2\n};\nclass GPUMonitor {\n  constructor() {\n    this._gpuTextureSize = /* @__PURE__ */ new Map();\n  }\n  start(renderer) {\n    this._renderer = renderer;\n  }\n  update() {\n    if (!this._renderer) return { textureCount: 0, sizeInMb: 0 };\n    const data = this._get();\n    let textureCount = 0;\n    let totalSize = 0;\n    for (const texture of data) {\n      if (!texture.destroyed && texture.isLoaded) {\n        textureCount++;\n        totalSize += texture.gpuSize;\n      }\n    }\n    const sizeInMb = round(totalSize / 1024 / 1024, 1);\n    return {\n      textureCount,\n      sizeInMb\n    };\n  }\n  _get() {\n    const currentTextures = this._renderer.texture.managedTextures;\n    const glTextures = this._getWebTextures();\n    const data = [];\n    currentTextures.forEach((texture) => {\n      if (!(texture == null ? void 0 : texture.resource)) return;\n      if (!this._gpuTextureSize.has(texture.uid)) {\n        const size = this._getMemorySize(texture, glTextures[texture.uid]);\n        if (size) {\n          this._gpuTextureSize.set(texture.uid, size);\n        }\n      }\n      data.push({\n        gpuSize: this._gpuTextureSize.get(texture.uid) || 0,\n        destroyed: texture.destroyed,\n        isLoaded: !!glTextures[texture.uid]\n      });\n    });\n    return data;\n  }\n  _getWebTextures() {\n    const renderer = this._renderer;\n    let glTextures = {};\n    const textureSystem = renderer.texture;\n    if (\"_glTextures\" in textureSystem || \"_gpuSources\" in textureSystem) {\n      glTextures = \"_glTextures\" in textureSystem ? textureSystem._glTextures : textureSystem._gpuSources;\n    } else {\n      const managedTextures = textureSystem.managedTextures;\n      glTextures = managedTextures.reduce(\n        (acc, texture) => {\n          if (!texture) return acc;\n          const gpuData = texture._gpuData[this._renderer.uid];\n          if (!gpuData) return acc;\n          acc[texture.uid] = \"gpuTexture\" in gpuData ? gpuData.gpuTexture : gpuData;\n          return acc;\n        },\n        {}\n      );\n    }\n    return glTextures;\n  }\n  _getMemorySize(texture, webTexture) {\n    if (!webTexture) return null;\n    if (Array.isArray(texture.resource) && texture.resource[0] instanceof Uint8Array) {\n      return texture.resource.reduce((acc, res) => acc + res.byteLength, 0);\n    }\n    if (typeof webTexture.format === \"string\" && gpuTextureFormatSize[webTexture.format]) {\n      return webTexture.width * webTexture.height * gpuTextureFormatSize[webTexture.format];\n    } else if (typeof webTexture.format === \"number\" && glTextureFormatSize[webTexture.format]) {\n      return webTexture.width * webTexture.height * glTextureFormatSize[webTexture.format];\n    }\n    return null;\n  }\n}\nexport {\n  GPUMonitor\n};\n//# sourceMappingURL=GPUMonitor.mjs.map\n","import { Ticker } from \"pixi.js\";\nimport { AssetMonitor } from \"./AssetMonitor.mjs\";\nimport { FPSMonitor } from \"./FPSMonitor.mjs\";\nimport { GPUMonitor } from \"./GPUMonitor.mjs\";\nconst ANALYTICS_TIMER = 60 * 1e3;\nconst MAX_FRAME_DT = 2 * 1e3;\nconst START_TRACKING_AFTER = 20 * 1e3;\nclass PerformanceTrackerClass {\n  constructor() {\n    this.assetMonitor = new AssetMonitor();\n    this._paused = false;\n    this._isFirstEvent = true;\n    this._lastTickTime = 0;\n    this._systemThrottled = false;\n    this._peakSizeInMb = 0;\n    this._deviceScreenRefresh = 0;\n    this._LIKELY_HZ = [15, 30, 60, 90, 120];\n    this._rafSamplingStarted = false;\n    this._timeTo = {};\n    this._gpuMonitor = new GPUMonitor();\n    this._segments = /* @__PURE__ */ new Map();\n    this._warningLastEmit = /* @__PURE__ */ Object.create(null);\n    this._GPU_WARNING_THRESHOLD_MB = 200 * 0.9;\n  }\n  init(trackFunction, addSelf = true, warningFunction) {\n    this._trackFunction = trackFunction;\n    this._warningFunction = warningFunction;\n    this.startSegment(\"session\", { trackTail: true });\n    setInterval(() => this._trackAnalytics(), ANALYTICS_TIMER);\n    this._startDisplayHzSampling();\n    if (addSelf) Ticker.shared.add(this.update, this);\n  }\n  /**\n   * Start tracking a named performance segment (e.g., 'level-1').\n   * If the id is already active this is a no-op.\n   *\n   * @param id Unique segment identifier.\n   * @param options Segment options (e.g., enable per-segment tail FPS computation).\n   */\n  startSegment(id, options) {\n    if (this._segments.has(id)) return;\n    const trackTail = (options == null ? void 0 : options.trackTail) ?? true;\n    this._segments.set(id, new FPSMonitor(id, trackTail));\n  }\n  /**\n   * End a segment and return its final aggregated performance data snapshot.\n   * The ended segment is removed from active tracking and will no longer appear\n   * in subsequent analytics pulse snapshots.\n   *\n   * @param id Segment identifier.\n   * @returns Final `SegmentPerformanceData` or undefined if id not active.\n   */\n  endSegment(id) {\n    const seg = this._segments.get(id);\n    if (!seg) return void 0;\n    const data = this._buildSegmentData(seg, true);\n    this._segments.delete(id);\n    return data;\n  }\n  /**\n   * Get an array of currently active segment ids.\n   * Useful for debugging or UI overlays.\n   */\n  getActiveSegments() {\n    return Array.from(this._segments.keys());\n  }\n  /** The used JS heap size if available (undefined if not supported) */\n  get jsHeapSizeUsed() {\n    var _a;\n    return (_a = performance == null ? void 0 : performance.memory) == null ? void 0 : _a.usedJSHeapSize;\n  }\n  /** The total JS heap size if available (undefined if not supported) */\n  get jsHeapSizeTotal() {\n    var _a;\n    return (_a = performance == null ? void 0 : performance.memory) == null ? void 0 : _a.totalJSHeapSize;\n  }\n  /** The JS heap size limit if available (undefined if not supported) */\n  get jsHeapSizeLimit() {\n    var _a;\n    return (_a = performance == null ? void 0 : performance.memory) == null ? void 0 : _a.jsHeapSizeLimit;\n  }\n  /** The average FPS (frames per second) */\n  get fps() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.fps) ?? 0;\n  }\n  /** The realtime FPS (frames per second) */\n  get realtimeFPS() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.realtimeFPS) ?? 0;\n  }\n  /** The average DT variance */\n  get choppiness() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.choppiness) ?? 0;\n  }\n  /** The average DT sample variance */\n  get choppinessSample() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.choppinessSample) ?? 0;\n  }\n  /** The realtime DT variance */\n  get realtimeChoppiness() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.realtimeChoppiness) ?? 0;\n  }\n  /** The realtime DT sample variance */\n  get realtimeChoppinessSample() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.realtimeChoppinessSample) ?? 0;\n  }\n  /** The average tail FPS */\n  get tailFPS() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.tailFPS) ?? 0;\n  }\n  /** The average rolling window size in seconds */\n  get tailWindowSeconds() {\n    var _a;\n    return ((_a = this._segments.get(\"session\")) == null ? void 0 : _a.tailWindowSeconds) ?? 0;\n  }\n  /** The detected (approx) display refresh rate (Hz) */\n  get deviceScreenRefresh() {\n    return this._deviceScreenRefresh || void 0;\n  }\n  /** Peak VRAM usage (MB) across the whole session */\n  get peakSizeInMb() {\n    return this._peakSizeInMb;\n  }\n  /** True if VRAM peak exceeded the warning threshold */\n  get vramPeakExceeded() {\n    return this._peakSizeInMb >= 200;\n  }\n  /** True if low power mode is active (FPS calculations paused) */\n  get systemThrottled() {\n    return this._systemThrottled;\n  }\n  startGPUMonitoring(renderer) {\n    this._gpuMonitor.start(renderer);\n  }\n  /**\n   * Update performance tracking.\n   */\n  update() {\n    if (this._paused) return;\n    const timeNow = performance.now();\n    const delta = timeNow - this._lastTickTime;\n    if (this._lastTickTime !== 0 && delta < MAX_FRAME_DT && timeNow > START_TRACKING_AFTER) {\n      const clampedDelta = this._capDeltaFor60(delta);\n      if (this._segments.size) {\n        for (const seg of this._segments.values()) {\n          seg.update(clampedDelta, timeNow);\n        }\n      }\n    }\n    this._lastTickTime = timeNow;\n  }\n  /**\n   * Pause tracking performance data.\n   */\n  pause() {\n    this._paused = true;\n  }\n  /**\n   * Resume tracking performance data.\n   */\n  resume() {\n    this._paused = false;\n  }\n  /**\n   * Reset all performance tracking data and segments.\n   * This clears all accumulated statistics, segments, and tracking state.\n   * Useful for starting fresh measurements or between game sessions.\n   */\n  reset() {\n    this.assetMonitor.blockingAssetsTrackingState = {\n      state: \"blockingAssets\",\n      size: 0,\n      startTime: performance.now(),\n      endTime: 0,\n      count: 0\n    };\n    this.assetMonitor.gameAssetsTrackingState = { state: \"gameAssets\", size: 0, count: 0 };\n    this.assetMonitor.currentAssetState = \"blockingAssets\";\n    this._paused = false;\n    this._isFirstEvent = true;\n    this._lastTickTime = 0;\n    this._systemThrottled = false;\n    this._peakSizeInMb = 0;\n    this._deviceScreenRefresh = 0;\n    this._rafSamplingStarted = false;\n    this._timeTo = {};\n    this._segments.clear();\n    this._warningLastEmit = /* @__PURE__ */ Object.create(null);\n    this.startSegment(\"session\", { trackTail: true });\n    this._startDisplayHzSampling();\n    return this;\n  }\n  /**\n   * Track time when a specific 'timeTo' event occurs.\n   *\n   * @param key - The key of the 'timeTo' event to track\n   */\n  trackTimeTo(key) {\n    const event = `timeTo${key.charAt(0).toUpperCase() + key.slice(1)}`;\n    this._timeTo[event] = Math.round(window.performance.now()) / 1e3;\n  }\n  _trackAnalytics() {\n    if (this._paused) return;\n    const gpu = this._gpuMonitor.update();\n    if (gpu.sizeInMb > this._peakSizeInMb) this._peakSizeInMb = gpu.sizeInMb;\n    this._checkGpuWarning(gpu.sizeInMb);\n    this._checkSystemMemoryWarning();\n    const segmentSnapshots = [];\n    const nowTs = performance.now();\n    let sessionSnapshot;\n    if (this._segments.size) {\n      for (const seg of this._segments.values()) {\n        const snap = this._buildSegmentData(seg, false, nowTs);\n        if (seg.id === \"session\") sessionSnapshot = snap;\n        else segmentSnapshots.push(snap);\n      }\n    }\n    const session = this._segments.get(\"session\");\n    const perfData = {\n      ...sessionSnapshot,\n      isFirst: this._isFirstEvent,\n      realtimeFPS: session.realtimeFPS,\n      realtimeChoppiness: session.realtimeChoppiness,\n      realtimeChoppinessSample: session.realtimeChoppinessSample,\n      jsHeapSizeLimit: this.jsHeapSizeLimit,\n      jsHeapSizeTotal: this.jsHeapSizeTotal,\n      jsHeapSizeUsed: this.jsHeapSizeUsed,\n      tailWindowSeconds: session.tailWindowSeconds,\n      textureCount: gpu.textureCount,\n      sizeInMb: gpu.sizeInMb,\n      peakSizeInMb: this._peakSizeInMb,\n      vramPeakExceeded: this.vramPeakExceeded,\n      deviceScreenRefresh: this.deviceScreenRefresh,\n      ...this.assetMonitor.getState(),\n      ...this._timeTo\n    };\n    this._trackFunction(perfData, segmentSnapshots);\n    session.resetRealTimeStats();\n    this._isFirstEvent = false;\n  }\n  _capDeltaFor60(delta) {\n    const MIN_DELTA = 1e3 / 60;\n    return delta < MIN_DELTA ? MIN_DELTA : delta;\n  }\n  _startDisplayHzSampling() {\n    var _a;\n    if (this._deviceScreenRefresh || this._rafSamplingStarted) return;\n    const w = typeof window !== \"undefined\" ? window : void 0;\n    const rAF = (_a = w == null ? void 0 : w.requestAnimationFrame) == null ? void 0 : _a.bind(w);\n    if (!rAF) return;\n    this._rafSamplingStarted = true;\n    let frameCount = 0;\n    const startTime = performance.now();\n    const SAMPLE_DURATION_MS = 1e3;\n    const HARD_TIMEOUT_MS = 2500;\n    const finish = (now) => {\n      if (this._deviceScreenRefresh) return;\n      const elapsed = Math.max(1, now - startTime);\n      const estimate = frameCount / (elapsed / 1e3);\n      this._deviceScreenRefresh = this._snapHz(estimate);\n      if (this._deviceScreenRefresh <= 30) {\n        this._systemThrottled = true;\n      }\n    };\n    const step = (t) => {\n      if (this._deviceScreenRefresh) return;\n      frameCount++;\n      const elapsed = t - startTime;\n      if (elapsed >= SAMPLE_DURATION_MS || frameCount >= 300) {\n        finish(t);\n        return;\n      }\n      rAF(step);\n    };\n    rAF(step);\n    setTimeout(() => {\n      if (!this._deviceScreenRefresh) finish(performance.now());\n    }, HARD_TIMEOUT_MS);\n  }\n  _snapHz(fps) {\n    let best = fps;\n    let diff = Infinity;\n    for (const hz of this._LIKELY_HZ) {\n      const d = Math.abs(hz - fps);\n      if (d < diff) {\n        diff = d;\n        best = hz;\n      }\n    }\n    if (Math.abs(best - fps) / fps > 0.15) return Math.round(fps);\n    return Math.round(best);\n  }\n  /**\n   * Build an immutable snapshot for a segment (active or ended) computing derived metrics\n   * like percentiles on-demand. Sorting occurs only for the segment's bounded reservoir samples.\n   */\n  _buildSegmentData(seg, ended, now = performance.now()) {\n    return { ...seg.getStats(ended, now), systemThrottled: this._systemThrottled };\n  }\n  /**\n   * Emit a performance warning if its cooldown has elapsed.\n   * Built-in emitters: 'gpuMemoryHigh', 'systemMemoryHigh'.\n   * Custom callers can emit arbitrary types to integrate with quality scaling logic.\n   *\n   * @param type Arbitrary warning identifier.\n   * @param data Context object (type-specific) serialized to callback.\n   * @param cooldownMs Minimum ms between repeated warnings of this type (default 5m).\n   */\n  emitWarning(type, data, cooldownMs = 2 * 60 * 1e3) {\n    if (!this._warningFunction) return false;\n    const now = performance.now();\n    const last = this._warningLastEmit[type];\n    if (last !== void 0 && now - last < cooldownMs) return false;\n    this._warningLastEmit[type] = now;\n    this._warningFunction({ type, data, at: now });\n    return true;\n  }\n  // 90% of 200MB heuristic cap\n  /** Built-in GPU memory high watermark warning helper (uses generic emitWarning API). */\n  _checkGpuWarning(currentMb) {\n    if (currentMb >= this._GPU_WARNING_THRESHOLD_MB) {\n      this.emitWarning(\"gpuMemoryHigh\", {\n        sizeInMb: currentMb,\n        peakSizeInMb: this._peakSizeInMb,\n        thresholdMb: this._GPU_WARNING_THRESHOLD_MB\n      });\n    }\n  }\n  /** Built-in System memory high warning helper (>=90% of reported JS heap limit). */\n  _checkSystemMemoryWarning() {\n    const used = this.jsHeapSizeUsed;\n    const limit = this.jsHeapSizeLimit;\n    if (!used || !limit) return;\n    if (limit <= 0) return;\n    const ratio = used / limit;\n    if (ratio >= 0.9) {\n      this.emitWarning(\"systemMemoryHigh\", { jsHeapSizeUsed: used, jsHeapSizeLimit: limit, ratio });\n    }\n  }\n}\nconst PerformanceTracker = new PerformanceTrackerClass();\nexport {\n  PerformanceTracker\n};\n//# sourceMappingURL=PerformanceTracker.mjs.map\n","import { Ticker, SystemRunner } from \"pixi.js\";\nimport { limitFPS } from \"../../utils/system/time/limitFPS.mjs\";\nimport { Prioritiser, getPixiRunnerData } from \"./Prioritiser.mjs\";\nimport { promiseAllRunner, promiseRunner } from \"../../utils/runners/promiseRunner.mjs\";\nimport { PerformanceTracker } from \"../../utils/system/monitor/PerformanceTracker.mjs\";\nclass Application {\n  /**\n   * @param config - config for the application\n   */\n  constructor(config = {}) {\n    this._defaultPluginName = \"default\";\n    this.runners = [];\n    this.setupRunner = this.addRunner(\"setup\");\n    this.initRunner = this.addRunner(\"init\");\n    this.prepareRunner = this.addRunner(\"prepare\");\n    this.startRunner = this.addRunner(\"start\");\n    this.updateRunner = this.addRunner(\"update\");\n    this.config = config;\n    this.verbose = this.config.verbose ?? false;\n    this.plugins = /* @__PURE__ */ new Map();\n    this.pluginDefaults = /* @__PURE__ */ new Map();\n    this.config.limitFPS = this.config.limitFPS ?? 60;\n    if (this.config.limitFPS) {\n      limitFPS(this.config.limitFPS);\n    }\n    this._prioritiser = new Prioritiser(this.runners, getPixiRunnerData, (plugin, name) => this.get(plugin, name));\n  }\n  /**\n   * Add a plugin by class.\n   *\n   * @param type - Plugin class to be added.\n   * @param options - Options for the plugin. If a \"name\" is specified then options from the AppConfig will be applied.\n   * It is also used to differentiate between multiple plugins of the same class.\n   * @returns A plugin built from given class and options.\n   */\n  add(PluginClass, options) {\n    options = options || {};\n    const name = options.name;\n    const nameToRegister = name ?? this._defaultPluginName;\n    options = Object.assign(options, this.config[name] || {});\n    const plugin = new PluginClass(this, options);\n    const classPlugins = this.plugins.get(PluginClass) || {};\n    if (classPlugins[nameToRegister]) {\n      throw new Error(`app plugin ${nameToRegister} already exists`);\n    }\n    classPlugins[nameToRegister] = plugin;\n    if (!this.pluginDefaults.get(PluginClass)) {\n      this.pluginDefaults.set(PluginClass, nameToRegister);\n    }\n    this.runners.forEach((runner) => {\n      runner.add(plugin);\n    });\n    this.plugins.set(PluginClass, classPlugins);\n    return plugin;\n  }\n  /**\n   * Get a plugin by class. You can specify a name in order to get a certain plugin of a particular class.\n   *\n   * @param type - Plugin class to find.\n   * @param name - Used to get a specific plugin rather than the default.\n   * @returns A plugin found for given class.\n   */\n  get(pluginClass, name) {\n    const pluginName = name ?? this.pluginDefaults.get(pluginClass);\n    return this.plugins.get(pluginClass)[pluginName];\n  }\n  /**\n   * Calls the init, prepare, and starts runners in that order.\n   * Awaits each runners functions to ensure they are called in the correct order.\n   */\n  async init() {\n    this._prioritiser.applyPrioritise();\n    await promiseAllRunner(this.setupRunner);\n    await promiseRunner(this.initRunner);\n    Ticker.system.add(this.update, this);\n    await promiseRunner(this.prepareRunner);\n    await promiseRunner(this.startRunner);\n    PerformanceTracker.assetMonitor.switchAssetState(\"gameAssets\");\n  }\n  /**\n   * Calls the update runner\n   *\n   * @param ticker - pixi ticker.\n   */\n  update(ticker) {\n    this.updateRunner.emit(ticker.deltaTime);\n  }\n  /**\n   * Add a new runner for the application.\n   *\n   * @param name - The name of the new runner.\n   */\n  addRunner(name) {\n    const runner = new SystemRunner(name);\n    this.runners.push(runner);\n    return runner;\n  }\n  get prioritise() {\n    return this._prioritiser.prioritise;\n  }\n}\nexport {\n  Application\n};\n//# sourceMappingURL=Application.mjs.map\n","class Plugin {\n  constructor(app, options) {\n    this.app = app;\n    this.options = options || {};\n    this.verbose = (options == null ? void 0 : options.verbose) ?? app.verbose ?? false;\n  }\n}\nexport {\n  Plugin\n};\n//# sourceMappingURL=Plugin.mjs.map\n","function formatTextures(assets) {\n  var _a, _b;\n  for (const assetData of assets) {\n    const tags = (_a = assetData.data) == null ? void 0 : _a.tags;\n    const baseTexture = (_b = assetData.asset) == null ? void 0 : _b.source;\n    if (baseTexture) {\n      if (tags) {\n        if (tags.REPEAT) {\n          baseTexture.style.addressMode = \"repeat\";\n        }\n        if (tags.NEAREST) {\n          baseTexture.style.scaleMode = \"nearest\";\n        }\n      }\n    }\n  }\n}\nexport {\n  formatTextures\n};\n//# sourceMappingURL=formatTextures.mjs.map\n","import { ExtensionType, loadTextures } from \"pixi.js\";\nimport { formatTextures } from \"../utils/formatTextures.mjs\";\nconst loadTexturesWrapper = {\n  ...loadTextures,\n  extension: ExtensionType.LoadParser,\n  async load(url, loadAsset, loader) {\n    var _a, _b;\n    const res = await ((_b = (_a = loadTextures).load) == null ? void 0 : _b.call(_a, url, loadAsset, loader));\n    if (loadAsset) {\n      formatTextures([{ asset: res, data: loadAsset.data }]);\n    }\n    return res;\n  }\n};\nexport {\n  loadTexturesWrapper\n};\n//# sourceMappingURL=loadTexture.mjs.map\n","import { ExtensionType, loadWebFont } from \"pixi.js\";\nconst loadWebFontWrapper = {\n  ...loadWebFont,\n  extension: ExtensionType.LoadParser,\n  async load(url, loadAsset) {\n    var _a;\n    const validWeights = [\"normal\", \"bold\", \"100\", \"200\", \"300\", \"400\", \"500\", \"600\", \"700\", \"800\", \"900\"];\n    let weights = [];\n    const tags = ((_a = loadAsset == null ? void 0 : loadAsset.data) == null ? void 0 : _a.tags) || {};\n    if (tags.w) {\n      if (!Array.isArray(tags.w)) {\n        if (tags.w === \"all\") {\n          weights = validWeights;\n        } else {\n          weights.push(tags.w.toString());\n        }\n      } else {\n        weights.push(...tags.w.map((w) => w.toString()));\n      }\n    }\n    if (weights.length === 0) {\n      weights = [\"normal\"];\n    }\n    if (!weights.every((r) => validWeights.includes(r))) {\n      console.warn(`[loadWebFont] A font weight provided for ${url} is invalid`);\n    }\n    if (tags.w) {\n      loadAsset.data.weights = weights;\n    }\n    if (tags.family) {\n      loadAsset.data.family = tags.family;\n    }\n    return loadWebFont.load(url, loadAsset);\n  }\n};\nexport {\n  loadWebFontWrapper\n};\n//# sourceMappingURL=loadWebFont.mjs.map\n","import { ExtensionType, Resolver } from \"pixi.js\";\nconst atlasResolver = {\n  extension: {\n    type: ExtensionType.ResolveParser,\n    name: \"resolveSpineAtlas\"\n  },\n  test: (value) => {\n    const tempURL = value.split(\"?\")[0];\n    const split = tempURL.split(\".\");\n    const extension = split.pop();\n    const format = split.pop();\n    return extension === \"atlas\" && [\"png\", \"webp\", \"avif\"].includes(format);\n  },\n  parse: (value) => {\n    var _a;\n    const split = value.split(\".\");\n    return {\n      resolution: parseFloat(((_a = Resolver.RETINA_PREFIX.exec(value)) == null ? void 0 : _a[1]) ?? \"1\"),\n      format: split[split.length - 2],\n      src: value\n    };\n  }\n};\nexport {\n  atlasResolver\n};\n//# sourceMappingURL=spineParser.mjs.map\n","import { Assets, Spritesheet, Cache, convertToList } from \"pixi.js\";\nimport { PerformanceTracker } from \"../../utils/system/monitor/PerformanceTracker.mjs\";\nconst spritesheetHash = {};\nlet firstLoad = true;\nconst originalLoad = Assets.load;\nconst originalBackgroundLoad = Assets.backgroundLoad;\nconst mainOverride = (urls) => {\n  if (firstLoad) {\n    const manifest = Assets.resolver[\"_manifest\"];\n    if (manifest) {\n      manifest.bundles.forEach((bundle) => {\n        const assets = bundle.assets;\n        assets.forEach((asset) => {\n          if (asset.data.tags.tps && asset.data.frameNames) {\n            asset.data.frameNames.forEach((frameName) => {\n              spritesheetHash[frameName] = asset;\n            });\n          }\n        });\n      });\n      firstLoad = false;\n    }\n  }\n  const urlToSpritesheetMap = {};\n  const res = convertToList(urls, (url) => {\n    const spriteSheet = spritesheetHash[url];\n    if (spriteSheet) {\n      urlToSpritesheetMap[url] = spriteSheet;\n      return spriteSheet;\n    } else {\n      return url;\n    }\n  });\n  return { urlToSpritesheetMap, res };\n};\nfunction overrideAssetLoad() {\n  Assets.load = async (urls, onProgress) => {\n    const { res, urlToSpritesheetMap } = mainOverride(urls);\n    const originalResult = await originalLoad.bind(Assets)(res.length === 1 ? res[0] : res, onProgress);\n    let returnValue;\n    Object.entries(urlToSpritesheetMap).forEach(([key, _]) => {\n      const texture = originalResult[key];\n      if (!texture && !(originalResult instanceof Spritesheet)) {\n        originalResult[key] = Cache.get(key);\n        return;\n      }\n      returnValue = Cache.get(key);\n    });\n    const urlArray = Array.isArray(urls) ? urls : [urls];\n    const newUrls = urlArray.map((url) => typeof url === \"string\" ? url : url.alias[0]);\n    const progressSize = Object.values(Assets.resolver.resolve(newUrls)).map((u) => {\n      return u.progressSize ?? 1;\n    });\n    PerformanceTracker.assetMonitor.trackAsset(progressSize);\n    return returnValue ?? originalResult;\n  };\n  Assets.backgroundLoad = async (urls) => {\n    const { res } = mainOverride(urls);\n    const mappedRes = res.map((r) => {\n      return typeof r === \"string\" ? r : r.alias[0];\n    });\n    await originalBackgroundLoad.bind(Assets)(mappedRes);\n  };\n}\nexport {\n  overrideAssetLoad\n};\n//# sourceMappingURL=overrideAssetLoad.mjs.map\n","const warnings = {};\nfunction deprecation(version, message, ignoreDepth = 3) {\n  if (warnings[message]) {\n    return;\n  }\n  let stack = new Error().stack;\n  if (typeof stack === \"undefined\") {\n    console.warn(\"Astro Deprecation Warning: \", `${message}\nDeprecated since v${version}`);\n  } else {\n    stack = stack.split(\"\\n\").splice(ignoreDepth).join(\"\\n\");\n    if (console.groupCollapsed) {\n      console.groupCollapsed(\n        \"%cAstro Deprecation Warning: %c%s\",\n        \"color:#614108;background:#fffbe6\",\n        \"font-weight:normal;color:#614108;background:#fffbe6\",\n        `${message}\nDeprecated since v${version}`\n      );\n      console.warn(stack);\n      console.groupEnd();\n    } else {\n      console.warn(\"Astro Deprecation Warning: \", `${message}\nDeprecated since v${version}`);\n      console.warn(stack);\n    }\n  }\n  warnings[message] = true;\n}\nexport {\n  deprecation\n};\n//# sourceMappingURL=deprecation.mjs.map\n","/////////////////////////////////////////////////////////////////////////////////\n/* UAParser.js v1.0.41\n   Copyright  2012-2025 Faisal Salman <f@faisalman.com>\n   MIT License *//*\n   Detect Browser, Engine, OS, CPU, and Device type/model from User-Agent data.\n   Supports browser & node.js environment. \n   Demo   : https://faisalman.github.io/ua-parser-js\n   Source : https://github.com/faisalman/ua-parser-js */\n/////////////////////////////////////////////////////////////////////////////////\n\n(function (window, undefined) {\n\n    'use strict';\n\n    //////////////\n    // Constants\n    /////////////\n\n\n    var LIBVERSION  = '1.0.41',\n        EMPTY       = '',\n        UNKNOWN     = '?',\n        FUNC_TYPE   = 'function',\n        UNDEF_TYPE  = 'undefined',\n        OBJ_TYPE    = 'object',\n        STR_TYPE    = 'string',\n        MAJOR       = 'major',\n        MODEL       = 'model',\n        NAME        = 'name',\n        TYPE        = 'type',\n        VENDOR      = 'vendor',\n        VERSION     = 'version',\n        ARCHITECTURE= 'architecture',\n        CONSOLE     = 'console',\n        MOBILE      = 'mobile',\n        TABLET      = 'tablet',\n        SMARTTV     = 'smarttv',\n        WEARABLE    = 'wearable',\n        EMBEDDED    = 'embedded',\n        UA_MAX_LENGTH = 500;\n\n    var AMAZON  = 'Amazon',\n        APPLE   = 'Apple',\n        ASUS    = 'ASUS',\n        BLACKBERRY = 'BlackBerry',\n        BROWSER = 'Browser',\n        CHROME  = 'Chrome',\n        EDGE    = 'Edge',\n        FIREFOX = 'Firefox',\n        GOOGLE  = 'Google',\n        HONOR   = 'Honor',\n        HUAWEI  = 'Huawei',\n        LENOVO  = 'Lenovo',\n        LG      = 'LG',\n        MICROSOFT = 'Microsoft',\n        MOTOROLA  = 'Motorola',\n        NVIDIA  = 'Nvidia',\n        ONEPLUS = 'OnePlus',\n        OPERA   = 'Opera',\n        OPPO    = 'OPPO',\n        SAMSUNG = 'Samsung',\n        SHARP   = 'Sharp',\n        SONY    = 'Sony',\n        XIAOMI  = 'Xiaomi',\n        ZEBRA   = 'Zebra',\n        FACEBOOK    = 'Facebook',\n        CHROMIUM_OS = 'Chromium OS',\n        MAC_OS  = 'Mac OS',\n        SUFFIX_BROWSER = ' Browser';\n\n    ///////////\n    // Helper\n    //////////\n\n    var extend = function (regexes, extensions) {\n            var mergedRegexes = {};\n            for (var i in regexes) {\n                if (extensions[i] && extensions[i].length % 2 === 0) {\n                    mergedRegexes[i] = extensions[i].concat(regexes[i]);\n                } else {\n                    mergedRegexes[i] = regexes[i];\n                }\n            }\n            return mergedRegexes;\n        },\n        enumerize = function (arr) {\n            var enums = {};\n            for (var i=0; i<arr.length; i++) {\n                enums[arr[i].toUpperCase()] = arr[i];\n            }\n            return enums;\n        },\n        has = function (str1, str2) {\n            return typeof str1 === STR_TYPE ? lowerize(str2).indexOf(lowerize(str1)) !== -1 : false;\n        },\n        lowerize = function (str) {\n            return str.toLowerCase();\n        },\n        majorize = function (version) {\n            return typeof(version) === STR_TYPE ? version.replace(/[^\\d\\.]/g, EMPTY).split('.')[0] : undefined;\n        },\n        trim = function (str, len) {\n            if (typeof(str) === STR_TYPE) {\n                str = str.replace(/^\\s\\s*/, EMPTY);\n                return typeof(len) === UNDEF_TYPE ? str : str.substring(0, UA_MAX_LENGTH);\n            }\n    };\n\n    ///////////////\n    // Map helper\n    //////////////\n\n    var rgxMapper = function (ua, arrays) {\n\n            var i = 0, j, k, p, q, matches, match;\n\n            // loop through all regexes maps\n            while (i < arrays.length && !matches) {\n\n                var regex = arrays[i],       // even sequence (0,2,4,..)\n                    props = arrays[i + 1];   // odd sequence (1,3,5,..)\n                j = k = 0;\n\n                // try matching uastring with regexes\n                while (j < regex.length && !matches) {\n\n                    if (!regex[j]) { break; }\n                    matches = regex[j++].exec(ua);\n\n                    if (!!matches) {\n                        for (p = 0; p < props.length; p++) {\n                            match = matches[++k];\n                            q = props[p];\n                            // check if given property is actually array\n                            if (typeof q === OBJ_TYPE && q.length > 0) {\n                                if (q.length === 2) {\n                                    if (typeof q[1] == FUNC_TYPE) {\n                                        // assign modified match\n                                        this[q[0]] = q[1].call(this, match);\n                                    } else {\n                                        // assign given value, ignore regex match\n                                        this[q[0]] = q[1];\n                                    }\n                                } else if (q.length === 3) {\n                                    // check whether function or regex\n                                    if (typeof q[1] === FUNC_TYPE && !(q[1].exec && q[1].test)) {\n                                        // call function (usually string mapper)\n                                        this[q[0]] = match ? q[1].call(this, match, q[2]) : undefined;\n                                    } else {\n                                        // sanitize match using given regex\n                                        this[q[0]] = match ? match.replace(q[1], q[2]) : undefined;\n                                    }\n                                } else if (q.length === 4) {\n                                        this[q[0]] = match ? q[3].call(this, match.replace(q[1], q[2])) : undefined;\n                                }\n                            } else {\n                                this[q] = match ? match : undefined;\n                            }\n                        }\n                    }\n                }\n                i += 2;\n            }\n        },\n\n        strMapper = function (str, map) {\n\n            for (var i in map) {\n                // check if current value is array\n                if (typeof map[i] === OBJ_TYPE && map[i].length > 0) {\n                    for (var j = 0; j < map[i].length; j++) {\n                        if (has(map[i][j], str)) {\n                            return (i === UNKNOWN) ? undefined : i;\n                        }\n                    }\n                } else if (has(map[i], str)) {\n                    return (i === UNKNOWN) ? undefined : i;\n                }\n            }\n            return map.hasOwnProperty('*') ? map['*'] : str;\n    };\n\n    ///////////////\n    // String map\n    //////////////\n\n    // Safari < 3.0\n    var oldSafariMap = {\n            '1.0'   : '/8',\n            '1.2'   : '/1',\n            '1.3'   : '/3',\n            '2.0'   : '/412',\n            '2.0.2' : '/416',\n            '2.0.3' : '/417',\n            '2.0.4' : '/419',\n            '?'     : '/'\n        },\n        windowsVersionMap = {\n            'ME'        : '4.90',\n            'NT 3.11'   : 'NT3.51',\n            'NT 4.0'    : 'NT4.0',\n            '2000'      : 'NT 5.0',\n            'XP'        : ['NT 5.1', 'NT 5.2'],\n            'Vista'     : 'NT 6.0',\n            '7'         : 'NT 6.1',\n            '8'         : 'NT 6.2',\n            '8.1'       : 'NT 6.3',\n            '10'        : ['NT 6.4', 'NT 10.0'],\n            'RT'        : 'ARM'\n    };\n\n    //////////////\n    // Regex map\n    /////////////\n\n    var regexes = {\n\n        browser : [[\n\n            /\\b(?:crmo|crios)\\/([\\w\\.]+)/i                                      // Chrome for Android/iOS\n            ], [VERSION, [NAME, 'Chrome']], [\n            /edg(?:e|ios|a)?\\/([\\w\\.]+)/i                                       // Microsoft Edge\n            ], [VERSION, [NAME, 'Edge']], [\n\n            // Presto based\n            /(opera mini)\\/([-\\w\\.]+)/i,                                        // Opera Mini\n            /(opera [mobiletab]{3,6})\\b.+version\\/([-\\w\\.]+)/i,                 // Opera Mobi/Tablet\n            /(opera)(?:.+version\\/|[\\/ ]+)([\\w\\.]+)/i                           // Opera\n            ], [NAME, VERSION], [\n            /opios[\\/ ]+([\\w\\.]+)/i                                             // Opera mini on iphone >= 8.0\n            ], [VERSION, [NAME, OPERA+' Mini']], [\n            /\\bop(?:rg)?x\\/([\\w\\.]+)/i                                          // Opera GX\n            ], [VERSION, [NAME, OPERA+' GX']], [\n            /\\bopr\\/([\\w\\.]+)/i                                                 // Opera Webkit\n            ], [VERSION, [NAME, OPERA]], [\n\n            // Mixed\n            /\\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\\/ ]?([\\w\\.]+)/i            // Baidu\n            ], [VERSION, [NAME, 'Baidu']], [\n            /\\b(?:mxbrowser|mxios|myie2)\\/?([-\\w\\.]*)\\b/i                       // Maxthon\n            ], [VERSION, [NAME, 'Maxthon']], [\n            /(kindle)\\/([\\w\\.]+)/i,                                             // Kindle\n            /(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\\/ ]?([\\w\\.]*)/i,      \n                                                                                // Lunascape/Maxthon/Netfront/Jasmine/Blazer/Sleipnir\n            // Trident based\n            /(avant|iemobile|slim(?:browser|boat|jet))[\\/ ]?([\\d\\.]*)/i,        // Avant/IEMobile/SlimBrowser/SlimBoat/Slimjet\n            /(?:ms|\\()(ie) ([\\w\\.]+)/i,                                         // Internet Explorer\n\n            // Blink/Webkit/KHTML based                                         // Flock/RockMelt/Midori/Epiphany/Silk/Skyfire/Bolt/Iron/Iridium/PhantomJS/Bowser/QupZilla/Falkon\n            /(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\\/([-\\w\\.]+)/i,\n                                                                                // Rekonq/Puffin/Brave/Whale/QQBrowserLite/QQ//Vivaldi/DuckDuckGo/Klar/Helio/Dragon\n            /(heytap|ovi|115)browser\\/([\\d\\.]+)/i,                              // HeyTap/Ovi/115\n            /(weibo)__([\\d\\.]+)/i                                               // Weibo\n            ], [NAME, VERSION], [\n            /quark(?:pc)?\\/([-\\w\\.]+)/i                                         // Quark\n            ], [VERSION, [NAME, 'Quark']], [\n            /\\bddg\\/([\\w\\.]+)/i                                                 // DuckDuckGo\n            ], [VERSION, [NAME, 'DuckDuckGo']], [\n            /(?:\\buc? ?browser|(?:juc.+)ucweb)[\\/ ]?([\\w\\.]+)/i                 // UCBrowser\n            ], [VERSION, [NAME, 'UC'+BROWSER]], [\n            /microm.+\\bqbcore\\/([\\w\\.]+)/i,                                     // WeChat Desktop for Windows Built-in Browser\n            /\\bqbcore\\/([\\w\\.]+).+microm/i,\n            /micromessenger\\/([\\w\\.]+)/i                                        // WeChat\n            ], [VERSION, [NAME, 'WeChat']], [\n            /konqueror\\/([\\w\\.]+)/i                                             // Konqueror\n            ], [VERSION, [NAME, 'Konqueror']], [\n            /trident.+rv[: ]([\\w\\.]{1,9})\\b.+like gecko/i                       // IE11\n            ], [VERSION, [NAME, 'IE']], [\n            /ya(?:search)?browser\\/([\\w\\.]+)/i                                  // Yandex\n            ], [VERSION, [NAME, 'Yandex']], [\n            /slbrowser\\/([\\w\\.]+)/i                                             // Smart Lenovo Browser\n            ], [VERSION, [NAME, 'Smart Lenovo '+BROWSER]], [\n            /(avast|avg)\\/([\\w\\.]+)/i                                           // Avast/AVG Secure Browser\n            ], [[NAME, /(.+)/, '$1 Secure '+BROWSER], VERSION], [\n            /\\bfocus\\/([\\w\\.]+)/i                                               // Firefox Focus\n            ], [VERSION, [NAME, FIREFOX+' Focus']], [\n            /\\bopt\\/([\\w\\.]+)/i                                                 // Opera Touch\n            ], [VERSION, [NAME, OPERA+' Touch']], [\n            /coc_coc\\w+\\/([\\w\\.]+)/i                                            // Coc Coc Browser\n            ], [VERSION, [NAME, 'Coc Coc']], [\n            /dolfin\\/([\\w\\.]+)/i                                                // Dolphin\n            ], [VERSION, [NAME, 'Dolphin']], [\n            /coast\\/([\\w\\.]+)/i                                                 // Opera Coast\n            ], [VERSION, [NAME, OPERA+' Coast']], [\n            /miuibrowser\\/([\\w\\.]+)/i                                           // MIUI Browser\n            ], [VERSION, [NAME, 'MIUI' + SUFFIX_BROWSER]], [\n            /fxios\\/([\\w\\.-]+)/i                                                // Firefox for iOS\n            ], [VERSION, [NAME, FIREFOX]], [\n            /\\bqihoobrowser\\/?([\\w\\.]*)/i                                       // 360\n            ], [VERSION, [NAME, '360']], [\n            /\\b(qq)\\/([\\w\\.]+)/i                                                // QQ\n            ], [[NAME, /(.+)/, '$1Browser'], VERSION], [\n            /(oculus|sailfish|huawei|vivo|pico)browser\\/([\\w\\.]+)/i\n            ], [[NAME, /(.+)/, '$1' + SUFFIX_BROWSER], VERSION], [              // Oculus/Sailfish/HuaweiBrowser/VivoBrowser/PicoBrowser\n            /samsungbrowser\\/([\\w\\.]+)/i                                        // Samsung Internet\n            ], [VERSION, [NAME, SAMSUNG + ' Internet']], [\n            /metasr[\\/ ]?([\\d\\.]+)/i                                            // Sogou Explorer\n            ], [VERSION, [NAME, 'Sogou Explorer']], [\n            /(sogou)mo\\w+\\/([\\d\\.]+)/i                                          // Sogou Mobile\n            ], [[NAME, 'Sogou Mobile'], VERSION], [\n            /(electron)\\/([\\w\\.]+) safari/i,                                    // Electron-based App\n            /(tesla)(?: qtcarbrowser|\\/(20\\d\\d\\.[-\\w\\.]+))/i,                   // Tesla\n            /m?(qqbrowser|2345(?=browser|chrome|explorer))\\w*[\\/ ]?v?([\\w\\.]+)/i   // QQ/2345\n            ], [NAME, VERSION], [\n            /(lbbrowser|rekonq)/i,                                              // LieBao Browser/Rekonq\n            /\\[(linkedin)app\\]/i                                                // LinkedIn App for iOS & Android\n            ], [NAME], [\n            /ome\\/([\\w\\.]+) \\w* ?(iron) saf/i,                                  // Iron\n            /ome\\/([\\w\\.]+).+qihu (360)[es]e/i                                  // 360\n            ], [VERSION, NAME], [\n\n            // WebView\n            /((?:fban\\/fbios|fb_iab\\/fb4a)(?!.+fbav)|;fbav\\/([\\w\\.]+);)/i       // Facebook App for iOS & Android\n            ], [[NAME, FACEBOOK], VERSION], [\n            /(Klarna)\\/([\\w\\.]+)/i,                                             // Klarna Shopping Browser for iOS & Android\n            /(kakao(?:talk|story))[\\/ ]([\\w\\.]+)/i,                             // Kakao App\n            /(naver)\\(.*?(\\d+\\.[\\w\\.]+).*\\)/i,                                  // Naver InApp\n            /(daum)apps[\\/ ]([\\w\\.]+)/i,                                        // Daum App\n            /safari (line)\\/([\\w\\.]+)/i,                                        // Line App for iOS\n            /\\b(line)\\/([\\w\\.]+)\\/iab/i,                                        // Line App for Android\n            /(alipay)client\\/([\\w\\.]+)/i,                                       // Alipay\n            /(twitter)(?:and| f.+e\\/([\\w\\.]+))/i,                               // Twitter\n            /(chromium|instagram|snapchat)[\\/ ]([-\\w\\.]+)/i                     // Chromium/Instagram/Snapchat\n            ], [NAME, VERSION], [\n            /\\bgsa\\/([\\w\\.]+) .*safari\\//i                                      // Google Search Appliance on iOS\n            ], [VERSION, [NAME, 'GSA']], [\n            /musical_ly(?:.+app_?version\\/|_)([\\w\\.]+)/i                        // TikTok\n            ], [VERSION, [NAME, 'TikTok']], [\n\n            /headlesschrome(?:\\/([\\w\\.]+)| )/i                                  // Chrome Headless\n            ], [VERSION, [NAME, CHROME+' Headless']], [\n\n            / wv\\).+(chrome)\\/([\\w\\.]+)/i                                       // Chrome WebView\n            ], [[NAME, CHROME+' WebView'], VERSION], [\n\n            /droid.+ version\\/([\\w\\.]+)\\b.+(?:mobile safari|safari)/i           // Android Browser\n            ], [VERSION, [NAME, 'Android '+BROWSER]], [\n\n            /(chrome|omniweb|arora|[tizenoka]{5} ?browser)\\/v?([\\w\\.]+)/i       // Chrome/OmniWeb/Arora/Tizen/Nokia\n            ], [NAME, VERSION], [\n\n            /version\\/([\\w\\.\\,]+) .*mobile\\/\\w+ (safari)/i                      // Mobile Safari\n            ], [VERSION, [NAME, 'Mobile Safari']], [\n            /version\\/([\\w(\\.|\\,)]+) .*(mobile ?safari|safari)/i                // Safari & Safari Mobile\n            ], [VERSION, NAME], [\n            /webkit.+?(mobile ?safari|safari)(\\/[\\w\\.]+)/i                      // Safari < 3.0\n            ], [NAME, [VERSION, strMapper, oldSafariMap]], [\n\n            /(webkit|khtml)\\/([\\w\\.]+)/i\n            ], [NAME, VERSION], [\n\n            // Gecko based\n            /(navigator|netscape\\d?)\\/([-\\w\\.]+)/i                              // Netscape\n            ], [[NAME, 'Netscape'], VERSION], [\n            /(wolvic|librewolf)\\/([\\w\\.]+)/i                                    // Wolvic/LibreWolf\n            ], [NAME, VERSION], [\n            /mobile vr; rv:([\\w\\.]+)\\).+firefox/i                               // Firefox Reality\n            ], [VERSION, [NAME, FIREFOX+' Reality']], [\n            /ekiohf.+(flow)\\/([\\w\\.]+)/i,                                       // Flow\n            /(swiftfox)/i,                                                      // Swiftfox\n            /(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\\/ ]?([\\w\\.\\+]+)/i,\n                                                                                // IceDragon/Iceweasel/Camino/Chimera/Fennec/Maemo/Minimo/Conkeror\n            /(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\\/([-\\w\\.]+)$/i,\n                                                                                // Firefox/SeaMonkey/K-Meleon/IceCat/IceApe/Firebird/Phoenix\n            /(firefox)\\/([\\w\\.]+)/i,                                            // Other Firefox-based\n            /(mozilla)\\/([\\w\\.]+) .+rv\\:.+gecko\\/\\d+/i,                         // Mozilla\n\n            // Other\n            /(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\\. ]?browser)[-\\/ ]?v?([\\w\\.]+)/i,\n                                                                                // Polaris/Lynx/Dillo/iCab/Doris/Amaya/w3m/NetSurf/Obigo/Mosaic/Go/ICE/UP.Browser/Ladybird\n            /\\b(links) \\(([\\w\\.]+)/i                                            // Links\n            ], [NAME, [VERSION, /_/g, '.']], [\n            \n            /(cobalt)\\/([\\w\\.]+)/i                                              // Cobalt\n            ], [NAME, [VERSION, /master.|lts./, \"\"]]\n        ],\n\n        cpu : [[\n\n            /\\b((amd|x|x86[-_]?|wow|win)64)\\b/i                                 // AMD64 (x64)\n            ], [[ARCHITECTURE, 'amd64']], [\n\n            /(ia32(?=;))/i,                                                     // IA32 (quicktime)\n            /\\b((i[346]|x)86)(pc)?\\b/i                                          // IA32 (x86)\n            ], [[ARCHITECTURE, 'ia32']], [\n\n            /\\b(aarch64|arm(v?[89]e?l?|_?64))\\b/i                               // ARM64\n            ], [[ARCHITECTURE, 'arm64']], [\n\n            /\\b(arm(v[67])?ht?n?[fl]p?)\\b/i                                     // ARMHF\n            ], [[ARCHITECTURE, 'armhf']], [\n\n            // PocketPC mistakenly identified as PowerPC\n            /( (ce|mobile); ppc;|\\/[\\w\\.]+arm\\b)/i\n            ], [[ARCHITECTURE, 'arm']], [\n\n            /((ppc|powerpc)(64)?)( mac|;|\\))/i                                  // PowerPC\n            ], [[ARCHITECTURE, /ower/, EMPTY, lowerize]], [\n\n            / sun4\\w[;\\)]/i                                                     // SPARC\n            ], [[ARCHITECTURE, 'sparc']], [\n\n            /\\b(avr32|ia64(?=;)|68k(?=\\))|\\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\\b|pa-risc)/i\n                                                                                // IA64, 68K, ARM/64, AVR/32, IRIX/64, MIPS/64, SPARC/64, PA-RISC\n            ], [[ARCHITECTURE, lowerize]]\n        ],\n\n        device : [[\n\n            //////////////////////////\n            // MOBILES & TABLETS\n            /////////////////////////\n\n            // Samsung\n            /\\b(sch-i[89]0\\d|shw-m380s|sm-[ptx]\\w{2,4}|gt-[pn]\\d{2,4}|sgh-t8[56]9|nexus 10)/i\n            ], [MODEL, [VENDOR, SAMSUNG], [TYPE, TABLET]], [\n            /\\b((?:s[cgp]h|gt|sm)-(?![lr])\\w+|sc[g-]?[\\d]+a?|galaxy nexus)/i,\n            /samsung[- ]((?!sm-[lr])[-\\w]+)/i,\n            /sec-(sgh\\w+)/i\n            ], [MODEL, [VENDOR, SAMSUNG], [TYPE, MOBILE]], [\n\n            // Apple\n            /(?:\\/|\\()(ip(?:hone|od)[\\w, ]*)(?:\\/|;)/i                          // iPod/iPhone\n            ], [MODEL, [VENDOR, APPLE], [TYPE, MOBILE]], [\n            /\\((ipad);[-\\w\\),; ]+apple/i,                                       // iPad\n            /applecoremedia\\/[\\w\\.]+ \\((ipad)/i,\n            /\\b(ipad)\\d\\d?,\\d\\d?[;\\]].+ios/i\n            ], [MODEL, [VENDOR, APPLE], [TYPE, TABLET]], [\n            /(macintosh);/i\n            ], [MODEL, [VENDOR, APPLE]], [\n\n            // Sharp\n            /\\b(sh-?[altvz]?\\d\\d[a-ekm]?)/i\n            ], [MODEL, [VENDOR, SHARP], [TYPE, MOBILE]], [\n\n            // Honor\n            /\\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\\)|;)/i\n            ], [MODEL, [VENDOR, HONOR], [TYPE, TABLET]], [\n            /honor([-\\w ]+)[;\\)]/i\n            ], [MODEL, [VENDOR, HONOR], [TYPE, MOBILE]], [\n\n            // Huawei\n            /\\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\\w\\. ]*(?= bui|\\)))\\b(?!.+d\\/s)/i\n            ], [MODEL, [VENDOR, HUAWEI], [TYPE, TABLET]], [\n            /(?:huawei)([-\\w ]+)[;\\)]/i,\n            /\\b(nexus 6p|\\w{2,4}e?-[atu]?[ln][\\dx][012359c][adn]?)\\b(?!.+d\\/s)/i\n            ], [MODEL, [VENDOR, HUAWEI], [TYPE, MOBILE]], [\n\n            // Xiaomi\n            /oid[^\\)]+; (2[\\dbc]{4}(182|283|rp\\w{2})[cgl]|m2105k81a?c)(?: bui|\\))/i,\n            /\\b((?:red)?mi[-_ ]?pad[\\w- ]*)(?: bui|\\))/i                                // Mi Pad tablets\n            ],[[MODEL, /_/g, ' '], [VENDOR, XIAOMI], [TYPE, TABLET]], [\n\n            /\\b(poco[\\w ]+|m2\\d{3}j\\d\\d[a-z]{2})(?: bui|\\))/i,                  // Xiaomi POCO\n            /\\b; (\\w+) build\\/hm\\1/i,                                           // Xiaomi Hongmi 'numeric' models\n            /\\b(hm[-_ ]?note?[_ ]?(?:\\d\\w)?) bui/i,                             // Xiaomi Hongmi\n            /\\b(redmi[\\-_ ]?(?:note|k)?[\\w_ ]+)(?: bui|\\))/i,                   // Xiaomi Redmi\n            /oid[^\\)]+; (m?[12][0-389][01]\\w{3,6}[c-y])( bui|; wv|\\))/i,        // Xiaomi Redmi 'numeric' models\n            /\\b(mi[-_ ]?(?:a\\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\\d?\\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\\))/i, // Xiaomi Mi\n            / ([\\w ]+) miui\\/v?\\d/i\n            ], [[MODEL, /_/g, ' '], [VENDOR, XIAOMI], [TYPE, MOBILE]], [\n\n            // OPPO\n            /; (\\w+) bui.+ oppo/i,\n            /\\b(cph[12]\\d{3}|p(?:af|c[al]|d\\w|e[ar])[mt]\\d0|x9007|a101op)\\b/i\n            ], [MODEL, [VENDOR, OPPO], [TYPE, MOBILE]], [\n            /\\b(opd2(\\d{3}a?))(?: bui|\\))/i\n            ], [MODEL, [VENDOR, strMapper, { 'OnePlus' : ['304', '403', '203'], '*' : OPPO }], [TYPE, TABLET]], [\n\n            // Vivo\n            /vivo (\\w+)(?: bui|\\))/i,\n            /\\b(v[12]\\d{3}\\w?[at])(?: bui|;)/i\n            ], [MODEL, [VENDOR, 'Vivo'], [TYPE, MOBILE]], [\n\n            // Realme\n            /\\b(rmx[1-3]\\d{3})(?: bui|;|\\))/i\n            ], [MODEL, [VENDOR, 'Realme'], [TYPE, MOBILE]], [\n\n            // Motorola\n            /\\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\\b[\\w ]+build\\//i,\n            /\\bmot(?:orola)?[- ](\\w*)/i,\n            /((?:moto(?! 360)[\\w\\(\\) ]+|xt\\d{3,4}|nexus 6)(?= bui|\\)))/i\n            ], [MODEL, [VENDOR, MOTOROLA], [TYPE, MOBILE]], [\n            /\\b(mz60\\d|xoom[2 ]{0,2}) build\\//i\n            ], [MODEL, [VENDOR, MOTOROLA], [TYPE, TABLET]], [\n\n            // LG\n            /((?=lg)?[vl]k\\-?\\d{3}) bui| 3\\.[-\\w; ]{10}lg?-([06cv9]{3,4})/i\n            ], [MODEL, [VENDOR, LG], [TYPE, TABLET]], [\n            /(lm(?:-?f100[nv]?|-[\\w\\.]+)(?= bui|\\))|nexus [45])/i,\n            /\\blg[-e;\\/ ]+((?!browser|netcast|android tv|watch)\\w+)/i,\n            /\\blg-?([\\d\\w]+) bui/i\n            ], [MODEL, [VENDOR, LG], [TYPE, MOBILE]], [\n\n            // Lenovo\n            /(ideatab[-\\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\\d{3,4}(?:f[cu]|xu|[av])|yt\\d?-[jx]?\\d+[lfmx])( bui|;|\\)|\\/)/i,\n            /lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\\w- ]+?)|tb[\\w-]{6,7})( bui|;|\\)|\\/)/i\n            ], [MODEL, [VENDOR, LENOVO], [TYPE, TABLET]], [\n\n            // Nokia\n            /(nokia) (t[12][01])/i\n            ], [VENDOR, MODEL, [TYPE, TABLET]], [\n            /(?:maemo|nokia).*(n900|lumia \\d+|rm-\\d+)/i,\n            /nokia[-_ ]?(([-\\w\\. ]*))/i\n            ], [[MODEL, /_/g, ' '], [TYPE, MOBILE], [VENDOR, 'Nokia']], [\n\n            // Google\n            /(pixel (c|tablet))\\b/i                                             // Google Pixel C/Tablet\n            ], [MODEL, [VENDOR, GOOGLE], [TYPE, TABLET]], [\n            /droid.+; (pixel[\\daxl ]{0,6})(?: bui|\\))/i                         // Google Pixel\n            ], [MODEL, [VENDOR, GOOGLE], [TYPE, MOBILE]], [\n\n            // Sony\n            /droid.+; (a?\\d[0-2]{2}so|[c-g]\\d{4}|so[-gl]\\w+|xq-a\\w[4-7][12])(?= bui|\\).+chrome\\/(?![1-6]{0,1}\\d\\.))/i\n            ], [MODEL, [VENDOR, SONY], [TYPE, MOBILE]], [\n            /sony tablet [ps]/i,\n            /\\b(?:sony)?sgp\\w+(?: bui|\\))/i\n            ], [[MODEL, 'Xperia Tablet'], [VENDOR, SONY], [TYPE, TABLET]], [\n\n            // OnePlus\n            / (kb2005|in20[12]5|be20[12][59])\\b/i,\n            /(?:one)?(?:plus)? (a\\d0\\d\\d)(?: b|\\))/i\n            ], [MODEL, [VENDOR, ONEPLUS], [TYPE, MOBILE]], [\n\n            // Amazon\n            /(alexa)webm/i,\n            /(kf[a-z]{2}wi|aeo(?!bc)\\w\\w)( bui|\\))/i,                           // Kindle Fire without Silk / Echo Show\n            /(kf[a-z]+)( bui|\\)).+silk\\//i                                      // Kindle Fire HD\n            ], [MODEL, [VENDOR, AMAZON], [TYPE, TABLET]], [\n            /((?:sd|kf)[0349hijorstuw]+)( bui|\\)).+silk\\//i                     // Fire Phone\n            ], [[MODEL, /(.+)/g, 'Fire Phone $1'], [VENDOR, AMAZON], [TYPE, MOBILE]], [\n\n            // BlackBerry\n            /(playbook);[-\\w\\),; ]+(rim)/i                                      // BlackBerry PlayBook\n            ], [MODEL, VENDOR, [TYPE, TABLET]], [\n            /\\b((?:bb[a-f]|st[hv])100-\\d)/i,\n            /\\(bb10; (\\w+)/i                                                    // BlackBerry 10\n            ], [MODEL, [VENDOR, BLACKBERRY], [TYPE, MOBILE]], [\n\n            // Asus\n            /(?:\\b|asus_)(transfo[prime ]{4,10} \\w+|eeepc|slider \\w+|nexus 7|padfone|p00[cj])/i\n            ], [MODEL, [VENDOR, ASUS], [TYPE, TABLET]], [\n            / (z[bes]6[027][012][km][ls]|zenfone \\d\\w?)\\b/i\n            ], [MODEL, [VENDOR, ASUS], [TYPE, MOBILE]], [\n\n            // HTC\n            /(nexus 9)/i                                                        // HTC Nexus 9\n            ], [MODEL, [VENDOR, 'HTC'], [TYPE, TABLET]], [\n            /(htc)[-;_ ]{1,2}([\\w ]+(?=\\)| bui)|\\w+)/i,                         // HTC\n\n            // ZTE\n            /(zte)[- ]([\\w ]+?)(?: bui|\\/|\\))/i,\n            /(alcatel|geeksphone|nexian|panasonic(?!(?:;|\\.))|sony(?!-bra))[-_ ]?([-\\w]*)/i         // Alcatel/GeeksPhone/Nexian/Panasonic/Sony\n            ], [VENDOR, [MODEL, /_/g, ' '], [TYPE, MOBILE]], [\n\n            // TCL\n            /droid [\\w\\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\\w*(\\)| bui)/i\n            ], [MODEL, [VENDOR, 'TCL'], [TYPE, TABLET]], [\n\n            // itel\n            /(itel) ((\\w+))/i\n            ], [[VENDOR, lowerize], MODEL, [TYPE, strMapper, { 'tablet' : ['p10001l', 'w7001'], '*' : 'mobile' }]], [\n\n            // Acer\n            /droid.+; ([ab][1-7]-?[0178a]\\d\\d?)/i\n            ], [MODEL, [VENDOR, 'Acer'], [TYPE, TABLET]], [\n\n            // Meizu\n            /droid.+; (m[1-5] note) bui/i,\n            /\\bmz-([-\\w]{2,})/i\n            ], [MODEL, [VENDOR, 'Meizu'], [TYPE, MOBILE]], [\n                \n            // Ulefone\n            /; ((?:power )?armor(?:[\\w ]{0,8}))(?: bui|\\))/i\n            ], [MODEL, [VENDOR, 'Ulefone'], [TYPE, MOBILE]], [\n\n            // Energizer\n            /; (energy ?\\w+)(?: bui|\\))/i,\n            /; energizer ([\\w ]+)(?: bui|\\))/i\n            ], [MODEL, [VENDOR, 'Energizer'], [TYPE, MOBILE]], [\n\n            // Cat\n            /; cat (b35);/i,\n            /; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\\))/i\n            ], [MODEL, [VENDOR, 'Cat'], [TYPE, MOBILE]], [\n\n            // Smartfren\n            /((?:new )?andromax[\\w- ]+)(?: bui|\\))/i\n            ], [MODEL, [VENDOR, 'Smartfren'], [TYPE, MOBILE]], [\n\n            // Nothing\n            /droid.+; (a(?:015|06[35]|142p?))/i\n            ], [MODEL, [VENDOR, 'Nothing'], [TYPE, MOBILE]], [\n\n            // Archos\n            /; (x67 5g|tikeasy \\w+|ac[1789]\\d\\w+)( b|\\))/i,\n            /archos ?(5|gamepad2?|([\\w ]*[t1789]|hello) ?\\d+[\\w ]*)( b|\\))/i\n            ], [MODEL, [VENDOR, 'Archos'], [TYPE, TABLET]], [\n            /archos ([\\w ]+)( b|\\))/i,\n            /; (ac[3-6]\\d\\w{2,8})( b|\\))/i \n            ], [MODEL, [VENDOR, 'Archos'], [TYPE, MOBILE]], [\n\n            // MIXED\n            /(imo) (tab \\w+)/i,                                                 // IMO\n            /(infinix) (x1101b?)/i                                              // Infinix XPad\n            ], [VENDOR, MODEL, [TYPE, TABLET]], [\n\n            /(blackberry|benq|palm(?=\\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\\w]*)/i,\n                                                                                // BlackBerry/BenQ/Palm/Sony-Ericsson/Acer/Asus/Dell/Meizu/Motorola/Polytron/Infinix/Tecno/Micromax/Advan\n            /; (hmd|imo) ([\\w ]+?)(?: bui|\\))/i,                                // HMD/IMO\n            /(hp) ([\\w ]+\\w)/i,                                                 // HP iPAQ\n            /(microsoft); (lumia[\\w ]+)/i,                                      // Microsoft Lumia\n            /(lenovo)[-_ ]?([-\\w ]+?)(?: bui|\\)|\\/)/i,                          // Lenovo\n            /(oppo) ?([\\w ]+) bui/i                                             // OPPO\n            ], [VENDOR, MODEL, [TYPE, MOBILE]], [\n\n            /(kobo)\\s(ereader|touch)/i,                                         // Kobo\n            /(hp).+(touchpad(?!.+tablet)|tablet)/i,                             // HP TouchPad\n            /(kindle)\\/([\\w\\.]+)/i,                                             // Kindle\n            /(nook)[\\w ]+build\\/(\\w+)/i,                                        // Nook\n            /(dell) (strea[kpr\\d ]*[\\dko])/i,                                   // Dell Streak\n            /(le[- ]+pan)[- ]+(\\w{1,9}) bui/i,                                  // Le Pan Tablets\n            /(trinity)[- ]*(t\\d{3}) bui/i,                                      // Trinity Tablets\n            /(gigaset)[- ]+(q\\w{1,9}) bui/i,                                    // Gigaset Tablets\n            /(vodafone) ([\\w ]+)(?:\\)| bui)/i                                   // Vodafone\n            ], [VENDOR, MODEL, [TYPE, TABLET]], [\n\n            /(surface duo)/i                                                    // Surface Duo\n            ], [MODEL, [VENDOR, MICROSOFT], [TYPE, TABLET]], [\n            /droid [\\d\\.]+; (fp\\du?)(?: b|\\))/i                                 // Fairphone\n            ], [MODEL, [VENDOR, 'Fairphone'], [TYPE, MOBILE]], [\n            /(u304aa)/i                                                         // AT&T\n            ], [MODEL, [VENDOR, 'AT&T'], [TYPE, MOBILE]], [\n            /\\bsie-(\\w*)/i                                                      // Siemens\n            ], [MODEL, [VENDOR, 'Siemens'], [TYPE, MOBILE]], [\n            /\\b(rct\\w+) b/i                                                     // RCA Tablets\n            ], [MODEL, [VENDOR, 'RCA'], [TYPE, TABLET]], [\n            /\\b(venue[\\d ]{2,7}) b/i                                            // Dell Venue Tablets\n            ], [MODEL, [VENDOR, 'Dell'], [TYPE, TABLET]], [\n            /\\b(q(?:mv|ta)\\w+) b/i                                              // Verizon Tablet\n            ], [MODEL, [VENDOR, 'Verizon'], [TYPE, TABLET]], [\n            /\\b(?:barnes[& ]+noble |bn[rt])([\\w\\+ ]*) b/i                       // Barnes & Noble Tablet\n            ], [MODEL, [VENDOR, 'Barnes & Noble'], [TYPE, TABLET]], [\n            /\\b(tm\\d{3}\\w+) b/i\n            ], [MODEL, [VENDOR, 'NuVision'], [TYPE, TABLET]], [\n            /\\b(k88) b/i                                                        // ZTE K Series Tablet\n            ], [MODEL, [VENDOR, 'ZTE'], [TYPE, TABLET]], [\n            /\\b(nx\\d{3}j) b/i                                                   // ZTE Nubia\n            ], [MODEL, [VENDOR, 'ZTE'], [TYPE, MOBILE]], [\n            /\\b(gen\\d{3}) b.+49h/i                                              // Swiss GEN Mobile\n            ], [MODEL, [VENDOR, 'Swiss'], [TYPE, MOBILE]], [\n            /\\b(zur\\d{3}) b/i                                                   // Swiss ZUR Tablet\n            ], [MODEL, [VENDOR, 'Swiss'], [TYPE, TABLET]], [\n            /\\b((zeki)?tb.*\\b) b/i                                              // Zeki Tablets\n            ], [MODEL, [VENDOR, 'Zeki'], [TYPE, TABLET]], [\n            /\\b([yr]\\d{2}) b/i,\n            /\\b(dragon[- ]+touch |dt)(\\w{5}) b/i                                // Dragon Touch Tablet\n            ], [[VENDOR, 'Dragon Touch'], MODEL, [TYPE, TABLET]], [\n            /\\b(ns-?\\w{0,9}) b/i                                                // Insignia Tablets\n            ], [MODEL, [VENDOR, 'Insignia'], [TYPE, TABLET]], [\n            /\\b((nxa|next)-?\\w{0,9}) b/i                                        // NextBook Tablets\n            ], [MODEL, [VENDOR, 'NextBook'], [TYPE, TABLET]], [\n            /\\b(xtreme\\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i                  // Voice Xtreme Phones\n            ], [[VENDOR, 'Voice'], MODEL, [TYPE, MOBILE]], [\n            /\\b(lvtel\\-)?(v1[12]) b/i                                           // LvTel Phones\n            ], [[VENDOR, 'LvTel'], MODEL, [TYPE, MOBILE]], [\n            /\\b(ph-1) /i                                                        // Essential PH-1\n            ], [MODEL, [VENDOR, 'Essential'], [TYPE, MOBILE]], [\n            /\\b(v(100md|700na|7011|917g).*\\b) b/i                               // Envizen Tablets\n            ], [MODEL, [VENDOR, 'Envizen'], [TYPE, TABLET]], [\n            /\\b(trio[-\\w\\. ]+) b/i                                              // MachSpeed Tablets\n            ], [MODEL, [VENDOR, 'MachSpeed'], [TYPE, TABLET]], [\n            /\\btu_(1491) b/i                                                    // Rotor Tablets\n            ], [MODEL, [VENDOR, 'Rotor'], [TYPE, TABLET]], [\n            /((?:tegranote|shield t(?!.+d tv))[\\w- ]*?)(?: b|\\))/i              // Nvidia Tablets\n            ], [MODEL, [VENDOR, NVIDIA], [TYPE, TABLET]], [\n            /(sprint) (\\w+)/i                                                   // Sprint Phones\n            ], [VENDOR, MODEL, [TYPE, MOBILE]], [\n            /(kin\\.[onetw]{3})/i                                                // Microsoft Kin\n            ], [[MODEL, /\\./g, ' '], [VENDOR, MICROSOFT], [TYPE, MOBILE]], [\n            /droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\\)/i             // Zebra\n            ], [MODEL, [VENDOR, ZEBRA], [TYPE, TABLET]], [\n            /droid.+; (ec30|ps20|tc[2-8]\\d[kx])\\)/i\n            ], [MODEL, [VENDOR, ZEBRA], [TYPE, MOBILE]], [\n\n            ///////////////////\n            // SMARTTVS\n            ///////////////////\n\n            /smart-tv.+(samsung)/i                                              // Samsung\n            ], [VENDOR, [TYPE, SMARTTV]], [\n            /hbbtv.+maple;(\\d+)/i\n            ], [[MODEL, /^/, 'SmartTV'], [VENDOR, SAMSUNG], [TYPE, SMARTTV]], [\n            /(nux; netcast.+smarttv|lg (netcast\\.tv-201\\d|android tv))/i        // LG SmartTV\n            ], [[VENDOR, LG], [TYPE, SMARTTV]], [\n            /(apple) ?tv/i                                                      // Apple TV\n            ], [VENDOR, [MODEL, APPLE+' TV'], [TYPE, SMARTTV]], [\n            /crkey/i                                                            // Google Chromecast\n            ], [[MODEL, CHROME+'cast'], [VENDOR, GOOGLE], [TYPE, SMARTTV]], [\n            /droid.+aft(\\w+)( bui|\\))/i                                         // Fire TV\n            ], [MODEL, [VENDOR, AMAZON], [TYPE, SMARTTV]], [\n            /(shield \\w+ tv)/i                                                  // Nvidia Shield TV\n            ], [MODEL, [VENDOR, NVIDIA], [TYPE, SMARTTV]], [\n            /\\(dtv[\\);].+(aquos)/i,\n            /(aquos-tv[\\w ]+)\\)/i                                               // Sharp\n            ], [MODEL, [VENDOR, SHARP], [TYPE, SMARTTV]],[\n            /(bravia[\\w ]+)( bui|\\))/i                                              // Sony\n            ], [MODEL, [VENDOR, SONY], [TYPE, SMARTTV]], [\n            /(mi(tv|box)-?\\w+) bui/i                                            // Xiaomi\n            ], [MODEL, [VENDOR, XIAOMI], [TYPE, SMARTTV]], [\n            /Hbbtv.*(technisat) (.*);/i                                         // TechniSAT\n            ], [VENDOR, MODEL, [TYPE, SMARTTV]], [\n            /\\b(roku)[\\dx]*[\\)\\/]((?:dvp-)?[\\d\\.]*)/i,                          // Roku\n            /hbbtv\\/\\d+\\.\\d+\\.\\d+ +\\([\\w\\+ ]*; *([\\w\\d][^;]*);([^;]*)/i         // HbbTV devices\n            ], [[VENDOR, trim], [MODEL, trim], [TYPE, SMARTTV]], [\n                                                                                // SmartTV from Unidentified Vendors\n            /droid.+; ([\\w- ]+) (?:android tv|smart[- ]?tv)/i\n            ], [MODEL, [TYPE, SMARTTV]], [\n            /\\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\\b/i\n            ], [[TYPE, SMARTTV]], [\n\n            ///////////////////\n            // CONSOLES\n            ///////////////////\n\n            /(ouya)/i,                                                          // Ouya\n            /(nintendo) ([wids3utch]+)/i                                        // Nintendo\n            ], [VENDOR, MODEL, [TYPE, CONSOLE]], [\n            /droid.+; (shield)( bui|\\))/i                                       // Nvidia Portable\n            ], [MODEL, [VENDOR, NVIDIA], [TYPE, CONSOLE]], [\n            /(playstation \\w+)/i                                                // Playstation\n            ], [MODEL, [VENDOR, SONY], [TYPE, CONSOLE]], [\n            /\\b(xbox(?: one)?(?!; xbox))[\\); ]/i                                // Microsoft Xbox\n            ], [MODEL, [VENDOR, MICROSOFT], [TYPE, CONSOLE]], [\n\n            ///////////////////\n            // WEARABLES\n            ///////////////////\n\n            /\\b(sm-[lr]\\d\\d[0156][fnuw]?s?|gear live)\\b/i                       // Samsung Galaxy Watch\n            ], [MODEL, [VENDOR, SAMSUNG], [TYPE, WEARABLE]], [\n            /((pebble))app/i,                                                   // Pebble\n            /(asus|google|lg|oppo) ((pixel |zen)?watch[\\w ]*)( bui|\\))/i        // Asus ZenWatch / LG Watch / Pixel Watch\n            ], [VENDOR, MODEL, [TYPE, WEARABLE]], [\n            /(ow(?:19|20)?we?[1-3]{1,3})/i                                      // Oppo Watch\n            ], [MODEL, [VENDOR, OPPO], [TYPE, WEARABLE]], [\n            /(watch)(?: ?os[,\\/]|\\d,\\d\\/)[\\d\\.]+/i                              // Apple Watch\n            ], [MODEL, [VENDOR, APPLE], [TYPE, WEARABLE]], [\n            /(opwwe\\d{3})/i                                                     // OnePlus Watch\n            ], [MODEL, [VENDOR, ONEPLUS], [TYPE, WEARABLE]], [\n            /(moto 360)/i                                                       // Motorola 360\n            ], [MODEL, [VENDOR, MOTOROLA], [TYPE, WEARABLE]], [\n            /(smartwatch 3)/i                                                   // Sony SmartWatch\n            ], [MODEL, [VENDOR, SONY], [TYPE, WEARABLE]], [\n            /(g watch r)/i                                                      // LG G Watch R\n            ], [MODEL, [VENDOR, LG], [TYPE, WEARABLE]], [\n            /droid.+; (wt63?0{2,3})\\)/i\n            ], [MODEL, [VENDOR, ZEBRA], [TYPE, WEARABLE]], [\n\n            ///////////////////\n            // XR\n            ///////////////////\n\n            /droid.+; (glass) \\d/i                                              // Google Glass\n            ], [MODEL, [VENDOR, GOOGLE], [TYPE, WEARABLE]], [\n            /(pico) (4|neo3(?: link|pro)?)/i                                    // Pico\n            ], [VENDOR, MODEL, [TYPE, WEARABLE]], [\n            /; (quest( \\d| pro)?)/i                                             // Oculus Quest\n            ], [MODEL, [VENDOR, FACEBOOK], [TYPE, WEARABLE]], [\n\n            ///////////////////\n            // EMBEDDED\n            ///////////////////\n\n            /(tesla)(?: qtcarbrowser|\\/[-\\w\\.]+)/i                              // Tesla\n            ], [VENDOR, [TYPE, EMBEDDED]], [\n            /(aeobc)\\b/i                                                        // Echo Dot\n            ], [MODEL, [VENDOR, AMAZON], [TYPE, EMBEDDED]], [\n            /(homepod).+mac os/i                                                // Apple HomePod\n            ], [MODEL, [VENDOR, APPLE], [TYPE, EMBEDDED]], [\n            /windows iot/i\n            ], [[TYPE, EMBEDDED]], [\n\n            ////////////////////\n            // MIXED (GENERIC)\n            ///////////////////\n\n            /droid .+?; ([^;]+?)(?: bui|; wv\\)|\\) applew).+? mobile safari/i    // Android Phones from Unidentified Vendors\n            ], [MODEL, [TYPE, MOBILE]], [\n            /droid .+?; ([^;]+?)(?: bui|\\) applew).+?(?! mobile) safari/i       // Android Tablets from Unidentified Vendors\n            ], [MODEL, [TYPE, TABLET]], [\n            /\\b((tablet|tab)[;\\/]|focus\\/\\d(?!.+mobile))/i                      // Unidentifiable Tablet\n            ], [[TYPE, TABLET]], [\n            /(phone|mobile(?:[;\\/]| [ \\w\\/\\.]*safari)|pda(?=.+windows ce))/i    // Unidentifiable Mobile\n            ], [[TYPE, MOBILE]], [\n            /droid .+?; ([\\w\\. -]+)( bui|\\))/i                                  // Generic Android Device\n            ], [MODEL, [VENDOR, 'Generic']]\n        ],\n\n        engine : [[\n\n            /windows.+ edge\\/([\\w\\.]+)/i                                       // EdgeHTML\n            ], [VERSION, [NAME, EDGE+'HTML']], [\n\n            /(arkweb)\\/([\\w\\.]+)/i                                              // ArkWeb\n            ], [NAME, VERSION], [\n\n            /webkit\\/537\\.36.+chrome\\/(?!27)([\\w\\.]+)/i                         // Blink\n            ], [VERSION, [NAME, 'Blink']], [\n\n            /(presto)\\/([\\w\\.]+)/i,                                             // Presto\n            /(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\\/([\\w\\.]+)/i, // WebKit/Trident/NetFront/NetSurf/Amaya/Lynx/w3m/Goanna/Servo\n            /ekioh(flow)\\/([\\w\\.]+)/i,                                          // Flow\n            /(khtml|tasman|links)[\\/ ]\\(?([\\w\\.]+)/i,                           // KHTML/Tasman/Links\n            /(icab)[\\/ ]([23]\\.[\\d\\.]+)/i,                                      // iCab\n\n            /\\b(libweb)/i                                                       // LibWeb\n            ], [NAME, VERSION], [\n            /ladybird\\//i\n            ], [[NAME, 'LibWeb']], [\n\n            /rv\\:([\\w\\.]{1,9})\\b.+(gecko)/i                                     // Gecko\n            ], [VERSION, NAME]\n        ],\n\n        os : [[\n\n            // Windows\n            /microsoft (windows) (vista|xp)/i                                   // Windows (iTunes)\n            ], [NAME, VERSION], [\n            /(windows (?:phone(?: os)?|mobile|iot))[\\/ ]?([\\d\\.\\w ]*)/i         // Windows Phone\n            ], [NAME, [VERSION, strMapper, windowsVersionMap]], [\n            /windows nt 6\\.2; (arm)/i,                                          // Windows RT\n            /windows[\\/ ]([ntce\\d\\. ]+\\w)(?!.+xbox)/i,\n            /(?:win(?=3|9|n)|win 9x )([nt\\d\\.]+)/i\n            ], [[VERSION, strMapper, windowsVersionMap], [NAME, 'Windows']], [\n\n            // iOS/macOS\n            /[adehimnop]{4,7}\\b(?:.*os ([\\w]+) like mac|; opera)/i,             // iOS\n            /(?:ios;fbsv\\/|iphone.+ios[\\/ ])([\\d\\.]+)/i,\n            /cfnetwork\\/.+darwin/i\n            ], [[VERSION, /_/g, '.'], [NAME, 'iOS']], [\n            /(mac os x) ?([\\w\\. ]*)/i,\n            /(macintosh|mac_powerpc\\b)(?!.+haiku)/i                             // Mac OS\n            ], [[NAME, MAC_OS], [VERSION, /_/g, '.']], [\n\n            // Mobile OSes\n            /droid ([\\w\\.]+)\\b.+(android[- ]x86|harmonyos)/i                    // Android-x86/HarmonyOS\n            ], [VERSION, NAME], [                                               \n            /(ubuntu) ([\\w\\.]+) like android/i                                  // Ubuntu Touch\n            ], [[NAME, /(.+)/, '$1 Touch'], VERSION], [\n                                                                                // Android/Blackberry/WebOS/QNX/Bada/RIM/KaiOS/Maemo/MeeGo/S40/Sailfish OS/OpenHarmony/Tizen\n            /(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\\w*[-\\/; ]?([\\d\\.]*)/i\n            ], [NAME, VERSION], [\n            /\\(bb(10);/i                                                        // BlackBerry 10\n            ], [VERSION, [NAME, BLACKBERRY]], [\n            /(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\\/ ]?([\\w\\.]*)/i       // Symbian\n            ], [VERSION, [NAME, 'Symbian']], [\n            /mozilla\\/[\\d\\.]+ \\((?:mobile|tablet|tv|mobile; [\\w ]+); rv:.+ gecko\\/([\\w\\.]+)/i // Firefox OS\n            ], [VERSION, [NAME, FIREFOX+' OS']], [\n            /web0s;.+rt(tv)/i,\n            /\\b(?:hp)?wos(?:browser)?\\/([\\w\\.]+)/i                              // WebOS\n            ], [VERSION, [NAME, 'webOS']], [\n            /watch(?: ?os[,\\/]|\\d,\\d\\/)([\\d\\.]+)/i                              // watchOS\n            ], [VERSION, [NAME, 'watchOS']], [\n\n            // Google Chromecast\n            /crkey\\/([\\d\\.]+)/i                                                 // Google Chromecast\n            ], [VERSION, [NAME, CHROME+'cast']], [\n            /(cros) [\\w]+(?:\\)| ([\\w\\.]+)\\b)/i                                  // Chromium OS\n            ], [[NAME, CHROMIUM_OS], VERSION],[\n\n            // Smart TVs\n            /panasonic;(viera)/i,                                               // Panasonic Viera\n            /(netrange)mmh/i,                                                   // Netrange\n            /(nettv)\\/(\\d+\\.[\\w\\.]+)/i,                                         // NetTV\n\n            // Console\n            /(nintendo|playstation) ([wids345portablevuch]+)/i,                 // Nintendo/Playstation\n            /(xbox); +xbox ([^\\);]+)/i,                                         // Microsoft Xbox (360, One, X, S, Series X, Series S)\n\n            // Other\n            /\\b(joli|palm)\\b ?(?:os)?\\/?([\\w\\.]*)/i,                            // Joli/Palm\n            /(mint)[\\/\\(\\) ]?(\\w*)/i,                                           // Mint\n            /(mageia|vectorlinux)[; ]/i,                                        // Mageia/VectorLinux\n            /([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\\/ ]?(?!chrom|package)([-\\w\\.]*)/i,\n                                                                                // Ubuntu/Debian/SUSE/Gentoo/Arch/Slackware/Fedora/Mandriva/CentOS/PCLinuxOS/RedHat/Zenwalk/Linpus/Raspbian/Plan9/Minix/RISCOS/Contiki/Deepin/Manjaro/elementary/Sabayon/Linspire\n            /(hurd|linux)(?: arm\\w*| x86\\w*| ?)([\\w\\.]*)/i,                     // Hurd/Linux\n            /(gnu) ?([\\w\\.]*)/i,                                                // GNU\n            /\\b([-frentopcghs]{0,5}bsd|dragonfly)[\\/ ]?(?!amd|[ix346]{1,2}86)([\\w\\.]*)/i, // FreeBSD/NetBSD/OpenBSD/PC-BSD/GhostBSD/DragonFly\n            /(haiku) (\\w+)/i                                                    // Haiku\n            ], [NAME, VERSION], [\n            /(sunos) ?([\\w\\.\\d]*)/i                                             // Solaris\n            ], [[NAME, 'Solaris'], VERSION], [\n            /((?:open)?solaris)[-\\/ ]?([\\w\\.]*)/i,                              // Solaris\n            /(aix) ((\\d)(?=\\.|\\)| )[\\w\\.])*/i,                                  // AIX\n            /\\b(beos|os\\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i, // BeOS/OS2/AmigaOS/MorphOS/OpenVMS/Fuchsia/HP-UX/SerenityOS\n            /(unix) ?([\\w\\.]*)/i                                                // UNIX\n            ], [NAME, VERSION]\n        ]\n    };\n\n    /////////////////\n    // Constructor\n    ////////////////\n\n    var UAParser = function (ua, extensions) {\n\n        if (typeof ua === OBJ_TYPE) {\n            extensions = ua;\n            ua = undefined;\n        }\n\n        if (!(this instanceof UAParser)) {\n            return new UAParser(ua, extensions).getResult();\n        }\n\n        var _navigator = (typeof window !== UNDEF_TYPE && window.navigator) ? window.navigator : undefined;\n        var _ua = ua || ((_navigator && _navigator.userAgent) ? _navigator.userAgent : EMPTY);\n        var _uach = (_navigator && _navigator.userAgentData) ? _navigator.userAgentData : undefined;\n        var _rgxmap = extensions ? extend(regexes, extensions) : regexes;\n        var _isSelfNav = _navigator && _navigator.userAgent == _ua;\n\n        this.getBrowser = function () {\n            var _browser = {};\n            _browser[NAME] = undefined;\n            _browser[VERSION] = undefined;\n            rgxMapper.call(_browser, _ua, _rgxmap.browser);\n            _browser[MAJOR] = majorize(_browser[VERSION]);\n            // Brave-specific detection\n            if (_isSelfNav && _navigator && _navigator.brave && typeof _navigator.brave.isBrave == FUNC_TYPE) {\n                _browser[NAME] = 'Brave';\n            }\n            return _browser;\n        };\n        this.getCPU = function () {\n            var _cpu = {};\n            _cpu[ARCHITECTURE] = undefined;\n            rgxMapper.call(_cpu, _ua, _rgxmap.cpu);\n            return _cpu;\n        };\n        this.getDevice = function () {\n            var _device = {};\n            _device[VENDOR] = undefined;\n            _device[MODEL] = undefined;\n            _device[TYPE] = undefined;\n            rgxMapper.call(_device, _ua, _rgxmap.device);\n            if (_isSelfNav && !_device[TYPE] && _uach && _uach.mobile) {\n                _device[TYPE] = MOBILE;\n            }\n            // iPadOS-specific detection: identified as Mac, but has some iOS-only properties\n            if (_isSelfNav && _device[MODEL] == 'Macintosh' && _navigator && typeof _navigator.standalone !== UNDEF_TYPE && _navigator.maxTouchPoints && _navigator.maxTouchPoints > 2) {\n                _device[MODEL] = 'iPad';\n                _device[TYPE] = TABLET;\n            }\n            return _device;\n        };\n        this.getEngine = function () {\n            var _engine = {};\n            _engine[NAME] = undefined;\n            _engine[VERSION] = undefined;\n            rgxMapper.call(_engine, _ua, _rgxmap.engine);\n            return _engine;\n        };\n        this.getOS = function () {\n            var _os = {};\n            _os[NAME] = undefined;\n            _os[VERSION] = undefined;\n            rgxMapper.call(_os, _ua, _rgxmap.os);\n            if (_isSelfNav && !_os[NAME] && _uach && _uach.platform && _uach.platform != 'Unknown') {\n                _os[NAME] = _uach.platform  \n                                    .replace(/chrome os/i, CHROMIUM_OS)\n                                    .replace(/macos/i, MAC_OS);           // backward compatibility\n            }\n            return _os;\n        };\n        this.getResult = function () {\n            return {\n                ua      : this.getUA(),\n                browser : this.getBrowser(),\n                engine  : this.getEngine(),\n                os      : this.getOS(),\n                device  : this.getDevice(),\n                cpu     : this.getCPU()\n            };\n        };\n        this.getUA = function () {\n            return _ua;\n        };\n        this.setUA = function (ua) {\n            _ua = (typeof ua === STR_TYPE && ua.length > UA_MAX_LENGTH) ? trim(ua, UA_MAX_LENGTH) : ua;\n            return this;\n        };\n        this.setUA(_ua);\n        return this;\n    };\n\n    UAParser.VERSION = LIBVERSION;\n    UAParser.BROWSER =  enumerize([NAME, VERSION, MAJOR]);\n    UAParser.CPU = enumerize([ARCHITECTURE]);\n    UAParser.DEVICE = enumerize([MODEL, VENDOR, TYPE, CONSOLE, MOBILE, SMARTTV, TABLET, WEARABLE, EMBEDDED]);\n    UAParser.ENGINE = UAParser.OS = enumerize([NAME, VERSION]);\n\n    ///////////\n    // Export\n    //////////\n\n    // check js environment\n    if (typeof(exports) !== UNDEF_TYPE) {\n        // nodejs env\n        if (typeof module !== UNDEF_TYPE && module.exports) {\n            exports = module.exports = UAParser;\n        }\n        exports.UAParser = UAParser;\n    } else {\n        // requirejs env (optional)\n        if (typeof(define) === FUNC_TYPE && define.amd) {\n            define(function () {\n                return UAParser;\n            });\n        } else if (typeof window !== UNDEF_TYPE) {\n            // browser env\n            window.UAParser = UAParser;\n        }\n    }\n\n    // jQuery/Zepto specific (optional)\n    // Note:\n    //   In AMD env the global scope should be kept clean, but jQuery is an exception.\n    //   jQuery always exports to global scope, unless jQuery.noConflict(true) is used,\n    //   and we should catch that.\n    var $ = typeof window !== UNDEF_TYPE && (window.jQuery || window.Zepto);\n    if ($ && !$.ua) {\n        var parser = new UAParser();\n        $.ua = parser.getResult();\n        $.ua.get = function () {\n            return parser.getUA();\n        };\n        $.ua.set = function (ua) {\n            parser.setUA(ua);\n            var result = parser.getResult();\n            for (var prop in result) {\n                $.ua[prop] = result[prop];\n            }\n        };\n    }\n\n})(typeof window === 'object' ? window : this);\n","var StorageType = /* @__PURE__ */ ((StorageType2) => {\n  StorageType2[\"LOCAL\"] = \"local\";\n  StorageType2[\"SESSION\"] = \"session\";\n  return StorageType2;\n})(StorageType || {});\nfunction autoDetectStorage(type) {\n  let storage;\n  try {\n    storage = type === \"local\" ? window.localStorage : window.sessionStorage;\n    const x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return e instanceof DOMException && // everything except Firefox\n    (e.code === 22 || // Firefox\n    e.code === 1014 || // test name field too, because code might not be present\n    // everything except Firefox\n    e.name === \"QuotaExceededError\" || // Firefox\n    e.name === \"NS_ERROR_DOM_QUOTA_REACHED\") && // acknowledge QuotaExceededError only if there's something already stored\n    storage && storage.length !== 0;\n  }\n}\nexport {\n  StorageType,\n  autoDetectStorage\n};\n//# sourceMappingURL=autoDetectStorage.mjs.map\n","import { Device } from \"./Device.mjs\";\nfunction isIPhone6(query) {\n  if (!(query.type === \"device\" && query.value === \"iPhone6\")) return false;\n  if (Device.ios) {\n    if (window.outerHeight === 667 && window.outerWidth === 375 && window.devicePixelRatio === 3) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction isGalaxyS5(query) {\n  if (!(query.type === \"device\" && query.value === \"s5\")) return false;\n  if (Device.android) {\n    if (window.outerHeight === 560 && window.outerWidth === 360 && window.devicePixelRatio === 3) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction isKindle(query) {\n  if (!(query.type === \"device\" && query.value === \"kindle\")) return false;\n  const ua = navigator.userAgent;\n  return /Kindle|Silk|KFAPW|KFARWI|KFASWI|KFFOWI|KFJW|KFMEWI|KFOT|KFSAW|KFSOWI|KFTBW|KFTHW|KFTT|WFFOWI/i.test(ua);\n}\nfunction isSafari18Dot4(query) {\n  var _a, _b;\n  if (!(query.type === \"browser\" && query.value === \"safari-18.4\")) return false;\n  const ua = Device.uaData;\n  const version = (_a = ua == null ? void 0 : ua.browser) == null ? void 0 : _a.version;\n  const name = (_b = ua == null ? void 0 : ua.browser) == null ? void 0 : _b.name;\n  if (name === \"Mobile Safari\") {\n    if (!version) return false;\n    const [major, minor] = version.split(\".\").map(Number);\n    if (major === 18 && minor === 4) {\n      return true;\n    }\n  }\n  return false;\n}\nfunction isSafari18(query) {\n  var _a, _b;\n  if (!(query.type === \"browser\" && query.value === \"safari-18\")) return false;\n  const ua = Device.uaData;\n  const version = (_a = ua == null ? void 0 : ua.browser) == null ? void 0 : _a.version;\n  const name = (_b = ua == null ? void 0 : ua.browser) == null ? void 0 : _b.name;\n  if (name === \"Mobile Safari\") {\n    if (!version) return false;\n    const [major] = version.split(\".\").map(Number);\n    if (major === 18) {\n      return true;\n    }\n  }\n  return false;\n}\nexport {\n  isGalaxyS5,\n  isIPhone6,\n  isKindle,\n  isSafari18,\n  isSafari18Dot4\n};\n//# sourceMappingURL=deviceQueries.mjs.map\n","import { UAParser } from \"ua-parser-js\";\nimport { autoDetectStorage, StorageType } from \"../detections/autoDetectStorage.mjs\";\nimport { isIPhone6, isGalaxyS5, isKindle, isSafari18Dot4, isSafari18 } from \"./deviceQueries.mjs\";\nvar GPU_TIER = /* @__PURE__ */ ((GPU_TIER2) => {\n  GPU_TIER2[GPU_TIER2[\"NONE\"] = 0] = \"NONE\";\n  GPU_TIER2[GPU_TIER2[\"LOW\"] = 1] = \"LOW\";\n  GPU_TIER2[GPU_TIER2[\"MEDIUM\"] = 2] = \"MEDIUM\";\n  GPU_TIER2[GPU_TIER2[\"HIGH\"] = 3] = \"HIGH\";\n  return GPU_TIER2;\n})(GPU_TIER || {});\nclass DeviceClass {\n  constructor() {\n    this.allowGPUData = true;\n    this.customQueries = [];\n    this.caches = {\n      query: {},\n      browser: {},\n      os: {},\n      device: {},\n      custom: {}\n    };\n    this.uaData = new UAParser().getResult();\n    this.isLocalStorageAllowed = autoDetectStorage(StorageType.LOCAL);\n    this.isSessionStorageAllowed = autoDetectStorage(StorageType.SESSION);\n    this._checkIPadPro();\n  }\n  get supportedFileFormats() {\n    console.warn(\"[Device] File format detection is no longer supported. Returning default values of false\");\n    return {\n      webp: false,\n      avif: false\n    };\n  }\n  get desktop() {\n    return !(this.uaData.device.type === \"tablet\" || this.uaData.device.type === \"mobile\");\n  }\n  get mobile() {\n    return this.isDevice(\"mobile\");\n  }\n  get phone() {\n    return this.isDevice(\"phone\");\n  }\n  get tablet() {\n    return this.isDevice(\"tablet\");\n  }\n  get android() {\n    return this.uaData.os.name === \"Android\";\n  }\n  get ios() {\n    return this.uaData.os.name === \"iOS\" || this.uaData.os.name === \"Mac OS\" && this.uaData.device.type === \"tablet\";\n  }\n  get kindle() {\n    return this.isDevice(\"kindle\");\n  }\n  get ie() {\n    return this.uaData.browser.name === \"IE\";\n  }\n  get gpu() {\n    console.warn(\"[Device] GPU data is no longer supported. Returning default value of 2\");\n    return 2;\n  }\n  /**\n   * Initialises async data about the device\n   */\n  async init() {\n    if (this.gpuData) return;\n    this.gpuData = {\n      tier: 2,\n      type: null\n    };\n  }\n  /**\n   * Adds a set of functions to the list to check against\n   *\n   * @param funcs - functions to check against\n   */\n  addQuery(...funcs) {\n    this.customQueries.push(...funcs);\n  }\n  /**\n   * Returns whether or not the query is true for this device\n   *\n   * @param query - query to be parsed\n   */\n  query(query) {\n    const cachedRes = this.checkCache(query, \"query\");\n    if (cachedRes !== null) return cachedRes;\n    const splitMatches = this.parseQuery(query);\n    let matches = true;\n    for (const match of splitMatches) {\n      const value = match;\n      switch (value.type) {\n        case \"browser\":\n          matches = this.isBrowser(value.value);\n          break;\n        case \"os\":\n          matches = this.isOS(value.value);\n          break;\n        case \"device\":\n          matches = this.isDevice(value.value);\n          break;\n        case \"gpu\":\n          console.warn(\"[Device] GPU data is no longer supported. Returning default value of 2\");\n          matches = this.isGPU(value.value);\n          break;\n        default:\n          matches = this.checkCustom(value);\n          break;\n      }\n      if (!matches) break;\n    }\n    this.addToCache(query, matches, \"query\");\n    return matches;\n  }\n  /**\n   * Returns whether or not the specified browser is being used\n   *\n   * @param value - value to test\n   */\n  isBrowser(value) {\n    const cachedRes = this.checkCache(value, \"browser\");\n    if (cachedRes !== null) return cachedRes;\n    const tests = [\n      () => this.checkCustom({ type: \"browser\", value }),\n      () => {\n        const isVersion = value.split(\":\");\n        if (isVersion.length > 1) {\n          return this.uaData.browser.version.split(\".\")[0] === isVersion[1];\n        }\n        return false;\n      },\n      () => this.uaData.browser.name.toLowerCase().replace(\" \", \"-\") === value\n    ];\n    return this.checkTests(tests, value, \"browser\");\n  }\n  /**\n   * Returns whether or not the specified OS is being used\n   *\n   * @param value - value to test\n   */\n  isOS(value) {\n    const cachedRes = this.checkCache(value, \"os\");\n    if (cachedRes !== null) return cachedRes;\n    const tests = [\n      () => this.checkCustom({ type: \"os\", value }),\n      () => {\n        const isVersion = value.split(\":\");\n        if (isVersion.length > 1) {\n          return this.uaData.os.version.split(\".\")[0] === isVersion[1];\n        }\n        return false;\n      },\n      () => {\n        if (value === \"mobile\" || value === \"desktop\") {\n          return value === \"mobile\" ? !this.desktop : this.desktop;\n        }\n        return false;\n      },\n      () => this.uaData.os.name.toLowerCase().replace(\" \", \"-\") === value\n    ];\n    return this.checkTests(tests, value, \"os\");\n  }\n  /**\n   * Returns whether or not the specified device is being used\n   *\n   * @param value - value to test\n   */\n  isDevice(value) {\n    const cachedRes = this.checkCache(value, \"device\");\n    if (cachedRes !== null) return cachedRes;\n    const tests = [\n      () => this.checkCustom({ type: \"device\", value }),\n      () => {\n        if (value === \"tablet\") return this.uaData.device.type === \"tablet\";\n        return false;\n      },\n      () => {\n        if (value === \"mobile\")\n          return this.uaData.device.type === \"tablet\" || this.uaData.device.type === \"mobile\";\n        return false;\n      },\n      () => {\n        if (value === \"phone\") {\n          return this.uaData.device.type === \"mobile\";\n        }\n        return false;\n      },\n      () => this.uaData.device.model === value\n    ];\n    return this.checkTests(tests, value, \"device\");\n  }\n  /**\n   * Returns whether or not the devices GPU is the correct tier\n   *\n   * @param value - value to test\n   */\n  isGPU(value) {\n    return this.gpu === Number(value);\n  }\n  /**\n   * Splits the query into its individual pieces ready to be processed\n   *\n   * @param query - query to be parsed\n   */\n  parseQuery(query) {\n    return query.split(\"--\").map((query2) => {\n      const split = query2.split(\":\").filter((value) => value !== \":\");\n      return {\n        type: split.shift(),\n        value: split.join(\":\")\n      };\n    });\n  }\n  /**\n   * Checks all the custom query functions to see if any of them match\n   *\n   * @param value - value to be checked\n   */\n  checkCustom(value) {\n    const cachedRes = this.checkCache(JSON.stringify(value), \"custom\");\n    if (cachedRes !== null) return cachedRes;\n    for (const query of this.customQueries) {\n      const queryTest = query;\n      if (queryTest(value)) {\n        this.addToCache(JSON.stringify(value), true, \"custom\");\n        return true;\n      }\n    }\n    this.addToCache(JSON.stringify(value), false, \"custom\");\n    return false;\n  }\n  checkCache(query, cacheType) {\n    if (this.caches[cacheType][query]) {\n      return this.caches[cacheType][query];\n    }\n    return null;\n  }\n  checkTests(tests, value, type) {\n    let res = false;\n    for (const test of tests) {\n      res = test();\n      if (res) break;\n    }\n    this.addToCache(value, res, type);\n    return res;\n  }\n  addToCache(query, result, cacheType) {\n    this.caches[cacheType][query] = result;\n  }\n  _checkIPadPro() {\n    const userAgent = this.uaData.ua;\n    const isMacOS = userAgent.includes(\"Mac OS\") && !userAgent.includes(\"like Mac OS\");\n    const touchCheck = \"ontouchstart\" in window;\n    if (isMacOS && touchCheck) {\n      this.uaData.device.type = \"tablet\";\n      this.uaData.device.vendor = \"apple\";\n      this.uaData.device.model = \"ipad-pro\";\n      console.warn(\"[Device]: OS cannot be determined on this device\");\n    }\n  }\n}\nconst Device = new DeviceClass();\nDevice.addQuery(isIPhone6, isGalaxyS5, isKindle, isSafari18Dot4, isSafari18);\nexport {\n  Device,\n  DeviceClass,\n  GPU_TIER\n};\n//# sourceMappingURL=Device.mjs.map\n","import { utils } from \"@pixi/sound\";\nimport { NakedPromise } from \"@play-co/commons\";\nimport { Assets, extensions, loadWebFont, loadTextures } from \"pixi.js\";\nimport { Plugin } from \"../app/Plugin.mjs\";\nimport { overrideAssetLoad } from \"./overrideAssetLoad.mjs\";\nimport { loadTexturesWrapper } from \"./plugins/loadTexture.mjs\";\nimport { loadWebFontWrapper } from \"./plugins/loadWebFont.mjs\";\nimport { atlasResolver } from \"./plugins/spineParser.mjs\";\nimport { deprecation } from \"../../utils/logging/deprecation.mjs\";\nimport { Device } from \"../../utils/system/devices/Device.mjs\";\noverrideAssetLoad();\nclass ResourcePlugin extends Plugin {\n  constructor() {\n    super(...arguments);\n    this.initialised = new NakedPromise();\n  }\n  /**\n   * Initializes PixiJS `Assets` class\n   */\n  async setup() {\n    if (Device.isBrowser(\"safari-18\")) {\n      utils.supported.ogg = false;\n      console.warn(\"iOS 18 has a bug with ogg support. Ogg files have been disabled.\");\n    }\n    await Assets.init(this.options);\n    this.initialised.resolve();\n  }\n  /**\n   * Loads assets from a path or a list of paths\n   *\n   * @param paths - The path or list of paths to load\n   * @deprecated since 8.4.0\n   */\n  async load(paths) {\n    deprecation(\"8.4.0\", \"Please use PixiJS Assets instead of ResourcePlugin. e.g Assets.load()\");\n    return typeof paths === \"string\" ? Assets.load(paths) : paths.map((path) => Assets.load(path));\n  }\n}\nextensions.remove(loadWebFont, loadTextures);\nextensions.add(loadWebFontWrapper, loadTexturesWrapper, atlasResolver);\nexport {\n  ResourcePlugin\n};\n//# sourceMappingURL=ResourcePlugin.mjs.map\n","import { Plugin } from \"../core/app/Plugin.mjs\";\nconst aliases = {\n  up: \"ArrowUp\",\n  down: \"ArrowDown\",\n  left: \"ArrowLeft\",\n  right: \"ArrowRight\",\n  space: \" \"\n};\nclass KeyBindingCollection {\n  constructor() {\n    this.map = {};\n  }\n  /**\n   *  Add a key binding\n   *\n   * @param binding - The key binding that will be added\n   */\n  add(binding) {\n    Object.entries(aliases).forEach(([key, value]) => {\n      if (key === binding.key) {\n        binding.key = value;\n      }\n    });\n    const list = this.map[binding.key] || [];\n    list.push(binding);\n    this.map[binding.key] = list;\n  }\n  /**\n   * Remove a key binding\n   *\n   * @param binding - The key binding that will be removed\n   */\n  remove(binding) {\n    const list = this.map[binding.key];\n    if (!list) return;\n    const index = list.indexOf(binding);\n    if (index < 0) return;\n    list.splice(index, 1);\n  }\n  /**\n   *  Retreive a key binding unsing its key id\n   *\n   * @param key - key binding id\n   * @returns key binding\n   */\n  bindingsByKey(key) {\n    return this.map[key] || [];\n  }\n}\nclass KeyboardPlugin extends Plugin {\n  /**\n   * @param app - Instance of the application\n   * @param options - Keyboard options\n   */\n  constructor(app, options) {\n    super(app, options);\n    this.enabled = true;\n    this._onKeyDown = (e) => {\n      if (!this.enabled || e.repeat) return;\n      const key = e.key;\n      const bindings = this._keyDownBindings.bindingsByKey(key);\n      for (const binding of bindings) {\n        if (binding.action) binding.action();\n        binding.isDown = true;\n      }\n    };\n    this._onBlur = () => {\n      if (!this.enabled) return;\n      const allDownBindings = this._keyDownBindings.map;\n      for (const key in allDownBindings) {\n        const bindings = allDownBindings[key];\n        for (const binding of bindings) {\n          if (binding.isDown) {\n            this._keyUpBindings.bindingsByKey(binding.key).forEach((bind) => {\n              var _a;\n              (_a = bind.action) == null ? void 0 : _a.call(bind);\n            });\n          }\n          binding.isDown = false;\n        }\n      }\n    };\n    this._onKeyUp = (e) => {\n      if (!this.enabled || e.repeat) return;\n      const key = e.key;\n      let bindings = this._keyUpBindings.bindingsByKey(key);\n      for (const binding of bindings) {\n        if (binding.action) binding.action();\n        binding.isDown = false;\n      }\n      bindings = this._keyDownBindings.bindingsByKey(key);\n      for (const binding of bindings) {\n        binding.isDown = false;\n      }\n    };\n    this._keyDownBindings = new KeyBindingCollection();\n    this._keyUpBindings = new KeyBindingCollection();\n    window.addEventListener(\"keydown\", this._onKeyDown);\n    window.addEventListener(\"keyup\", this._onKeyUp);\n    window.addEventListener(\"blur\", this._onBlur);\n  }\n  /** Empty key bindings for both key up and key down as well as remove event listeners*/\n  dispose() {\n    this._keyDownBindings.map = {};\n    this._keyUpBindings.map = {};\n    window.removeEventListener(\"keydown\", this._onKeyDown);\n    window.removeEventListener(\"keyup\", this._onKeyUp);\n    window.removeEventListener(\"blur\", this._onBlur);\n  }\n  bindKeyDown(key, action, options) {\n    if (typeof key === \"string\") {\n      return this._bindKeyDown(key, action, options);\n    }\n    return key.map((singleKey) => this._bindKeyDown(singleKey, action, options));\n  }\n  _bindKeyDown(key, action, options) {\n    const allowHold = (options == null ? void 0 : options.allowHold) || false;\n    const currentHoldTime = (options == null ? void 0 : options.holdTime) || 0.1;\n    const binding = { key, action, allowHold, currentHoldTime, holdTime: currentHoldTime };\n    this._keyDownBindings.add(binding);\n    return binding;\n  }\n  bindKeyUp(key, action) {\n    if (typeof key === \"string\") {\n      return this._bindKeyUp(key, action);\n    }\n    return key.map((singleKey) => this.bindKeyUp(singleKey, action));\n  }\n  _bindKeyUp(key, action) {\n    const binding = { key, action };\n    this._keyUpBindings.add(binding);\n    return binding;\n  }\n  /**\n   *  Unbind a key and its response\n   *\n   * @param binding - The key binding that will be removed\n   */\n  unbind(binding) {\n    this._keyDownBindings.remove(binding);\n    this._keyUpBindings.remove(binding);\n  }\n  /**\n   * Loop through bindings to see if keys are currently down and allowed to be held\n   *\n   * @param dt - delta time\n   */\n  update(dt) {\n    const bindings = this._keyDownBindings.map;\n    for (const key in bindings) {\n      const bind = bindings[key];\n      for (const b of bind) {\n        const element = b;\n        if (element.allowHold && element.isDown) {\n          if (element.currentHoldTime >= 0) {\n            element.currentHoldTime -= dt / 60;\n          } else {\n            element.currentHoldTime = element.holdTime;\n            if (element.action) element.action();\n          }\n        }\n      }\n    }\n  }\n  getBindings(key) {\n    return this._keyDownBindings.bindingsByKey(key);\n  }\n  isKeyDown(key) {\n    if (typeof key === \"string\") {\n      return this._isKeyDown(key);\n    }\n    const array = key.map((singleKey) => this._isKeyDown(singleKey));\n    for (const arr of array) {\n      const element = arr;\n      if (element === true) {\n        return true;\n      }\n    }\n    return false;\n  }\n  _isKeyDown(key) {\n    let isDown = false;\n    const bindings = this.getBindings(key);\n    if (!bindings) return false;\n    for (const key2 in bindings) {\n      const bind = bindings[key2];\n      if (bind.isDown) {\n        isDown = true;\n        break;\n      }\n    }\n    return isDown;\n  }\n}\nexport {\n  KeyBindingCollection,\n  KeyboardPlugin\n};\n//# sourceMappingURL=KeyboardPlugin.mjs.map\n","import { Lock, Vector2 } from \"@play-co/commons\";\nclass TouchInput {\n  // init\n  // -------------------------------------------------------------------------\n  constructor(source) {\n    this._enabled = true;\n    this._bubble = true;\n    this._down = false;\n    this._tapLock = new Lock();\n    this._source = source;\n    source == null ? void 0 : source.on(\"pointertap\", (event) => {\n      void this._onTap(event);\n    }).on(\"pointerdown\", (event) => {\n      this._onDown(event);\n    }).on(\"pointerup\", (event) => {\n      this._onUp(event);\n    }).on(\"pointerupoutside\", (event) => {\n      this._onUp(event);\n    }).on(\"pointerout\", (event) => {\n      var _a;\n      (_a = this.onOut) == null ? void 0 : _a.call(this, this._convertEvent(event));\n    }).on(\"pointermove\", (event) => {\n      var _a;\n      (_a = this.onMove) == null ? void 0 : _a.call(this, this._convertEvent(event));\n    });\n    this._updateEnabled();\n  }\n  // properties\n  // -------------------------------------------------------------------------\n  // enabled\n  get enabled() {\n    return this._enabled;\n  }\n  set enabled(enabled) {\n    this._enabled = enabled;\n    this._updateEnabled();\n  }\n  // bubble\n  get bubble() {\n    return this._bubble;\n  }\n  set bubble(bubble) {\n    this._bubble = bubble;\n  }\n  // api\n  // -------------------------------------------------------------------------\n  // emulate a tap\n  async triggerTap() {\n    this._down = true;\n    await this._onTap({\n      pointerId: 0,\n      global: { x: 0, y: 0 }\n    });\n  }\n  // private: updaters\n  // -------------------------------------------------------------------------\n  _updateEnabled() {\n    const source = this._source;\n    source.interactive = this.enabled;\n    source.cursor = this.enabled ? \"pointer\" : \"default\";\n  }\n  // private: event handlers\n  // -------------------------------------------------------------------------\n  async _onTap(event) {\n    var _a;\n    if (!this._bubble) event == null ? void 0 : event.stopImmediatePropagation();\n    if (this._down && this._tapLock.lock()) {\n      await ((_a = this.onTap) == null ? void 0 : _a.call(this, this._convertEvent(event)));\n      this._tapLock.unlock();\n    }\n    this._down = false;\n  }\n  _onDown(event) {\n    var _a;\n    if (!this._bubble) event == null ? void 0 : event.stopImmediatePropagation();\n    this._down = true;\n    (_a = this.onDown) == null ? void 0 : _a.call(this, this._convertEvent(event));\n  }\n  _onUp(event) {\n    var _a;\n    if ((_a = this.onUp) == null ? void 0 : _a.call(this, this._convertEvent(event))) {\n      this._down = false;\n    }\n  }\n  // private: support\n  // -------------------------------------------------------------------------\n  _convertEvent(event) {\n    return {\n      id: event.pointerId,\n      position: new Vector2(event.global.x, event.global.y)\n    };\n  }\n}\nexport {\n  TouchInput\n};\n//# sourceMappingURL=TouchInput.mjs.map\n","function autoDetectResolution() {\n  return Math.min(window.devicePixelRatio, 2);\n}\nexport {\n  autoDetectResolution\n};\n//# sourceMappingURL=autoDetectResolution.mjs.map\n","import { Device } from \"../devices/Device.mjs\";\nfunction autoDetectAntialias() {\n  return Device.desktop;\n}\nexport {\n  autoDetectAntialias\n};\n//# sourceMappingURL=autoDetectAntialias.mjs.map\n","function autoDetectTransparency() {\n  const canvas = document.createElement(\"canvas\");\n  let gl;\n  let debugInfo;\n  let renderer;\n  let transparent = false;\n  try {\n    gl = canvas.getContext(\"webgl\");\n    debugInfo = gl.getExtension(\"WEBGL_debug_renderer_info\");\n    renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n    const sub = renderer.substring(0, 8);\n    if (sub === \"Mali-400\" || sub === \"Mali-450\") {\n      transparent = true;\n    }\n  } catch (e) {\n    console.warn(\"WebGL or renderer info not supported!\");\n  }\n  return transparent;\n}\nexport {\n  autoDetectTransparency\n};\n//# sourceMappingURL=autoDetectTransparency.mjs.map\n","import { Container, autoDetectRenderer } from \"pixi.js\";\nimport { Plugin } from \"../core/app/Plugin.mjs\";\nimport { Device } from \"../utils/system/devices/Device.mjs\";\nimport { autoDetectResolution } from \"../utils/system/detections/autoDetectResolution.mjs\";\nimport { autoDetectAntialias } from \"../utils/system/detections/autoDetectAntialias.mjs\";\nimport { autoDetectTransparency } from \"../utils/system/detections/autoDetectTransparency.mjs\";\nif (Device.android) ;\nelse if (Device.ios) ;\nclass StagePlugin extends Plugin {\n  /**\n   *\n   * @param app - instance of the application\n   * @param options - stage options\n   */\n  constructor(app, options) {\n    super(app, options);\n    options.resolution = options.resolution ?? autoDetectResolution();\n    options.antialias = options.antialias ?? autoDetectAntialias();\n    options.powerPreference = options.powerPreference ?? \"high-performance\";\n    options.backgroundAlpha = options.backgroundAlpha ?? autoDetectTransparency() ? 0 : 1;\n    this.canvas = options.canvas = options.canvas || this._setupCanvas();\n    this.wrapper = document.createElement(\"div\");\n    this.wrapper.style.transformOrigin = \"0 0\";\n    this.wrapper.appendChild(options.canvas);\n    if (options.autoAddToDocument ?? true) {\n      document.body.appendChild(this.wrapper);\n    }\n    this.stage = new Container();\n    this.mainContainer = new Container();\n    this.overlayContainer = new Container();\n    this.stage.addChild(this.mainContainer);\n    this.stage.addChild(this.overlayContainer);\n    this.useHalfFPS = options.useHalfFPS ?? false;\n    this._halfTick = 0;\n    this.rendererPromise = autoDetectRenderer({ canvas: this.canvas, ...this.options });\n  }\n  async init() {\n    this.renderer = await this.rendererPromise;\n    if (this.renderer.accessibility) {\n      this.renderer.accessibility.debug = this.options.accessibilityDebug ?? false;\n      if (this.options.alwaysOnAccessibility ?? false) {\n        this.renderer.accessibility[\"_isMobileAccessibility\"] = true;\n        this.renderer.accessibility[\"_activate\"]();\n        this.renderer.accessibility[\"_destroyTouchHook\"]();\n      }\n    }\n  }\n  /**\n   * Creates a default canvas with some css styles applied.\n   */\n  _setupCanvas() {\n    const canvas = document.createElement(\"canvas\");\n    canvas.id = \"pixi-canvas\";\n    canvas.style.position = \"absolute\";\n    canvas.style.left = \"0px\";\n    canvas.style.right = \"0px\";\n    canvas.style.top = \"0px\";\n    canvas.style.bottom = \"0px\";\n    canvas.style.width = \"100%\";\n    canvas.style.height = \"100%\";\n    canvas.style.overflow = \"visible\";\n    canvas.style.display = \"block\";\n    canvas.style.margin = \"0 auto\";\n    return canvas;\n  }\n  /**\n   * Removes the update function from the apps update runner and adds it back again.\n   *\n   * This ensures that rendering is the last thing to happen. If it happens halfway it can introduce some jank where things fall\n   * out of sync\n   */\n  start() {\n    this.app.updateRunner.remove(this.update);\n    this.app.updateRunner.add(this.update);\n  }\n  /**\n   * Calls the renderer.render function. If halfTick is true then this function is called every other frame instead.\n   */\n  update(dt) {\n    if (!Device.ios || dt > 0.8) {\n      this._halfTick++;\n      if (!this.useHalfFPS || this._halfTick % 2) {\n        this.renderer.render(this.stage);\n      }\n    }\n  }\n  /**\n   * @returns the canvas element of the renderer\n   */\n  get view() {\n    return this.renderer.canvas;\n  }\n  get element() {\n    return this.renderer.canvas;\n  }\n  /**\n   * Sets the stage to be interactive... or not!\n   * This also covers affects accessibility too\n   */\n  set interactive(value) {\n    this.stage.interactive = value;\n    this.stage.interactiveChildren = value;\n  }\n  /**\n   * @returns whether the stage is interactive or not.\n   */\n  get interactive() {\n    return this.stage.interactive;\n  }\n}\nexport {\n  StagePlugin\n};\n//# sourceMappingURL=StagePlugin.mjs.map\n","function resizeDefault(w, h) {\n  return { rendererWidth: w, rendererHeight: h, canvasWidth: w, canvasHeight: h };\n}\nexport {\n  resizeDefault\n};\n//# sourceMappingURL=resizeDefault.mjs.map\n","import { throttle } from \"@play-co/commons\";\nimport { EventSystem } from \"pixi.js\";\nimport { Signal } from \"typed-signals\";\nimport { Plugin } from \"../../core/app/Plugin.mjs\";\nimport { StagePlugin } from \"../StagePlugin.mjs\";\nimport { resizeDefault } from \"./resizeDefault.mjs\";\nimport { Device } from \"../../utils/system/devices/Device.mjs\";\nclass ResizePlugin extends Plugin {\n  constructor(app, options) {\n    var _a;\n    super(app, options);\n    this.onResize = new Signal();\n    this._w = 0;\n    this._h = 0;\n    this._canvasWidth = 0;\n    this._canvasHeight = 0;\n    this.autoResize = options.autoResize ?? true;\n    this.resizeFunction = (options == null ? void 0 : options.resizeFunction) || resizeDefault;\n    this.fitToCanvasParent = options.fitToCanvasParent;\n    this.orientationLock = options.orientationLock ?? \"none\";\n    if (((_a = screen == null ? void 0 : screen.orientation) == null ? void 0 : _a.type) === void 0) {\n      this.orientationLock = \"none\";\n    }\n  }\n  /**\n   * begins to listen to the window resize event\n   */\n  prepare() {\n    var _a, _b;\n    if (this.orientationLock !== \"none\") {\n      this._overrideMapPositionToPoint();\n    }\n    if (this.autoResize) {\n      const stageView = (_b = (_a = this.app.get(StagePlugin)) == null ? void 0 : _a.view) == null ? void 0 : _b.parentElement;\n      const parent = this.fitToCanvasParent ? stageView : null;\n      window.addEventListener(\"resize\", () => {\n        const { width: width2, height: height2 } = this._getMeasurements(parent);\n        throttle(this.resize, Device.desktop ? 0 : 100, this)(width2, height2);\n      });\n      const { width, height } = this._getMeasurements(parent);\n      this.resize(width, height);\n    }\n  }\n  /**\n   * Get measurements from parent container, temporarily hiding canvas to avoid circular dependency\n   */\n  _getMeasurements(parent) {\n    if (!parent || !this.fitToCanvasParent) {\n      return {\n        width: (parent == null ? void 0 : parent.clientWidth) ?? window.innerWidth,\n        height: (parent == null ? void 0 : parent.clientHeight) ?? window.innerHeight\n      };\n    }\n    const stage = this.app.get(StagePlugin);\n    const canvas = stage == null ? void 0 : stage.canvas;\n    if (!(canvas == null ? void 0 : canvas.style)) {\n      return {\n        width: parent.clientWidth,\n        height: parent.clientHeight\n      };\n    }\n    const originalDisplay = canvas.style.display;\n    const needsHiding = originalDisplay !== \"none\";\n    try {\n      if (needsHiding) {\n        canvas.style.display = \"none\";\n      }\n      const width = parent.clientWidth;\n      const height = parent.clientHeight;\n      return { width, height };\n    } finally {\n      if (needsHiding) {\n        canvas.style.display = originalDisplay;\n      }\n    }\n  }\n  /**\n   * Override the mapPositionToPoint function to account for the manual transform of the canvas\n   */\n  _overrideMapPositionToPoint() {\n    EventSystem.prototype.mapPositionToPoint = (point, x, y) => {\n      const resolutionMultiplier = 1 / this.resolution;\n      const stage = this.app.get(StagePlugin);\n      const canvas = stage.canvas;\n      const canvasWidth = canvas.width;\n      const canvasHeight = canvas.height;\n      const canvasStyleWidth = parseFloat(canvas.style.width);\n      const canvasStyleHeight = parseFloat(canvas.style.height);\n      const isPortrait = this.orientationLock === \"portrait\";\n      const transformPoint = { x, y };\n      switch (screen.orientation.type) {\n        case \"portrait-primary\":\n          if (!isPortrait) {\n            transformPoint.x = y;\n            transformPoint.y = canvasStyleHeight - x;\n          }\n          break;\n        case \"landscape-primary\":\n          if (isPortrait) {\n            transformPoint.x = canvasStyleWidth - y;\n            transformPoint.y = x;\n          }\n          break;\n        case \"landscape-secondary\":\n          if (isPortrait) {\n            transformPoint.x = y;\n            transformPoint.y = canvasStyleHeight - x;\n          }\n          break;\n        case \"portrait-secondary\":\n          if (!isPortrait) {\n            transformPoint.y = canvasStyleWidth - y;\n          }\n          break;\n      }\n      point.x = transformPoint.x * (canvasWidth / canvasStyleWidth) * resolutionMultiplier;\n      point.y = transformPoint.y * (canvasHeight / canvasStyleHeight) * resolutionMultiplier;\n    };\n  }\n  /**\n   * adjust the resolution of the canvas on the fly!\n   */\n  set resolution(value) {\n    const renderer = this.app.get(StagePlugin).renderer;\n    renderer.resolution = value;\n    this.resize(this._w, this._h, true);\n  }\n  /**\n   * get the resolution of the renderer\n   */\n  get resolution() {\n    const renderer = this.app.get(StagePlugin).renderer;\n    return renderer.resolution;\n  }\n  /**\n   * resize function. called automatically if autoResize is true.\n   * if autoResize is false, its up to you to cal this.\n   *\n   * @param w - width of the window\n   * @param h - height of the window\n   * @param force - force the resize to happen even if the screen size remains the same\n   */\n  resize(w, h, force = false) {\n    var _a;\n    const stage = this.app.get(StagePlugin);\n    const renderer = stage.renderer;\n    const newOrientation = ((_a = screen == null ? void 0 : screen.orientation) == null ? void 0 : _a.type) ?? \"unknown\";\n    const isCorrectOrientation = this.orientationLock === \"none\" || newOrientation.includes(this.orientationLock);\n    const { canvasWidth, canvasHeight, rendererWidth, rendererHeight } = isCorrectOrientation ? this.resizeFunction(w, h) : this.resizeFunction(h, w);\n    if (force || this._w !== rendererWidth || this._h !== rendererHeight || this._canvasWidth !== canvasWidth || this._canvasHeight !== canvasHeight || this.currentOrientation !== newOrientation) {\n      this._w = rendererWidth;\n      this._h = rendererHeight;\n      this._canvasWidth = canvasWidth;\n      this._canvasHeight = canvasHeight;\n      this.currentOrientation = newOrientation;\n      const canvas = stage.canvas;\n      canvas.style.width = `${canvasWidth}px`;\n      canvas.style.height = `${canvasHeight}px`;\n      if (this.orientationLock !== \"none\" && this.currentOrientation !== \"unknown\") {\n        const isPortrait = this.orientationLock === \"portrait\";\n        switch (newOrientation) {\n          case \"portrait-primary\":\n            stage.wrapper.style.transform = isPortrait ? \"\" : `rotate(90deg) translate(0, -${canvasHeight}px)`;\n            break;\n          case \"landscape-primary\":\n            stage.wrapper.style.transform = isPortrait ? `rotate(-90deg) translate(-${canvasWidth}px, 0)` : \"\";\n            break;\n          case \"landscape-secondary\":\n            stage.wrapper.style.transform = isPortrait ? `rotate(90deg) translate(0, -${canvasHeight}px)` : \"\";\n            break;\n          case \"portrait-secondary\":\n            stage.wrapper.style.transform = isPortrait ? \"\" : `rotate(-90deg) translate(-${canvasWidth}px, 0)`;\n            break;\n        }\n      }\n      window.scrollTo(0, 0);\n      renderer.resize(this.w, this.h);\n      this.onResize.emit(this.w, this.h);\n    }\n  }\n  get w() {\n    return this._w;\n  }\n  get h() {\n    return this._h;\n  }\n  get width() {\n    return this._w;\n  }\n  get height() {\n    return this._h;\n  }\n  get canvasWidth() {\n    return this._canvasWidth;\n  }\n  get canvasHeight() {\n    return this._canvasHeight;\n  }\n  get isCorrectOrientation() {\n    return this.orientationLock === \"none\" || this.currentOrientation.includes(this.orientationLock);\n  }\n}\nexport {\n  ResizePlugin\n};\n//# sourceMappingURL=ResizePlugin.mjs.map\n","import { Container } from \"pixi.js\";\nclass EmptyScreen {\n  constructor(app) {\n    this.app = app;\n    this.view = new Container();\n  }\n  async init() {\n  }\n  async show() {\n  }\n  shown() {\n  }\n  async hide() {\n  }\n  async hidden() {\n  }\n  resize(w, h) {\n  }\n}\nexport {\n  EmptyScreen\n};\n//# sourceMappingURL=EmptyScreen.mjs.map\n","class History {\n  /**\n   * Create a history.\n   */\n  constructor() {\n    this.history = [];\n    this.currentIndex = -1;\n  }\n  /**\n   * Navigate to a new screen.\n   *\n   * @param id - The id of the screen.\n   * @param data - The data associated with the screen.\n   */\n  navigate(id, data) {\n    this.history = this.history.slice(0, this.currentIndex + 1);\n    this.history.push({ id, data });\n    this.currentIndex++;\n  }\n  /**\n   * Go back to the previous screen.\n   *\n   * @returns The previous screen object, or null if there is no previous screen.\n   */\n  back() {\n    if (this.canGoBack()) {\n      this.currentIndex--;\n      return this.currentScreen();\n    }\n    return null;\n  }\n  /**\n   * Go forward to the next screen.\n   *\n   * @returns The next screen object, or null if there is no next screen.\n   */\n  forward() {\n    if (this.canGoForward()) {\n      this.currentIndex++;\n      return this.currentScreen();\n    }\n    return null;\n  }\n  /**\n   * Check if it's possible to go back.\n   *\n   * @returns True if it's possible to go back, false otherwise.\n   */\n  canGoBack() {\n    return this.currentIndex > 0;\n  }\n  /**\n   * Check if it's possible to go forward.\n   *\n   * @returns True if it's possible to go forward, false otherwise.\n   */\n  canGoForward() {\n    return this.currentIndex < this.history.length - 1;\n  }\n  /**\n   * Get the current screen.\n   *\n   * @returns The current screen object.\n   */\n  currentScreen() {\n    return this.history[this.currentIndex];\n  }\n}\nexport {\n  History\n};\n//# sourceMappingURL=History.mjs.map\n","import { Container, Graphics, Sprite } from \"pixi.js\";\nclass Bar extends Container {\n  constructor(options = {}) {\n    super();\n    this.barWidth = options.width ?? 100;\n    const bg = this.getPixiObject(options.bg, this.barWidth);\n    const frame = this.getPixiObject(options.frame, this.barWidth);\n    const bar = this.getPixiObject(options.bar ?? 16711680, this.barWidth);\n    if (options.frameTint !== void 0) {\n      frame.tint = 4144959;\n    }\n    this._easing = options.easing ?? 1;\n    this._easeRatio = 0;\n    this._ratio = 0;\n    if (bg) {\n      this.bg = bg;\n      this.addChild(bg);\n    }\n    if (bar) {\n      this.addChild(bar);\n      this.bar = bar;\n    }\n    if (frame) {\n      if (frame.width > bar.width) {\n        frame.x = -(frame.width - bar.width) / 2;\n      }\n      if (frame.height > bar.height) {\n        frame.y = -(frame.height - bar.height) / 2;\n      }\n      this.addChild(frame);\n    }\n    const mask = this.getPixiObject(options.mask, this.barWidth);\n    if (mask) {\n      this._barMask = mask;\n      this.addChild(this._barMask);\n      this.bar.mask = this._barMask;\n      this._barMask.x -= this.bar.width;\n    }\n    this.onRender = this._updateTransform;\n  }\n  _updateTransform() {\n    this._easeRatio += (this._ratio - this._easeRatio) * this._easing;\n    if (this.bar && !this._barMask) {\n      this.bar.scale.x = this._easeRatio;\n    } else if (this._barMask) {\n      this._barMask.x = -this._barMask.width + this._barMask.width / 100 * (this._easeRatio * 100);\n    }\n  }\n  getPixiObject(id, width) {\n    let item = null;\n    if (typeof id === \"number\") {\n      item = new Graphics();\n      item.context.fill({\n        color: id\n      }).rect(0, 0, width, 40);\n    } else if (typeof id === \"string\") {\n      item = Sprite.from(id);\n    } else {\n      item = id;\n    }\n    return item;\n  }\n  set ratio(value) {\n    this._ratio = Math.max(Math.min(value, 1), 0);\n  }\n  get ratio() {\n    return this._ratio;\n  }\n}\nexport {\n  Bar\n};\n//# sourceMappingURL=Bar.mjs.map\n","import { gsap } from \"gsap\";\nimport { Container } from \"pixi.js\";\nimport { Bar } from \"../temp-ui/Bar.mjs\";\nclass LoaderScreen {\n  constructor() {\n    this.view = new Container();\n    this.bar = new Bar({ bg: 0, bar: 16711680, width: 300 });\n    this.view.addChild(this.bar);\n  }\n  updateProgress(value) {\n    this.bar.ratio = value;\n  }\n  show() {\n    this.view.alpha = 0;\n    gsap.to(this.view, 0.4, { alpha: 1 });\n  }\n  hide() {\n    return new Promise((resolve) => {\n      gsap.to(this.view, 0.4, { alpha: 0, onComplete: resolve });\n    });\n  }\n  resize(w, h) {\n    this.bar.x = w / 2 - this.bar.barWidth / 2;\n    this.bar.y = h / 2;\n  }\n}\nexport {\n  LoaderScreen\n};\n//# sourceMappingURL=LoaderScreen.mjs.map\n","class TransitionManager {\n  constructor() {\n    this._transitionMap = {};\n  }\n  get default() {\n    if (this._transitionMap.all) {\n      return this._transitionMap.all.all;\n    }\n    return null;\n  }\n  set default(value) {\n    if (\"transition\" in value) {\n      this.register(value);\n    } else {\n      this.register({ transition: value });\n    }\n  }\n  register(transitionData) {\n    const defaults = {\n      from: \"all\",\n      to: \"all\",\n      both: false\n    };\n    const cleanedData = Object.fromEntries(Object.entries(transitionData).filter(([_, value]) => value != null));\n    const { from, to, both, transition, ...rest } = { ...defaults, ...cleanedData };\n    let mapping = this._transitionMap[from];\n    if (!mapping) {\n      mapping = this._transitionMap[from] = {};\n    }\n    mapping[to] = { transition, ...rest };\n    if (both) {\n      this.register({ transition, from: to, to: from, ...rest });\n    }\n  }\n  get(currentId, nextId) {\n    const checkAndReturn = (from, to) => {\n      if (this._transitionMap[from]) {\n        return this._transitionMap[from][to] || this._transitionMap[from].all;\n      }\n      return null;\n    };\n    return checkAndReturn(currentId, nextId) || checkAndReturn(\"all\", nextId) || this.default;\n  }\n}\nexport {\n  TransitionManager\n};\n//# sourceMappingURL=TransitionManager.mjs.map\n","import { gsap } from \"gsap\";\nclass AlphaTransition {\n  constructor(data = {}) {\n    this.autoManageContainers = true;\n    this.duration = 0.4;\n    this.prepare(data);\n  }\n  prepare(data) {\n    this.duration = data.duration || this.duration;\n  }\n  /**\n   * Begins the transition to hide the current screen.\n   *\n   * @param _container - The container of the screen.\n   * @param current - The current screen.\n   * @returns A promise that resolves when the transition is complete.\n   */\n  hide(_container, current) {\n    return new Promise((resolve) => {\n      gsap.to(current.view, {\n        duration: this.duration,\n        alpha: 0,\n        onComplete: () => {\n          current.view.alpha = 1;\n          resolve();\n        }\n      });\n    });\n  }\n  /**\n   * Begins the transition to show the next screen.\n   *\n   * @param _container - The container of the screen.\n   * @param _current - The current screen.\n   * @param next - The next screen.\n   * @returns A promise that resolves when the transition is complete.\n   */\n  show(_container, _current, next) {\n    return new Promise((resolve) => {\n      next.view.alpha = 0;\n      gsap.to(next.view, {\n        duration: this.duration,\n        alpha: 1,\n        onComplete: () => {\n          resolve();\n        }\n      });\n    });\n  }\n}\nexport {\n  AlphaTransition\n};\n//# sourceMappingURL=AlphaTransition.mjs.map\n","import { Container, Assets } from \"pixi.js\";\nimport { Signal } from \"typed-signals\";\nimport { EmptyScreen } from \"./EmptyScreen.mjs\";\nimport { History } from \"./History.mjs\";\nimport { LoaderScreen } from \"./loader/LoaderScreen.mjs\";\nimport { TransitionManager } from \"./TransitionManager.mjs\";\nimport { AlphaTransition } from \"./transitions/AlphaTransition.mjs\";\nclass ScreenGroup {\n  constructor(app, options) {\n    this.onChange = new Signal();\n    this.onShown = new Signal();\n    this.w = 0;\n    this.h = 0;\n    this.history = new History();\n    this._loaderActive = false;\n    this._applyLoaderAsOverlay = false;\n    this._loadingScreenDelay = 1e3;\n    this.options = options;\n    this.app = app;\n    this.view = (options == null ? void 0 : options.view) || new Container();\n    this.transitionManager = new TransitionManager();\n    if (options == null ? void 0 : options.defaultTransitionClass) {\n      this.transitionManager.default = new options.defaultTransitionClass(options.defaultTransitionOptions);\n    } else {\n      this.transitionManager.default = new AlphaTransition(options == null ? void 0 : options.defaultTransitionOptions);\n    }\n    this.screens = {};\n    this.add(EmptyScreen, {}, \"empty\", true);\n    this.currentScreenId = \"empty\";\n    this.visibleScreens = [];\n    this._applyLoaderAsOverlay = (options == null ? void 0 : options.applyLoaderAsOverlay) ?? false;\n    this._loadingScreenDelay = (options == null ? void 0 : options.loadingScreenDelay) ?? 1e3;\n  }\n  /** Gets the currently visible screens. */\n  getVisibleScreens() {\n    return this.visibleScreens.map((screenData) => screenData.instance);\n  }\n  /** Get the instance of a screen by its id. */\n  get(id) {\n    var _a;\n    return (_a = this.screens[id]) == null ? void 0 : _a.instance;\n  }\n  /**\n   * @deprecated Use `get` instead.\n   */\n  getScreen(id) {\n    return this.get(id);\n  }\n  /**\n   * Add a screen to the group.\n   *\n   * @param Class - The class of the screen to add.\n   * @param options - The options to pass to the screen.\n   * @param id - The id of the screen.\n   * @param async - Whether the screen should be initialized right away.\n   */\n  add(Class, options, id, async = false) {\n    if (this.screens[id]) {\n      throw new Error(`Screen id ${id} has already been assigned`);\n    }\n    const screenData = { instance: null, class: Class, options, id };\n    if (async) {\n      screenData.instance = new Class(this.app, screenData.options);\n    }\n    this.screens[id] = screenData;\n  }\n  /**\n   * Go to the previous screen in the history.\n   */\n  async back() {\n    const lastScreen = this.history.back();\n    if (!lastScreen) return;\n    await this.show(lastScreen.id, { force: true, data: lastScreen.data }, true);\n  }\n  /**\n   * Go to the next screen in the history.\n   */\n  async forward() {\n    const nextScreen = this.history.forward();\n    if (!nextScreen) return;\n    await this.show(nextScreen.id, { force: true, data: nextScreen.data }, true);\n  }\n  /**\n   * Go to a screen by its id.\n   *\n   * @param id - The id of the screen to go to.\n   * @param data - The data to pass to the screen.\n   * @returns A promise that resolves when the screen has been navigated to.\n   */\n  async show(id, data = {}, omitFromHistory = false) {\n    if (this.currentScreenId === id && !data.force) return;\n    if (!this.screens[id]) {\n      throw new Error(`Screen id ${id} does not exist`);\n    }\n    this.nextScreenId = id;\n    this.nextData = data;\n    if (this.transitionPromise) {\n      if (this.nextScreenId === id) {\n        return;\n      }\n      await this.transitionPromise;\n      return;\n    } else if (this.currentScreenId === id && !data.force) {\n      return;\n    }\n    this.onChange.emit(id, data);\n    this.transitionPromise = this.createTransitionPromise(\n      this.nextData.data,\n      omitFromHistory,\n      this.nextData.transitionOptions\n    );\n    await this.transitionPromise;\n    this.transitionPromise = null;\n    this.onShown.emit(id, data);\n  }\n  /**\n   * @deprecated Use `show` instead.\n   */\n  async goto(id, data = {}) {\n    return this.show(id, data);\n  }\n  async hide() {\n    return this.show(\"empty\");\n  }\n  /**\n   * Preload a screen's assets without navigating to it.\n   * Creates the screen instance if it doesn't already exist.\n   *\n   * @param id - The id of the screen to preload.\n   * @param data - Optional data to pass to the screen's preload function.\n   * @returns A promise that resolves when preloading is complete.\n   */\n  async preloadScreen(id, data) {\n    var _a, _b;\n    const screenData = this.screens[id];\n    if (!screenData) {\n      throw new Error(`Screen id ${id} does not exist`);\n    }\n    const previousInstance = screenData.instance;\n    if (!screenData.instance) {\n      screenData.instance = new screenData.class(this.app, screenData.options);\n    }\n    await this._loadScreen(screenData, data == null ? void 0 : data.data);\n    if (!previousInstance) {\n      await ((_b = (_a = screenData.instance).init) == null ? void 0 : _b.call(_a, screenData.options));\n    }\n  }\n  createTransitionPromise(screenSessionData, skipNavigationEntry = false, transitionOptions) {\n    return new Promise(async (resolve) => {\n      var _a, _b, _c, _d, _e, _f, _g, _h, _i, _j, _k, _l;\n      this.view.interactiveChildren = false;\n      const {\n        transition,\n        loadingScreenDelay,\n        applyLoaderAsOverlay,\n        loaderOptions,\n        loaderScreenClass,\n        loadBeforeTransition\n      } = transitionOptions ?? this.transitionManager.get(this.currentScreenId, this.nextScreenId);\n      const autoManageContainers = transition.autoManageContainers;\n      const currentData = this.screens[this.currentScreenId];\n      const nextData = this.screens[this.nextScreenId];\n      const firstRun = !nextData.instance;\n      const isEmptyScreen = this.currentScreenId === \"empty\" || (currentData == null ? void 0 : currentData.instance) instanceof EmptyScreen;\n      const shouldRemoveScreen = applyLoaderAsOverlay ?? this._applyLoaderAsOverlay;\n      if (firstRun) {\n        nextData.instance = new nextData.class(this.app, nextData.options);\n      }\n      let loadPromise = Promise.resolve();\n      let loadComplete = false;\n      let loader = this.loader;\n      const loadBefore = loadBeforeTransition ?? this.options.loadBeforeTransition;\n      loadPromise = this._loadScreen(nextData, screenSessionData).then(() => {\n        var _a2;\n        loadComplete = true;\n        (_a2 = loader == null ? void 0 : loader.complete) == null ? void 0 : _a2.call(loader);\n      });\n      if (loadBefore) {\n        loader = this._initLoader(loaderScreenClass, loaderOptions);\n        await this._awaitLoad(\n          loadPromise,\n          loadingScreenDelay ?? this._loadingScreenDelay,\n          loadComplete,\n          async () => {\n          }\n        );\n      }\n      await ((_a = transition.prepare) == null ? void 0 : _a.call(transition, (transitionOptions == null ? void 0 : transitionOptions.data) || {}));\n      (_b = transition.resize) == null ? void 0 : _b.call(transition, this.w, this.h);\n      if (currentData) {\n        await ((_d = (_c = currentData.instance).hide) == null ? void 0 : _d.call(_c));\n        const hideCurrentScreen = !isEmptyScreen || isEmptyScreen && transition.forceHideOnEmptyScreen;\n        if (hideCurrentScreen) await transition.hide(this.view, currentData.instance, nextData.instance);\n        if (!shouldRemoveScreen) {\n          this._hideScreen(currentData, autoManageContainers);\n        }\n      }\n      if (!loadBefore) {\n        loader = this._initLoader();\n        await this._awaitLoad(\n          loadPromise,\n          loadingScreenDelay ?? this._loadingScreenDelay,\n          loadComplete,\n          async () => {\n            var _a2, _b2;\n            if (firstRun) {\n              await ((_b2 = (_a2 = nextData.instance).init) == null ? void 0 : _b2.call(_a2, nextData.options));\n            }\n          }\n        );\n      } else {\n        if (firstRun) {\n          await ((_f = (_e = nextData.instance).init) == null ? void 0 : _f.call(_e, nextData.options));\n        }\n      }\n      this.currentScreenId = nextData.id;\n      if (!skipNavigationEntry) {\n        this.history.navigate(this.currentScreenId, screenSessionData);\n      }\n      if (shouldRemoveScreen) {\n        this._hideScreen(currentData, autoManageContainers);\n      }\n      await ((_h = (_g = nextData.instance).prepare) == null ? void 0 : _h.call(_g, screenSessionData));\n      nextData.instance.resize(this.w, this.h);\n      await ((_j = (_i = nextData.instance).show) == null ? void 0 : _j.call(_i));\n      this.view.interactiveChildren = true;\n      this.visibleScreens.push(nextData);\n      if (autoManageContainers) {\n        this.view.addChild(nextData.instance.view);\n      }\n      await transition.show(this.view, currentData == null ? void 0 : currentData.instance, nextData.instance);\n      (_l = (_k = nextData.instance).shown) == null ? void 0 : _l.call(_k);\n      const index = this.visibleScreens.indexOf(currentData);\n      if (index !== -1) {\n        this.visibleScreens.splice(index, 1);\n      }\n      if (this.currentScreenId !== this.nextScreenId) {\n        await this.createTransitionPromise(this.nextData.data, void 0, this.nextData.transitionOptions);\n      }\n      resolve();\n    });\n  }\n  resize(w, h) {\n    this.w = w;\n    this.h = h;\n    if (this.screens[this.currentScreenId]) {\n      this.screens[this.currentScreenId].instance.resize(w, h);\n    }\n    if (this.loader) this.loader.resize(w, h);\n  }\n  update(dt) {\n    var _a, _b;\n    const vs = this.visibleScreens;\n    for (const screen of vs) {\n      if (screen.instance.update) {\n        screen.instance.update(dt);\n      }\n    }\n    if (this._loaderActive) {\n      (_b = (_a = this.loader).update) == null ? void 0 : _b.call(_a, dt);\n    }\n  }\n  _initLoader(loaderScreenClass, loaderOptions) {\n    var _a, _b, _c, _d, _e;\n    if (!this.loader) {\n      const LoaderScreenClass = loaderScreenClass ?? (((_a = this.options) == null ? void 0 : _a.loaderScreenClass) || LoaderScreen);\n      this.loader = new LoaderScreenClass(this.app);\n      (_c = (_b = this.loader).prepare) == null ? void 0 : _c.call(_b, loaderOptions ?? this.options.loaderOptions ?? {});\n      this.loader.resize(this.w, this.h);\n    } else {\n      (_e = (_d = this.loader).prepare) == null ? void 0 : _e.call(_d, loaderOptions ?? this.options.loaderOptions ?? {});\n      this.loader.resize(this.w, this.h);\n    }\n    return this.loader;\n  }\n  async _awaitLoad(loadPromise, loadingScreenDelay, loadComplete, loadCompleteCallback) {\n    const timeoutId = setTimeout(() => {\n      var _a, _b;\n      if (!loadComplete) {\n        this.view.addChild(this.loader.view);\n        this.loader.show();\n        (_b = (_a = this.loader).start) == null ? void 0 : _b.call(_a);\n        this._loaderActive = true;\n      }\n    }, loadingScreenDelay);\n    await loadPromise;\n    await loadCompleteCallback();\n    if (this._loaderActive) {\n      await this.loader.hide();\n      this._loaderActive = false;\n      this.view.removeChild(this.loader.view);\n    } else {\n      clearTimeout(timeoutId);\n    }\n  }\n  _loadScreen(screenData, transitionData) {\n    return new Promise(async (resolve) => {\n      const screen = screenData.instance;\n      const manifests = [];\n      const assets = [];\n      const screenPromises = [];\n      let manifestProgress = 0;\n      let assetProgress = 0;\n      let promiseProgress = 0;\n      let totalProgress = 0;\n      if (screen.preload) {\n        if (screen.preload) {\n          const preloadData = await screen.preload(transitionData);\n          if (preloadData) {\n            manifests.push(...preloadData.manifests ?? []);\n            assets.push(...preloadData.assets ?? []);\n            screenPromises.push(...preloadData.promises ?? []);\n          }\n        }\n      }\n      if (screen.manifests || screen.assets) {\n        if (screen.manifests) manifests.push(...screen.manifests);\n        if (screen.assets) assets.push(...screen.assets);\n      }\n      if (manifests.length) ++totalProgress;\n      if (assets.length) ++totalProgress;\n      if (screenPromises.length) ++totalProgress;\n      await Promise.all([\n        Assets.loadBundle(manifests, (progress) => {\n          var _a, _b;\n          manifestProgress = progress;\n          (_b = (_a = this.loader) == null ? void 0 : _a.updateProgress) == null ? void 0 : _b.call(_a, (manifestProgress + assetProgress + promiseProgress) / totalProgress);\n        }),\n        Assets.load(assets, (progress) => {\n          var _a, _b;\n          assetProgress = progress;\n          (_b = (_a = this.loader) == null ? void 0 : _a.updateProgress) == null ? void 0 : _b.call(_a, (manifestProgress + assetProgress + promiseProgress) / totalProgress);\n        }),\n        ...screenPromises.map(async (promise) => {\n          var _a, _b;\n          await promise;\n          promiseProgress += 1 / screenPromises.length;\n          (_b = (_a = this.loader) == null ? void 0 : _a.updateProgress) == null ? void 0 : _b.call(_a, (manifestProgress + assetProgress + promiseProgress) / totalProgress);\n        })\n      ]);\n      resolve();\n    });\n  }\n  _hideScreen(currentData, autoManageContainers) {\n    if (autoManageContainers) {\n      this.view.removeChild(currentData == null ? void 0 : currentData.instance.view);\n    }\n    if (currentData == null ? void 0 : currentData.instance.hidden) {\n      void currentData.instance.hidden();\n    }\n  }\n}\nexport {\n  ScreenGroup\n};\n//# sourceMappingURL=ScreenGroup.mjs.map\n","import { Container } from \"pixi.js\";\nimport { Plugin } from \"../core/app/Plugin.mjs\";\nimport { ScreenGroup } from \"./ScreenGroup.mjs\";\nimport { ResizePlugin } from \"../stage/resize/ResizePlugin.mjs\";\nimport { StagePlugin } from \"../stage/StagePlugin.mjs\";\nclass ScreensPlugin extends Plugin {\n  constructor(app, options) {\n    super(app, options);\n    this.w = 0;\n    this.h = 0;\n    this.stack = [];\n    this.view = new Container();\n    const layers = {};\n    const config = (options == null ? void 0 : options.config) ? Object.entries(options.config) : [];\n    if (!config.find(([id]) => id === \"main\")) {\n      config.unshift([\"main\", { options: options.main }]);\n    }\n    if (!config.find(([id]) => id === \"overlay\")) {\n      const index = config.findIndex(([id]) => id === \"main\");\n      config.splice(index + 1, 0, [\"overlay\", { options: options.overlay }]);\n    }\n    config.forEach(([id, config2]) => {\n      var _a;\n      const layer = new ScreenGroup(this.app, config2.options);\n      this.view.addChild(layer.view);\n      layers[id] = layer;\n      this.stack.push(layer);\n      for (const screenId in config2.screens) {\n        const screenData = config2.screens[screenId];\n        const isClass = typeof screenData === \"function\";\n        const screenClass = isClass ? screenData : screenData.screen;\n        const screenOptions = isClass ? {} : screenData.options;\n        const isAsync = isClass ? false : screenData.async;\n        layer.add(screenClass, screenOptions, screenId, isAsync);\n        if (isClass) continue;\n        (_a = screenData.transitions) == null ? void 0 : _a.forEach((transition) => {\n          layer.transitionManager.register({\n            ...transition,\n            from: transition.from ?? screenId\n          });\n        });\n      }\n    });\n    this.layers = layers;\n  }\n  /**\n   * Getter for the main layer of screens.\n   *\n   * @returns The main `ScreenGroup`.\n   */\n  get main() {\n    return this.layers.main;\n  }\n  /**\n   * Getter for the overlay layer of screens.\n   *\n   * @returns The overlay `ScreenGroup`.\n   */\n  get overlay() {\n    return this.layers.overlay;\n  }\n  /** Prepare the plugin by adding the view to the stage and setting up the resize event. */\n  prepare() {\n    const resizer = this.app.get(ResizePlugin);\n    const stage = this.app.get(StagePlugin);\n    if (resizer) {\n      resizer.onResize.connect(this.resize.bind(this));\n      this.resize(resizer.w, resizer.h);\n    }\n    stage.mainContainer.addChild(this.view);\n  }\n  /**\n   * Add a screen to the main layer.\n   *\n   * @param screenClass - The class of the screen to add.\n   * @param options - The options to pass to the screen.\n   * @param id - The id of the screen.\n   * @param async - Whether the screen should be loaded asynchronously.\n   *\n   * @deprecated Use `screens.main.add` instead.\n   */\n  add(screenClass, options, id, async = false) {\n    this.addToLayer(\"main\", screenClass, options, id, async);\n  }\n  /**\n   * Add a screen to the specified layer.\n   *\n   * @param layer - The name of the layer to add the screen to.\n   * @param screenClass - The class of the screen to add.\n   * @param options - The options to pass to the screen.\n   * @param id - The id of the screen.\n   * @param async - Whether the screen should be loaded asynchronously.\n   *\n   * @deprecated Use `screens.layers.xxx.add` instead.\n   */\n  addToLayer(layer, screenClass, options, id, async = false) {\n    const group = this.layers[layer];\n    if (!group) {\n      throw new Error(`Layer ${layer} does not exist`);\n    }\n    group.add(screenClass, options, id, async);\n  }\n  /**\n   * Add multiple screens to the layers.\n   *\n   * @param screens - The screens to add.\n   *\n   * @deprecated Pass in a `ScreensConfigOptions` object that combines\n   * both layers data and screens data as a single `config` parameter\n   * on the plugin option instead.\n   */\n  addScreens(screens) {\n    screens.forEach((data) => {\n      var _a;\n      const layer = this.layers[data.layer];\n      layer.add(data.screen, data.options, data.id, data.async);\n      (_a = data.transitions) == null ? void 0 : _a.forEach((transition) => {\n        layer.transitionManager.register({\n          ...transition,\n          from: transition.from ?? data.id\n        });\n      });\n    });\n  }\n  /**\n   * Transitions to a screen on the main layer.\n   *\n   * @param id - The id of the screen to go to.\n   * @param data - The data to pass to the screen.\n   * @returns A promise that resolves when the screen has been navigated to.\n   *\n   * @deprecated Use `screens.main.show` instead.\n   */\n  async goto(id, data = {}) {\n    return this.main.goto(id, data);\n  }\n  /**\n   * Gets a layer by name.\n   *\n   * @deprecated Use `screens.layers.xxx` instead.\n   */\n  getLayer(layer) {\n    return this.layers[layer];\n  }\n  /**\n   * Transitions to a screen.\n   *\n   * @param layer - The name of the layer to add the screen to.\n   * @param id - The id of the screen to go to.\n   * @param data - The data to pass to the screen.\n   * @returns A promise that resolves when the screen has been navigated to.\n   *\n   * @deprecated Use `screens.layers.xxx.goto` instead.\n   */\n  gotoLayer(layer, id, data = {}) {\n    const group = this.layers[layer];\n    if (!group) {\n      throw new Error(`Layer '${layer}' does not exist`);\n    }\n    return group.goto(id, data);\n  }\n  /**\n   * Adds a new layer to the screen stack at the top.\n   *\n   * @param name - The name of the layer.\n   * @param options - The options for the screen group.\n   */\n  addLayer(name, options) {\n    this.addLayerAt(name, options, this.stack.length);\n  }\n  /**\n   * Removes a layer from the screen stack.\n   *\n   * @param name - The name of the layer to remove.\n   */\n  removeLayer(name) {\n    const group = this.layers[name];\n    if (!group) {\n      throw new Error(`Layer '${name}' does not exist`);\n    }\n    this.view.removeChild(group.view);\n    delete this.layers[name];\n    this.stack.splice(this.stack.indexOf(group), 1);\n  }\n  /**\n   * Adds a new layer to the screen stack at a specific index.\n   *\n   * @param name - The name of the layer.\n   * @param options - The options for the screen group.\n   * @param index - The index at which to add the new layer.\n   */\n  addLayerAt(name, options, index) {\n    if (index > this.stack.length || index < 0) {\n      throw new Error(`Layer index ${index}, is out of bound`);\n    }\n    if (this.layers[name]) {\n      throw new Error(`Layer '${name}' already exists`);\n    }\n    const group = new ScreenGroup(this.app, options);\n    this.view.addChildAt(group.view, index);\n    this.layers[name] = group;\n    this.stack.splice(index, 0, group);\n  }\n  /**\n   * Sets the index of a layer in the screen stack.\n   *\n   * @param name - The name of the layer.\n   * @param index - The new index for the layer.\n   */\n  setLayerIndex(name, index) {\n    if (index >= this.stack.length) {\n      throw new Error(`Layer index ${index}, is out of bound`);\n    }\n    const group = this.layers[name];\n    if (!group) {\n      throw new Error(`Layer '${name}' does not exist`);\n    }\n    this.view.setChildIndex(group.view, index);\n    this.stack.splice(this.stack.indexOf(group), 1);\n    this.stack.splice(index, 0, group);\n  }\n  /** Resizes all the screen groups. */\n  resize(w, h) {\n    this.w = w;\n    this.h = h;\n    this.stack.forEach((group) => {\n      group.resize(w, h);\n    });\n  }\n  /** Updates all the screen groups. */\n  update(dt) {\n    this.stack.forEach((group) => {\n      group.update(dt);\n    });\n  }\n}\nexport {\n  ScreensPlugin\n};\n//# sourceMappingURL=ScreensPlugin.mjs.map\n","function gameResize(logicalWidth, logicalHeight) {\n  return (w, h) => {\n    if (w > h) {\n      const ratioW2 = w / logicalWidth;\n      const ratioH2 = logicalHeight / h;\n      return {\n        rendererWidth: Math.round(Math.floor(logicalWidth * ratioW2 * ratioH2)),\n        rendererHeight: logicalHeight,\n        canvasWidth: w,\n        canvasHeight: h\n      };\n    }\n    const ratioW = logicalWidth / w;\n    const ratioH = h / logicalHeight;\n    return {\n      rendererWidth: logicalWidth,\n      rendererHeight: Math.round(Math.floor(logicalHeight * ratioH * ratioW)),\n      canvasWidth: w,\n      canvasHeight: h\n    };\n  };\n}\nfunction aspectResize(minWidth, minHeight, fixCanvasSize = false) {\n  const aspectRatio = minWidth / minHeight;\n  return (w, h) => {\n    let canvasWidth = w;\n    let canvasHeight = h;\n    if (fixCanvasSize) {\n      if (minWidth < minHeight) {\n        canvasHeight = h;\n        canvasWidth = Math.min(w, minWidth, canvasHeight * aspectRatio);\n      } else {\n        canvasWidth = w;\n        canvasHeight = Math.min(h, minHeight, canvasWidth / aspectRatio);\n      }\n    }\n    const scaleX = canvasWidth < minWidth ? minWidth / canvasWidth : 1;\n    const scaleY = canvasHeight < minHeight ? minHeight / canvasHeight : 1;\n    const scale = scaleX > scaleY ? scaleX : scaleY;\n    const width = Math.floor(canvasWidth * scale);\n    const height = Math.floor(canvasHeight * scale);\n    return {\n      rendererWidth: width,\n      rendererHeight: height,\n      canvasWidth,\n      canvasHeight\n    };\n  };\n}\nexport {\n  aspectResize,\n  gameResize\n};\n//# sourceMappingURL=gameResize.mjs.map\n","import { URLParams as URLParams$1 } from \"@play-co/commons\";\nimport { NakedPromise, PromiseQueue, Wait, throttle, waitAFrame, waitFor } from \"@play-co/commons\";\nimport { Application } from \"./core/app/Application.mjs\";\nimport { Plugin } from \"./core/app/Plugin.mjs\";\nimport { Prioritiser, getPixiRunnerData } from \"./core/app/Prioritiser.mjs\";\nimport { loadTexturesWrapper } from \"./core/asset/plugins/loadTexture.mjs\";\nimport { loadWebFontWrapper } from \"./core/asset/plugins/loadWebFont.mjs\";\nimport { atlasResolver } from \"./core/asset/plugins/spineParser.mjs\";\nimport { ResourcePlugin } from \"./core/asset/ResourcePlugin.mjs\";\nimport { formatTextures } from \"./core/asset/utils/formatTextures.mjs\";\nimport { I18n, defaultI18nEntry, i18n } from \"./i18n/I18n.mjs\";\nimport { I18nLabel } from \"./i18n/I18nLabel.mjs\";\nimport { I18nText } from \"./i18n/I18nText.mjs\";\nimport { I18nSprite } from \"./i18n/I18nSprite.mjs\";\nimport { I18nPlugin } from \"./i18n/I18nPlugin.mjs\";\nimport { MarkupI18nText } from \"./i18n/MarkupI18nText.mjs\";\nimport { BaseNavigation } from \"./input/BaseNavigation.mjs\";\nimport { KeyBindingCollection, KeyboardPlugin } from \"./input/KeyboardPlugin.mjs\";\nimport { FixedNavigationPlugin } from \"./input/navigation-types/FixedNavigationPlugin.mjs\";\nimport { SmartNavigationPlugin } from \"./input/navigation-types/SmartNavigationPlugin.mjs\";\nimport { NavigationPlugin } from \"./input/NavigationPlugin.mjs\";\nimport { GestureInput } from \"./input/touch/GestureInput.mjs\";\nimport { TouchInput } from \"./input/touch/TouchInput.mjs\";\nimport { BusyPlugin } from \"./misc/busy/BusyPlugin.mjs\";\nimport { Stats } from \"./misc/stats/Stats.mjs\";\nimport { StatsPlugin } from \"./misc/StatsPlugin.mjs\";\nimport { VersionPlugin } from \"./misc/VersionPlugin.mjs\";\nimport { PreventTouchDefaultPlugin } from \"./misc/PreventTouchDefaultPlugin.mjs\";\nimport { EmptyScreen } from \"./screens/EmptyScreen.mjs\";\nimport { History } from \"./screens/History.mjs\";\nimport { LoaderScreen } from \"./screens/loader/LoaderScreen.mjs\";\nimport { SpinnerLoaderScreen } from \"./screens/loader/SpinnerLoader.mjs\";\nimport { BaseScreen } from \"./screens/Screen.mjs\";\nimport { ScreenGroup } from \"./screens/ScreenGroup.mjs\";\nimport { ScreensPlugin } from \"./screens/ScreensPlugin.mjs\";\nimport { TransitionManager } from \"./screens/TransitionManager.mjs\";\nimport { PreloadPlugin } from \"./screens/preload/PreloadPlugin.mjs\";\nimport { SetupPlugin } from \"./screens/preload/SetupPlugin.mjs\";\nimport { Bar } from \"./screens/temp-ui/Bar.mjs\";\nimport { AlphaTransition } from \"./screens/transitions/AlphaTransition.mjs\";\nimport { BlankTransition } from \"./screens/transitions/BlankTransition.mjs\";\nimport { FadeTransition } from \"./screens/transitions/FadeTransition.mjs\";\nimport { SoundChannel } from \"./sound/SoundChannel.mjs\";\nimport { SoundPlugin, firstTapPromise } from \"./sound/SoundPlugin.mjs\";\nimport { Orientation, OrientationPlugin } from \"./stage/OrientationPlugin.mjs\";\nimport { aspectResize, gameResize } from \"./stage/resize/gameResize.mjs\";\nimport { resizeDefault } from \"./stage/resize/resizeDefault.mjs\";\nimport { ResizePlugin } from \"./stage/resize/ResizePlugin.mjs\";\nimport { StagePlugin } from \"./stage/StagePlugin.mjs\";\nimport { VignettePlugin } from \"./stage/VignettePlugin.mjs\";\nimport { VisibilityPlugin } from \"./stage/VisibilityPlugin.mjs\";\nimport { PixiDevtoolPlugin } from \"./utils/devtool/PixiDevtoolPlugin.mjs\";\nimport { deepClone, deepEqual, deepMerge } from \"./utils/helpers/jsHelpers.mjs\";\nimport { deprecation } from \"./utils/logging/deprecation.mjs\";\nimport { Observer } from \"./utils/observer/Observer.mjs\";\nimport { promiseAllRunner, promiseRunner } from \"./utils/runners/promiseRunner.mjs\";\nimport { AstroStorage } from \"./utils/storage/AstroStorage.mjs\";\nimport { autoDetectAntialias } from \"./utils/system/detections/autoDetectAntialias.mjs\";\nimport { autoDetectCacheBusting } from \"./utils/system/detections/autoDetectCacheBusting.mjs\";\nimport { autoDetectResolution } from \"./utils/system/detections/autoDetectResolution.mjs\";\nimport { StorageType, autoDetectStorage } from \"./utils/system/detections/autoDetectStorage.mjs\";\nimport { autoDetectTransparency } from \"./utils/system/detections/autoDetectTransparency.mjs\";\nimport { Device, DeviceClass, GPU_TIER } from \"./utils/system/devices/Device.mjs\";\nimport { DeviceConfigPlugin } from \"./utils/system/devices/DeviceConfigPlugin.mjs\";\nimport { isGalaxyS5, isIPhone6, isKindle, isSafari18, isSafari18Dot4 } from \"./utils/system/devices/deviceQueries.mjs\";\nimport { DeviceSettings } from \"./utils/system/devices/DeviceSettings.mjs\";\nimport { requestFullScreen } from \"./utils/system/devices/requestFullScreen.mjs\";\nimport { WakeLockPlugin } from \"./utils/system/devices/WakeLockPlugin.mjs\";\nimport { PerformanceMonitor } from \"./utils/system/monitor/PerformanceMonitor.mjs\";\nimport { PerformanceTracker } from \"./utils/system/monitor/PerformanceTracker.mjs\";\nimport { PerformanceTrackerPlugin } from \"./utils/system/monitor/PerformanceTrackerPlugin.mjs\";\nimport { limitFPS } from \"./utils/system/time/limitFPS.mjs\";\nimport { WaitPlugin } from \"./utils/system/time/WaitPlugin.mjs\";\nimport { DEFAULT_RETRY_VALUES, tripleFetch } from \"./utils/url/tripleFetch.mjs\";\nconst URLParams = new URLParams$1();\nexport {\n  AlphaTransition,\n  Application,\n  AstroStorage,\n  Bar,\n  BaseNavigation,\n  BaseScreen,\n  BlankTransition,\n  BusyPlugin,\n  DEFAULT_RETRY_VALUES,\n  Device,\n  DeviceClass,\n  DeviceConfigPlugin,\n  DeviceSettings,\n  EmptyScreen,\n  FadeTransition,\n  FixedNavigationPlugin,\n  GPU_TIER,\n  GestureInput,\n  History,\n  I18n,\n  I18nLabel,\n  I18nPlugin,\n  I18nSprite,\n  I18nText,\n  KeyBindingCollection,\n  KeyboardPlugin,\n  LoaderScreen,\n  MarkupI18nText,\n  NakedPromise,\n  NavigationPlugin,\n  Observer,\n  Orientation,\n  OrientationPlugin,\n  PerformanceMonitor,\n  PerformanceTracker,\n  PerformanceTrackerPlugin,\n  PixiDevtoolPlugin,\n  Plugin,\n  PreloadPlugin,\n  PreventTouchDefaultPlugin,\n  Prioritiser,\n  PromiseQueue,\n  ResizePlugin,\n  ResourcePlugin,\n  ScreenGroup,\n  ScreensPlugin,\n  SetupPlugin,\n  SmartNavigationPlugin,\n  SoundChannel,\n  SoundPlugin,\n  SpinnerLoaderScreen,\n  StagePlugin,\n  Stats,\n  StatsPlugin,\n  StorageType,\n  TouchInput,\n  TransitionManager,\n  URLParams,\n  VersionPlugin,\n  VignettePlugin,\n  VisibilityPlugin,\n  Wait,\n  WaitPlugin,\n  WakeLockPlugin,\n  aspectResize,\n  atlasResolver,\n  autoDetectAntialias,\n  autoDetectCacheBusting,\n  autoDetectResolution,\n  autoDetectStorage,\n  autoDetectTransparency,\n  deepClone,\n  deepEqual,\n  deepMerge,\n  defaultI18nEntry,\n  deprecation,\n  firstTapPromise,\n  formatTextures,\n  gameResize,\n  getPixiRunnerData,\n  i18n,\n  isGalaxyS5,\n  isIPhone6,\n  isKindle,\n  isSafari18,\n  isSafari18Dot4,\n  limitFPS,\n  loadTexturesWrapper,\n  loadWebFontWrapper,\n  promiseAllRunner,\n  promiseRunner,\n  requestFullScreen,\n  resizeDefault,\n  throttle,\n  tripleFetch,\n  waitAFrame,\n  waitFor\n};\n//# sourceMappingURL=index.mjs.map\n","import type { Screen, Application } from '@play-co/astro';\nimport { Container } from 'pixi.js';\n\n/**\n * Abstract base class for Astro screens with common lifecycle patterns.\n *\n * This class provides default implementations for all Screen interface methods\n * and exposes protected hook methods that subclasses can override. This reduces\n * boilerplate by only requiring subclasses to implement the hooks they need.\n *\n * Screen Lifecycle:\n * 1. `constructor` - Screen is instantiated\n * 2. `prepare()`  `onPrepare()` - Screen prepares before becoming visible\n * 3. `show()`  `onShow()` - Screen becomes visible\n * 4. `update()`  `onUpdate()` - Called each frame while visible\n * 5. `hide()`  `onHide()` - Screen starts hiding\n * 6. `hidden()`  `onHidden()` - Screen is fully hidden, cleanup\n *\n * Additional hooks:\n * - `onPause()` / `onResume()` - App visibility changes\n * - `onResize()` - Window resize events\n *\n * @example\n * // Simple screen with just prepare and cleanup\n * class MenuScreen extends BaseScreen {\n *   private menuUI: Container | null = null;\n *\n *   protected async onPrepare(): Promise<void> {\n *     this.menuUI = new Container();\n *     // Setup menu UI...\n *     this.view.addChild(this.menuUI);\n *   }\n *\n *   protected async onHidden(): Promise<void> {\n *     this.menuUI?.destroy();\n *     this.menuUI = null;\n *   }\n * }\n *\n * @example\n * // Screen with update loop and pause handling\n * class GameScreen extends BaseScreen {\n *   private gameScene: GameScene | null = null;\n *\n *   protected async onPrepare(): Promise<void> {\n *     this.gameScene = new GameScene({ stage: this.view });\n *     await this.gameScene.init();\n *   }\n *\n *   protected async onShow(): Promise<void> {\n *     this.gameScene?.start();\n *   }\n *\n *   protected onUpdate(dt: number): void {\n *     this.gameScene?.update(dt);\n *   }\n *\n *   protected onPause(): void {\n *     this.gameScene?.pause();\n *   }\n *\n *   protected onResume(): void {\n *     this.gameScene?.resume();\n *   }\n *\n *   protected async onHidden(): Promise<void> {\n *     this.gameScene?.destroy();\n *     this.gameScene = null;\n *   }\n * }\n *\n * @example\n * // Register and show the screen\n * import { ScreensPlugin } from '@play-co/astro';\n *\n * const screens = app.get(ScreensPlugin);\n * screens.main.add(MenuScreen, undefined, 'menu');\n * await screens.main.show('menu');\n */\nexport abstract class BaseScreen implements Screen {\n  /**\n   * The Astro application instance.\n   * @readonly\n   */\n  public readonly app: Application;\n\n  /**\n   * The root display container for this screen.\n   * Add visual elements as children of this container.\n   * @readonly\n   */\n  public readonly view: Container;\n\n  /**\n   * Creates a new screen instance.\n   *\n   * @param app - The Astro Application instance\n   * @param _options - Optional configuration (available for subclasses)\n   * @example\n   * const screen = new MenuScreen(app, { theme: 'dark' });\n   */\n  constructor(app: Application, _options?: Record<string, unknown>) {\n    this.app = app;\n    this.view = new Container();\n  }\n\n  // ============================================\n  // Protected hooks for subclasses to override\n  // ============================================\n\n  /**\n   * Called when the screen is preparing to become visible.\n   * Override to initialize resources, create UI, load assets.\n   *\n   * @returns Promise or void when preparation is complete\n   * @example\n   * protected async onPrepare(): Promise<void> {\n   *   this.ui = new Container();\n   *   this.view.addChild(this.ui);\n   * }\n   */\n  protected onPrepare(): Promise<void> | void {\n    // Override in subclass\n  }\n\n  /**\n   * Called when the screen becomes visible.\n   * Override to start animations, game loops, etc.\n   *\n   * @returns Promise or void when show is complete\n   * @example\n   * protected onShow(): void {\n   *   this.scene?.start();\n   * }\n   */\n  protected onShow(): Promise<void> | void {\n    // Override in subclass\n  }\n\n  /**\n   * Called each frame while the screen is visible.\n   * Override to update game logic, animations, etc.\n   *\n   * @param _dt - Delta time since last frame in seconds\n   * @example\n   * protected onUpdate(dt: number): void {\n   *   this.scene?.update(dt);\n   * }\n   */\n  protected onUpdate(_dt: number): void {\n    // Override in subclass\n  }\n\n  /**\n   * Called when the screen starts hiding.\n   * Override to stop animations, pause game loops, etc.\n   *\n   * @returns Promise or void when hide is complete\n   * @example\n   * protected onHide(): void {\n   *   this.scene?.pause();\n   * }\n   */\n  protected onHide(): Promise<void> | void {\n    // Override in subclass\n  }\n\n  /**\n   * Called when the screen is fully hidden.\n   * Override to cleanup resources, destroy objects.\n   *\n   * @returns Promise or void when cleanup is complete\n   * @example\n   * protected onHidden(): void {\n   *   this.scene?.destroy();\n   *   this.scene = null;\n   * }\n   */\n  protected onHidden(): Promise<void> | void {\n    // Override in subclass\n  }\n\n  /**\n   * Called when the app is paused (e.g., tab loses focus).\n   * Override to pause game, audio, etc.\n   *\n   * @example\n   * protected onPause(): void {\n   *   this.audio?.pause();\n   * }\n   */\n  protected onPause(): void {\n    // Override in subclass\n  }\n\n  /**\n   * Called when the app is resumed (e.g., tab gains focus).\n   * Override to resume game, audio, etc.\n   *\n   * @example\n   * protected onResume(): void {\n   *   this.audio?.resume();\n   * }\n   */\n  protected onResume(): void {\n    // Override in subclass\n  }\n\n  /**\n   * Called when the window is resized.\n   * Override to adjust layout, reposition elements.\n   *\n   * @param _w - New width in pixels\n   * @param _h - New height in pixels\n   * @example\n   * protected onResize(w: number, h: number): void {\n   *   this.background.width = w;\n   *   this.background.height = h;\n   * }\n   */\n  protected onResize(_w: number, _h: number): void {\n    // Override in subclass\n  }\n\n  // ============================================\n  // Screen interface implementation\n  // ============================================\n\n  /**\n   * Prepares the screen before showing.\n   * @internal\n   * @example screen.prepare();\n   */\n  public async prepare(): Promise<void> {\n    await this.onPrepare();\n  }\n\n  /**\n   * Shows the screen.\n   * @internal\n   * @example screen.show();\n   */\n  public async show(): Promise<void> {\n    await this.onShow();\n  }\n\n  /**\n   * Updates the screen each frame.\n   * @param dt - Delta time in seconds\n   * @internal\n   * @example screen.update(0.016);\n   */\n  public update(dt: number): void {\n    this.onUpdate(dt);\n  }\n\n  /**\n   * Starts hiding the screen.\n   * @internal\n   * @example screen.hide();\n   */\n  public async hide(): Promise<void> {\n    await this.onHide();\n  }\n\n  /**\n   * Called when screen is fully hidden.\n   * @internal\n   * @example screen.hidden();\n   */\n  public async hidden(): Promise<void> {\n    await this.onHidden();\n  }\n\n  /**\n   * Pauses the screen.\n   * @internal\n   * @example screen.pause();\n   */\n  public pause(): void {\n    this.onPause();\n  }\n\n  /**\n   * Resumes the screen.\n   * @internal\n   * @example screen.resume();\n   */\n  public resume(): void {\n    this.onResume();\n  }\n\n  /**\n   * Handles window resize.\n   * @param w - New width in pixels\n   * @param h - New height in pixels\n   * @internal\n   * @example screen.resize(1920, 1080);\n   */\n  public resize(w: number, h: number): void {\n    this.onResize(w, h);\n  }\n}\n","const _Runner = class _Runner {\n  /**\n   * @param name - the function name that will be executed on the listeners added to this MiniRunner.\n   * @param argsLength - total number of arguments that will be passed from the runner\n   */\n  constructor(name, argsLength = 0) {\n    this.items = [];\n    this._name = name;\n    this.running = false;\n    this.dispatch = _Runner._generateRun(name, argsLength);\n    this.run = this.dispatch;\n    this.emit = this.dispatch;\n    this._dummy = {};\n    this._dummy[name] = () => {\n    };\n  }\n  static _generateRun(name, argsLength) {\n    const key = `${name}|${argsLength}`;\n    let func = _Runner._hash[key];\n    if (!func) {\n      if (argsLength > 0) {\n        let args = \"arg0\";\n        for (let i = 1; i < argsLength; i++) {\n          args += `,arg${i}`;\n        }\n        const src = `this.running = true;\n                            var items = this.items;\n                            for(var i=0;i<items.length;i++)\n                            { items[i].${name}(${args});}\n                            this.running = false;\n                            if( this.needsTidy) this.tidy()`;\n        func = new Function(args, src);\n      } else {\n        func = new Function(`this.running = true;\n                                    var items = this.items;\n                                    for(var i=0;i<items.length;i++)\n                                    { items[i].${name}(); }\n                                    this.running = false;\n                                    if( this.needsTidy) this.tidy() `);\n      }\n      _Runner._hash[key] = func;\n    }\n    return func;\n  }\n  /**\n   * Add a listener to the MiniRunner\n   *\n   * MiniRunners do not need to have scope or functions passed to them.\n   * All that is required is to pass the listening object and ensure that it has contains a function that has the same name\n   * as the name provided to the MiniRunner when it was created.\n   *\n   * Eg A listener passed to this MiniRunner will require a 'complete' function.\n   *\n   * ```\n   * var complete = new MiniRunner('complete');\n   * ```\n   *\n   * The scope used will be the object itself.\n   *\n   * @param item - The object that will be listening.\n   */\n  add(item) {\n    if (item[this._name]) {\n      this.remove(item);\n      this.items.push(item);\n      this._toRemove = [];\n      this.needsTidy = false;\n    }\n    return this;\n  }\n  /**\n   * Remove a single listener from the dispatch queue.\n   *\n   * @param item - The listener that you would like to remove.\n   */\n  remove(item) {\n    const index = this.items.indexOf(item);\n    if (this.running) {\n      this.needsTidy = true;\n      this._toRemove.push(index);\n      this.items[index] = this._dummy;\n    } else if (index !== -1) {\n      this.items.splice(index, 1);\n    }\n    return this;\n  }\n  /**\n   * Check to see if the listener is already in the MiniRunner\n   *\n   * @param item - listener that you would like to check.\n   * @returns true if the Runner has the object\n   */\n  contains(item) {\n    return this.items.indexOf(item) !== -1;\n  }\n  /** Removes all listeners from the Runner */\n  removeAll() {\n    this.items.length = 0;\n  }\n  /** Remove all references, don't use after this. */\n  destroy() {\n    this.removeAll();\n    this.items = null;\n  }\n  tidy() {\n    for (let i = this._toRemove.length - 1; i >= 0; i--) {\n      const index = this._toRemove[i];\n      if (index !== -1) {\n        this.items.splice(index, 1);\n      }\n    }\n  }\n  /** true if the Runner is empty */\n  get empty() {\n    return this.items.length === 0;\n  }\n};\n_Runner._hash = {};\nlet Runner = _Runner;\nexport {\n  Runner\n};\n//# sourceMappingURL=Runner.mjs.map\n","class ID32 {\n  constructor() {\n    this.id = new Int32Array(4);\n  }\n  /**\n   * Sets an index in an id\n   *\n   * @param index - index to set in the id\n   */\n  setIndex(index) {\n    const id = index / 31 | 0;\n    this.id[id] = this.id[id] | 1 << index % 31;\n  }\n  /**\n   * Unsets an index in an id\n   *\n   * @param index - index to unset in the id\n   */\n  unsetIndex(index) {\n    const id = index / 31 | 0;\n    this.id[id] = this.id[id] & ~(1 << index % 31);\n  }\n  /**\n   * checks if idB contains the same bits as this id\n   *\n   * @param id - id to compare\n   */\n  matchIndex(id) {\n    const q1 = this.id[0];\n    const q2 = this.id[1];\n    const q3 = this.id[2];\n    const q4 = this.id[3];\n    const idValue = id.id;\n    return (idValue[0] & q1 ^ q1) + (idValue[1] & q2 ^ q2) + (idValue[2] & q3 ^ q3) + (idValue[3] & q4 ^ q4) === 0;\n  }\n  /**\n   * checks if any bits in idB match this id\n   *\n   * @param id - id to compare\n   */\n  matchAnyIndex(id) {\n    const q1 = this.id[0];\n    const q2 = this.id[1];\n    const q3 = this.id[2];\n    const q4 = this.id[3];\n    const idValue = id.id;\n    return (idValue[0] & q1) + (idValue[1] & q2) + (idValue[2] & q3) + (idValue[3] & q4) > 0;\n  }\n}\nexport {\n  ID32\n};\n//# sourceMappingURL=ID32.mjs.map\n","import { Runner } from \"../utils/Runner.mjs\";\nimport { ID32 } from \"./queries/ID32.mjs\";\nconst UIDs = {\n  _ENTITY: 0,\n  _COMPONENT: 0,\n  _ENTITY_CLASS: 0\n};\nconst _Entity = class _Entity {\n  constructor() {\n    this.c = {};\n    this.UID = UIDs._ENTITY++;\n    this.componentBitHash = new ID32();\n    this.queries = [];\n    this.name = `item${this.UID}`;\n    this.runners = {\n      /** A runner called when the entity is gathered from a pool. Calls `init()` on any registered objects. */\n      init: new Runner(\"init\", 1),\n      /** A runner called when the entity is returned to a pool. Calls `reset()` on any registered objects. */\n      reset: new Runner(\"reset\")\n    };\n    this._gc = false;\n    this._released = false;\n    this._pooled = false;\n    this._initialised = false;\n    this._staticComponents = this._staticComponents || /* @__PURE__ */ new Set();\n    this._addStaticComponents();\n  }\n  /**\n   * called when the entity is taken from the pool\n   *\n   * @param data - the init data for this entity\n   */\n  init(data) {\n    var _a;\n    if (this._initialised) return;\n    this._addStaticComponents();\n    const components = this.runners.init.items;\n    for (let i = 0; i < components.length; i++) {\n      const component = components[i];\n      (_a = component.init) == null ? void 0 : _a.call(component, (data == null ? void 0 : data[component.name]) || {});\n    }\n    this._initialised = true;\n  }\n  /** called when the entity is added back to the pool */\n  reset() {\n    this._gc = false;\n    this.runners.reset.run();\n    for (const key in this.c) {\n      const component = this.c[key];\n      if (component.signals) {\n        const signals = component.signals;\n        for (const i in signals) {\n          signals[i].disconnectAll();\n        }\n      }\n      if (component.dynamic) this._removeComponent(component.name, component.id);\n    }\n    this._initialised = false;\n  }\n  /**\n   * create and add a component. Init data is only passed if the entity is already part of a scene\n   *\n   * @param Class - the component class to create and add\n   * @param data - the data to pass to the component constructor if part of a scene\n   */\n  addComponent(Class, data, staticComp = false) {\n    var _a;\n    if (!Class.NAME) {\n      throw new Error(\"[Entity] cannot add component that does not have a name\");\n    }\n    if (this.c[Class.NAME]) {\n      return this.c[Class.NAME];\n    }\n    if (Class.ID === void 0) {\n      Class.ID = UIDs._COMPONENT++;\n    }\n    const component = new Class();\n    component.name = Class.NAME;\n    component.id = Class.ID;\n    component.entity = this;\n    this.c[Class.NAME] = component;\n    for (const i in this.runners) {\n      this.runners[i].add(component);\n    }\n    this.componentBitHash.setIndex(Class.ID);\n    if (this._initialised) (_a = component.init) == null ? void 0 : _a.call(component, data || {});\n    if (this.scene) {\n      this.scene.queryManager.onEntityComponentAdded(this);\n    }\n    if (staticComp && !this._staticComponents.has(Class)) this._staticComponents.add(Class);\n    if (!this._staticComponents.has(Class)) component.dynamic = true;\n    return component;\n  }\n  /**\n   * removes a component of specified type\n   *\n   * @param Class - the type of component to remove\n   * @param name - optional name used to register component\n   */\n  removeComponent(Class) {\n    this._removeComponent(Class.NAME, Class.ID);\n    return this;\n  }\n  /** removes all components from the entity */\n  removeAllComponents() {\n    for (const key in this.c) {\n      const comp = this.c[key];\n      this._removeComponent(comp.name, comp.id);\n    }\n    return this;\n  }\n  /**\n   * gets the instance of a component on the entity\n   *\n   * @param Class - component class to get instance of\n   * @returns the instance of the component\n   */\n  getComponent(Class) {\n    return this.c[Class.NAME];\n  }\n  /**\n   * Sets a component to be modified and lets the query manager dispatch the \"modified\" event\n   *\n   * @param Class - component to be set as modified\n   */\n  setModified(Class, data) {\n    for (let i = 0; i < this.queries.length; i++) {\n      this.queries[i].modifiedQuery(this, Class, data);\n    }\n  }\n  /** adds static components to the entity */\n  _addStaticComponents() {\n    for (const comp of this._staticComponents) {\n      this.addComponent(comp, void 0, true);\n    }\n    return this;\n  }\n  /**\n   * Internally removes a component from the entity\n   *\n   * @param name - name of component to remove\n   * @param id - id of component to remove\n   */\n  _removeComponent(name, id) {\n    var _a;\n    const component = this.c[name];\n    if (!component) {\n      return;\n    }\n    for (const i in this.runners) {\n      this.runners[i].remove(component);\n    }\n    this.componentBitHash.unsetIndex(id);\n    if (this.scene) {\n      this.scene.queryManager.onEntityComponentRemoved(this);\n    }\n    (_a = component.reset) == null ? void 0 : _a.call(component);\n    delete this.c[name];\n    return;\n  }\n};\n_Entity.POOL = true;\nlet Entity = _Entity;\nexport {\n  Entity,\n  UIDs\n};\n//# sourceMappingURL=Entity.mjs.map\n","class Pool {\n  /**\n   * a pool of reusable instances of a class\n   *\n   * @param ClassType -\n   */\n  constructor(ClassType, initialSize) {\n    this._pool = [];\n    this._count = 0;\n    this._debug = false;\n    this._classType = ClassType;\n    if (initialSize) {\n      this.prepopulate(initialSize);\n    }\n  }\n  /**\n   * create items to populate pool\n   *\n   * @param total - the number of items to add to the pool\n   */\n  prepopulate(total) {\n    for (let i = 0; i < total; i++) {\n      this._pool.push(new this._classType());\n    }\n    this._count += total;\n  }\n  /** get an item from the pool, or create a new one if the pool is empty */\n  get() {\n    if (this._pool.length <= 0) {\n      this.prepopulate(Math.round(this._count * 0.2) + 1);\n    }\n    let item = this._pool.pop();\n    if (!item) {\n      item = new this._classType();\n    }\n    return item;\n  }\n  /**\n   * add an object into the pool\n   *\n   * @param item - the itm to add to the pool\n   */\n  return(item) {\n    if (this._pool.indexOf(item) !== -1) {\n      if (this._debug) console.warn(\"Object already in pool\", item);\n      return;\n    }\n    this._pool.push(item);\n  }\n  get totalSize() {\n    return this._count;\n  }\n  get totalFree() {\n    return this._pool.length;\n  }\n  get totalUsed() {\n    return this._count - this._pool.length;\n  }\n}\nexport {\n  Pool\n};\n//# sourceMappingURL=Pool.mjs.map\n","import { Pool } from \"./Pool.mjs\";\nclass PoolGroupClass {\n  constructor() {\n    this._poolsByClass = /* @__PURE__ */ new Map();\n  }\n  /**\n   * populates the pool with the specified number of instances\n   *\n   * @param Class - Class type to prepopulate\n   * @param total - number of instances to create\n   */\n  prepopulate(Class, total) {\n    const classPool = this.getPool(Class);\n    classPool.prepopulate(total);\n  }\n  /**\n   * return an entity of the specified class type, initialised with the supplied data object.\n   * Entity will be automatically returned to the pool when it is destroyed.\n   *\n   * @param Class - the class of entity required\n   * @param data - data object to initialise entity from\n   */\n  get(Class, data) {\n    var _a;\n    const pool = this.getPool(Class);\n    const item = pool.get();\n    item._pooled = true;\n    (_a = item.init) == null ? void 0 : _a.call(item, data);\n    return item;\n  }\n  /**\n   * puts an entity back into its pool. The entity will be reset and all signal listeners removed\n   *\n   * @param entity - the entity to return to the pool\n   */\n  return(item) {\n    var _a;\n    (_a = item.reset) == null ? void 0 : _a.call(item);\n    item._pooled = false;\n    this._returnToPool(item);\n  }\n  /** returns a pool for a specific class */\n  getPool(ClassType) {\n    if (!this._poolsByClass.has(ClassType)) {\n      this._poolsByClass.set(ClassType, new Pool(ClassType));\n    }\n    return this._poolsByClass.get(ClassType);\n  }\n  /** gets the usage stats of each pool in the system */\n  stats() {\n    const stats = {};\n    this._poolsByClass.forEach((pool) => {\n      const name = stats[pool._classType.name] ? pool._classType.name + pool._classType.ID : pool._classType.name;\n      stats[name] = {\n        free: pool.totalFree,\n        used: pool.totalUsed,\n        size: pool.totalSize\n      };\n    });\n    return stats;\n  }\n  /**\n   * Return an object to the pool\n   *\n   * @param object -\n   */\n  _returnToPool(object) {\n    this.getPool(object.constructor).return(object);\n  }\n}\nconst PoolGroup = new PoolGroupClass();\nexport {\n  PoolGroup,\n  PoolGroupClass\n};\n//# sourceMappingURL=PoolGroup.mjs.map\n","import { PoolGroup } from \"./pool/PoolGroup.mjs\";\nimport { UIDs } from \"./Entity.mjs\";\nconst ctors = /* @__PURE__ */ new Map();\nfunction DefineEntity(Constructor, ...components) {\n  const curr = ctors.get(Constructor.ID) ?? /* @__PURE__ */ new Set();\n  const entityClass = class extends Constructor {\n  };\n  const value = /* @__PURE__ */ new Set([...curr, ...components]);\n  entityClass.ID = UIDs._ENTITY_CLASS++;\n  ctors.set(entityClass.ID, value);\n  Object.defineProperty(entityClass.prototype, \"_staticComponents\", {\n    value,\n    writable: true\n  });\n  return entityClass;\n}\nfunction createEntity(Class, data) {\n  if (!Class.POOL) {\n    const entity = new Class();\n    entity.init(data);\n    return entity;\n  }\n  return PoolGroup.get(Class, data);\n}\nfunction releaseEntity(entity, releaseChildren = true) {\n  const scene = entity.scene;\n  const release = (ent) => {\n    if (releaseChildren && ent.c.container) {\n      ent.c.container.traverse((child) => {\n        if (child === ent) return;\n        if (!child.scene) quickRemove(child);\n        else {\n          child._released = true;\n          scene.removeFromScene(child);\n        }\n      });\n    }\n  };\n  const quickRemove = (ent) => {\n    var _a;\n    release(ent);\n    ent._pooled ? PoolGroup.return(ent) : (_a = ent.reset) == null ? void 0 : _a.call(ent);\n    ent._gc = false;\n    ent._released = false;\n  };\n  if (!scene) quickRemove(entity);\n  else {\n    entity._released = true;\n    scene.removeFromScene(entity);\n    release(entity);\n  }\n}\nexport {\n  DefineEntity,\n  createEntity,\n  releaseEntity\n};\n//# sourceMappingURL=EntityUtils.mjs.map\n","import { Container } from \"pixi.js\";\nconst _View2DComponent = class _View2DComponent {\n  init(options = {}) {\n    this.layer = options.layer || \"default\";\n    this.view = options.view || new Container();\n  }\n};\n_View2DComponent.NAME = \"view2d\";\nlet View2DComponent = _View2DComponent;\nexport {\n  View2DComponent\n};\n//# sourceMappingURL=View2DComponent.mjs.map\n","import { Entity } from \"../../core/Entity.mjs\";\nimport { DefineEntity } from \"../../core/EntityUtils.mjs\";\nimport { View2DComponent } from \"./view/View2DComponent.mjs\";\nclass Entity2D extends DefineEntity(Entity, View2DComponent) {\n  get view() {\n    return this.c.view2d.view;\n  }\n  get transform() {\n    return this.c.view2d.view.transform;\n  }\n  get position() {\n    return this.view.position;\n  }\n  get scale() {\n    return this.view.scale;\n  }\n  get rotation() {\n    return this.view.rotation;\n  }\n  get x() {\n    return this.view.position.x;\n  }\n  set x(value) {\n    this.view.position.x = value;\n  }\n  get y() {\n    return this.view.position.y;\n  }\n  set y(value) {\n    this.view.position.y = value;\n  }\n  get scaleX() {\n    return this.view.scale.x;\n  }\n  set scaleX(value) {\n    this.view.scale.x = value;\n  }\n  get scaleY() {\n    return this.view.scale.y;\n  }\n  set scaleY(value) {\n    this.view.scale.y = value;\n  }\n}\nexport {\n  Entity2D\n};\n//# sourceMappingURL=Entity2D.mjs.map\n","import { Signal } from \"typed-signals\";\nclass Signals {\n  constructor() {\n    this.signals = {};\n  }\n  /**\n   * Add some signals to the item. This exists as we are lazy devs..\n   * Instead of:\n   *\n   * var Signal = require('Signals')\n   * signals.onSomething = new Signal();\n   * signals.onSomethingElse = new Signal();\n   *\n   * we can now simply do this:\n   * this.registerSignals('onSomething', 'onSomethingElse')\n   *\n   * @param signalName - the name of the signal to to create.\n   */\n  register(...args) {\n    for (let i = 0; i < args.length; i++) {\n      const signalName = args[i];\n      if (!this.signals[signalName]) {\n        this.signals[signalName] = new Signal();\n      }\n    }\n  }\n  /** Because everything should be pooled - its good to have a way to reset all signals */\n  resetSignals() {\n    for (const i in this.signals) {\n      this.signals[i].disconnectAll();\n    }\n  }\n}\nexport {\n  Signals\n};\n//# sourceMappingURL=Signals.mjs.map\n","class Time {\n  constructor(options = {}) {\n    this.timeScale = 1;\n    this.maxDeltaTime = 1e3 / 20;\n    this._fps = 60;\n    this._deltaTime = 0;\n    this._frameTime = 0;\n    this.timeScale = options.timeScale ?? 1;\n    this._lastTime = performance.now();\n    this.fps = options.fps ?? 60;\n  }\n  /** call at the start of the game update loop in the scene */\n  nextUpdate() {\n    const now = performance.now();\n    this._deltaTime = Math.min(now - this._lastTime, this.maxDeltaTime);\n    this._frameTime = this._deltaTime / this._frameDuration;\n    this._lastTime = now;\n  }\n  /** the time elapsed from the previous frame in milliseconds */\n  get deltaTime() {\n    return this._deltaTime * this.timeScale;\n  }\n  /**\n   * the time elapsed from the previous frame in milliseconds\n   * does not take into account the time scale\n   */\n  get unscaledDeltaTime() {\n    return this._deltaTime;\n  }\n  /**\n   * the time elapsed from the previous frame in frames.\n   * a value around one indicates we are matching the frame rate\n   */\n  get frameTime() {\n    return this._frameTime * this.timeScale;\n  }\n  /**\n   * the time elapsed from the previous frame in frames.\n   * a value around one indicates we are matching the frame rate\n   * does not take into account the time scale\n   */\n  get unscaledFrameTime() {\n    return this._frameTime;\n  }\n  /** Get the target frame rate (frame per second) to used to calculate frameTime */\n  get fps() {\n    return this._fps;\n  }\n  /** Set the target frame rate (frame per second) to used to calculate frameTime */\n  set fps(v) {\n    this._fps = v;\n    this._frameDuration = 1e3 / this._fps;\n  }\n}\nexport {\n  Time\n};\n//# sourceMappingURL=Time.mjs.map\n","import { Time } from \"./Time.mjs\";\nclass SmoothTime extends Time {\n  constructor(options = {}) {\n    super(options);\n    this.smooth = options.smooth ?? 0.2;\n  }\n  nextUpdate() {\n    const now = performance.now();\n    const deltaTime = Math.min(now - this._lastTime, this.maxDeltaTime);\n    if (this.smooth > 0 && this.smooth < 1) {\n      this._deltaTime -= (this._deltaTime - deltaTime) * this.smooth;\n    } else {\n      this._deltaTime = deltaTime;\n    }\n    this._frameTime = this._deltaTime / this._frameDuration;\n    this._lastTime = now;\n  }\n}\nexport {\n  SmoothTime\n};\n//# sourceMappingURL=SmoothTime.mjs.map\n","import { Signal } from \"typed-signals\";\nclass Group {\n  constructor(children = []) {\n    this.onAdded = new Signal();\n    this.onRemoved = new Signal();\n    this.children = children;\n  }\n  add(item) {\n    const index = this.children.indexOf(item);\n    if (index !== -1) return;\n    this.children.push(item);\n    this.onAdded.emit(item);\n  }\n  remove(item) {\n    const index = this.children.indexOf(item);\n    if (index === -1) return false;\n    this.children.splice(index, 1);\n    this.onRemoved.emit(item);\n    return true;\n  }\n  contains(item) {\n    return this.children.indexOf(item) !== -1;\n  }\n  getIndex(item) {\n    return this.children.indexOf(item);\n  }\n  getItem(index) {\n    return this.children[index];\n  }\n  run(f, scope) {\n    let i;\n    if (scope) {\n      for (i = 0; i < this.children.length; i++) {\n        f.call(scope, this.children[i]);\n      }\n    } else {\n      for (i = 0; i < this.children.length; i++) {\n        f(this.children[i]);\n      }\n    }\n  }\n  empty() {\n    this.children.length = 0;\n    this.onAdded.disconnectAll();\n    this.onRemoved.disconnectAll();\n  }\n  get length() {\n    return this.children.length;\n  }\n}\nexport {\n  Group\n};\n//# sourceMappingURL=Group.mjs.map\n","function Not(componentClass) {\n  return {\n    operator: \"not\",\n    component: componentClass\n  };\n}\nfunction Or(...componentClass) {\n  return {\n    operator: \"or\",\n    components: componentClass\n  };\n}\nfunction generateQueries(systemClass, system) {\n  if (systemClass.Queries) {\n    for (const queryName in systemClass.Queries) {\n      const queryConfig = systemClass.Queries[queryName];\n      const queryComponents = queryConfig.components;\n      if (!queryComponents || queryComponents.length === 0) {\n        throw new Error(\"'components' attribute can't be empty in a query\");\n      }\n      const query = system.scene.queryManager.getQuery(queryComponents, queryName);\n      if (!system.queries) system.queries = {};\n      system.queries[queryName] = query;\n      if (queryConfig.modified) {\n        query.reactive = true;\n        query.runners.modified.add(system);\n      }\n      if (queryConfig.added) {\n        query.reactive = true;\n        query.runners.added.add(system);\n      }\n      if (queryConfig.removed) {\n        query.reactive = true;\n        query.runners.removed.add(system);\n      }\n    }\n  }\n}\nexport {\n  Not,\n  Or,\n  generateQueries\n};\n//# sourceMappingURL=QueryHelpers.mjs.map\n","import { Runner } from \"../../utils/Runner.mjs\";\nimport { ID32 } from \"./ID32.mjs\";\nvar QueryEvents = /* @__PURE__ */ ((QueryEvents2) => {\n  QueryEvents2[\"MODIFIED\"] = \"modified\";\n  QueryEvents2[\"ADDED\"] = \"added\";\n  QueryEvents2[\"REMOVED\"] = \"removed\";\n  return QueryEvents2;\n})(QueryEvents || {});\nclass Query {\n  constructor(world, key, name) {\n    this.reactive = false;\n    this.runners = {\n      added: new Runner(\"addedToQuery\", 2),\n      removed: new Runner(\"removedFromQuery\", 2),\n      modified: new Runner(\"modifiedQuery\", 5)\n    };\n    this.componentID = new ID32();\n    this.notComponentID = new ID32();\n    this.orComponentIDs = [];\n    this.entities = [];\n    this.key = key.name;\n    this.componentID = key.componentID;\n    this.notComponentID = key.notComponentID;\n    this.orComponentIDs = key.orComponentIDs;\n    this.name = name;\n    for (let i = 0; i < world.allEntities.children.length; i++) {\n      const entity = world.allEntities.children[i];\n      if (this.match(entity.componentBitHash)) {\n        this.entities.push(entity);\n      }\n    }\n  }\n  /** Gets the first entity in the query. */\n  get first() {\n    return this.entities[0];\n  }\n  /**\n   * Loops through all entities in the query backwards\n   *\n   * @param callbackfn - callback on interaction\n   */\n  forEach(callbackfn) {\n    for (let e = this.entities.length - 1; e >= 0; --e) {\n      const entity = this.entities[e];\n      callbackfn(entity, e, this.entities);\n    }\n  }\n  /**\n   * Add entity to this query\n   *\n   * @param entity - entity to be added\n   */\n  addEntity(entity) {\n    const index = this.entities.indexOf(entity);\n    if (!~index) {\n      entity.queries.push(this);\n      this.entities.push(entity);\n      this.runners.added.run(entity, this);\n    }\n  }\n  /**\n   * Remove entity from this query\n   *\n   * @param entity - entity to be removed\n   */\n  removeEntity(entity) {\n    let index = this.entities.indexOf(entity);\n    if (~index) {\n      this.entities.splice(index, 1);\n      index = entity.queries.indexOf(this);\n      entity.queries.splice(index, 1);\n      this.runners.removed.run(entity, this);\n    }\n  }\n  modifiedQuery(entity, Class, data) {\n    this.runners.modified.run(entity, entity.c[Class.NAME], data, this, Class);\n  }\n  /**\n   * checks if an entity exists in this query\n   *\n   * @param entity - entity to be checked\n   */\n  hasEntity(entity) {\n    return !!~this.entities.indexOf(entity);\n  }\n  /**\n   * Checks if an entity id matches the query id.\n   *\n   * @param entityId - id of the entity to check\n   */\n  match(entityId) {\n    const matchesComponents = this.componentID.matchIndex(entityId);\n    const matchesNotComponents = this.notComponentID.matchAnyIndex(entityId);\n    let matchesOrComponents = true;\n    if (this.orComponentIDs.length > 0) {\n      matchesOrComponents = this.orComponentIDs.every((ids) => ids.matchAnyIndex(entityId));\n    }\n    return matchesComponents && !matchesNotComponents && matchesOrComponents;\n  }\n}\nexport {\n  Query,\n  QueryEvents\n};\n//# sourceMappingURL=Query.mjs.map\n","import { UIDs } from \"../Entity.mjs\";\nimport { ID32 } from \"./ID32.mjs\";\nimport { Query } from \"./Query.mjs\";\nclass QueryManager {\n  constructor(world) {\n    this._scene = world;\n    this._queries = {};\n  }\n  /**\n   * Adds/removes an entity from a query after a component has been added\n   *\n   * @param entity - entity to be added/removed\n   */\n  onEntityComponentAdded(entity) {\n    for (const queryName in this._queries) {\n      const query = this._queries[queryName];\n      query.match(entity.componentBitHash) ? query.addEntity(entity) : query.removeEntity(entity);\n    }\n  }\n  /**\n   * Adds/removes an entity from a query after a component has been removed\n   *\n   * @param entity - entity to be added/removed\n   */\n  onEntityComponentRemoved(entity) {\n    for (const queryName in this._queries) {\n      const query = this._queries[queryName];\n      query.match(entity.componentBitHash) ? query.addEntity(entity) : query.removeEntity(entity);\n    }\n  }\n  /**\n   * Adds an entity to any matching queries\n   *\n   * @param entity - entity to be added\n   */\n  onEntityAdded(entity) {\n    this.onEntityComponentAdded(entity);\n  }\n  /**\n   * Removed an entity from any matching queries\n   *\n   * @param entity - entity to be removed\n   */\n  onEntityRemoved(entity) {\n    for (const queryName in this._queries) {\n      this._queries[queryName].removeEntity(entity);\n    }\n  }\n  /**\n   * Returns a query based off of the components provided\n   *\n   * @param components - components to check\n   * @param name - name of the query\n   */\n  getQuery(components, name) {\n    if (components.length === 0) {\n      throw Error(\"[QueryManager] cannot create empty query\");\n    }\n    const key = this.generateQueryKey(components);\n    let query = this._queries[key.name];\n    if (!query) {\n      this._queries[key.name] = query = new Query(this._scene, key, name);\n    }\n    return query;\n  }\n  /**\n   * Generate a query key using component ids\n   *\n   * @param components - components to generate key\n   */\n  generateQueryKey(components) {\n    const componentID = new ID32();\n    const notComponentID = new ID32();\n    const orComponentIDs = [];\n    let orNames = \"\";\n    const setID = (component) => {\n      if (component.ID === void 0) {\n        component.ID = UIDs._COMPONENT++;\n      }\n    };\n    components.forEach((component) => {\n      if (typeof component === \"object\") {\n        if (component.operator === \"not\") {\n          component = component.component;\n          setID(component);\n          notComponentID.setIndex(component.ID);\n        } else {\n          const orId = new ID32();\n          component.components.forEach((component2) => {\n            setID(component2);\n            orId.setIndex(component2.ID);\n          });\n          orComponentIDs.push(orId);\n          orNames += `${orId.id.toString()}||`;\n        }\n      } else {\n        setID(component);\n        componentID.setIndex(component.ID);\n      }\n    });\n    return {\n      name: `${componentID.id.toString()}!${notComponentID.id.toString()}||${orNames}`,\n      componentID,\n      notComponentID,\n      orComponentIDs\n    };\n  }\n}\nexport {\n  QueryManager\n};\n//# sourceMappingURL=QueryManager.mjs.map\n","import { Runner } from \"../utils/Runner.mjs\";\nimport { Signals } from \"../utils/Signals.mjs\";\nimport { SmoothTime } from \"../utils/SmoothTime.mjs\";\nimport { Time } from \"../utils/Time.mjs\";\nimport { Group } from \"./groups/Group.mjs\";\nimport { PoolGroup } from \"./pool/PoolGroup.mjs\";\nimport { generateQueries } from \"./queries/QueryHelpers.mjs\";\nimport { QueryManager } from \"./queries/QueryManager.mjs\";\nclass Scene extends Signals {\n  /**\n   * @param data - Options to use for your game\n   * updateAndRender - True if you want the update and render to be\n   * called simultaneously. This can be handy if you want to render and update the game at different rates\n   * smoothTime - If is set, the scene will use SmoothTime instead of Time, that can potentially\n   * help to prevent some small hiccups caused by frame rate oscilation.\n   */\n  constructor(data = {}) {\n    super();\n    this.allSystems = /* @__PURE__ */ new Map();\n    this.allEntities = new Group();\n    this.queryManager = new QueryManager(this);\n    this.paused = false;\n    this.runners = {\n      /** A runner called when the scene is resized. Calls `resize()` on any registered objects. */\n      resize: new Runner(\"resize\", 2),\n      /** A runner called before a scene update happens. Calls `preupdate()` on any registered objects. */\n      preupdate: new Runner(\"preupdate\", 1),\n      /** A runner called before a scene update happens. Calls `update()` on any registered objects. */\n      update: new Runner(\"update\", 1),\n      /** A runner called after the scene has updated. Calls `postupdate()` on any registered objects. */\n      postupdate: new Runner(\"postupdate\", 1),\n      /** A runner called before a scene render happens. Calls `prerender()` on any registered objects. */\n      prerender: new Runner(\"prerender\", 1),\n      /** A runner called before a scene render happens. Calls `render()` on any registered objects. */\n      render: new Runner(\"render\", 1),\n      /** A runner called after the scene has render. Calls `postrender()` on any registered objects. */\n      postrender: new Runner(\"postrender\", 1),\n      /** A runner called when a scene is about to be emptied. Calls `reset()` on any registered objects. */\n      reset: new Runner(\"reset\", 1)\n    };\n    this._enabled = false;\n    this._width = 100;\n    this._height = 100;\n    this._entitiesToRemove = [];\n    this._systemsToStart = [];\n    this.time = data.smoothTime ? new SmoothTime({ smooth: data.smoothTime }) : new Time();\n    this._updateAndRender = data.updateAndRender ?? true;\n    data.autoStart = data.autoStart ?? false;\n    data.autoStart && this.start();\n  }\n  start() {\n    if (this._enabled) return;\n    this.allSystems.forEach((system) => {\n      var _a;\n      (_a = system.awake) == null ? void 0 : _a.call(system);\n    });\n    this._enabled = true;\n  }\n  /**\n   * Adds a system to the scene, passing data to the `init` function of the system if implemented.\n   *\n   * @param Class - A class to create an instance of.\n   * @param data - A list of options passed to the System when it is initialized.\n   */\n  addSystem(Class, data) {\n    var _a, _b;\n    const name = Class.NAME;\n    if (!name) throw new Error(\"[SystemManager]: cannot add System without name\");\n    if (this.allSystems.has(name)) {\n      return this.allSystems.get(name);\n    }\n    const system = new Class();\n    system.scene = this;\n    system.queries = {};\n    generateQueries(Class, system);\n    (_a = system.init) == null ? void 0 : _a.call(system, data);\n    this._enabled && ((_b = system.awake) == null ? void 0 : _b.call(system));\n    const { runners } = this;\n    for (const key in runners)\n      runners[key].add(system);\n    this._systemsToStart.push(system);\n    this.allSystems.set(Class.NAME, system);\n    return system;\n  }\n  /**\n   * return the system of the specified type\n   *\n   * @param Class - instance of class to get\n   */\n  getSystem(Class) {\n    return this.allSystems.get(Class.NAME);\n  }\n  /**\n   * Directly adds an entity to the game.\n   *\n   * @param entity - the entity to add to the game\n   */\n  addToScene(entity) {\n    if (entity._gc) {\n      const index = this._entitiesToRemove.indexOf(entity);\n      this._entitiesToRemove.splice(index, 1);\n      entity._gc = false;\n    }\n    if (entity.scene) {\n      if (entity.scene === this) {\n        return;\n      }\n      this._removeEntity(entity);\n    }\n    entity.scene = this;\n    this.allEntities.add(entity);\n    this.queryManager.onEntityAdded(entity);\n  }\n  /**\n   * Directly removes an entity from the game\n   *\n   * @param entity - the entity to remove\n   */\n  removeFromScene(entity) {\n    if (entity._gc || !entity.scene) return;\n    entity._gc = true;\n    this._entitiesToRemove.push(entity);\n  }\n  /** Called before the game is rendered. Called by a render system before it is about to draw to the screen */\n  renderStart() {\n    if (this._updateAndRender) {\n      this.update();\n    }\n    this.runners.prerender.run(this.time);\n    this.runners.render.run(this.time);\n  }\n  /** called by a render system when it has finished rendering */\n  renderFinish() {\n    this.runners.postrender.run(this.time);\n  }\n  /** Called automatically by View2DSystem/View3DSystem before each render if `updateAndRender` is true. Otherwise you must call this manually */\n  update() {\n    if (this.paused || !this._enabled) return;\n    this.time.nextUpdate();\n    this._startSystems();\n    this._removeEntities();\n    this.runners.preupdate.run(this.time);\n    this._removeEntities();\n    this.runners.update.run(this.time);\n    this._removeEntities();\n    this.runners.postupdate.run(this.time);\n  }\n  /** Restarts the scene by calling `scene.reset` and `scene.start` */\n  restart() {\n    this.reset();\n    this.start();\n  }\n  /**\n   * This is called when you want to essentially clean out the game. Its like wiping the slate clean\n   * All systems will be notified and all entities will be removed.\n   */\n  reset() {\n    this._removeEntities();\n    this.runners.reset.run();\n    for (let i = this.allEntities.children.length - 1; i >= 0; --i) {\n      const entity = this.allEntities.children[i];\n      entity._released = true;\n      this._removeEntity(entity);\n    }\n    this.allEntities.empty();\n    for (const key in this.runners) {\n      this.runners[key].removeAll();\n    }\n    this._entitiesToRemove.length = 0;\n    this.allSystems.forEach((system) => {\n      for (const rKey in this.runners) {\n        this.runners[rKey].add(system);\n      }\n      this._systemsToStart.push(system);\n    });\n    this._enabled = false;\n  }\n  /**\n   * Calls resize on all systems subscribed to the resize runner\n   *\n   * @param w - the width to make the game\n   * @param h - the height to make the game\n   */\n  resize(w, h) {\n    this._width = w;\n    this._height = h;\n    this.runners.resize.run(w, h);\n  }\n  /** removes all entities that need to be removed from the scene */\n  _removeEntities() {\n    const entitiesToRemove = this._entitiesToRemove;\n    if (!entitiesToRemove.length) return;\n    for (let i = 0; i < entitiesToRemove.length; i++) {\n      const entity = entitiesToRemove[i];\n      this._removeEntity(entity);\n    }\n    entitiesToRemove.length = 0;\n  }\n  /** removes an entity from the scene */\n  _removeEntity(entity) {\n    var _a;\n    if (entity._released) {\n      entity._pooled ? PoolGroup.return(entity) : (_a = entity.reset) == null ? void 0 : _a.call(entity);\n    }\n    this.queryManager.onEntityRemoved(entity);\n    this.allEntities.remove(entity);\n    entity._gc = false;\n    entity.scene = null;\n    entity._released = false;\n  }\n  /** calls the start function on systems */\n  _startSystems() {\n    var _a;\n    for (let i = 0; i < this._systemsToStart.length; i++) {\n      const system = this._systemsToStart[i];\n      (_a = system.start) == null ? void 0 : _a.call(system);\n    }\n    this._systemsToStart.length = 0;\n  }\n  /** the width of the game. to modify this its best to call `game.resize(w, h)` */\n  get width() {\n    return this._width;\n  }\n  /** the height of the game. to modify this its best to call `game.resize(w, h)` */\n  get height() {\n    return this._height;\n  }\n}\nexport {\n  Scene\n};\n//# sourceMappingURL=Scene.mjs.map\n","import { Container, RenderContainer } from \"pixi.js\";\nimport { View2DComponent } from \"./View2DComponent.mjs\";\nconst _View2DSystem = class _View2DSystem {\n  constructor() {\n    this.w = -1;\n    this.h = -1;\n    this.camera = { x: 0, y: 0, zoom: 1, offset: { x: 0, y: 0 } };\n    this._activeItemsContainer = new Container();\n    this._layers = {};\n    this._innerContainer = new Container();\n  }\n  init(opts = {}) {\n    this.stage = opts.stage || new Container();\n    const startHook = new RenderContainer({\n      render: () => {\n        this.scene.renderStart();\n      }\n    });\n    const endHook = new RenderContainer({\n      render: () => {\n        this.scene.renderFinish();\n      }\n    });\n    this.stage.isRenderGroup = true;\n    this.stage.addChild(startHook);\n    this.stage.addChild(this._innerContainer);\n    this._innerContainer.addChild(this._activeItemsContainer);\n    this.stage.addChild(endHook);\n    this.addLayer(\"back\");\n    this.addLayer(\"default\");\n    this.addLayer(\"front\");\n    this.resize(1, 1);\n  }\n  setCamera(camera) {\n    this.camera = camera;\n    this.resize(this.w, this.h);\n  }\n  render() {\n    const zoom = this.camera.zoom;\n    const stage = this.stage;\n    stage.scale.set(zoom);\n    stage.position.x = this.w / 2 - this.w / 2 * zoom + this.camera.offset.x * 2;\n    stage.position.y = this.h / 2 - this.h / 2 * zoom + this.camera.offset.y;\n    const sx = this._innerContainer.scale.x;\n    const sy = this._innerContainer.scale.y;\n    this._innerContainer.x = -this.camera.x * sx + this.w / 2;\n    this._innerContainer.y = -this.camera.y * sy + this.h / 2;\n  }\n  addedToQuery(ent) {\n    const entity = ent;\n    const view = entity.c.view2d.view;\n    const layer = this._layers[entity.c.view2d.layer];\n    layer.addChild(view);\n  }\n  removedFromQuery(ent) {\n    const entity = ent;\n    const view = entity.c.view2d.view;\n    const layer = this._layers[entity.c.view2d.layer];\n    layer.removeChild(view);\n  }\n  reset() {\n  }\n  addLayer(id, index = -1) {\n    this._layers[id] = new Container();\n    if (index === -1) {\n      index = this._activeItemsContainer.children.length;\n    }\n    this._activeItemsContainer.addChildAt(this._layers[id], index);\n  }\n  /**\n   * Changes an entities layer\n   *\n   * @param entity - entity to swap layer\n   * @param newLayer - id of layer to swap too\n   * @param depth - depth to add the entity at\n   */\n  setEntityLayer(entity, newLayer, depth = -1) {\n    if (!this._layers[newLayer]) {\n      throw new Error(`Layer doesn't exist: ${newLayer}`);\n    }\n    const view2d = entity.getComponent(View2DComponent);\n    if (view2d) {\n      const view = view2d.view;\n      const layer = this._layers[view2d.layer];\n      const index = layer.children.indexOf(view);\n      if (index !== -1) {\n        layer.removeChild(view);\n      }\n      if (depth === -1) {\n        depth = this._layers[newLayer].children.length;\n      }\n      this._layers[newLayer].addChildAt(view, depth);\n      view2d.layer = newLayer;\n    }\n  }\n  /**\n   * Sets a layer to a specific index\n   *\n   * @param layerName - name of the layer\n   * @param index - index to add the layer at\n   */\n  setLayerAt(layerName, index) {\n    const layer = this.layers[layerName];\n    if (!layer) return;\n    this.activeItemsContainer.addChildAt(layer, index);\n  }\n  resize(w, h) {\n    if (this.w === w && this.h === h) return;\n    this.w = w;\n    this.h = h;\n  }\n  get layers() {\n    return this._layers;\n  }\n  get activeItemsContainer() {\n    return this._activeItemsContainer;\n  }\n  get innerContainer() {\n    return this._innerContainer;\n  }\n};\n_View2DSystem.NAME = \"view2d\";\n_View2DSystem.Queries = {\n  view2d: {\n    components: [View2DComponent],\n    added: true,\n    removed: true\n  }\n};\nlet View2DSystem = _View2DSystem;\nexport {\n  View2DSystem\n};\n//# sourceMappingURL=View2DSystem.mjs.map\n","import { Scene } from \"../../core/Scene.mjs\";\nimport { View2DSystem } from \"./view/View2DSystem.mjs\";\nclass Scene2D extends Scene {\n  constructor(options) {\n    super(options);\n    this.register(\"onGameover\");\n    this.register(\"onGameComplete\");\n    this.view2d = this.addSystem(View2DSystem, { stage: options.stage });\n  }\n  addChild(...entities) {\n    if (entities.length > 1) {\n      for (let i = 0; i < entities.length; i++) {\n        this.addToScene(entities[i]);\n      }\n    } else {\n      this.addToScene(entities[0]);\n    }\n  }\n  removeChild(...entities) {\n    if (entities.length > 1) {\n      for (let i = 0; i < entities.length; i++) {\n        this.removeFromScene(entities[i]);\n      }\n    } else {\n      this.removeFromScene(entities[0]);\n    }\n  }\n}\nexport {\n  Scene2D\n};\n//# sourceMappingURL=Scene2D.mjs.map\n","/**\n * Part registry for looking up part definitions by ID.\n *\n * Parts are registered at module load time via `registerPart()`.\n * Use `getPart()` to retrieve a part definition by its ID.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\n\n/** Registry of all registered parts */\nconst parts = new Map<string, PartDefinition>();\n\n/**\n * Register a part definition.\n *\n * @param part - The part definition to register\n * @throws Error if a part with the same ID is already registered\n *\n * @example\n * ```typescript\n * import { registerPart } from '@shared/parts/registry';\n *\n * const myPart: PartDefinition = {\n *   id: 'my-part',\n *   name: 'My Part',\n *   // ... other properties\n * };\n *\n * registerPart(myPart);\n * ```\n */\nexport function registerPart(part: PartDefinition): void {\n  if (parts.has(part.id)) {\n    throw new Error(`Part \"${part.id}\" is already registered`);\n  }\n  parts.set(part.id, part);\n}\n\n/**\n * Get a part definition by ID.\n *\n * @param id - The part ID to look up\n * @returns The part definition\n * @throws Error if the part ID is not found\n *\n * @example\n * ```typescript\n * import { getPart } from '@shared/parts/registry';\n *\n * const part = getPart('simple-plate');\n * console.log(part.name); // \"Simple Plate\"\n * ```\n */\nexport function getPart(id: string): PartDefinition {\n  const part = parts.get(id);\n  if (!part) {\n    throw new Error(`Part \"${id}\" not found in registry`);\n  }\n  return part;\n}\n\n/**\n * Check if a part ID is registered.\n *\n * @param id - The part ID to check\n * @returns true if the part is registered\n *\n * @example\n * ```typescript\n * if (hasPart('simple-plate')) {\n *   const part = getPart('simple-plate');\n * }\n * ```\n */\nexport function hasPart(id: string): boolean {\n  return parts.has(id);\n}\n\n/**\n * Get all registered part IDs.\n *\n * @returns Array of all registered part IDs\n *\n * @example\n * ```typescript\n * const ids = getAllPartIds();\n * console.log('Available parts:', ids.join(', '));\n * ```\n */\nexport function getAllPartIds(): string[] {\n  return Array.from(parts.keys());\n}\n\n/**\n * Get all registered part definitions.\n *\n * @returns Array of all registered part definitions\n *\n * @example\n * ```typescript\n * const parts = getAllParts();\n * parts.forEach(part => console.log(part.name));\n * ```\n */\nexport function getAllParts(): PartDefinition[] {\n  return Array.from(parts.values());\n}\n\n/**\n * Clear all registered parts.\n *\n * Primarily useful for testing.\n *\n * @example\n * ```typescript\n * beforeEach(() => clearRegistry());\n * ```\n */\nexport function clearRegistry(): void {\n  parts.clear();\n}\n","/**\n * Simple plate part definition.\n *\n * A basic rectangular static part used for foundational puzzle elements.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A simple rectangular metal plate.\n *\n * Static part that cannot move. Has 4 screw mount points at corners.\n */\nexport const simplePlate: PartDefinition = {\n  id: 'simple-plate',\n  name: 'Simple Plate',\n  asset: 'images/parts/simple-plate.png',\n  collision: { type: 'box', width: 200, height: 100 },\n  material: 'metal',\n  constraint: { type: 'static' },\n  screwMounts: [\n    { id: 'top-left', localPosition: { x: 20, y: 20 } },\n    { id: 'top-right', localPosition: { x: 180, y: 20 } },\n    { id: 'bottom-left', localPosition: { x: 20, y: 80 } },\n    { id: 'bottom-right', localPosition: { x: 180, y: 80 } },\n  ],\n};\n\nregisterPart(simplePlate);\n","/**\n * Sliding cover part definition.\n *\n * A panel that slides horizontally when screws are removed.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A sliding metal cover.\n *\n * Slides along the X axis when freed. Used to hide screws underneath.\n */\nexport const slidingCover: PartDefinition = {\n  id: 'sliding-cover',\n  name: 'Sliding Cover',\n  asset: 'images/parts/sliding-cover.png',\n  collision: { type: 'box', width: 150, height: 80 },\n  material: 'metal',\n  constraint: {\n    type: 'slider',\n    axis: 'x',\n    min: 0,\n    max: 100,\n  },\n  screwMounts: [\n    { id: 'left', localPosition: { x: 25, y: 40 } },\n    { id: 'center', localPosition: { x: 75, y: 40 } },\n    { id: 'right', localPosition: { x: 125, y: 40 } },\n  ],\n};\n\nregisterPart(slidingCover);\n","/**\n * Walnut square board part definition.\n *\n * A dark brown wooden square board used in puzzles.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A square walnut wood board.\n *\n * Has friction constraint - can move when screws are removed.\n * 4 screw mount points at corners.\n */\nexport const boardWalnutSquare: PartDefinition = {\n  id: 'board-walnut-square',\n  name: 'Walnut Square Board',\n  asset: 'images/parts/board-walnut-square.png',\n  collision: { type: 'box', width: 270, height: 260 },\n  material: 'wood',\n  constraint: { type: 'friction', screwThreshold: 1 },\n  screwMounts: [\n    { id: 'top-left', localPosition: { x: 30, y: 30 } },\n    { id: 'top-right', localPosition: { x: 240, y: 30 } },\n    { id: 'bottom-left', localPosition: { x: 30, y: 230 } },\n    { id: 'bottom-right', localPosition: { x: 240, y: 230 } },\n  ],\n};\n\nregisterPart(boardWalnutSquare);\n","/**\n * Oak horizontal board part definition.\n *\n * A light wooden horizontal rectangular board.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A horizontal oak wood board.\n *\n * Has friction constraint - can move when screws are removed.\n * 4 screw mount points at corners.\n */\nexport const boardOakHorizontal: PartDefinition = {\n  id: 'board-oak-horizontal',\n  name: 'Oak Horizontal Board',\n  asset: 'images/parts/board-oak-horizontal.png',\n  collision: { type: 'box', width: 755, height: 317 },\n  material: 'wood',\n  constraint: { type: 'friction', screwThreshold: 1 },\n  screwMounts: [\n    { id: 'top-left', localPosition: { x: 30, y: 30 } },\n    { id: 'top-right', localPosition: { x: 725, y: 30 } },\n    { id: 'bottom-left', localPosition: { x: 30, y: 287 } },\n    { id: 'bottom-right', localPosition: { x: 725, y: 287 } },\n  ],\n};\n\nregisterPart(boardOakHorizontal);\n","/**\n * Oak vertical board part definition.\n *\n * A light wooden vertical rectangular board.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A vertical oak wood board.\n *\n * Has friction constraint - can move when screws are removed.\n * 4 screw mount points at corners.\n */\nexport const boardOakVertical: PartDefinition = {\n  id: 'board-oak-vertical',\n  name: 'Oak Vertical Board',\n  asset: 'images/parts/board-oak-vertical.png',\n  collision: { type: 'box', width: 270, height: 417 },\n  material: 'wood',\n  constraint: { type: 'friction', screwThreshold: 1 },\n  screwMounts: [\n    { id: 'top-left', localPosition: { x: 30, y: 30 } },\n    { id: 'top-right', localPosition: { x: 240, y: 30 } },\n    { id: 'bottom-left', localPosition: { x: 30, y: 387 } },\n    { id: 'bottom-right', localPosition: { x: 240, y: 387 } },\n  ],\n};\n\nregisterPart(boardOakVertical);\n","/**\n * Birch square board part definition.\n *\n * A pale cream colored wooden square board.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A square birch wood board.\n *\n * Has friction constraint - can move when screws are removed.\n * 4 screw mount points at corners.\n */\nexport const boardBirchSquare: PartDefinition = {\n  id: 'board-birch-square',\n  name: 'Birch Square Board',\n  asset: 'images/parts/board-birch-square.png',\n  collision: { type: 'box', width: 270, height: 260 },\n  material: 'wood',\n  constraint: { type: 'friction', screwThreshold: 1 },\n  screwMounts: [\n    { id: 'top-left', localPosition: { x: 30, y: 30 } },\n    { id: 'top-right', localPosition: { x: 240, y: 30 } },\n    { id: 'bottom-left', localPosition: { x: 30, y: 230 } },\n    { id: 'bottom-right', localPosition: { x: 240, y: 230 } },\n  ],\n};\n\nregisterPart(boardBirchSquare);\n","/**\n * Mahogany square board part definition.\n *\n * A reddish-brown wooden square board.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A square mahogany wood board.\n *\n * Has friction constraint - can move when screws are removed.\n * 4 screw mount points at corners.\n */\nexport const boardMahoganySquare: PartDefinition = {\n  id: 'board-mahogany-square',\n  name: 'Mahogany Square Board',\n  asset: 'images/parts/board-mahogany-square.png',\n  collision: { type: 'box', width: 270, height: 260 },\n  material: 'wood',\n  constraint: { type: 'friction', screwThreshold: 1 },\n  screwMounts: [\n    { id: 'top-left', localPosition: { x: 30, y: 30 } },\n    { id: 'top-right', localPosition: { x: 240, y: 30 } },\n    { id: 'bottom-left', localPosition: { x: 30, y: 230 } },\n    { id: 'bottom-right', localPosition: { x: 240, y: 230 } },\n  ],\n};\n\nregisterPart(boardMahoganySquare);\n","/**\n * Pine horizontal board part definition.\n *\n * A light yellow wooden horizontal rectangular board.\n *\n * @module\n */\n\nimport type { PartDefinition } from '@shared/types';\nimport { registerPart } from '../registry';\n\n/**\n * A horizontal pine wood board.\n *\n * Has friction constraint - can move when screws are removed.\n * 4 screw mount points at corners.\n */\nexport const boardPineHorizontal: PartDefinition = {\n  id: 'board-pine-horizontal',\n  name: 'Pine Horizontal Board',\n  asset: 'images/parts/board-pine-horizontal.png',\n  collision: { type: 'box', width: 501, height: 317 },\n  material: 'wood',\n  constraint: { type: 'friction', screwThreshold: 1 },\n  screwMounts: [\n    { id: 'top-left', localPosition: { x: 30, y: 30 } },\n    { id: 'top-right', localPosition: { x: 471, y: 30 } },\n    { id: 'bottom-left', localPosition: { x: 30, y: 287 } },\n    { id: 'bottom-right', localPosition: { x: 471, y: 287 } },\n  ],\n};\n\nregisterPart(boardPineHorizontal);\n","/**\n * Geometry utilities for bounds checking.\n *\n * Used primarily for validating screw positions within part collision shapes.\n *\n * @module\n */\n\nimport type {\n  Position,\n  CollisionShape,\n  BoxCollisionShape,\n} from '@shared/types';\n\n/** Screw head radius in pixels for bounds checking */\nexport const SCREW_RADIUS = 40;\n\n/**\n * Check if a point is inside a box collision shape.\n *\n * @param point - Point to check\n * @param box - Box collision shape\n * @returns True if point is inside or on boundary\n * @example\n * const inside = isPointInBox({ x: 50, y: 50 }, { type: 'box', width: 100, height: 100 });\n */\nexport function isPointInBox(point: Position, box: BoxCollisionShape): boolean {\n  return (\n    point.x >= 0 &&\n    point.x <= box.width &&\n    point.y >= 0 &&\n    point.y <= box.height\n  );\n}\n\n/**\n * Check if a circle is fully inside a box collision shape.\n *\n * @param center - Circle center point\n * @param radius - Circle radius\n * @param box - Box collision shape\n * @returns True if circle is fully contained\n * @example\n * const inside = isCircleInBox({ x: 50, y: 50 }, 10, { type: 'box', width: 100, height: 100 });\n */\nexport function isCircleInBox(\n  center: Position,\n  radius: number,\n  box: BoxCollisionShape\n): boolean {\n  return (\n    center.x - radius >= 0 &&\n    center.x + radius <= box.width &&\n    center.y - radius >= 0 &&\n    center.y + radius <= box.height\n  );\n}\n\n/**\n * Check if a point is inside a polygon using ray casting algorithm.\n *\n * @param point - Point to check\n * @param polygon - Array of polygon vertices\n * @returns True if point is inside polygon\n * @example\n * const inside = isPointInPolygon({ x: 5, y: 5 }, [{ x: 0, y: 0 }, { x: 10, y: 0 }, { x: 10, y: 10 }, { x: 0, y: 10 }]);\n */\nexport function isPointInPolygon(\n  point: Position,\n  polygon: Position[]\n): boolean {\n  let inside = false;\n  const n = polygon.length;\n\n  for (let i = 0, j = n - 1; i < n; j = i++) {\n    const pi = polygon[i];\n    const pj = polygon[j];\n\n    if (pi === undefined || pj === undefined) continue;\n\n    if (\n      pi.y > point.y !== pj.y > point.y &&\n      point.x < ((pj.x - pi.x) * (point.y - pi.y)) / (pj.y - pi.y) + pi.x\n    ) {\n      inside = !inside;\n    }\n  }\n\n  return inside;\n}\n\n/**\n * Check if a circle is approximately inside a polygon.\n *\n * Uses 5-point approximation: center + 4 cardinal direction points.\n *\n * @param center - Circle center point\n * @param radius - Circle radius\n * @param polygon - Array of polygon vertices\n * @returns True if all test points are inside polygon\n * @example\n * const inside = isCircleInPolygon({ x: 50, y: 50 }, 10, polygon);\n */\nexport function isCircleInPolygon(\n  center: Position,\n  radius: number,\n  polygon: Position[]\n): boolean {\n  const testPoints: Position[] = [\n    center,\n    { x: center.x - radius, y: center.y },\n    { x: center.x + radius, y: center.y },\n    { x: center.x, y: center.y - radius },\n    { x: center.x, y: center.y + radius },\n  ];\n\n  return testPoints.every((point) => isPointInPolygon(point, polygon));\n}\n\n/**\n * Check if a screw at given position is within collision bounds.\n *\n * @param screwPosition - Screw center position (local to part)\n * @param collision - Part collision shape\n * @param radius - Screw radius (defaults to SCREW_RADIUS)\n * @returns True if screw is fully within bounds\n * @example\n * const valid = isScrewInBounds({ x: 100, y: 100 }, collision);\n */\nexport function isScrewInBounds(\n  screwPosition: Position,\n  collision: CollisionShape,\n  radius: number = SCREW_RADIUS\n): boolean {\n  if (collision.type === 'box') {\n    return isCircleInBox(screwPosition, radius, collision);\n  } else {\n    return isCircleInPolygon(screwPosition, radius, collision.points);\n  }\n}\n","/**\n * Play area utilities for coordinate transformation and validation.\n *\n * The play area uses a centered coordinate system where (0, 0) is the center.\n * Parts are positioned using local coordinates which are transformed to world\n * coordinates for rendering.\n *\n * @module\n */\n\nimport type { Position } from '@shared/types';\n\n/**\n * Play area configuration constants.\n *\n * The play area is the inner usable region inside the puzzle-base frame\n * where parts can be placed.\n */\nexport const PLAY_AREA = {\n  /** Inner play area width in pixels */\n  width: 815,\n\n  /** Inner play area height in pixels */\n  height: 860,\n\n  /** Play area center X in world coordinates */\n  centerX: 540,\n\n  /** Play area center Y in world coordinates */\n  centerY: 1199,\n\n  /** Local coordinate bounds (centered origin at 0,0) */\n  bounds: {\n    /** Minimum X coordinate (left edge) */\n    minX: -407,\n    /** Maximum X coordinate (right edge) */\n    maxX: 407,\n    /** Minimum Y coordinate (top edge) */\n    minY: -430,\n    /** Maximum Y coordinate (bottom edge) */\n    maxY: 430,\n  },\n} as const;\n\n/**\n * Convert local (centered) coordinates to world coordinates.\n *\n * Local coordinates use the play area center as origin (0, 0).\n * World coordinates use the screen top-left as origin.\n *\n * @param localPosition - Position in centered coordinate system\n * @returns Position in world coordinates\n *\n * @example\n * ```typescript\n * // Center of play area\n * localToWorld({ x: 0, y: 0 }); // => { x: 540, y: 1199 }\n *\n * // Top-left corner of play area\n * localToWorld({ x: -407, y: -430 }); // => { x: 133, y: 769 }\n * ```\n */\nexport function localToWorld(localPosition: Position): Position {\n  return {\n    x: PLAY_AREA.centerX + localPosition.x,\n    y: PLAY_AREA.centerY + localPosition.y,\n  };\n}\n\n/**\n * Convert world coordinates to local (centered) coordinates.\n *\n * @param worldPosition - Position in world coordinates\n * @returns Position in centered coordinate system\n *\n * @example\n * ```typescript\n * worldToLocal({ x: 540, y: 1199 }); // => { x: 0, y: 0 }\n * ```\n */\nexport function worldToLocal(worldPosition: Position): Position {\n  return {\n    x: worldPosition.x - PLAY_AREA.centerX,\n    y: worldPosition.y - PLAY_AREA.centerY,\n  };\n}\n\n/**\n * Check if a part's bounding box fits entirely within the play area.\n *\n * The part is represented by its center position (in local coordinates)\n * and its collision box dimensions. The function checks that all four\n * edges of the part stay within the play area bounds.\n *\n * @param localPosition - Part center position in local coordinates\n * @param width - Part collision box width in pixels\n * @param height - Part collision box height in pixels\n * @returns true if the part fits entirely within the play area\n *\n * @example\n * ```typescript\n * // Small part at center - fits\n * isPartInPlayArea({ x: 0, y: 0 }, 100, 100); // => true\n *\n * // Part too close to edge - doesn't fit\n * isPartInPlayArea({ x: 350, y: 0 }, 200, 100); // => false (right edge at 450 > 407)\n * ```\n */\nexport function isPartInPlayArea(\n  localPosition: Position,\n  width: number,\n  height: number\n): boolean {\n  const halfWidth = width / 2;\n  const halfHeight = height / 2;\n\n  const leftEdge = localPosition.x - halfWidth;\n  const rightEdge = localPosition.x + halfWidth;\n  const topEdge = localPosition.y - halfHeight;\n  const bottomEdge = localPosition.y + halfHeight;\n\n  return (\n    leftEdge >= PLAY_AREA.bounds.minX &&\n    rightEdge <= PLAY_AREA.bounds.maxX &&\n    topEdge >= PLAY_AREA.bounds.minY &&\n    bottomEdge <= PLAY_AREA.bounds.maxY\n  );\n}\n\n/** Detailed information about a part's position relative to play area bounds. */\nexport interface PartBoundsInfo {\n  leftEdge: number;\n  rightEdge: number;\n  topEdge: number;\n  bottomEdge: number;\n  exceedsLeft: boolean;\n  exceedsRight: boolean;\n  exceedsTop: boolean;\n  exceedsBottom: boolean;\n}\n\n/**\n * Get detailed information about why a part doesn't fit in the play area.\n *\n * @param localPosition - Part center position in local coordinates\n * @param width - Part collision box width in pixels\n * @param height - Part collision box height in pixels\n * @returns Object with edge positions and which bounds are exceeded\n *\n * @internal\n */\nexport function getPartBoundsInfo(\n  localPosition: Position,\n  width: number,\n  height: number\n): PartBoundsInfo {\n  const halfWidth = width / 2;\n  const halfHeight = height / 2;\n  const leftEdge = localPosition.x - halfWidth;\n  const rightEdge = localPosition.x + halfWidth;\n  const topEdge = localPosition.y - halfHeight;\n  const bottomEdge = localPosition.y + halfHeight;\n\n  return {\n    leftEdge,\n    rightEdge,\n    topEdge,\n    bottomEdge,\n    exceedsLeft: leftEdge < PLAY_AREA.bounds.minX,\n    exceedsRight: rightEdge > PLAY_AREA.bounds.maxX,\n    exceedsTop: topEdge < PLAY_AREA.bounds.minY,\n    exceedsBottom: bottomEdge > PLAY_AREA.bounds.maxY,\n  };\n}\n","/**\n * Level and region loading with validation.\n *\n * @module\n */\n\nimport type {\n  LevelDefinition,\n  RegionDefinition,\n  PartInstance,\n  ScrewPlacement,\n} from '@shared/types';\nimport { getPart, hasPart } from '@shared/parts';\nimport {\n  isScrewInBounds,\n  SCREW_RADIUS,\n  isPartInPlayArea,\n  getPartBoundsInfo,\n  PLAY_AREA,\n} from '@shared/utils';\n\n/**\n * Validation error with context.\n */\nexport interface ValidationError {\n  /** Error message */\n  message: string;\n  /** Path to the error location (e.g., \"parts[0].screws[1]\") */\n  path: string;\n}\n\n/**\n * Validation result.\n */\nexport interface ValidationResult {\n  /** Whether the validation passed */\n  valid: boolean;\n  /** List of errors (empty if valid) */\n  errors: ValidationError[];\n  /** List of warnings (non-fatal issues) */\n  warnings: ValidationError[];\n}\n\n/**\n * Validate a screw placement against its part definition.\n *\n * Checks that the screw position is within the part's collision bounds,\n * accounting for the screw radius.\n *\n * @param screw - The screw placement to validate\n * @param partInstance - The part instance containing this screw\n * @param screwIndex - Index of the screw in the part's screws array\n * @param partIndex - Index of the part in the level's parts array\n * @returns Validation error if invalid, null if valid\n *\n * @example\n * ```typescript\n * const error = validateScrewPlacement(screw, part, 0, 1);\n * if (error) console.error(error.message);\n * ```\n */\nfunction validateScrewPlacement(\n  screw: ScrewPlacement,\n  partInstance: PartInstance,\n  screwIndex: number,\n  partIndex: number\n): ValidationError | null {\n  const partDef = getPart(partInstance.partId);\n\n  if (!isScrewInBounds(screw.position, partDef.collision)) {\n    const boundsDesc =\n      partDef.collision.type === 'box'\n        ? `${String(partDef.collision.width)}x${String(partDef.collision.height)}`\n        : `${String(partDef.collision.points.length)}-point polygon`;\n\n    return {\n      message: `Screw at (${String(screw.position.x)}, ${String(screw.position.y)}) extends beyond part bounds (${boundsDesc}). Screw radius is ${String(SCREW_RADIUS)}px.`,\n      path: `parts[${String(partIndex)}].screws[${String(screwIndex)}].position`,\n    };\n  }\n\n  return null;\n}\n\n/**\n * Get collision box dimensions from a part definition.\n * @param partId - The part ID to look up\n * @returns Width and height of the part's collision box\n * @example\n */\nfunction getPartDimensions(partId: string): { width: number; height: number } {\n  const partDef = getPart(partId);\n  if (partDef.collision.type === 'box') {\n    return { width: partDef.collision.width, height: partDef.collision.height };\n  }\n  // For polygon collisions, calculate bounding box\n  const points = partDef.collision.points;\n  const xs = points.map((p) => p.x);\n  const ys = points.map((p) => p.y);\n  return {\n    width: Math.max(...xs) - Math.min(...xs),\n    height: Math.max(...ys) - Math.min(...ys),\n  };\n}\n\n/**\n * Format exceeded bounds into human-readable strings.\n * @param info - Bounds info from getPartBoundsInfo\n * @returns Array of exceeded boundary descriptions\n * @example\n */\nfunction formatExceededBounds(\n  info: ReturnType<typeof getPartBoundsInfo>\n): string[] {\n  const result: string[] = [];\n  if (info.exceedsLeft)\n    result.push(\n      `left (${String(info.leftEdge)} < ${String(PLAY_AREA.bounds.minX)})`\n    );\n  if (info.exceedsRight)\n    result.push(\n      `right (${String(info.rightEdge)} > ${String(PLAY_AREA.bounds.maxX)})`\n    );\n  if (info.exceedsTop)\n    result.push(\n      `top (${String(info.topEdge)} < ${String(PLAY_AREA.bounds.minY)})`\n    );\n  if (info.exceedsBottom)\n    result.push(\n      `bottom (${String(info.bottomEdge)} > ${String(PLAY_AREA.bounds.maxY)})`\n    );\n  return result;\n}\n\n/**\n * Validate that a part instance fits within the play area boundaries.\n * @param part - The part instance to validate\n * @param partIndex - Index of the part in the level's parts array\n * @returns Validation error if part exceeds boundaries, null if valid\n * @example\n */\nfunction validatePartPlayAreaBounds(\n  part: PartInstance,\n  partIndex: number\n): ValidationError | null {\n  const { width, height } = getPartDimensions(part.partId);\n  if (isPartInPlayArea(part.position, width, height)) return null;\n\n  const boundsInfo = getPartBoundsInfo(part.position, width, height);\n  const exceeded = formatExceededBounds(boundsInfo);\n  const pos = `(${String(part.position.x)}, ${String(part.position.y)})`;\n  const size = `${String(width)}x${String(height)}`;\n\n  return {\n    message: `Part \"${part.partId}\" at ${pos} with size ${size} exceeds play area bounds. Exceeded: ${exceeded.join(', ')}`,\n    path: `parts[${String(partIndex)}].position`,\n  };\n}\n\n/** Result type for part instance validation. */\ninterface PartValidationResult {\n  errors: ValidationError[];\n  warnings: ValidationError[];\n}\n\n/**\n * Validate a part instance for unknown parts, play area bounds, and screw positions.\n * @param part - The part instance to validate\n * @param partIndex - Index of the part in the level's parts array\n * @returns Object containing errors and warnings arrays\n * @example\n */\nfunction validatePartInstance(\n  part: PartInstance,\n  partIndex: number\n): PartValidationResult {\n  const errors: ValidationError[] = [];\n  const warnings: ValidationError[] = [];\n\n  if (!hasPart(part.partId)) {\n    const path = `parts[${String(partIndex)}].partId`;\n    errors.push({ message: `Unknown part \"${part.partId}\"`, path });\n    return { errors, warnings };\n  }\n\n  const boundsError = validatePartPlayAreaBounds(part, partIndex);\n  if (boundsError) errors.push(boundsError);\n\n  const usedPositions = new Set<string>();\n  part.screws.forEach((screw, i) => {\n    const screwError = validateScrewPlacement(screw, part, i, partIndex);\n    if (screwError) errors.push(screwError);\n\n    const posKey = `${String(screw.position.x)},${String(screw.position.y)}`;\n    if (usedPositions.has(posKey)) {\n      const path = `parts[${String(partIndex)}].screws[${String(i)}].position`;\n      const msg = `Multiple screws at position (${String(screw.position.x)}, ${String(screw.position.y)})`;\n      warnings.push({ message: msg, path });\n    }\n    usedPositions.add(posKey);\n  });\n\n  return { errors, warnings };\n}\n\n/**\n * Validate tray capacities in a level.\n *\n * @param level - The level to validate\n * @returns Array of validation errors for invalid tray capacities\n *\n * @example\n * ```typescript\n * const errors = validateTrayCapacities(level);\n * ```\n */\nfunction validateTrayCapacities(level: LevelDefinition): ValidationError[] {\n  const errors: ValidationError[] = [];\n  level.trays.forEach((tray, i) => {\n    if (tray.capacity < 1 || tray.capacity > 4) {\n      errors.push({\n        message: `Tray capacity must be 1-4, got ${String(tray.capacity)}`,\n        path: `trays[${String(i)}].capacity`,\n      });\n    }\n  });\n  return errors;\n}\n\n/**\n * Validate parts in a level and detect layer conflicts.\n *\n * @param level - The level to validate\n * @returns Object with errors and warnings arrays\n *\n * @example\n * ```typescript\n * const result = validateLevelParts(level);\n * ```\n */\nfunction validateLevelParts(level: LevelDefinition): {\n  errors: ValidationError[];\n  warnings: ValidationError[];\n} {\n  const errors: ValidationError[] = [];\n  const warnings: ValidationError[] = [];\n  const layerCounts = new Map<number, number>();\n\n  level.parts.forEach((part, i) => {\n    const partResult = validatePartInstance(part, i);\n    errors.push(...partResult.errors);\n    warnings.push(...partResult.warnings);\n    const count = layerCounts.get(part.layer) ?? 0;\n    layerCounts.set(part.layer, count + 1);\n  });\n\n  for (const [layer, count] of layerCounts) {\n    if (count > 1) {\n      warnings.push({\n        message: `${String(count)} parts share layer ${String(layer)} - occlusion order may be ambiguous`,\n        path: 'parts',\n      });\n    }\n  }\n\n  return { errors, warnings };\n}\n\n/**\n * Validate win condition references in a level.\n *\n * @param level - The level to validate\n * @returns Array of validation errors for invalid win conditions\n *\n * @example\n * ```typescript\n * const errors = validateWinCondition(level);\n * ```\n */\nfunction validateWinCondition(level: LevelDefinition): ValidationError[] {\n  const errors: ValidationError[] = [];\n\n  if (level.win.type === 'partsRemoved') {\n    for (const partIndex of level.win.partIndices) {\n      if (partIndex < 0 || partIndex >= level.parts.length) {\n        errors.push({\n          message: `Invalid part index ${String(partIndex)} in win condition (valid: 0-${String(level.parts.length - 1)})`,\n          path: 'win.partIndices',\n        });\n      }\n    }\n  } else if (level.win.type === 'targetFreed') {\n    const { targetPartIndex } = level.win;\n    if (targetPartIndex < 0 || targetPartIndex >= level.parts.length) {\n      errors.push({\n        message: `Invalid target part index ${String(targetPartIndex)} in win condition`,\n        path: 'win.targetPartIndex',\n      });\n    }\n  }\n\n  return errors;\n}\n\n/**\n * Validate a level definition.\n *\n * @param level - The level to validate\n * @returns Validation result with errors and warnings\n *\n * @example\n * ```typescript\n * const result = validateLevel(level);\n * if (!result.valid) {\n *   console.error('Level validation failed:', result.errors);\n * }\n * ```\n */\nexport function validateLevel(level: LevelDefinition): ValidationResult {\n  const errors: ValidationError[] = [];\n  const warnings: ValidationError[] = [];\n\n  errors.push(...validateTrayCapacities(level));\n\n  if (level.bufferCapacity !== undefined && level.bufferCapacity < 1) {\n    errors.push({\n      message: `Buffer capacity must be at least 1, got ${String(level.bufferCapacity)}`,\n      path: 'bufferCapacity',\n    });\n  }\n\n  const partsResult = validateLevelParts(level);\n  errors.push(...partsResult.errors);\n  warnings.push(...partsResult.warnings);\n\n  errors.push(...validateWinCondition(level));\n\n  return { valid: errors.length === 0, errors, warnings };\n}\n\n/**\n * Append level validation results with path prefix.\n *\n * @param levelResult - Result from validateLevel\n * @param index - Level index for path prefixing\n * @param errors - Errors array to append to\n * @param warnings - Warnings array to append to\n *\n * @example\n * ```typescript\n * appendLevelResults(validateLevel(level), 0, errors, warnings);\n * ```\n */\nfunction appendLevelResults(\n  levelResult: ValidationResult,\n  index: number,\n  errors: ValidationError[],\n  warnings: ValidationError[]\n): void {\n  for (const error of levelResult.errors) {\n    errors.push({\n      message: error.message,\n      path: `levels[${String(index)}].${error.path}`,\n    });\n  }\n  for (const warning of levelResult.warnings) {\n    warnings.push({\n      message: warning.message,\n      path: `levels[${String(index)}].${warning.path}`,\n    });\n  }\n}\n\n/**\n * Validate individual levels within a region.\n *\n * @param region - The region to validate\n * @returns Object with errors and warnings arrays\n *\n * @example\n * ```typescript\n * const result = validateRegionLevelContents(region);\n * ```\n */\nfunction validateRegionLevelContents(region: RegionDefinition): {\n  errors: ValidationError[];\n  warnings: ValidationError[];\n} {\n  const errors: ValidationError[] = [];\n  const warnings: ValidationError[] = [];\n  const levelIds = new Set<string>();\n\n  region.levels.forEach((level, i) => {\n    if (levelIds.has(level.id)) {\n      errors.push({\n        message: `Duplicate level ID \"${level.id}\"`,\n        path: `levels[${String(i)}].id`,\n      });\n    }\n    levelIds.add(level.id);\n    appendLevelResults(validateLevel(level), i, errors, warnings);\n  });\n\n  return { errors, warnings };\n}\n\n/**\n * Validate a region definition.\n *\n * @param region - The region to validate\n * @returns Validation result with errors and warnings\n *\n * @example\n * ```typescript\n * const result = validateRegion(region);\n * if (!result.valid) {\n *   console.error('Region validation failed:', result.errors);\n * }\n * ```\n */\nexport function validateRegion(region: RegionDefinition): ValidationResult {\n  const warnings: ValidationError[] = [];\n\n  if (region.levels.length !== 10) {\n    warnings.push({\n      message: `Expected 10 levels, got ${String(region.levels.length)}`,\n      path: 'levels',\n    });\n  }\n\n  const levelContents = validateRegionLevelContents(region);\n\n  return {\n    valid: levelContents.errors.length === 0,\n    errors: levelContents.errors,\n    warnings: [...warnings, ...levelContents.warnings],\n  };\n}\n\n/**\n * Load and validate a region from a JSON file.\n *\n * @param path - Path to the region JSON file\n * @returns The validated region definition\n * @throws Error if loading or validation fails\n *\n * @example\n * ```typescript\n * const region = await loadRegion('regions/region-1.json');\n * console.log(`Loaded region \"${region.name}\"`);\n * ```\n */\nexport async function loadRegion(path: string): Promise<RegionDefinition> {\n  const response = await fetch(path);\n  if (!response.ok) {\n    throw new Error(\n      `Failed to load region from ${path}: ${String(response.status)}`\n    );\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n  const region: RegionDefinition = await response.json();\n  const result = validateRegion(region);\n\n  if (!result.valid) {\n    const errorMessages = result.errors\n      .map((e) => `  ${e.path}: ${e.message}`)\n      .join('\\n');\n    throw new Error(\n      `Region \"${region.id}\" validation failed:\\n${errorMessages}`\n    );\n  }\n\n  return region;\n}\n\n/**\n * Get a specific level from a region by ID.\n *\n * @param region - The region to search\n * @param levelId - The level ID to find\n * @returns The level definition\n * @throws Error if level is not found\n *\n * @example\n * ```typescript\n * const level = getLevelById(region, 'workshop-01');\n * console.log(level.name);\n * ```\n */\nexport function getLevelById(\n  region: RegionDefinition,\n  levelId: string\n): LevelDefinition {\n  const level = region.levels.find((l) => l.id === levelId);\n  if (!level) {\n    throw new Error(`Level \"${levelId}\" not found in region \"${region.id}\"`);\n  }\n  return level;\n}\n\n/**\n * Get a specific level from a region by index.\n *\n * @param region - The region to search\n * @param index - The level index (0-based)\n * @returns The level definition\n * @throws Error if index is out of bounds\n *\n * @example\n * ```typescript\n * const level = getLevelByIndex(region, 0);\n * console.log(level.name);\n * ```\n */\nexport function getLevelByIndex(\n  region: RegionDefinition,\n  index: number\n): LevelDefinition {\n  const level = region.levels[index];\n  if (level === undefined) {\n    throw new Error(\n      `Level index ${String(index)} out of bounds (0-${String(region.levels.length - 1)})`\n    );\n  }\n  return level;\n}\n","/**\n * Type definitions for puzzle parts.\n *\n * Parts are defined in TypeScript code (not JSON) because they contain\n * constant properties like shapes, physics constraints, and materials.\n *\n * @module\n */\n\nimport type { Position } from './game.types';\n\n/**\n * Available screw colors.\n *\n * String enum for JSON readability and debuggability.\n */\nexport enum ScrewColor {\n  Red = 'red',\n  Blue = 'blue',\n  Green = 'green',\n  Yellow = 'yellow',\n}\n\n/**\n * Static constraint - part cannot move.\n */\nexport interface StaticConstraintDef {\n  type: 'static';\n}\n\n/**\n * Slider constraint - linear motion along an axis.\n */\nexport interface SliderConstraintDef {\n  type: 'slider';\n  /** Movement axis relative to part */\n  axis: 'x' | 'y';\n  /** Minimum travel distance in pixels */\n  min: number;\n  /** Maximum travel distance in pixels */\n  max: number;\n}\n\n/**\n * Hinge constraint - rotation around a pivot point.\n */\nexport interface HingeConstraintDef {\n  type: 'hinge';\n  /** Pivot point relative to part origin */\n  pivot: Position;\n  /** Minimum angle in degrees */\n  minAngle: number;\n  /** Maximum angle in degrees */\n  maxAngle: number;\n}\n\n/**\n * Spring constraint - tension release behavior.\n */\nexport interface SpringConstraintDef {\n  type: 'spring';\n  /** Direction spring pulls toward when released */\n  direction: 'open' | 'closed';\n  /** Animation duration in milliseconds */\n  duration: number;\n}\n\n/**\n * Friction constraint - resistance until screw threshold is met.\n */\nexport interface FrictionConstraintDef {\n  type: 'friction';\n  /** Number of screws that must be removed before part can move */\n  screwThreshold: number;\n}\n\n/**\n * Union of all constraint types.\n */\nexport type ConstraintDef =\n  | StaticConstraintDef\n  | SliderConstraintDef\n  | HingeConstraintDef\n  | SpringConstraintDef\n  | FrictionConstraintDef;\n\n/**\n * Box collision shape.\n */\nexport interface BoxCollisionShape {\n  type: 'box';\n  /** Width in pixels */\n  width: number;\n  /** Height in pixels */\n  height: number;\n}\n\n/**\n * Polygon collision shape.\n */\nexport interface PolygonCollisionShape {\n  type: 'polygon';\n  /** Vertices relative to part origin */\n  points: Position[];\n}\n\n/**\n * Union of all collision shapes.\n */\nexport type CollisionShape = BoxCollisionShape | PolygonCollisionShape;\n\n/**\n * Visual material types.\n */\nexport type MaterialType = 'metal' | 'wood' | 'plastic' | 'rubber' | 'glass';\n\n/**\n * Screw mount point on a part.\n *\n * Defines where a screw CAN be attached. The level JSON specifies\n * which mounts are actually used and what color each screw is.\n */\nexport interface ScrewMountDef {\n  /** Unique identifier within the part (e.g., 'top-left', 'center') */\n  id: string;\n  /** Position relative to part origin */\n  localPosition: Position;\n}\n\n/**\n * Part definition - the \"blueprint\" for a puzzle part.\n *\n * Defined in TypeScript code, not JSON. Contains all properties\n * that are constant for every instance of this part type.\n */\nexport interface PartDefinition {\n  /** Unique identifier (e.g., 'simple-plate', 'sliding-cover') */\n  id: string;\n  /** Display name for debugging/tools */\n  name: string;\n  /** Asset path for sprite, or null for procedural geometry */\n  asset: string | null;\n  /** Collision shape for physics */\n  collision: CollisionShape;\n  /** Visual material type */\n  material: MaterialType;\n  /** Physics constraint behavior */\n  constraint: ConstraintDef;\n  /** Available screw mount points */\n  screwMounts: ScrewMountDef[];\n  /** Custom pivot point (defaults to center of collision bounds) */\n  pivot?: Position;\n}\n","import type { Component, ComponentClass } from '@play-co/odie';\n\n/**\n * Creates a component class with reduced boilerplate.\n *\n * This helper function generates a fully-typed ODIE component class from\n * a name and default values, eliminating the need to manually write\n * interfaces, classes, static NAME properties, and init methods.\n *\n * @template T - The shape of the component data (inferred from defaults)\n * @param name - Component identifier (must be unique, used as key in entity data)\n * @param defaults - Default values for component properties\n * @returns A ComponentClass ready for use with DefineEntity and createEntity\n *\n * @example\n * // Define a simple health component (4 lines instead of ~18)\n * export const HealthComponent = defineComponent('health', {\n *   current: 100,\n *   max: 100,\n * });\n *\n * // Use with entity definition\n * import { DefineEntity, Entity2D } from '@play-co/odie';\n * const PlayerEntity = DefineEntity(Entity2D, HealthComponent);\n *\n * // Create entity with component data\n * import { createEntity } from '@play-co/odie';\n * const player = createEntity(PlayerEntity, {\n *   health: { current: 50, max: 100 }\n * });\n *\n * @example\n * // Define a velocity component for movement\n * export const VelocityComponent = defineComponent('velocity', {\n *   x: 0,\n *   y: 0,\n *   speed: 5,\n * });\n *\n * @example\n * // Access component data from an entity\n * const health = player.c.health as ReturnType<typeof HealthComponent.prototype.init>;\n * console.log(health.current); // 50\n * health.current -= 10; // Take damage\n *\n * @example\n * // Define a tag component (empty data)\n * export const PlayerTagComponent = defineComponent('playerTag', {});\n */\nexport function defineComponent<T extends Record<string, unknown>>(\n  name: string,\n  defaults: T\n): ComponentClass<T, Component<T> & T> {\n  // Create a class that implements Component<T>\n  const ComponentImpl = class implements Component<T> {\n    static readonly NAME = name;\n\n    constructor() {\n      // Initialize with default values\n      Object.assign(this, structuredClone(defaults));\n    }\n\n    init(data: T): void {\n      // Merge provided data with defaults\n      Object.assign(this, data);\n    }\n\n    reset(): void {\n      // Reset to default values\n      Object.assign(this, structuredClone(defaults));\n    }\n  };\n\n  // Copy default properties to prototype for type inference\n  Object.keys(defaults).forEach((key) => {\n    Object.defineProperty(ComponentImpl.prototype, key, {\n      value: defaults[key],\n      writable: true,\n      enumerable: true,\n      configurable: true,\n    });\n  });\n\n  return ComponentImpl as unknown as ComponentClass<T, Component<T> & T>;\n}\n\n/**\n * Type helper to extract the data type from a component created with defineComponent.\n *\n * @example\n * const HealthComponent = defineComponent('health', { current: 100, max: 100 });\n * type HealthData = ComponentData<typeof HealthComponent>;\n * // HealthData = { current: number; max: number }\n */\nexport type ComponentData<C extends ComponentClass<unknown>> =\n  C extends ComponentClass<infer D> ? D : never;\n","import { defineComponent } from '@shared/ecs';\nimport { ScrewColor } from '@shared/types';\n\n/**\n * Screw state types.\n */\nexport type ScrewState = 'inBoard' | 'inTray' | 'inBuffer' | 'dragging';\n\n/**\n * Component for screw entities.\n *\n * Stores the screw's color, state, and relationship to its parent part.\n *\n * @example\n * const entity = createEntity(ScrewEntity, {\n *   screw: { color: ScrewColor.Red, partEntityId: '123' }\n * });\n */\nexport const ScrewComponent = defineComponent('screw', {\n  /** Screw color - determines which tray it goes to */\n  color: ScrewColor.Red as ScrewColor,\n  /** ID of the parent part entity (empty string if removed) */\n  partEntityId: '',\n  /** Current state of the screw */\n  state: 'inBoard' as ScrewState,\n  /** ID of the tray entity this screw is in (empty if in board) */\n  trayEntityId: '',\n  /** Slot index in the tray (0-based, -1 if not in tray) */\n  slotIndex: -1,\n  /** Whether the screw is currently animating (locked for interaction) */\n  isAnimating: false,\n});\n\n/** Data interface for ScrewComponent */\nexport interface ScrewComponentData {\n  color: ScrewColor;\n  partEntityId: string;\n  state: ScrewState;\n  trayEntityId: string;\n  slotIndex: number;\n  isAnimating: boolean;\n}\n","import { defineComponent } from '@shared/ecs';\n\n/**\n * Part state types.\n */\nexport type PartState = 'static' | 'constrained' | 'free';\n\n/**\n * Component for part/board entities.\n *\n * Stores the part's definition reference, layer order, and state.\n *\n * @example\n * const entity = createEntity(PartEntity, {\n *   part: { partDefinitionId: 'board-walnut-square', layer: 1 }\n * });\n */\nexport const PartComponent = defineComponent('part', {\n  /** ID referencing the PartDefinition in the registry */\n  partDefinitionId: '',\n  /** Z-order layer for occlusion (higher = on top) */\n  layer: 0,\n  /** Number of screws currently attached */\n  screwCount: 0,\n  /** Current movement state */\n  state: 'static' as PartState,\n});\n\n/** Data interface for PartComponent */\nexport interface PartComponentData {\n  partDefinitionId: string;\n  layer: number;\n  screwCount: number;\n  state: PartState;\n}\n","import { defineComponent } from '@shared/ecs';\nimport { ScrewColor } from '@shared/types';\n\n/**\n * Component for colored tray entities.\n *\n * Stores the tray's color, capacity, and current screw count.\n * Screws of matching color are placed here when removed from parts.\n *\n * The displayOrder property (0-4) determines visibility:\n * - 0-1: Visible trays in left-to-right order\n * - 2-4: Hidden trays (below the visible area, covered)\n *\n * @example\n * const entity = createEntity(TrayEntity, {\n *   tray: { color: ScrewColor.Blue, capacity: 3, displayOrder: 0 }\n * });\n */\nexport const TrayComponent = defineComponent('tray', {\n  /** Tray color - only matching screws can be placed here */\n  color: ScrewColor.Red as ScrewColor,\n  /** Maximum number of screws this tray can hold */\n  capacity: 3,\n  /** Current number of screws in the tray */\n  screwCount: 0,\n  /** Display order (0-4): 0-1 are visible, 2-4 are hidden */\n  displayOrder: 0,\n  /** Whether the tray is currently animating (block interactions) */\n  isAnimating: false,\n});\n\n/** Data interface for TrayComponent */\nexport interface TrayComponentData {\n  color: ScrewColor;\n  capacity: number;\n  screwCount: number;\n  displayOrder: number;\n  isAnimating: boolean;\n}\n","import { defineComponent } from '@shared/ecs';\n\n/**\n * Component for the buffer tray entity.\n *\n * The buffer tray holds screws temporarily when the matching colored tray\n * is full. Screws are auto-transferred when space becomes available.\n *\n * @example\n * const entity = createEntity(BufferTrayEntity, {\n *   bufferTray: { capacity: 5 }\n * });\n */\nexport const BufferTrayComponent = defineComponent('bufferTray', {\n  /** Maximum number of screws the buffer can hold */\n  capacity: 5,\n  /** IDs of screws in FIFO order for auto-transfer */\n  screwIds: [] as string[],\n});\n\n/** Data interface for BufferTrayComponent */\nexport interface BufferTrayComponentData {\n  capacity: number;\n  screwIds: string[];\n}\n","import { defineComponent } from '@shared/ecs';\n\n/**\n * Game phase types.\n */\nexport type GamePhase = 'playing' | 'won' | 'stuck';\n\n/**\n * Component for tracking overall game state.\n *\n * This is a singleton component attached to a single entity that\n * tracks the game's progress through the current level.\n *\n * @example\n * const entity = createEntity(GameStateEntity, {\n *   gameState: { totalScrews: 6, winConditionType: 'allScrewsRemoved' }\n * });\n */\nexport const GameStateComponent = defineComponent('gameState', {\n  /** Current game phase */\n  phase: 'playing' as GamePhase,\n  /** Total screws in the level (set at load) */\n  totalScrews: 0,\n  /** Number of screws removed from puzzle */\n  removedScrews: 0,\n  /** Type of win condition for this level */\n  winConditionType: 'allScrewsRemoved' as string,\n});\n\n/** Data interface for GameStateComponent */\nexport interface GameStateComponentData {\n  phase: GamePhase;\n  totalScrews: number;\n  removedScrews: number;\n  winConditionType: string;\n}\n","import { DefineEntity, Entity2D } from '@play-co/odie';\nimport { ScrewComponent } from '../components';\n\n/**\n * Entity type definition for a screw.\n *\n * This entity combines Entity2D (providing position, scale, rotation, and view)\n * with ScrewComponent (providing color, state, and part relationship data).\n *\n * @example\n * // Create using the factory function (recommended)\n * import { createScrewEntity } from '@scenes/game/factories';\n *\n * const screw = await createScrewEntity({\n *   color: ScrewColor.Blue,\n *   position: { x: 100, y: 100 }\n * });\n * scene.addChild(screw);\n */\nexport const ScrewEntity = DefineEntity(Entity2D, ScrewComponent);\n","import { DefineEntity, Entity2D } from '@play-co/odie';\nimport { PartComponent } from '../components';\n\n/**\n * Entity type definition for a puzzle part (board).\n *\n * This entity combines Entity2D (providing position, scale, rotation, and view)\n * with PartComponent (providing part definition reference, layer, and state).\n *\n * @example\n * // Create using the factory function (recommended)\n * import { createPartEntity } from '@scenes/game/factories';\n *\n * const board = await createPartEntity({\n *   partDefinitionId: 'board-walnut-square',\n *   position: { x: 200, y: 300 },\n *   layer: 1\n * });\n * scene.addChild(board);\n */\nexport const PartEntity = DefineEntity(Entity2D, PartComponent);\n","import { DefineEntity, Entity2D } from '@play-co/odie';\nimport { TrayComponent } from '../components';\n\n/**\n * Entity type definition for a colored tray.\n *\n * This entity combines Entity2D (providing position, scale, rotation, and view)\n * with TrayComponent (providing color, capacity, and screw count).\n *\n * @example\n * // Create using the factory function (recommended)\n * import { createTrayEntity } from '@scenes/game/factories';\n *\n * const tray = await createTrayEntity({\n *   color: ScrewColor.Red,\n *   position: { x: 48, y: 175 },\n *   capacity: 3\n * });\n * scene.addChild(tray);\n */\nexport const TrayEntity = DefineEntity(Entity2D, TrayComponent);\n","import { DefineEntity, Entity2D } from '@play-co/odie';\nimport { BufferTrayComponent } from '../components';\n\n/**\n * Entity type definition for the buffer tray.\n *\n * This entity combines Entity2D (providing position, scale, rotation, and view)\n * with BufferTrayComponent (providing capacity and screw IDs).\n *\n * @example\n * // Create using the factory function (recommended)\n * import { createBufferTrayEntity } from '@scenes/game/factories';\n *\n * const buffer = await createBufferTrayEntity({\n *   position: { x: 136, y: 405 },\n *   capacity: 5\n * });\n * scene.addChild(buffer);\n */\nexport const BufferTrayEntity = DefineEntity(Entity2D, BufferTrayComponent);\n","/**\n * Factory functions for creating game entities (screws, parts, trays).\n *\n * These factories encapsulate the entity creation, visual setup, and positioning\n * in a single call, reducing boilerplate and centralizing entity creation logic.\n *\n * @module\n */\n\nimport { createEntity, type Entity2D } from '@play-co/odie';\nimport { Assets, type Container, Sprite, type Texture } from 'pixi.js';\n\nimport type { Position } from '@shared/types';\nimport { ScrewColor } from '@shared/types';\nimport { ScrewEntity } from '../entities/ScrewEntity';\nimport { PartEntity } from '../entities/PartEntity';\nimport { TrayEntity } from '../entities/TrayEntity';\nimport { BufferTrayEntity } from '../entities/BufferTrayEntity';\nimport type { ScrewState } from '../components';\n\n/**\n * WeakMap registry for storing visual references.\n */\nconst gameVisualRegistry = new WeakMap<Entity2D, Container>();\n\n/**\n * Gets the visual display object from a game entity.\n *\n * @param entity - The entity to get the visual from\n * @returns The visual container or undefined if not found\n *\n * @example\n * const screw = await createScrewEntity({ color: ScrewColor.Blue, position: { x: 0, y: 0 } });\n * const sprite = getGameVisual(screw) as Sprite;\n */\nexport function getGameVisual(entity: Entity2D): Container | undefined {\n  return gameVisualRegistry.get(entity);\n}\n\n/**\n * Maps screw color to short screw asset alias (used when screw is in board).\n */\nconst SHORT_SCREW_ASSET_MAP: Record<ScrewColor, string> = {\n  [ScrewColor.Red]: 'short-screw-red',\n  [ScrewColor.Yellow]: 'short-screw-yellow',\n  [ScrewColor.Green]: 'short-screw-green',\n  [ScrewColor.Blue]: 'short-screw-blue',\n};\n\n/**\n * Maps screw color to long screw asset alias (used when screw is removed).\n */\nconst LONG_SCREW_ASSET_MAP: Record<ScrewColor, string> = {\n  [ScrewColor.Red]: 'screw-red',\n  [ScrewColor.Yellow]: 'screw-yellow',\n  [ScrewColor.Green]: 'screw-green',\n  [ScrewColor.Blue]: 'screw-blue',\n};\n\n/**\n * Maps screw color to tray asset alias.\n */\nconst TRAY_ASSET_MAP: Record<ScrewColor, string> = {\n  [ScrewColor.Red]: 'tray-red',\n  [ScrewColor.Yellow]: 'tray-yellow',\n  [ScrewColor.Green]: 'tray-green',\n  [ScrewColor.Blue]: 'tray-blue',\n};\n\n/**\n * Maps screw color to placeholder asset alias.\n */\nconst PLACEHOLDER_ASSET_MAP: Record<ScrewColor, string> = {\n  [ScrewColor.Red]: 'placeholder-red',\n  [ScrewColor.Yellow]: 'placeholder-yellow',\n  [ScrewColor.Green]: 'placeholder-green',\n  [ScrewColor.Blue]: 'placeholder-blue',\n};\n\n/**\n * Tray sprite width for centering calculations.\n * Updated for new Figma design (was 200, now 185).\n */\nconst TRAY_WIDTH = 185;\n\n/**\n * Placeholder display width (new assets are 40x50, no scaling needed).\n */\nconst PLACEHOLDER_DISPLAY_WIDTH = 40;\n\n/**\n * Spacing between placeholder sprite centers.\n * Adjusted for smaller tray width.\n */\nconst PLACEHOLDER_SPACING = 40;\n\n/**\n * Y position for placeholders within tray.\n * Centered vertically in 150px tray height.\n */\nconst PLACEHOLDER_Y = 75;\n\n/**\n * WeakMap registry for storing placeholder sprite references.\n */\nconst placeholderRegistry = new WeakMap<Entity2D, Sprite[]>();\n\n/**\n * Gets the placeholder sprites from a tray entity.\n *\n * @param entity - The tray entity to get placeholders from\n * @returns Array of placeholder sprites or undefined if not found\n *\n * @example\n * const placeholders = getTrayPlaceholders(trayEntity);\n * if (placeholders) placeholders[0].alpha = 0; // Hide first placeholder\n */\nexport function getTrayPlaceholders(entity: Entity2D): Sprite[] | undefined {\n  return placeholderRegistry.get(entity);\n}\n\n// ============================================================================\n// Screw Entity Factory\n// ============================================================================\n\n/**\n * Options for creating a screw entity.\n */\nexport interface ScrewEntityOptions {\n  /** Screw color */\n  color: ScrewColor;\n  /** Position to place the screw (world coordinates) */\n  position: Position;\n  /** Initial state (defaults to 'inBoard') */\n  state?: ScrewState;\n  /** ID of the parent part entity */\n  partEntityId?: string;\n}\n\n/**\n * Creates a screw entity with its sprite.\n *\n * @param options - Entity configuration\n * @returns Promise resolving to the created entity\n *\n * @example\n * const screw = await createScrewEntity({\n *   color: ScrewColor.Blue,\n *   position: { x: 100, y: 100 }\n * });\n * scene.addChild(screw);\n */\nexport async function createScrewEntity(\n  options: ScrewEntityOptions\n): Promise<Entity2D> {\n  const state = options.state ?? 'inBoard';\n\n  // Use short screw when in board, long screw when removed\n  const assetMap =\n    state === 'inBoard' ? SHORT_SCREW_ASSET_MAP : LONG_SCREW_ASSET_MAP;\n  const assetAlias = assetMap[options.color];\n  const texture = await Assets.load<Texture>(assetAlias);\n\n  const entity = createEntity(ScrewEntity, {\n    screw: {\n      color: options.color,\n      state,\n      partEntityId: options.partEntityId ?? '',\n    },\n  });\n\n  const sprite = new Sprite(texture);\n  sprite.anchor.set(0.5); // Center anchor for rotation\n\n  gameVisualRegistry.set(entity, sprite);\n  entity.view.addChild(sprite);\n  entity.position.set(options.position.x, options.position.y);\n\n  return entity;\n}\n\n// ============================================================================\n// Part Entity Factory\n// ============================================================================\n\n/**\n * Options for creating a part entity.\n */\nexport interface PartEntityOptions {\n  /** Asset alias for the part sprite */\n  assetAlias: string;\n  /** Part definition ID (for component data) */\n  partDefinitionId: string;\n  /** Position to place the part */\n  position: Position;\n  /** Z-order layer (defaults to 0) */\n  layer?: number;\n}\n\n/**\n * Creates a part (board) entity with its sprite.\n *\n * @param options - Entity configuration\n * @returns Promise resolving to the created entity\n *\n * @example\n * const board = await createPartEntity({\n *   assetAlias: 'board-walnut-square',\n *   partDefinitionId: 'board-walnut-square',\n *   position: { x: 200, y: 300 },\n *   layer: 1\n * });\n * scene.addChild(board);\n */\nexport async function createPartEntity(\n  options: PartEntityOptions\n): Promise<Entity2D> {\n  const texture = await Assets.load<Texture>(options.assetAlias);\n\n  const entity = createEntity(PartEntity, {\n    part: {\n      partDefinitionId: options.partDefinitionId,\n      layer: options.layer ?? 0,\n      screwCount: 0,\n      state: 'static',\n    },\n  });\n\n  const sprite = new Sprite(texture);\n  sprite.anchor.set(0.5); // Center anchor for centered coordinate system\n  sprite.eventMode = 'static'; // Block clicks from reaching screws underneath\n\n  gameVisualRegistry.set(entity, sprite);\n  entity.view.addChild(sprite);\n  entity.position.set(options.position.x, options.position.y);\n\n  return entity;\n}\n\n// ============================================================================\n// Tray Entity Factory\n// ============================================================================\n\n/**\n * Options for creating a tray entity.\n */\nexport interface TrayEntityOptions {\n  /** Tray color */\n  color: ScrewColor;\n  /** Position to place the tray */\n  position: Position;\n  /** Maximum screw capacity (defaults to 3) */\n  capacity?: number;\n  /** Display order (0-3): 0-1 are visible, 2-3 are hidden */\n  displayOrder?: number;\n}\n\n/**\n * Creates a colored tray entity with its sprite and placeholder sprites.\n *\n * Placeholders are semi-transparent screw outlines that show where screws\n * should be placed. They fade out when a screw is placed in their slot.\n *\n * @param options - Entity configuration\n * @returns Promise resolving to the created entity\n *\n * @example\n * const tray = await createTrayEntity({\n *   color: ScrewColor.Red,\n *   position: { x: 48, y: 175 },\n *   capacity: 3,\n *   displayOrder: 0\n * });\n * scene.addChild(tray);\n */\nexport async function createTrayEntity(\n  options: TrayEntityOptions\n): Promise<Entity2D> {\n  const capacity = options.capacity ?? 3;\n  const displayOrder = options.displayOrder ?? 0;\n\n  const [trayTexture, placeholderTexture] = await loadTrayTextures(\n    options.color\n  );\n  const entity = createTrayEntityWithComponent(\n    options.color,\n    capacity,\n    displayOrder\n  );\n  setupTraySprite(entity, trayTexture);\n  setupPlaceholders(entity, placeholderTexture, capacity);\n  entity.position.set(options.position.x, options.position.y);\n\n  return entity;\n}\n\nfunction loadTrayTextures(color: ScrewColor): Promise<[Texture, Texture]> {\n  return Promise.all([\n    Assets.load<Texture>(TRAY_ASSET_MAP[color]),\n    Assets.load<Texture>(PLACEHOLDER_ASSET_MAP[color]),\n  ]);\n}\n\nfunction createTrayEntityWithComponent(\n  color: ScrewColor,\n  capacity: number,\n  displayOrder: number\n): Entity2D {\n  return createEntity(TrayEntity, {\n    tray: { color, capacity, screwCount: 0, displayOrder, isAnimating: false },\n  });\n}\n\nfunction setupTraySprite(entity: Entity2D, texture: Texture): void {\n  const traySprite = new Sprite(texture);\n  gameVisualRegistry.set(entity, traySprite);\n  entity.view.addChild(traySprite);\n}\n\nfunction setupPlaceholders(\n  entity: Entity2D,\n  texture: Texture,\n  capacity: number\n): void {\n  const placeholders: Sprite[] = [];\n\n  // Calculate centered positions for placeholders within tray\n  const totalWidth =\n    (capacity - 1) * PLACEHOLDER_SPACING + PLACEHOLDER_DISPLAY_WIDTH;\n  const startX = (TRAY_WIDTH - totalWidth) / 2 + PLACEHOLDER_DISPLAY_WIDTH / 2;\n\n  for (let i = 0; i < capacity; i++) {\n    const placeholder = new Sprite(texture);\n    placeholder.anchor.set(0.5);\n    // No scaling needed - new assets are already 40x50\n    placeholder.position.set(startX + i * PLACEHOLDER_SPACING, PLACEHOLDER_Y);\n    placeholder.alpha = 0.7;\n    entity.view.addChild(placeholder);\n    placeholders.push(placeholder);\n  }\n  placeholderRegistry.set(entity, placeholders);\n}\n\n// ============================================================================\n// Buffer Tray Entity Factory\n// ============================================================================\n\n/**\n * Options for creating a buffer tray entity.\n */\nexport interface BufferTrayEntityOptions {\n  /** Position to place the buffer tray */\n  position: Position;\n  /** Maximum screw capacity (defaults to 5) */\n  capacity?: number;\n}\n\n/**\n * Creates a buffer tray entity with its sprite.\n *\n * @param options - Entity configuration\n * @returns Promise resolving to the created entity\n *\n * @example\n * const buffer = await createBufferTrayEntity({\n *   position: { x: 136, y: 405 },\n *   capacity: 5\n * });\n * scene.addChild(buffer);\n */\nexport async function createBufferTrayEntity(\n  options: BufferTrayEntityOptions\n): Promise<Entity2D> {\n  const texture = await Assets.load<Texture>('buffer-tray-frame');\n\n  const entity = createEntity(BufferTrayEntity, {\n    bufferTray: {\n      capacity: options.capacity ?? 5,\n      screwIds: [],\n    },\n  });\n\n  const sprite = new Sprite(texture);\n\n  gameVisualRegistry.set(entity, sprite);\n  entity.view.addChild(sprite);\n  entity.position.set(options.position.x, options.position.y);\n\n  return entity;\n}\n","import { DefineEntity, Entity2D } from '@play-co/odie';\nimport { GameStateComponent } from '../components/GameStateComponent';\n\n/**\n * Entity type definition for game state.\n *\n * This is a singleton entity that tracks the overall game progress.\n * It should be created once per level and holds the win condition state.\n *\n * @example\n * import { createEntity } from '@play-co/odie';\n *\n * const gameState = createEntity(GameStateEntity, {\n *   gameState: {\n *     phase: 'playing',\n *     totalScrews: 6,\n *     removedScrews: 0,\n *     winConditionType: 'allScrewsRemoved'\n *   }\n * });\n * scene.addChild(gameState);\n */\nexport const GameStateEntity = DefineEntity(Entity2D, GameStateComponent);\n","import type {\n  System,\n  Entity,\n  Scene2D,\n  Time,\n  QueryResults,\n} from '@play-co/odie';\n\n/**\n * Abstract base class for ODIE systems with convenience methods.\n *\n * This class provides a foundation for building game systems with:\n * - Typed access to scene and query results\n * - Helper method for iterating over entities in a query\n * - Proper TypeScript typing for Entity2D-based entities\n *\n * Systems are the \"S\" in ECS (Entity-Component-System). They contain the game\n * logic that operates on entities with specific components.\n *\n * @example\n * // Create a movement system\n * import { BaseSystem } from './BaseSystem';\n * import { VelocityComponent } from '../components';\n *\n * export class MovementSystem extends BaseSystem {\n *   static readonly NAME = 'movement';\n *   static Queries = {\n *     movable: { components: [VelocityComponent] }\n *   };\n *\n *   update(time: Time): void {\n *     this.forEachEntity('movable', (entity) => {\n *       const velocity = entity.c.velocity;\n *       entity.position.x += velocity.x * time.deltaTime;\n *       entity.position.y += velocity.y * time.deltaTime;\n *     });\n *   }\n * }\n *\n * @example\n * // Register the system with a scene\n * import { MovementSystem } from './systems/MovementSystem';\n *\n * // In your scene setup:\n * scene.addSystem(MovementSystem);\n *\n * @example\n * // Create a collision system with multiple queries\n * export class CollisionSystem extends BaseSystem {\n *   static readonly NAME = 'collision';\n *   static Queries = {\n *     players: { components: [PlayerComponent, ColliderComponent] },\n *     enemies: { components: [EnemyComponent, ColliderComponent] }\n *   };\n *\n *   update(_time: Time): void {\n *     this.forEachEntity('players', (player) => {\n *       this.forEachEntity('enemies', (enemy) => {\n *         if (this.checkCollision(player, enemy)) {\n *           // Handle collision\n *         }\n *       });\n *     });\n *   }\n *\n *   private checkCollision(a: Entity, b: Entity): boolean {\n *     // Collision detection logic\n *     return false;\n *   }\n * }\n */\nexport abstract class BaseSystem implements System<unknown, Scene2D> {\n  /**\n   * Reference to the scene this system is attached to.\n   * Automatically injected by ODIE when the system is added to a scene.\n   * @readonly\n   */\n  declare readonly scene: Scene2D;\n\n  /**\n   * Query results containing entities that match each defined query.\n   * Automatically populated by ODIE based on the static Queries definition.\n   * @readonly\n   */\n  declare readonly queries: QueryResults;\n\n  /**\n   * Iterates over all entities matching a named query.\n   *\n   * This is a convenience method that safely handles cases where the query\n   * might not exist or be empty.\n   *\n   * @param queryName - The name of the query (as defined in static Queries)\n   * @param callback - Function to call for each entity\n   *\n   * @example\n   * this.forEachEntity('movable', (entity) => {\n   *   entity.position.x += 1;\n   * });\n   */\n  protected forEachEntity(\n    queryName: string,\n    callback: (entity: Entity) => void\n  ): void {\n    const query = this.queries[queryName];\n    if (query) {\n      query.forEach(callback);\n    }\n  }\n\n  /**\n   * Gets all entities matching a named query.\n   *\n   * @param queryName - The name of the query (as defined in static Queries)\n   * @returns Array of entities, or empty array if query doesn't exist\n   *\n   * @example\n   * const enemies = this.getEntities('enemies');\n   * console.log(`${enemies.length} enemies in scene`);\n   */\n  protected getEntities(queryName: string): Entity[] {\n    const query = this.queries[queryName];\n    return query?.entities ?? [];\n  }\n\n  /**\n   * Gets the first entity matching a named query.\n   *\n   * Useful for singleton entities like player or camera.\n   *\n   * @param queryName - The name of the query (as defined in static Queries)\n   * @returns The first entity or undefined if query is empty\n   *\n   * @example\n   * const player = this.getFirstEntity('players');\n   * if (player) {\n   *   // Update player\n   * }\n   */\n  protected getFirstEntity(queryName: string): Entity | undefined {\n    const query = this.queries[queryName];\n    return query?.first;\n  }\n\n  /**\n   * Gets the count of entities matching a named query.\n   *\n   * @param queryName - The name of the query (as defined in static Queries)\n   * @returns Number of entities matching the query\n   *\n   * @example\n   * const enemyCount = this.getEntityCount('enemies');\n   * if (enemyCount === 0) {\n   *   this.spawnWave();\n   * }\n   */\n  protected getEntityCount(queryName: string): number {\n    const query = this.queries[queryName];\n    return query?.entities.length ?? 0;\n  }\n\n  /**\n   * Gets typed component access for an entity.\n   *\n   * ODIE's Entity.c is loosely typed (Map<string, unknown>). This helper\n   * provides a cleaner way to access components with proper typing,\n   * reducing the need for `as unknown as` casts throughout systems.\n   *\n   * @template T - The component access interface (e.g., ScrewComponentAccess)\n   * @param entity - The entity to get components from\n   * @param _typeHint - Optional type hint parameter (unused, for type inference)\n   * @returns The entity's component map cast to the specified type\n   *\n   * @example\n   * import type { ScrewComponentAccess } from '../types/component-access';\n   *\n   * const screw = this.getComponents<ScrewComponentAccess>(entity).screw;\n   */\n  protected getComponents<T>(entity: Entity, _typeHint?: T): T {\n    return entity.c as unknown as T;\n  }\n\n  /**\n   * Called each frame to update the system.\n   * Override this method to implement your game logic.\n   *\n   * @param time - Time information including deltaTime and elapsed time\n   */\n  abstract update(time: Time): void;\n}\n","/**\n * Precise layout measurements for the colored tray frame.\n *\n * All values in pixels, measured from Figma design (node 34:141).\n * The frame contains 5 slot positions for trays/covers.\n *\n * Visual structure:\n * ```\n * |<-------------- 1015px frame width ------------->|\n * +------------------------------------------------+\n * | [slot0] [slot1] [slot2] [slot3] [slot4]        |\n * +------------------------------------------------+\n * ```\n *\n * Behind the frame is a dark gray background (990x190) that shows\n * through the slot openings.\n */\nexport const TRAY_FRAME_LAYOUT = {\n  /** Frame asset dimensions (colored-tray-frame.png) */\n  frame: {\n    width: 1015,\n    height: 210,\n  },\n\n  /** Frame position in game world */\n  framePosition: {\n    x: 32,\n    y: 187,\n  },\n\n  /** Background layer (dark gray under slots) */\n  background: {\n    width: 990,\n    height: 190,\n    offsetX: 15, // Relative to frame top-left\n    offsetY: 10,\n    color: 0x535353,\n  },\n\n  /** Tray sprite dimensions */\n  traySprite: {\n    width: 185,\n    height: 150,\n  },\n\n  /** Cover sprite dimensions */\n  coverSprite: {\n    width: 180,\n    height: 145,\n  },\n\n  /** Screw placeholder dimensions */\n  placeholder: {\n    width: 40,\n    height: 50,\n  },\n\n  /**\n   * Slot positions relative to frame origin (0,0).\n   * These are the top-left corners of each tray/cover position.\n   *\n   * Measured from Figma \"most_common_case_2_slots_visible\" frame.\n   * Slot spacing is approximately 195px (tray width 185 + 10px gap).\n   */\n  slotOffsets: [\n    { x: 25, y: 16 }, // Slot 0 (leftmost)\n    { x: 220, y: 16 }, // Slot 1\n    { x: 419, y: 19 }, // Slot 2\n    { x: 614, y: 18 }, // Slot 3\n    { x: 808, y: 18 }, // Slot 4 (rightmost)\n  ],\n\n  /** Average slot spacing (center-to-center) */\n  slotSpacing: 195,\n} as const;\n\n/**\n * Calculate world position for a slot's top-left corner.\n * @param slotIndex - Index 0-4\n * @returns World position {x, y}\n * @example\n * const pos = getSlotWorldPosition(0); // { x: 57, y: 203 }\n */\nexport function getSlotWorldPosition(slotIndex: number): {\n  x: number;\n  y: number;\n} {\n  const offset = TRAY_FRAME_LAYOUT.slotOffsets[slotIndex];\n  if (!offset) {\n    throw new Error(`Invalid slot index: ${String(slotIndex)}`);\n  }\n  return {\n    x: TRAY_FRAME_LAYOUT.framePosition.x + offset.x,\n    y: TRAY_FRAME_LAYOUT.framePosition.y + offset.y,\n  };\n}\n\n/**\n * Calculate position for placing a tray sprite in a slot.\n * Tray position is the same as slot position (top-left alignment).\n *\n * @param slotIndex - Index 0-4\n * @returns World position for tray top-left corner\n * @example\n * const pos = getTrayPositionForBucket(1);\n */\nexport function getTrayPositionForBucket(slotIndex: number): {\n  x: number;\n  y: number;\n} {\n  return getSlotWorldPosition(slotIndex);\n}\n\n/**\n * Calculate position for a cover sprite in a slot.\n * Cover position is the same as slot position (top-left alignment).\n *\n * @param slotIndex - Index 0-4\n * @returns World position for cover top-left corner\n * @example\n * const pos = getCoverPositionForBucket(2);\n */\nexport function getCoverPositionForBucket(slotIndex: number): {\n  x: number;\n  y: number;\n} {\n  return getSlotWorldPosition(slotIndex);\n}\n\n// Legacy export for backwards compatibility\nexport const getBucketWorldPosition = getSlotWorldPosition;\n","/**\n * Precise layout measurements for the buffer tray.\n *\n * All values in pixels, measured from Figma design (node 36:648).\n * The buffer tray holds temporary screws before they go to colored trays.\n *\n * Visual structure:\n * ```\n * |<-------------- 780px frame width ------------->|\n * +------------------------------------------------+\n * | [slot0] [slot1] [slot2] [slot3] [slot4]        |\n * +------------------------------------------------+\n * ```\n *\n * This follows the same pattern as TRAY_FRAME_LAYOUT for consistency.\n */\nexport const BUFFER_TRAY_LAYOUT = {\n  /** Frame position and dimensions */\n  frame: {\n    x: 150,\n    y: 438,\n    width: 780,\n    height: 212,\n  },\n\n  /**\n   * Buffer slot positions (center-anchored for screws).\n   *\n   * Calculated from Figma top-left positions with screw center offset:\n   * - Screw display size: 56x70 at 0.5 scale (from 112x140 texture)\n   * - Center offset: +28, +35 from top-left\n   *\n   * Slot spacing is approximately 140-150px between centers.\n   */\n  slotPositions: [\n    { x: 257, y: 524 }, // slot 0: top-left(229, 489) + center offset(28, 35)\n    { x: 409, y: 524 }, // slot 1: top-left(381, 489) + center offset(28, 35)\n    { x: 540, y: 524 }, // slot 2: top-left(512, 489) + center offset(28, 35)\n    { x: 676, y: 524 }, // slot 3: top-left(648, 489) + center offset(28, 35)\n    { x: 821, y: 524 }, // slot 4: top-left(793, 489) + center offset(28, 35)\n  ],\n\n  /** Number of slots in the buffer tray */\n  capacity: 5,\n} as const;\n","import type { Entity2D } from '@play-co/odie';\nimport type { Position } from '@shared/types';\nimport { TRAY_FRAME_LAYOUT, getSlotWorldPosition } from './trayFrameLayout';\nimport { BUFFER_TRAY_LAYOUT } from './bufferTrayLayout';\n\n/**\n * Display positions for the 5 colored tray slots.\n * Calculated from TRAY_FRAME_LAYOUT slot positions.\n * displayOrder 0-1 are visible, 2-4 are hidden initially.\n */\nexport const TRAY_DISPLAY_POSITIONS: Position[] =\n  TRAY_FRAME_LAYOUT.slotOffsets.map((_, index) => getSlotWorldPosition(index));\n\n/**\n * Y position for hidden trays (below the visible tray frame).\n */\nexport const TRAY_HIDDEN_Y = 450;\n\n/**\n * X position for trays entering from under the rightmost cover.\n * This is the slot 4 position where the tray is hidden by a cover,\n * then slides left into its target slot.\n * Slot 4 X = frame.x(32) + slotOffsets[4].x(808) = 840\n */\nexport const TRAY_SPAWN_X =\n  TRAY_FRAME_LAYOUT.framePosition.x + TRAY_FRAME_LAYOUT.slotOffsets[4].x;\n\n/**\n * Tray sprite width for centering calculations.\n * Uses value from TRAY_FRAME_LAYOUT for consistency.\n */\nconst TRAY_WIDTH = TRAY_FRAME_LAYOUT.traySprite.width;\n\n/**\n * Slot display width (matches placeholder width).\n */\nconst SLOT_DISPLAY_WIDTH = TRAY_FRAME_LAYOUT.placeholder.width;\n\n/**\n * Spacing between slot centers in colored trays.\n */\nconst COLORED_TRAY_SLOT_SPACING = 40;\n\n/**\n * Y offset for slots within a colored tray.\n * Centered vertically in tray height.\n */\nconst COLORED_TRAY_Y_OFFSET = 75;\n\n/**\n * Calculate the world position for a screw slot in a tray.\n *\n * For colored trays, screws are centered horizontally based on capacity.\n * For buffer trays, screws go to predefined slot positions.\n *\n * @param trayEntity - The tray entity\n * @param slotIndex - The slot index (0-based)\n * @param isBuffer - Whether this is a buffer tray\n * @param trayCapacity - The tray's capacity (needed for centering calculation)\n * @returns The world position for the slot\n *\n * @example\n * const pos = getTraySlotPosition(redTray, 2, false, 3);\n * // Returns position for third slot in a 3-capacity red tray\n */\nexport function getTraySlotPosition(\n  trayEntity: Entity2D,\n  slotIndex: number,\n  isBuffer: boolean,\n  trayCapacity?: number\n): Position {\n  if (isBuffer) {\n    // Buffer tray uses predefined slot positions\n    const slot = BUFFER_TRAY_LAYOUT.slotPositions[slotIndex];\n    if (slot) {\n      return { x: slot.x, y: slot.y };\n    }\n    // Fallback for overflow (shouldn't happen with capacity 5)\n    const fallbackSlot = BUFFER_TRAY_LAYOUT.slotPositions[0];\n    return {\n      x: fallbackSlot.x + slotIndex * 80,\n      y: fallbackSlot.y,\n    };\n  }\n\n  // Colored tray: calculate centered position based on capacity\n  const capacity = trayCapacity ?? 3;\n  const totalWidth =\n    (capacity - 1) * COLORED_TRAY_SLOT_SPACING + SLOT_DISPLAY_WIDTH;\n  const startX = (TRAY_WIDTH - totalWidth) / 2 + SLOT_DISPLAY_WIDTH / 2;\n\n  return {\n    x: trayEntity.position.x + startX + slotIndex * COLORED_TRAY_SLOT_SPACING,\n    y: trayEntity.position.y + COLORED_TRAY_Y_OFFSET,\n  };\n}\n\n/**\n * Calculate the target (final) position for a screw slot in a colored tray.\n *\n * Unlike getTraySlotPosition which uses the tray's current position,\n * this function uses the tray's displayOrder to calculate where the tray\n * WILL be after animations complete. Use this when you need the final\n * position even if the tray is currently animating.\n *\n * @param displayOrder - The tray's display order (0-4)\n * @param slotIndex - The slot index within the tray (0-based)\n * @param trayCapacity - The tray's capacity (needed for centering calculation)\n * @returns The target world position for the slot\n *\n * @example\n * const pos = getTraySlotTargetPosition(0, 1, 3);\n * // Returns final position for slot 1 in a 3-capacity tray at displayOrder 0\n */\nexport function getTraySlotTargetPosition(\n  displayOrder: number,\n  slotIndex: number,\n  trayCapacity: number\n): Position {\n  // Get the fixed position for this display slot\n  const trayPosition = TRAY_DISPLAY_POSITIONS[displayOrder];\n  if (!trayPosition) {\n    throw new Error(`Invalid displayOrder: ${String(displayOrder)}`);\n  }\n\n  // Calculate centered slot position based on capacity\n  const totalWidth =\n    (trayCapacity - 1) * COLORED_TRAY_SLOT_SPACING + SLOT_DISPLAY_WIDTH;\n  const startX = (TRAY_WIDTH - totalWidth) / 2 + SLOT_DISPLAY_WIDTH / 2;\n\n  return {\n    x: trayPosition.x + startX + slotIndex * COLORED_TRAY_SLOT_SPACING,\n    y: trayPosition.y + COLORED_TRAY_Y_OFFSET,\n  };\n}\n\n/**\n * Get the next available buffer slot position.\n *\n * @param slotIndex - The slot index (0-based)\n * @returns The world position for the buffer slot\n * @example\n * const pos = getBufferSlotPosition(0); // { x: 219, y: 470 }\n */\nexport function getBufferSlotPosition(slotIndex: number): Position {\n  const slot = BUFFER_TRAY_LAYOUT.slotPositions[slotIndex];\n  if (slot) {\n    return { x: slot.x, y: slot.y };\n  }\n  // Fallback for out-of-range index\n  const fallbackSlot = BUFFER_TRAY_LAYOUT.slotPositions[0];\n  return {\n    x: fallbackSlot.x + slotIndex * 80,\n    y: fallbackSlot.y,\n  };\n}\n","/**\n * Simple event bus for game events.\n *\n * Provides a centralized pub/sub mechanism for game systems to communicate\n * without direct dependencies.\n *\n * @example\n * // Subscribe to an event\n * gameEvents.on('screw:startRemoval', (data) => {\n *   console.log('Screw removal started', data);\n * });\n *\n * // Emit an event\n * gameEvents.emit('screw:startRemoval', { screwEntity, targetTray });\n *\n * // Unsubscribe\n * gameEvents.off('screw:startRemoval', handler);\n */\n\ntype EventHandler<T = unknown> = (data: T) => void;\n\nclass GameEventBus {\n  private listeners = new Map<string, Set<EventHandler>>();\n\n  /**\n   * Subscribe to an event.\n   *\n   * @param event - Event name\n   * @param handler - Handler function\n   * @example\n   * gameEvents.on('screw:removed', (data) => console.log(data));\n   */\n  on<T = unknown>(event: string, handler: EventHandler<T>): void {\n    let handlers = this.listeners.get(event);\n    if (!handlers) {\n      handlers = new Set();\n      this.listeners.set(event, handlers);\n    }\n    handlers.add(handler as EventHandler);\n  }\n\n  /**\n   * Unsubscribe from an event.\n   *\n   * @param event - Event name\n   * @param handler - Handler function to remove\n   * @example\n   * gameEvents.off('screw:removed', myHandler);\n   */\n  off<T = unknown>(event: string, handler: EventHandler<T>): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      handlers.delete(handler as EventHandler);\n    }\n  }\n\n  /**\n   * Emit an event to all subscribers.\n   *\n   * @param event - Event name\n   * @param data - Event data\n   * @example\n   * gameEvents.emit('screw:removed', { screwId: '123' });\n   */\n  emit(event: string, data?: unknown): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      for (const handler of handlers) {\n        handler(data);\n      }\n    }\n  }\n\n  /**\n   * Remove all listeners for a specific event or all events.\n   *\n   * @param event - Optional event name. If omitted, clears all listeners.\n   * @example\n   * gameEvents.clear('screw:removed'); // Clear specific event\n   * gameEvents.clear(); // Clear all events\n   */\n  clear(event?: string): void {\n    if (event) {\n      this.listeners.delete(event);\n    } else {\n      this.listeners.clear();\n    }\n  }\n}\n\n/** Singleton instance for game events */\nexport const gameEvents = new GameEventBus();\n","/**\n * Registry for layer containers used by animation system.\n *\n * This module provides a way for GameScene to register its layer containers\n * so that AnimationSystem can access them without direct coupling.\n */\n\nimport type { Container } from 'pixi.js';\n\nlet animationLayer: Container | null = null;\nlet coloredTrayLayer: Container | null = null;\n\n/**\n * Register the animation layer container.\n * Called by GameScene during initialization.\n *\n * @param layer - The animation layer container\n * @example\n * registerAnimationLayer(container);\n */\nexport function registerAnimationLayer(layer: Container): void {\n  animationLayer = layer;\n}\n\n/**\n * Register the colored tray layer container.\n * Called by GameScene during initialization.\n *\n * @param layer - The colored tray layer container\n * @example\n * registerColoredTrayLayer(container);\n */\nexport function registerColoredTrayLayer(layer: Container): void {\n  coloredTrayLayer = layer;\n}\n\n/**\n * Get the animation layer container.\n * Used by AnimationSystem to move screws to top during animation.\n *\n * @returns The animation layer container or null if not registered\n * @example\n * const layer = getAnimationLayer();\n * if (layer) layer.addChild(sprite);\n */\nexport function getAnimationLayer(): Container | null {\n  return animationLayer;\n}\n\n/**\n * Get the colored tray layer container.\n * Used by AnimationSystem to move screws to correct layer after animation.\n *\n * @returns The colored tray layer container or null if not registered\n * @example\n * const layer = getColoredTrayLayer();\n * if (layer) layer.addChild(sprite);\n */\nexport function getColoredTrayLayer(): Container | null {\n  return coloredTrayLayer;\n}\n\n/**\n * Clear the layer registry.\n * Called when GameScene is destroyed.\n * @example\n * clearLayerRegistry();\n */\nexport function clearLayerRegistry(): void {\n  animationLayer = null;\n  coloredTrayLayer = null;\n}\n","/**\n * Layout coordinates from Figma design (1080x1920).\n * Updated from Figma node 28:14 using Layer image sizes.\n *\n * @module\n */\n\nimport {\n  TRAY_FRAME_LAYOUT,\n  getCoverPositionForBucket,\n} from './trayFrameLayout';\nimport { BUFFER_TRAY_LAYOUT } from './bufferTrayLayout';\n\n/**\n * Main game layout coordinates.\n */\nexport const GAME_LAYOUT = {\n  // Background\n  background: { x: 0, y: 0, width: 1080, height: 1920 },\n\n  // Puzzle base (metal frame)\n  puzzleBase: { x: 32, y: 676, width: 1015, height: 1090 },\n\n  // Restart button\n  restartButton: { x: 918, y: 21, width: 140, height: 140 },\n\n  // Colored tray area (from TRAY_FRAME_LAYOUT)\n  coloredTrayFrame: {\n    x: TRAY_FRAME_LAYOUT.framePosition.x,\n    y: TRAY_FRAME_LAYOUT.framePosition.y,\n    width: TRAY_FRAME_LAYOUT.frame.width,\n    height: TRAY_FRAME_LAYOUT.frame.height,\n  },\n\n  // Covers for hidden tray slots (displayOrder 2, 3, 4)\n  // Positions calculated from TRAY_FRAME_LAYOUT bucket positions\n  trayCovers: [\n    getCoverPositionForBucket(2), // covers bucket 2\n    getCoverPositionForBucket(3), // covers bucket 3\n    getCoverPositionForBucket(4), // covers bucket 4\n  ],\n\n  // Buffer tray (from BUFFER_TRAY_LAYOUT)\n  bufferTrayFrame: BUFFER_TRAY_LAYOUT.frame,\n  bufferSlots: BUFFER_TRAY_LAYOUT.slotPositions,\n} as const;\n","/**\n * Central tick counter for deterministic debug logging.\n *\n * Provides a frame-based tick counter that all systems can use for logging.\n * This enables deterministic reproduction of bugs from error logs by\n * replaying actions at specific tick numbers.\n *\n * @example\n * // In a system's update method\n * gameTick.update();\n *\n * // Log with tick number\n * gameTick.log('TAP', `(${x}, ${y})  ${color} screw`);\n * // Output: [T42] TAP: (100, 200)  red screw\n *\n * // Get current tick for E2E replay\n * const tick = gameTick.current;\n */\n\n/** Current tick number, incremented each frame */\nlet currentTick = 0;\n\n/** Whether debug logging is enabled */\nlet loggingEnabled = true;\n\n/**\n * Game tick counter singleton.\n *\n * The tick counter provides a consistent frame reference for all debug logs,\n * making it possible to deterministically reproduce bugs by replaying\n * input sequences at specific tick numbers.\n */\nexport const gameTick = {\n  /**\n   * Get the current tick number.\n   * @returns The current frame tick\n   */\n  get current(): number {\n    return currentTick;\n  },\n\n  /**\n   * Increment the tick counter. Call this once per frame in the main update loop.\n   * Should be called by a single system (typically a TickSystem or the scene).\n   * @example\n   * gameTick.update(); // Call in TickSystem.update()\n   */\n  update(): void {\n    currentTick++;\n  },\n\n  /**\n   * Reset the tick counter to zero.\n   * Useful for level restarts or E2E test setup.\n   * @example\n   * gameTick.reset(); // Called when loading a new level\n   */\n  reset(): void {\n    currentTick = 0;\n  },\n\n  /**\n   * Enable or disable logging output.\n   * @param enabled - Whether to enable logging\n   * @example\n   * gameTick.setLoggingEnabled(false); // Disable logging in production\n   */\n  setLoggingEnabled(enabled: boolean): void {\n    loggingEnabled = enabled;\n  },\n\n  /**\n   * Log a message with the current tick number prefix.\n   *\n   * Format: `[T{tick}] {category}: {message}`\n   *\n   * @param category - Log category (e.g., 'TAP', 'TRAY', 'TRANSFER')\n   * @param message - The log message\n   *\n   * @example\n   * gameTick.log('TAP', '(100, 200)  red screw  colored tray [slot 0]');\n   * // Output: [T42] TAP: (100, 200)  red screw  colored tray [slot 0]\n   */\n  log(category: string, message: string): void {\n    if (loggingEnabled) {\n      // eslint-disable-next-line no-console\n      console.log(`[T${String(currentTick)}] ${category}: ${message}`);\n    }\n  },\n\n  /**\n   * Log a debug message without category (simpler format).\n   *\n   * Format: `[T{tick}] {message}`\n   *\n   * @param message - The log message\n   *\n   * @example\n   * gameTick.debug('Animation complete');\n   * // Output: [T42] Animation complete\n   */\n  debug(message: string): void {\n    if (loggingEnabled) {\n      // eslint-disable-next-line no-console\n      console.log(`[T${String(currentTick)}] ${message}`);\n    }\n  },\n\n  /**\n   * Log a warning message with the current tick number prefix.\n   * Uses console.warn for higher visibility in developer tools.\n   *\n   * Format: `[T{tick}] {category}: {message}`\n   *\n   * @param category - Warning category (e.g., 'SNAP_CORRECTION')\n   * @param message - The warning message\n   *\n   * @example\n   * gameTick.warn('SNAP_CORRECTION', 'screw at (100, 200) snapped to (105, 200)');\n   * // Output: [T42] SNAP_CORRECTION: screw at (100, 200) snapped to (105, 200)\n   */\n  warn(category: string, message: string): void {\n    if (loggingEnabled) {\n      // eslint-disable-next-line no-console\n      console.warn(`[T${String(currentTick)}] ${category}: ${message}`);\n    }\n  },\n};\n","import type { Entity, Entity2D, Time } from '@play-co/odie';\nimport { BaseSystem } from './BaseSystem';\nimport { TrayComponent, ScrewComponent } from '../components';\nimport { gameEvents, gameTick } from '../utils';\nimport type {\n  ScrewRemovalCompleteEvent,\n  ScrewTransferCompleteEvent,\n} from './AnimationSystem';\nimport type { TrayComponentAccess } from '../types';\n\n/**\n * Event data emitted when a tray should start hiding.\n */\nexport interface TrayHideEvent {\n  /** The tray entity to hide */\n  trayEntity: Entity;\n}\n\n/**\n * Event data emitted when tray hide animation completes.\n */\nexport interface TrayHideCompleteEvent {\n  /** The tray entity that was hidden */\n  trayEntity: Entity;\n  /** Screws that were in the tray (for cleanup) */\n  screwsInTray: Entity[];\n}\n\n/**\n * Event data emitted when a tray should shift to a new position.\n */\nexport interface TrayShiftEvent {\n  /** The tray entity to shift */\n  trayEntity: Entity;\n  /** The new display order (position) */\n  newDisplayOrder: number;\n}\n\n/**\n * Event data emitted when a tray should reveal.\n */\nexport interface TrayRevealEvent {\n  /** The tray entity to reveal */\n  trayEntity: Entity;\n  /** The display order where it should appear */\n  displayOrder: number;\n}\n\n/**\n * Event data emitted when a tray has finished revealing.\n */\nexport interface TrayRevealedEvent {\n  /** The tray entity that was revealed */\n  trayEntity: Entity;\n}\n\n/**\n * System for managing tray visibility transitions.\n *\n * When a tray is filled to capacity, this system orchestrates:\n * 1. Hiding the full tray (slide down)\n * 2. Shifting remaining visible trays left\n * 3. Revealing the next hidden tray\n *\n * Uses a queue to handle rapid tray completions sequentially.\n *\n * Listens for:\n * - `screw:removalComplete` - Check if tray is now full\n *\n * Emits:\n * - `tray:startHide` - Trigger hide animation\n * - `tray:startShift` - Trigger shift animation\n * - `tray:startReveal` - Trigger reveal animation\n * - `tray:revealed` - Tray has finished revealing (triggers auto-transfer)\n */\nexport class TrayManagementSystem extends BaseSystem {\n  static readonly NAME = 'trayManagement';\n  static Queries = {\n    trays: { components: [TrayComponent] },\n    screws: { components: [ScrewComponent] },\n  };\n\n  /** Queue of full trays waiting to be processed */\n  private transitionQueue: Entity[] = [];\n\n  /** Whether a transition is currently in progress */\n  private isTransitioning = false;\n\n  /**\n   * Check if the system is currently processing or has pending transitions.\n   * Used by AutoTransferSystem to avoid starting transfers during tray animations.\n   * @returns True if transitions are in progress or queued\n   * @example\n   * if (trayManagementSystem.isBusy()) return;\n   */\n  public isBusy(): boolean {\n    return this.isTransitioning || this.transitionQueue.length > 0;\n  }\n\n  /**\n   * Initialize event listeners.\n   * @example\n   * system.init(); // Called automatically by ECS\n   */\n  init(): void {\n    gameEvents.on<ScrewRemovalCompleteEvent>(\n      'screw:removalComplete',\n      this.handleScrewRemovalComplete\n    );\n    // Also check tray fullness when buffer transfers complete\n    gameEvents.on<ScrewTransferCompleteEvent>(\n      'screw:transferComplete',\n      this.handleScrewTransferComplete\n    );\n\n    // Listen for animation completion events\n    gameEvents.on('tray:hideComplete', this.handleAnimationComplete);\n    gameEvents.on('tray:shiftComplete', this.handleAnimationComplete);\n    gameEvents.on('tray:revealComplete', this.handleRevealComplete);\n  }\n\n  /**\n   * Handle screw removal completion - check if tray is now full.\n   * @param event - The screw removal complete event\n   * @example\n   * // Called via event listener\n   */\n  private handleScrewRemovalComplete = (\n    event: ScrewRemovalCompleteEvent\n  ): void => {\n    const screw = event.screwEntity;\n    // Get the screw's tray entity ID\n    const screwComponent = this.getComponents<{\n      screw: { trayEntityId: string; state: string };\n    }>(screw).screw;\n\n    // Only check colored trays (not buffer)\n    if (screwComponent.state !== 'inTray') {\n      return;\n    }\n\n    // Find the tray this screw was placed in\n    const trayEntityId = screwComponent.trayEntityId;\n    const tray = this.findTrayByUID(trayEntityId);\n    if (!tray) return;\n\n    const trayComponent = this.getComponents<TrayComponentAccess>(tray).tray;\n\n    // Check if tray is now full AND no screws are still in-flight to this tray\n    // We must wait for all in-flight screws to land before hiding the tray,\n    // otherwise those screws won't be reparented and will remain visible\n    if (trayComponent.screwCount >= trayComponent.capacity) {\n      const inFlightToThisTray = this.countScrewsInFlightToTray(trayEntityId);\n      if (inFlightToThisTray > 0) {\n        gameTick.log(\n          'TRAY',\n          `${trayComponent.color} tray full but ${String(inFlightToThisTray)} screws still in-flight, waiting...`\n        );\n        return;\n      }\n      this.queueTransition(tray);\n    }\n  };\n\n  /**\n   * Handle screw transfer completion - check if target tray is now full.\n   * Buffer transfers also fill tray slots, so we need to check for hide.\n   * @param event - The screw transfer complete event\n   * @example\n   * // Called via event listener\n   */\n  private handleScrewTransferComplete = (\n    event: ScrewTransferCompleteEvent\n  ): void => {\n    // Reuse the same logic as removal complete\n    this.handleScrewRemovalComplete(event);\n  };\n\n  /**\n   * Count screws currently animating toward a specific tray.\n   * These are screws with state='dragging', isAnimating=true, and trayEntityId matching.\n   * @param trayUID - The tray entity UID\n   * @returns Number of screws in-flight to this tray\n   * @example\n   * const inFlight = this.countScrewsInFlightToTray('123');\n   */\n  private countScrewsInFlightToTray(trayUID: string): number {\n    const screws = this.getEntities('screws');\n    return screws.filter((entity) => {\n      const screw = this.getComponents<{\n        screw: { trayEntityId: string; state: string; isAnimating: boolean };\n      }>(entity).screw;\n      return (\n        screw.isAnimating &&\n        screw.state === 'dragging' &&\n        screw.trayEntityId === trayUID\n      );\n    }).length;\n  }\n\n  /**\n   * Find a tray entity by its UID.\n   * @param uid - The entity UID as a string\n   * @returns The tray entity, or undefined if not found\n   * @example\n   * const tray = this.findTrayByUID('123');\n   */\n  private findTrayByUID(uid: string): Entity | undefined {\n    const trays = this.getEntities('trays');\n    return trays.find((t) => String(t.UID) === uid);\n  }\n\n  /**\n   * Queue a tray transition for processing.\n   * @param tray - The tray entity to queue\n   * @example\n   * this.queueTransition(trayEntity);\n   */\n  private queueTransition(tray: Entity): void {\n    // Don't queue if already in queue\n    if (this.transitionQueue.includes(tray)) {\n      return;\n    }\n\n    this.transitionQueue.push(tray);\n    void this.processNextTransition();\n  }\n\n  /**\n   * Process the next tray transition in the queue.\n   * @example\n   * await this.processNextTransition();\n   */\n  private async processNextTransition(): Promise<void> {\n    if (this.isTransitioning || this.transitionQueue.length === 0) {\n      return;\n    }\n\n    this.isTransitioning = true;\n    const fullTray = this.transitionQueue.shift();\n    if (!fullTray) {\n      this.isTransitioning = false;\n      return;\n    }\n\n    const fullTrayComponent =\n      this.getComponents<TrayComponentAccess>(fullTray).tray;\n    fullTrayComponent.isAnimating = true;\n\n    const sortedTrays = this.getSortedTrays();\n    const nextHiddenTray = this.findNextHiddenTray(sortedTrays, fullTray);\n\n    // Hide the full tray\n    await this.hideTray(fullTray);\n\n    // Shift and reveal trays\n    const traysToShift = this.findTraysToShift(\n      sortedTrays,\n      fullTrayComponent.displayOrder,\n      fullTray\n    );\n    await this.shiftAndRevealTrays(traysToShift, nextHiddenTray);\n\n    // Finalize transition\n    this.finalizeTransition(fullTrayComponent, traysToShift, nextHiddenTray);\n    void this.processNextTransition();\n  }\n\n  /**\n   * Get all trays sorted by display order.\n   * @returns Array of tray entities sorted by display order\n   * @example\n   * const sorted = this.getSortedTrays();\n   */\n  private getSortedTrays(): Entity[] {\n    const allTrays = this.getEntities('trays');\n    return allTrays.sort((a, b) => {\n      const aOrder =\n        this.getComponents<TrayComponentAccess>(a).tray.displayOrder;\n      const bOrder =\n        this.getComponents<TrayComponentAccess>(b).tray.displayOrder;\n      return aOrder - bOrder;\n    });\n  }\n\n  /**\n   * Find the next hidden tray to reveal.\n   * @param sortedTrays - Trays sorted by display order\n   * @param fullTray - The tray that is being hidden\n   * @returns The next hidden tray, or undefined if none\n   * @example\n   * const next = this.findNextHiddenTray(sortedTrays, fullTray);\n   */\n  private findNextHiddenTray(\n    sortedTrays: Entity[],\n    fullTray: Entity\n  ): Entity | undefined {\n    return sortedTrays.find((t) => {\n      const comp = this.getComponents<TrayComponentAccess>(t).tray;\n      return comp.displayOrder >= 2 && t !== fullTray;\n    });\n  }\n\n  /**\n   * Hide a tray, wait for animation, then clean up entities.\n   * @param tray - The tray to hide\n   * @example\n   * await this.hideTray(trayEntity);\n   */\n  private async hideTray(tray: Entity): Promise<void> {\n    const trayComp = this.getComponents<TrayComponentAccess>(tray).tray;\n    gameTick.log('TRAY', `${trayComp.color} tray hidden (was full)`);\n\n    gameEvents.emit('tray:startHide', { trayEntity: tray } as TrayHideEvent);\n    const event =\n      await this.waitForEventWithData<TrayHideCompleteEvent>(\n        'tray:hideComplete'\n      );\n\n    // Clean up screw entities from scene\n    for (const screw of event.screwsInTray) {\n      this.scene.removeChild(screw as Entity2D);\n    }\n\n    // Clean up tray entity from scene\n    this.scene.removeChild(tray as Entity2D);\n  }\n\n  /**\n   * Find trays that need to shift left.\n   * @param sortedTrays - Trays sorted by display order\n   * @param currentDisplayOrder - Display order of the hiding tray\n   * @param fullTray - The tray that is being hidden\n   * @returns Array of trays that need to shift\n   * @example\n   * const toShift = this.findTraysToShift(sorted, 0, fullTray);\n   */\n  private findTraysToShift(\n    sortedTrays: Entity[],\n    currentDisplayOrder: number,\n    fullTray: Entity\n  ): Entity[] {\n    return sortedTrays.filter((t) => {\n      const comp = this.getComponents<TrayComponentAccess>(t).tray;\n      return (\n        comp.displayOrder > currentDisplayOrder &&\n        comp.displayOrder < 2 &&\n        t !== fullTray\n      );\n    });\n  }\n\n  /**\n   * Shift trays left and reveal next hidden tray.\n   * @param traysToShift - Trays to shift left\n   * @param nextHiddenTray - Next tray to reveal (if any)\n   * @example\n   * await this.shiftAndRevealTrays(toShift, nextTray);\n   */\n  private async shiftAndRevealTrays(\n    traysToShift: Entity[],\n    nextHiddenTray: Entity | undefined\n  ): Promise<void> {\n    const shiftPromises = this.emitShiftEvents(traysToShift);\n    const revealPromise = this.emitRevealEvent(nextHiddenTray);\n\n    const allPromises = revealPromise\n      ? [...shiftPromises, revealPromise]\n      : shiftPromises;\n    if (allPromises.length > 0) {\n      await Promise.all(allPromises);\n    }\n  }\n\n  /**\n   * Emit shift events for trays.\n   * @param traysToShift - Trays to shift\n   * @returns Array of promises that resolve when shifts complete\n   * @example\n   * const promises = this.emitShiftEvents(toShift);\n   */\n  private emitShiftEvents(traysToShift: Entity[]): Promise<void>[] {\n    const promises: Promise<void>[] = [];\n    for (const tray of traysToShift) {\n      const comp = this.getComponents<TrayComponentAccess>(tray).tray;\n      const newOrder = comp.displayOrder - 1;\n      comp.displayOrder = newOrder;\n      comp.isAnimating = true;\n\n      promises.push(this.waitForEvent('tray:shiftComplete'));\n      gameEvents.emit('tray:startShift', {\n        trayEntity: tray,\n        newDisplayOrder: newOrder,\n      } as TrayShiftEvent);\n    }\n    return promises;\n  }\n\n  /**\n   * Emit reveal event for the next hidden tray.\n   * @param nextHiddenTray - Tray to reveal (if any)\n   * @returns Promise that resolves when reveal completes, or null if no tray\n   * @example\n   * const promise = this.emitRevealEvent(nextTray);\n   */\n  private emitRevealEvent(\n    nextHiddenTray: Entity | undefined\n  ): Promise<void> | null {\n    if (!nextHiddenTray) return null;\n\n    const nextComp =\n      this.getComponents<TrayComponentAccess>(nextHiddenTray).tray;\n    const newDisplayOrder = 1;\n    nextComp.displayOrder = newDisplayOrder;\n    nextComp.isAnimating = true;\n\n    gameTick.log(\n      'TRAY',\n      `${nextComp.color} tray revealed at position ${String(newDisplayOrder)}`\n    );\n\n    const promise = this.waitForEvent('tray:revealComplete');\n    gameEvents.emit('tray:startReveal', {\n      trayEntity: nextHiddenTray,\n      displayOrder: newDisplayOrder,\n    } as TrayRevealEvent);\n\n    return promise;\n  }\n\n  /**\n   * Finalize the transition by resetting flags and emitting events.\n   * @param fullTrayComponent - Component of the hidden tray\n   * @param traysToShift - Trays that were shifted\n   * @param nextHiddenTray - Tray that was revealed (if any)\n   * @example\n   * this.finalizeTransition(comp, shifted, revealed);\n   */\n  // eslint-disable-next-line max-lines-per-function -- debug logging adds lines\n  private finalizeTransition(\n    fullTrayComponent: TrayComponentAccess['tray'],\n    traysToShift: Entity[],\n    nextHiddenTray: Entity | undefined\n  ): void {\n    gameTick.log(\n      'TRAY_FINALIZE',\n      `queueLen=${String(this.transitionQueue.length)} isTransitioning=${String(this.isTransitioning)}`\n    );\n\n    fullTrayComponent.displayOrder = 99;\n    fullTrayComponent.isAnimating = false;\n\n    for (const tray of traysToShift) {\n      const comp = this.getComponents<TrayComponentAccess>(tray).tray;\n      comp.isAnimating = false;\n    }\n\n    if (nextHiddenTray) {\n      const nextComp =\n        this.getComponents<TrayComponentAccess>(nextHiddenTray).tray;\n      nextComp.isAnimating = false;\n    }\n\n    // Mark transition complete BEFORE emitting tray:revealed\n    // This ensures AutoTransferSystem.checkAutoTransfer() doesn't skip the transfer\n    this.isTransitioning = false;\n\n    gameTick.log(\n      'TRAY_FINALIZE',\n      ' isTransitioning=false, emitting tray:revealed, then processNextTransition'\n    );\n\n    if (nextHiddenTray) {\n      gameEvents.emit('tray:revealed', {\n        trayEntity: nextHiddenTray,\n      } as TrayRevealedEvent);\n    }\n  }\n\n  /**\n   * Wait for a specific event to fire.\n   * @param eventName - The name of the event to wait for\n   * @example\n   * await this.waitForEvent('tray:hideComplete');\n   */\n  private waitForEvent(eventName: string): Promise<void> {\n    return new Promise((resolve) => {\n      const handler = (): void => {\n        gameEvents.off(eventName, handler);\n        resolve();\n      };\n      gameEvents.on(eventName, handler);\n    });\n  }\n\n  /**\n   * Wait for a specific event and return its data.\n   * @param eventName - The name of the event to wait for\n   * @returns Promise resolving to the event data\n   * @example\n   * const event = await this.waitForEventWithData<TrayHideCompleteEvent>('tray:hideComplete');\n   */\n  private waitForEventWithData<T>(eventName: string): Promise<T> {\n    return new Promise((resolve) => {\n      const handler = (data: T): void => {\n        gameEvents.off(eventName, handler);\n        resolve(data);\n      };\n      gameEvents.on(eventName, handler);\n    });\n  }\n\n  /**\n   * Handle animation completion events.\n   * @example\n   * // Called via event listener\n   */\n  private handleAnimationComplete = (): void => {\n    // Events are used for promise resolution in waitForEvent\n  };\n\n  /**\n   * Handle reveal completion event.\n   * @example\n   * // Called via event listener\n   */\n  private handleRevealComplete = (): void => {\n    // Events are used for promise resolution in waitForEvent\n  };\n\n  /**\n   * Update is a no-op for this system.\n   * @param _time - The game time (unused)\n   * @example\n   * system.update(time); // Called automatically by ECS\n   */\n  update(_time: Time): void {\n    // No per-frame updates needed - transitions are event-driven\n  }\n\n  /**\n   * Clean up when system is destroyed.\n   * @example\n   * system.destroy(); // Called automatically by ECS\n   */\n  destroy(): void {\n    gameEvents.off('screw:removalComplete', this.handleScrewRemovalComplete);\n    gameEvents.off('screw:transferComplete', this.handleScrewTransferComplete);\n    gameEvents.off('tray:hideComplete', this.handleAnimationComplete);\n    gameEvents.off('tray:shiftComplete', this.handleAnimationComplete);\n    gameEvents.off('tray:revealComplete', this.handleRevealComplete);\n    this.transitionQueue = [];\n    this.isTransitioning = false;\n  }\n}\n","import type { Entity, Time } from '@play-co/odie';\nimport { BaseSystem } from './BaseSystem';\nimport {\n  ScrewComponent,\n  TrayComponent,\n  BufferTrayComponent,\n} from '../components';\nimport type { ScrewColor } from '@shared/types';\nimport type {\n  ScrewComponentAccess,\n  TrayComponentAccess,\n  BufferTrayComponentAccess,\n} from '../types';\nimport { TrayManagementSystem } from './TrayManagementSystem';\nimport { gameTick } from '../utils';\n\n/**\n * Placement target information.\n */\nexport interface PlacementTarget {\n  /** Type of target tray */\n  type: 'colored' | 'buffer';\n  /** The tray entity */\n  tray: Entity;\n  /** Slot index in the tray (0-based) */\n  slotIndex: number;\n}\n\n/**\n * System for determining screw placement in trays.\n *\n * This system provides the logic for finding valid placement targets\n * for screws and managing tray occupancy. It does not handle animations\n * or user interaction - those are handled by other systems.\n *\n * Placement priority:\n * 1. Matching colored tray (if visible and has space)\n * 2. Buffer tray (if has space)\n * 3. No valid placement (soft lock)\n *\n * @example\n * // In another system\n * const placement = this.scene.getSystem(ScrewPlacementSystem);\n * const target = placement.findPlacementTarget(ScrewColor.Red);\n * if (target) {\n *   placement.reserveSlot(target, screwEntity);\n * }\n */\nexport class ScrewPlacementSystem extends BaseSystem {\n  static readonly NAME = 'screwPlacement';\n  static Queries = {\n    coloredTrays: { components: [TrayComponent] },\n    bufferTrays: { components: [BufferTrayComponent] },\n    screws: { components: [ScrewComponent] },\n  };\n\n  /**\n   * Find a valid placement target for a screw of the given color.\n   *\n   * Visible trays have displayOrder < 2 (positions 0 and 1).\n   * During tray animations, screws are forced to buffer to prevent misplacement.\n   *\n   * @param color - The screw color to find placement for\n   * @returns PlacementTarget if found, null if no valid placement\n   * @example\n   * const target = system.findPlacementTarget(ScrewColor.Red);\n   */\n  // eslint-disable-next-line max-lines-per-function -- debug logging adds lines\n  findPlacementTarget(color: ScrewColor): PlacementTarget | null {\n    const animating = this.anyTrayAnimating();\n    const busy = this.trayManagementBusy();\n\n    gameTick.log(\n      'PLACEMENT',\n      `${color} screw  animating=${String(animating)} busy=${String(busy)}`\n    );\n\n    // During tray animations OR transition queue processing, force buffer-only\n    // This prevents race conditions when transitions are queued but not yet started\n    if (!animating && !busy) {\n      const coloredTarget = this.findColoredTrayTarget(color);\n      if (coloredTarget) {\n        const tray = this.getComponents<TrayComponentAccess>(\n          coloredTarget.tray\n        ).tray;\n\n        // Check for position race condition: if target is at displayOrder 1 and\n        // displayOrder 0 is about to fill, the shift will move our target mid-flight.\n        // Redirect to buffer instead to avoid visual glitch.\n        if (tray.displayOrder === 1 && this.willDisplayOrder0Fill()) {\n          gameTick.log(\n            'PLACEMENT',\n            ` ${tray.color} tray at displayOrder 1 would race, redirecting to buffer`\n          );\n        } else {\n          gameTick.log(\n            'PLACEMENT',\n            ` ${tray.color} tray [slot ${String(coloredTarget.slotIndex)}]`\n          );\n          return coloredTarget;\n        }\n      }\n    }\n\n    const bufferTarget = this.findBufferTrayTarget();\n    if (bufferTarget) {\n      gameTick.log(\n        'PLACEMENT',\n        ` buffer [slot ${String(bufferTarget.slotIndex)}]`\n      );\n    } else {\n      gameTick.log('PLACEMENT', ' NO VALID TARGET');\n    }\n    return bufferTarget;\n  }\n\n  /**\n   * Check if TrayManagementSystem is processing or has pending transitions.\n   * @returns True if tray management is busy\n   * @example\n   * if (system.trayManagementBusy()) { ... }\n   */\n  trayManagementBusy(): boolean {\n    const trayManagement = this.scene.getSystem(TrayManagementSystem);\n    return trayManagement.isBusy();\n  }\n\n  /**\n   * Check if any colored tray is currently animating.\n   * When true, screws should go to buffer instead of colored trays.\n   * @returns True if any tray is animating\n   * @example\n   * if (system.anyTrayAnimating()) { ... }\n   */\n  anyTrayAnimating(): boolean {\n    const coloredTrays = this.getEntities('coloredTrays');\n    return coloredTrays.some((entity) => {\n      const tray = this.getComponents<TrayComponentAccess>(entity).tray;\n      return tray.isAnimating;\n    });\n  }\n\n  /**\n   * Check if buffer tray is full, including screws in-flight to buffer.\n   * Counts both screws already in buffer AND screws animating toward it.\n   * @returns True if buffer cannot accept more screws\n   * @example\n   * if (system.isBufferFull()) { ... }\n   */\n  isBufferFull(): boolean {\n    const bufferTray = this.getFirstEntity('bufferTrays');\n    if (!bufferTray) return true;\n\n    const buffer =\n      this.getComponents<BufferTrayComponentAccess>(bufferTray).bufferTray;\n    const inBuffer = buffer.screwIds.length;\n    const inFlight = this.countScrewsAnimatingToBuffer();\n\n    return inBuffer + inFlight >= buffer.capacity;\n  }\n\n  /**\n   * Count screws currently animating toward the buffer tray.\n   * @returns Number of screws in-flight to buffer\n   * @example\n   * const inFlight = this.countScrewsAnimatingToBuffer();\n   */\n  private countScrewsAnimatingToBuffer(): number {\n    const bufferTray = this.getFirstEntity('bufferTrays');\n    if (!bufferTray) return 0;\n\n    const bufferUid = String(bufferTray.UID);\n    const screws = this.getEntities('screws');\n\n    return screws.filter((entity) => {\n      const screw = this.getComponents<ScrewComponentAccess>(entity).screw;\n      return (\n        screw.isAnimating &&\n        screw.state === 'dragging' &&\n        screw.trayEntityId === bufferUid\n      );\n    }).length;\n  }\n\n  /**\n   * Find a matching colored tray with space.\n   * @param color - The screw color\n   * @returns Placement target or null if none found\n   * @example\n   * const target = this.findColoredTrayTarget(ScrewColor.Blue);\n   */\n  private findColoredTrayTarget(color: ScrewColor): PlacementTarget | null {\n    const coloredTrays = this.getEntities('coloredTrays');\n    const matchingTray = coloredTrays.find((entity) => {\n      const tray = this.getComponents<TrayComponentAccess>(entity).tray;\n      return (\n        tray.color === color &&\n        tray.displayOrder < 2 &&\n        !tray.isAnimating &&\n        tray.screwCount < tray.capacity\n      );\n    });\n\n    if (!matchingTray) return null;\n    const tray = this.getComponents<TrayComponentAccess>(matchingTray).tray;\n    return { type: 'colored', tray: matchingTray, slotIndex: tray.screwCount };\n  }\n\n  /**\n   * Find the buffer tray if it has space.\n   * @returns Placement target or null if buffer is full\n   * @example\n   * const target = this.findBufferTrayTarget();\n   */\n  private findBufferTrayTarget(): PlacementTarget | null {\n    const bufferTray = this.getFirstEntity('bufferTrays');\n    if (!bufferTray) return null;\n\n    const buffer =\n      this.getComponents<BufferTrayComponentAccess>(bufferTray).bufferTray;\n    if (buffer.screwIds.length >= buffer.capacity) return null;\n\n    return {\n      type: 'buffer',\n      tray: bufferTray,\n      slotIndex: buffer.screwIds.length,\n    };\n  }\n\n  /**\n   * Reserve a slot in the target tray for a screw.\n   *\n   * This should be called immediately when a screw starts its removal\n   * animation to prevent race conditions with multiple screws.\n   *\n   * @param target - The placement target from findPlacementTarget\n   * @param screwEntity - The screw entity being placed\n   * @example\n   * system.reserveSlot(target, screwEntity);\n   */\n  reserveSlot(target: PlacementTarget, screwEntity: Entity): void {\n    const screw = this.getComponents<ScrewComponentAccess>(screwEntity).screw;\n\n    if (target.type === 'colored') {\n      // Increment colored tray count\n      const tray = this.getComponents<TrayComponentAccess>(target.tray).tray;\n      tray.screwCount++;\n    } else {\n      // Add to buffer tray FIFO list\n      const buffer = this.getComponents<BufferTrayComponentAccess>(\n        target.tray\n      ).bufferTray;\n      buffer.screwIds.push(String(screwEntity.UID));\n    }\n\n    // Update screw component\n    screw.trayEntityId = String(target.tray.UID);\n    screw.slotIndex = target.slotIndex;\n  }\n\n  /**\n   * Find a colored tray with available space for the given color.\n   *\n   * Used by AutoTransferSystem to check if buffer screws can be moved.\n   * Only considers visible trays (displayOrder < 2) that are not animating.\n   *\n   * @param color - The screw color to find a tray for\n   * @returns The tray entity if found, null otherwise\n   * @example\n   * const tray = system.findAvailableColoredTray(ScrewColor.Green);\n   */\n  findAvailableColoredTray(color: ScrewColor): Entity | null {\n    const coloredTrays = this.getEntities('coloredTrays');\n    return (\n      coloredTrays.find((entity) => {\n        const tray = this.getComponents<TrayComponentAccess>(entity).tray;\n        return (\n          tray.color === color &&\n          tray.displayOrder < 2 && // Only visible trays\n          !tray.isAnimating &&\n          tray.screwCount < tray.capacity\n        );\n      }) ?? null\n    );\n  }\n\n  /**\n   * Find a screw entity by its UID.\n   *\n   * @param uid - The entity UID as a string\n   * @returns The screw entity if found, undefined otherwise\n   * @example\n   * const screw = system.findScrewByUid('123');\n   */\n  findScrewByUid(uid: string): Entity | undefined {\n    const screws = this.getEntities('screws');\n    return screws.find((entity) => String(entity.UID) === uid);\n  }\n\n  /**\n   * Check if any valid moves are available.\n   *\n   * Used by WinConditionSystem to detect soft lock state.\n   *\n   * @returns true if at least one screw in board can be placed\n   * @example\n   * const canMove = system.hasValidMoves();\n   */\n  hasValidMoves(): boolean {\n    const screws = this.getEntities('screws');\n\n    return screws.some((entity) => {\n      const screw = this.getComponents<ScrewComponentAccess>(entity).screw;\n      if (screw.state !== 'inBoard' || screw.isAnimating) {\n        return false;\n      }\n      return this.findPlacementTarget(screw.color) !== null;\n    });\n  }\n\n  /**\n   * Check if a tray at displayOrder 0 will fill soon, triggering a shift.\n   * Used to block placements to displayOrder 1 trays that would be affected by shift.\n   *\n   * @returns true if the tray at displayOrder 0 will fill with pending in-flight screws\n   * @example\n   * if (system.willDisplayOrder0Fill()) {\n   *   // Block placement to displayOrder 1 trays\n   * }\n   */\n  willDisplayOrder0Fill(): boolean {\n    const coloredTrays = this.getEntities('coloredTrays');\n    const screws = this.getEntities('screws');\n\n    for (const trayEntity of coloredTrays) {\n      const tray = this.getComponents<TrayComponentAccess>(trayEntity).tray;\n      // Only check the tray at displayOrder 0 (front position)\n      if (tray.displayOrder !== 0) continue;\n\n      const trayUid = String(trayEntity.UID);\n      const inFlightCount = screws.filter((entity) => {\n        const screw = this.getComponents<ScrewComponentAccess>(entity).screw;\n        return (\n          screw.isAnimating &&\n          screw.state === 'dragging' &&\n          screw.trayEntityId === trayUid\n        );\n      }).length;\n\n      if (tray.screwCount + inFlightCount >= tray.capacity) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Update is a no-op for this system.\n   * All logic is triggered by other systems calling methods directly.\n   * @param _time - Frame time info (unused)\n   * @example\n   * system.update(time); // Called automatically by ECS\n   */\n  update(_time: Time): void {\n    // No per-frame updates needed\n  }\n}\n","import type { Entity, Entity2D, Time } from '@play-co/odie';\nimport { TouchInput } from '@play-co/astro';\nimport { BaseSystem } from './BaseSystem';\nimport { ScrewComponent, GameStateComponent } from '../components';\nimport { ScrewPlacementSystem } from './ScrewPlacementSystem';\nimport { gameEvents, gameTick } from '../utils';\nimport type {\n  ScrewComponentAccess,\n  GameStateComponentAccess,\n  TrayComponentAccess,\n} from '../types';\n\n// Re-export component access types for use in other systems\nexport type { ScrewComponentAccess, GameStateComponentAccess };\n\n/**\n * Event data emitted when a screw removal starts.\n */\nexport interface ScrewRemovalEvent {\n  /** The screw entity being removed */\n  screwEntity: Entity;\n  /** The target tray entity */\n  targetTray: Entity;\n  /** Slot index in the target tray */\n  slotIndex: number;\n  /** Whether the target is a buffer tray */\n  isBuffer: boolean;\n}\n\n/**\n * System for handling screw tap interactions.\n *\n * This system attaches TouchInput handlers to screw entities and\n * initiates the removal sequence when a screw is tapped.\n *\n * Emits:\n * - `screw:startRemoval` - When a valid screw tap initiates removal\n *\n * @example\n * scene.addSystem(ScrewInteractionSystem);\n *\n * // Listen for removal events\n * scene.on('screw:startRemoval', (event: ScrewRemovalEvent) => {\n *   console.log('Removing screw to slot', event.slotIndex);\n * });\n */\nexport class ScrewInteractionSystem extends BaseSystem {\n  static readonly NAME = 'screwInteraction';\n  static Queries = {\n    screws: { components: [ScrewComponent] },\n    gameState: { components: [GameStateComponent] },\n  };\n\n  /** TouchInput instances for each screw entity */\n  private touchInputs = new Map<number, TouchInput>();\n\n  /** Flag to track if system has been initialized */\n  private initialized = false;\n\n  /**\n   * Initialize touch inputs for all existing screw entities.\n   * Called on first update to ensure entities are ready.\n   * @example\n   * this.initTouchInputs();\n   */\n  private initTouchInputs(): void {\n    if (this.initialized) return;\n    this.initialized = true;\n\n    this.forEachEntity('screws', (entity) => {\n      this.setupTouchInput(entity);\n    });\n  }\n\n  /**\n   * Set up touch input for a single screw entity.\n   * @param entity - The screw entity\n   * @example\n   * this.setupTouchInput(screwEntity);\n   */\n  private setupTouchInput(entity: Entity): void {\n    // Skip if already set up\n    if (this.touchInputs.has(entity.UID)) return;\n\n    const entity2d = entity as Entity2D;\n    const view = entity2d.view;\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition -- view may be null during entity creation\n    if (!view) return;\n\n    // Make interactive\n    view.eventMode = 'static';\n    view.cursor = 'pointer';\n\n    const input = new TouchInput(view);\n    input.onTap = (): Promise<void> => {\n      this.handleScrewTap(entity);\n      return Promise.resolve();\n    };\n\n    this.touchInputs.set(entity.UID, input);\n  }\n\n  /**\n   * Handle a tap on a screw entity.\n   * @param entity - The screw entity\n   * @example\n   * this.handleScrewTap(screwEntity);\n   */\n  private handleScrewTap(entity: Entity): void {\n    const screw = this.getComponents<ScrewComponentAccess>(entity).screw;\n    if (!this.canInteractWithScrew(screw)) return;\n\n    const placementSystem = this.scene.getSystem(ScrewPlacementSystem);\n    const target = placementSystem.findPlacementTarget(screw.color);\n    if (!target) return;\n\n    // Block interaction based on system state\n    if (this.isInteractionBlocked(placementSystem)) return;\n\n    this.logTapAction(entity, screw.color, target);\n\n    placementSystem.reserveSlot(target, entity);\n    screw.isAnimating = true;\n    screw.state = 'dragging';\n\n    gameEvents.emit('screw:startRemoval', {\n      screwEntity: entity,\n      targetTray: target.tray,\n      slotIndex: target.slotIndex,\n      isBuffer: target.type === 'buffer',\n    } as ScrewRemovalEvent);\n  }\n\n  /**\n   * Check if interaction is blocked.\n   *\n   * Blocking rule: Buffer full + trays animating/busy  block all (soft lock prevention)\n   *\n   * Note: Position race conditions (displayOrder 1 target + shift imminent) are handled\n   * by findPlacementTarget, which redirects to buffer instead of blocking.\n   *\n   * @param placementSystem - The placement system\n   * @returns True if interaction should be blocked\n   * @example\n   * if (this.isInteractionBlocked(placementSystem)) return;\n   */\n  private isInteractionBlocked(placementSystem: ScrewPlacementSystem): boolean {\n    const bufferFull = placementSystem.isBufferFull();\n    const traysAnimating = placementSystem.anyTrayAnimating();\n    const traysBusy = placementSystem.trayManagementBusy();\n\n    // Buffer full + trays in transition  block all\n    if (bufferFull && (traysAnimating || traysBusy)) {\n      gameTick.log(\n        'BLOCKED',\n        `bufferFull=${String(bufferFull)} animating=${String(traysAnimating)} busy=${String(traysBusy)}`\n      );\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Log tap action for debugging/test reproduction.\n   * @param entity - The screw entity\n   * @param color - The screw color\n   * @param target - The placement target\n   * @param target.type - The target type (colored or buffer)\n   * @param target.tray - The target tray entity\n   * @param target.slotIndex - The slot index in the tray\n   * @example\n   * this.logTapAction(entity, screw.color, target);\n   */\n  private logTapAction(\n    entity: Entity,\n    color: string,\n    target: { type: string; tray: Entity; slotIndex: number }\n  ): void {\n    const entity2d = entity as Entity2D;\n    const x = Math.round(entity2d.position.x);\n    const y = Math.round(entity2d.position.y);\n    const trayColor =\n      target.type === 'colored'\n        ? this.getComponents<TrayComponentAccess>(target.tray).tray.color\n        : 'buffer';\n    gameTick.log(\n      'TAP',\n      `(${String(x)}, ${String(y)})  ${color} screw  ${trayColor} tray [slot ${String(target.slotIndex)}]`\n    );\n  }\n\n  /**\n   * Check if a screw can be interacted with.\n   * @param screw - The screw component data\n   * @returns True if screw can be interacted with\n   * @example\n   * const canInteract = this.canInteractWithScrew(screw);\n   */\n  private canInteractWithScrew(screw: ScrewComponentAccess['screw']): boolean {\n    if (screw.state !== 'inBoard' || screw.isAnimating) return false;\n\n    const gameStateEntity = this.getFirstEntity('gameState');\n    if (gameStateEntity) {\n      const gameState =\n        this.getComponents<GameStateComponentAccess>(gameStateEntity).gameState;\n      if (gameState.phase !== 'playing') return false;\n    }\n    return true;\n  }\n\n  /**\n   * Clean up touch input for a screw entity.\n   * @param entity - The screw entity\n   * @example\n   * this.cleanupTouchInput(screwEntity);\n   */\n  private cleanupTouchInput(entity: Entity): void {\n    const input = this.touchInputs.get(entity.UID);\n    if (input) {\n      input.enabled = false;\n      this.touchInputs.delete(entity.UID);\n    }\n  }\n\n  /**\n   * Update checks for new screws and initializes them.\n   * @param _time - Frame time info (unused)\n   * @example\n   * system.update(time); // Called automatically by ECS\n   */\n  update(_time: Time): void {\n    // Initialize on first update\n    if (!this.initialized) {\n      this.initTouchInputs();\n      return;\n    }\n\n    // Check for any new screws that need touch input setup\n    this.forEachEntity('screws', (entity) => {\n      if (!this.touchInputs.has(entity.UID)) {\n        this.setupTouchInput(entity);\n      }\n    });\n  }\n\n  /**\n   * Clean up all touch inputs when system is destroyed.\n   * @example\n   * system.destroy(); // Called automatically by ECS\n   */\n  destroy(): void {\n    for (const [uid] of this.touchInputs) {\n      const entity = this.getEntities('screws').find((e) => e.UID === uid);\n      if (entity) {\n        this.cleanupTouchInput(entity);\n      }\n    }\n    this.touchInputs.clear();\n    this.initialized = false;\n  }\n}\n","import type { Entity, Entity2D } from '@play-co/odie';\nimport type { Container, Sprite } from 'pixi.js';\nimport { ScrewColor } from '@shared/types';\n\n/**\n * Event data emitted when a screw removal animation completes.\n */\nexport interface ScrewRemovalCompleteEvent {\n  /** The screw entity that was removed */\n  screwEntity: Entity;\n}\n\n/**\n * Event data emitted when a screw transfer animation completes.\n */\nexport interface ScrewTransferCompleteEvent {\n  /** The screw entity that was transferred */\n  screwEntity: Entity;\n}\n\n/**\n * Event data for screw transfer animation (buffer to colored tray).\n */\nexport interface ScrewTransferEvent {\n  /** The screw entity being transferred */\n  screwEntity: Entity;\n  /** The target colored tray entity */\n  targetTray: Entity;\n  /** Slot index in the target tray */\n  slotIndex: number;\n}\n\n/**\n * Animation parameters for bezier curve flight.\n */\nexport interface FlightParams {\n  startX: number;\n  startY: number;\n  controlX: number;\n  controlY: number;\n  endX: number;\n  endY: number;\n  startScale: number;\n  endScale: number;\n}\n\n/**\n * Maps screw color to long screw asset alias.\n */\nexport const LONG_SCREW_ASSET_MAP: Record<ScrewColor, string> = {\n  [ScrewColor.Red]: 'screw-red',\n  [ScrewColor.Yellow]: 'screw-yellow',\n  [ScrewColor.Green]: 'screw-green',\n  [ScrewColor.Blue]: 'screw-blue',\n};\n\n/**\n * Scale factor for screws in colored tray slots.\n * Long screw is 80x100, tray slot is 50x50, so ~0.5 scale fits well.\n */\nexport const TRAY_SLOT_SCALE = 0.5;\n\n/**\n * Scale factor for screws in buffer tray.\n * Long screw is 80x100, Figma shows 56x70, so 0.7 scale.\n */\nexport const BUFFER_SLOT_SCALE = 0.7;\n\n/** Pop-out animation height in pixels. */\nexport const POP_OUT_HEIGHT = 20;\n\n/** Scale during pop-out phase. */\nexport const POP_OUT_SCALE = 0.8;\n\n/** Arc height offset for bezier control point. */\nexport const REMOVAL_ARC_HEIGHT = 130;\n\n/** Arc height offset for transfer bezier control point. */\nexport const TRANSFER_ARC_HEIGHT = 80;\n\n/**\n * Component access type for screw entities.\n */\nexport interface ScrewComponentData {\n  color: ScrewColor;\n  state: string;\n  trayEntityId?: string;\n  slotIndex?: number;\n  isAnimating: boolean;\n}\n\n/**\n * Component access type for tray entities.\n */\nexport interface TrayComponentData {\n  color: ScrewColor;\n  capacity: number;\n  displayOrder: number;\n  isAnimating: boolean;\n}\n\n/**\n * Context provided to animator classes for accessing system resources.\n */\nexport interface AnimatorContext {\n  /** Set of active GSAP timelines for cleanup tracking */\n  activeTimelines: Set<GSAPTimeline>;\n  /** Get screws currently in a specific tray by UID */\n  getScrewsInTray: (trayUID: string) => Entity[];\n  /** Get typed component access for an entity */\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-parameters\n  getComponents: <T>(entity: Entity) => T;\n  /** Get animation layer container */\n  getAnimationLayer: () => Container | null;\n  /** Get colored tray layer container */\n  getColoredTrayLayer: () => Container | null;\n  /** Get visual sprite for an entity */\n  getGameVisual: (entity: Entity2D) => Sprite | null;\n  /** Get tray slot placeholders */\n  getTrayPlaceholders: (entity: Entity2D) => Sprite[] | null;\n  /** Get target position based on tray's displayOrder */\n  getTraySlotTargetPosition: (\n    displayOrder: number,\n    slotIndex: number,\n    capacity: number\n  ) => { x: number; y: number };\n  /** Get slot position from tray entity position */\n  getTraySlotPosition: (\n    trayEntity: Entity2D,\n    slotIndex: number,\n    isBuffer: boolean,\n    capacity?: number\n  ) => { x: number; y: number };\n}\n","import type { FlightParams } from './types';\nimport { POP_OUT_HEIGHT, POP_OUT_SCALE } from './types';\n\n/**\n * Calculate quadratic bezier position at parameter t.\n * @param t - Parameter from 0 to 1\n * @param p0 - Start point\n * @param p1 - Control point\n * @param p2 - End point\n * @returns Position at parameter t\n * @example\n * const x = bezierPosition(0.5, 0, 100, 200); // Returns 100\n */\nexport function bezierPosition(\n  t: number,\n  p0: number,\n  p1: number,\n  p2: number\n): number {\n  const invT = 1 - t;\n  return invT * invT * p0 + 2 * invT * t * p1 + t * t * p2;\n}\n\n/**\n * Create flight parameters for bezier animation.\n * @param start - Start position with x and y coordinates\n * @param start.x - Start X coordinate\n * @param start.y - Start Y coordinate\n * @param end - End position with x and y coordinates\n * @param end.x - End X coordinate\n * @param end.y - End Y coordinate\n * @param endScale - Target scale\n * @param arcHeight - Arc height offset\n * @returns Flight parameters\n * @example\n * const params = createFlightParams({ x: 0, y: 0 }, { x: 100, y: 100 }, 0.5, 130);\n */\nexport function createFlightParams(\n  start: { x: number; y: number },\n  end: { x: number; y: number },\n  endScale: number,\n  arcHeight: number\n): FlightParams {\n  const flightStartY = start.y - POP_OUT_HEIGHT;\n  return {\n    startX: start.x,\n    startY: flightStartY,\n    controlX: (start.x + end.x) / 2,\n    controlY: Math.min(flightStartY, end.y) - arcHeight,\n    endX: end.x,\n    endY: end.y,\n    startScale: POP_OUT_SCALE,\n    endScale,\n  };\n}\n","/**\n * Base class for animator modules.\n *\n * Provides shared animation utilities like timeline setup, flight animation,\n * and settle effects used by screw and tray animators.\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-example */\n\nimport type { Entity2D } from '@play-co/odie';\nimport type { Sprite } from 'pixi.js';\nimport gsap from 'gsap';\nimport type { AnimatorContext, FlightParams } from './types';\nimport { bezierPosition } from './bezier';\n\n/**\n * Abstract base class providing shared animation functionality.\n *\n * Animators extend this class to inherit common utilities for:\n * - GSAP timeline setup and tracking\n * - Bezier flight animations\n * - Settle/bounce effects\n * - Placeholder visibility\n *\n * @example\n * class MyAnimator extends AnimatorBase {\n *   constructor(ctx: AnimatorContext) {\n *     super(ctx);\n *   }\n *\n *   async animate(entity: Entity2D): Promise<void> {\n *     const timeline = this.setupAnimationTimeline(entity);\n *     // ... use timeline\n *   }\n * }\n */\nexport abstract class AnimatorBase {\n  protected ctx: AnimatorContext;\n\n  constructor(ctx: AnimatorContext) {\n    this.ctx = ctx;\n  }\n\n  /**\n   * Setup animation timeline and move entity to animation layer.\n   * @param entity - The entity to animate\n   * @returns GSAP timeline tracked in activeTimelines\n   * @example\n   */\n  protected setupAnimationTimeline(entity: Entity2D): gsap.core.Timeline {\n    const timeline = gsap.timeline();\n    this.ctx.activeTimelines.add(timeline);\n\n    const animationLayer = this.ctx.getAnimationLayer();\n    if (animationLayer) {\n      animationLayer.addChild(entity.view);\n    }\n\n    return timeline;\n  }\n\n  /**\n   * Remove timeline from tracking after animation completes.\n   * @param timeline - The timeline to cleanup\n   * @example\n   */\n  protected cleanupTimeline(timeline: gsap.core.Timeline): void {\n    this.ctx.activeTimelines.delete(timeline);\n  }\n\n  /**\n   * Animate flight along bezier curve with scale interpolation.\n   * @param timeline - GSAP timeline\n   * @param entity - The entity to animate\n   * @param sprite - The sprite visual\n   * @param params - Flight parameters\n   * @param duration - Animation duration in seconds\n   * @example\n   */\n  protected async animateFlight(\n    timeline: gsap.core.Timeline,\n    entity: Entity2D,\n    sprite: Sprite,\n    params: FlightParams,\n    duration: number\n  ): Promise<void> {\n    const progress = { t: 0 };\n    const updatePosition = (): void => {\n      this.updateFlightPosition(progress.t, entity, sprite, params);\n    };\n    await timeline.to(progress, {\n      t: 1,\n      duration,\n      ease: 'power2.inOut',\n      onUpdate: updatePosition,\n    });\n  }\n\n  /**\n   * Update entity position and scale during flight animation.\n   * @param t - Animation progress (0-1)\n   * @param entity - The entity to move\n   * @param sprite - The sprite to scale\n   * @param params - Flight parameters\n   * @example\n   */\n  protected updateFlightPosition(\n    t: number,\n    entity: Entity2D,\n    sprite: Sprite,\n    params: FlightParams\n  ): void {\n    entity.position.x = bezierPosition(\n      t,\n      params.startX,\n      params.controlX,\n      params.endX\n    );\n    entity.position.y = bezierPosition(\n      t,\n      params.startY,\n      params.controlY,\n      params.endY\n    );\n    sprite.scale.set(\n      params.startScale + (params.endScale - params.startScale) * t\n    );\n  }\n\n  /**\n   * Animate settle bounce at end of flight.\n   * @param timeline - GSAP timeline\n   * @param sprite - The sprite visual\n   * @param scale - Target scale\n   * @example\n   */\n  protected async animateSettle(\n    timeline: gsap.core.Timeline,\n    sprite: Sprite,\n    scale: number\n  ): Promise<void> {\n    await timeline.to(sprite.scale, {\n      x: scale,\n      y: scale,\n      duration: 0.1,\n      ease: 'bounce.out',\n    });\n  }\n\n  /**\n   * Hide a placeholder sprite when a screw fills that slot.\n   * @param trayEntity - The tray entity\n   * @param slotIndex - The slot index that was filled\n   * @example\n   */\n  protected hidePlaceholder(trayEntity: Entity2D, slotIndex: number): void {\n    const placeholders = this.ctx.getTrayPlaceholders(trayEntity);\n    const placeholder = placeholders?.[slotIndex];\n    if (placeholder) {\n      gsap.to(placeholder, { alpha: 0, duration: 0.15, ease: 'linear' });\n    }\n  }\n}\n","/**\n * Screw removal animation handler.\n *\n * Handles the screw:startRemoval event to animate screws being removed\n * from parts and flying to their target tray (buffer or colored).\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-returns, jsdoc/require-param, jsdoc/require-example */\n\nimport type { Entity, Entity2D } from '@play-co/odie';\nimport { Assets, type Sprite, type Texture } from 'pixi.js';\nimport { AnimatorBase } from './AnimatorBase';\nimport type { FlightParams } from './types';\nimport {\n  LONG_SCREW_ASSET_MAP,\n  TRAY_SLOT_SCALE,\n  BUFFER_SLOT_SCALE,\n  POP_OUT_SCALE,\n  POP_OUT_HEIGHT,\n  REMOVAL_ARC_HEIGHT,\n} from './types';\nimport { gameEvents, gameTick } from '../../utils';\nimport type { ScrewRemovalEvent } from '../ScrewInteractionSystem';\nimport type { ScrewColor } from '@shared/types';\n\n/** Component access type for screw entities */\ninterface ScrewComponentAccess {\n  screw: {\n    color: ScrewColor;\n    state: string;\n    trayEntityId?: string;\n    slotIndex?: number;\n    isAnimating: boolean;\n  };\n}\n\n/** Component access type for tray entities */\ninterface TrayComponentAccess {\n  tray: {\n    displayOrder: number;\n    capacity: number;\n    color: string;\n    isAnimating: boolean;\n  };\n}\n\n/**\n * Animator for screw removal (unscrew and fly to tray).\n *\n * Animation sequence:\n * 1. Swap texture from short screw to long screw\n * 2. Arc flight along bezier curve to target tray slot\n * 3. Settle bounce effect at landing\n *\n * Can target either buffer tray (when no matching colored tray is visible)\n * or colored tray (when a matching tray has space).\n *\n * Emits `screw:removalComplete` when animation finishes.\n *\n * @example\n * const animator = new ScrewRemovalAnimator(ctx);\n * await animator.handle(event);\n */\nexport class ScrewRemovalAnimator extends AnimatorBase {\n  /**\n   * Handle screw removal animation.\n   * @param event - The removal event data\n   */\n  async handle(event: ScrewRemovalEvent): Promise<void> {\n    const { screwEntity, targetTray, slotIndex, isBuffer } = event;\n    const screwEntity2D = screwEntity as Entity2D;\n    const visual = this.ctx.getGameVisual(screwEntity2D);\n\n    // Disable pointer events during animation\n    screwEntity2D.view.eventMode = 'none';\n\n    if (!visual) {\n      this.complete(screwEntity, isBuffer, targetTray, slotIndex);\n      return;\n    }\n\n    await this.animateRemoval(screwEntity2D, visual, event);\n    this.complete(screwEntity, isBuffer, targetTray, slotIndex);\n  }\n\n  /** Perform the removal animation sequence. */\n  private async animateRemoval(\n    entity: Entity2D,\n    sprite: Sprite,\n    event: ScrewRemovalEvent\n  ): Promise<void> {\n    const timeline = this.setupAnimationTimeline(entity);\n\n    try {\n      await this.executeAnimation(entity, sprite, event, timeline);\n    } finally {\n      this.cleanupTimeline(timeline);\n    }\n  }\n\n  /** Execute the removal animation phases. */\n  private async executeAnimation(\n    entity: Entity2D,\n    sprite: Sprite,\n    event: ScrewRemovalEvent,\n    timeline: gsap.core.Timeline\n  ): Promise<void> {\n    const { targetTray, slotIndex, isBuffer } = event;\n    const screw = this.ctx.getComponents<ScrewComponentAccess>(entity).screw;\n    await this.swapToLongScrew(sprite, screw.color);\n\n    const startPos = { x: entity.position.x, y: entity.position.y };\n    // For colored trays, use displayOrder-based target to handle tray shifts during flight\n    // For buffer trays, use current tray position (buffer doesn't shift)\n    const targetPos = isBuffer\n      ? this.getSlotTargetPosition(targetTray, slotIndex, isBuffer)\n      : this.getColoredTrayTargetPosition(targetTray, slotIndex);\n\n    const endScale = isBuffer ? BUFFER_SLOT_SCALE : TRAY_SLOT_SCALE;\n    const params = this.createFlightParams(\n      startPos,\n      targetPos,\n      endScale,\n      REMOVAL_ARC_HEIGHT\n    );\n\n    await this.animateFlight(timeline, entity, sprite, params, 0.45);\n    await this.animateSettle(timeline, sprite, endScale);\n  }\n\n  /** Swap screw texture to long screw variant. */\n  private async swapToLongScrew(\n    sprite: Sprite,\n    color: ScrewColor\n  ): Promise<void> {\n    sprite.scale.set(POP_OUT_SCALE);\n    const longTexture = await Assets.load<Texture>(LONG_SCREW_ASSET_MAP[color]);\n    sprite.texture = longTexture;\n  }\n\n  /** Create flight parameters for bezier animation. */\n  private createFlightParams(\n    start: { x: number; y: number },\n    end: { x: number; y: number },\n    endScale: number,\n    arcHeight: number\n  ): FlightParams {\n    const flightStartY = start.y - POP_OUT_HEIGHT;\n    return {\n      startX: start.x,\n      startY: flightStartY,\n      controlX: (start.x + end.x) / 2,\n      controlY: Math.min(flightStartY, end.y) - arcHeight,\n      endX: end.x,\n      endY: end.y,\n      startScale: POP_OUT_SCALE,\n      endScale,\n    };\n  }\n\n  /** Get target position for colored tray using displayOrder. */\n  private getColoredTrayTargetPosition(\n    targetTray: Entity,\n    slotIndex: number\n  ): { x: number; y: number } {\n    const tray = this.ctx.getComponents<TrayComponentAccess>(targetTray).tray;\n    return this.ctx.getTraySlotTargetPosition(\n      tray.displayOrder,\n      slotIndex,\n      tray.capacity\n    );\n  }\n\n  /** Get the target position for a slot in a tray. */\n  private getSlotTargetPosition(\n    targetTray: Entity,\n    slotIndex: number,\n    isBuffer: boolean\n  ): { x: number; y: number } {\n    const trayCapacity = isBuffer\n      ? undefined\n      : this.ctx.getComponents<TrayComponentAccess>(targetTray).tray.capacity;\n    return this.ctx.getTraySlotPosition(\n      targetTray as Entity2D,\n      slotIndex,\n      isBuffer,\n      trayCapacity\n    );\n  }\n\n  /** Complete the removal and emit event. */\n  private complete(\n    screwEntity: Entity,\n    isBuffer: boolean,\n    targetTray?: Entity,\n    slotIndex?: number\n  ): void {\n    const screw =\n      this.ctx.getComponents<ScrewComponentAccess>(screwEntity).screw;\n    screw.state = isBuffer ? 'inBuffer' : 'inTray';\n    screw.isAnimating = false;\n\n    const screwEntity2D = screwEntity as Entity2D;\n    if (!isBuffer) {\n      // Colored tray: move to layer and snap to final position\n      const coloredTrayLayer = this.ctx.getColoredTrayLayer();\n      if (coloredTrayLayer) {\n        coloredTrayLayer.addChild(screwEntity2D.view);\n      }\n      if (targetTray && slotIndex !== undefined) {\n        this.checkScrewPosition(screwEntity2D, targetTray, slotIndex);\n        this.hidePlaceholder(targetTray as Entity2D, slotIndex);\n      }\n    }\n    // Buffer tray: leave in animation layer (above uiLayer)\n\n    gameEvents.emit('screw:removalComplete', { screwEntity });\n  }\n\n  /** Check if screw position matches expected slot position. */\n  private checkScrewPosition(\n    screwEntity: Entity2D,\n    targetTray: Entity,\n    slotIndex: number\n  ): void {\n    const screw =\n      this.ctx.getComponents<ScrewComponentAccess>(screwEntity).screw;\n    const tray = this.ctx.getComponents<TrayComponentAccess>(targetTray).tray;\n    const expected = this.ctx.getTraySlotTargetPosition(\n      tray.displayOrder,\n      slotIndex,\n      tray.capacity\n    );\n    const dX = Math.abs(screwEntity.position.x - expected.x);\n    const dY = Math.abs(screwEntity.position.y - expected.y);\n\n    if (dX > 0.5 || dY > 0.5) {\n      gameTick.warn(\n        'POSITION_MISMATCH',\n        `${screw.color} screw at (${screwEntity.position.x.toFixed(1)}, ${screwEntity.position.y.toFixed(1)}) ` +\n          `expected (${String(expected.x)}, ${String(expected.y)}) ` +\n          `delta=(${dX.toFixed(1)}, ${dY.toFixed(1)}) ` +\n          `tray.displayOrder=${String(tray.displayOrder)} tray.isAnimating=${String(tray.isAnimating)}`\n      );\n    }\n  }\n}\n","/**\n * Screw transfer animation handler.\n *\n * Handles the screw:startTransfer event to animate screws moving from\n * the buffer tray to a colored tray when a matching tray becomes available.\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-returns, jsdoc/require-param, jsdoc/require-example */\n\nimport type { Entity, Entity2D } from '@play-co/odie';\nimport type { Sprite } from 'pixi.js';\nimport { AnimatorBase } from './AnimatorBase';\nimport type { FlightParams, ScrewTransferEvent } from './types';\nimport {\n  BUFFER_SLOT_SCALE,\n  TRAY_SLOT_SCALE,\n  TRANSFER_ARC_HEIGHT,\n} from './types';\nimport { gameEvents, gameTick } from '../../utils';\n\n/** Component access type for screw entities */\ninterface ScrewComponentAccess {\n  screw: {\n    color: string;\n    state: string;\n    trayEntityId?: string;\n    slotIndex?: number;\n    isAnimating: boolean;\n  };\n}\n\n/** Component access type for tray entities */\ninterface TrayComponentAccess {\n  tray: {\n    displayOrder: number;\n    capacity: number;\n    color: string;\n    isAnimating: boolean;\n  };\n}\n\n/**\n * Animator for screw transfer (buffer to colored tray).\n *\n * When a screw is in the buffer tray and its matching colored tray becomes\n * available, this animator handles the arc flight animation to move the\n * screw from buffer to the colored tray slot.\n *\n * Uses a faster animation (0.27s) than removal since the screw is already\n * in its long form and doesn't need texture swapping.\n *\n * Emits `screw:transferComplete` when animation finishes.\n *\n * @example\n * const animator = new ScrewTransferAnimator(ctx);\n * await animator.handle(event);\n */\nexport class ScrewTransferAnimator extends AnimatorBase {\n  /**\n   * Handle screw transfer animation (buffer to colored tray).\n   * @param event - The transfer event data\n   */\n  async handle(event: ScrewTransferEvent): Promise<void> {\n    const { screwEntity, targetTray, slotIndex } = event;\n    const screwEntity2D = screwEntity as Entity2D;\n    const visual = this.ctx.getGameVisual(screwEntity2D);\n\n    // Disable pointer events during animation\n    screwEntity2D.view.eventMode = 'none';\n\n    if (!visual) {\n      this.complete(screwEntity, targetTray, slotIndex);\n      return;\n    }\n\n    const timeline = this.setupAnimationTimeline(screwEntity2D);\n\n    try {\n      await this.executeAnimation(screwEntity2D, visual, event, timeline);\n    } finally {\n      this.cleanupTimeline(timeline);\n    }\n\n    this.complete(screwEntity, targetTray, slotIndex);\n  }\n\n  /** Execute the transfer animation phases. */\n  private async executeAnimation(\n    entity: Entity2D,\n    sprite: Sprite,\n    event: ScrewTransferEvent,\n    timeline: gsap.core.Timeline\n  ): Promise<void> {\n    const { targetTray, slotIndex } = event;\n    const startPos = { x: entity.position.x, y: entity.position.y };\n\n    // Use displayOrder-based targeting for correct position even during shifts\n    const tray = this.ctx.getComponents<TrayComponentAccess>(targetTray).tray;\n    const targetPos = this.ctx.getTraySlotTargetPosition(\n      tray.displayOrder,\n      slotIndex,\n      tray.capacity\n    );\n    const params = this.createTransferFlightParams(startPos, targetPos);\n\n    // Transfer animation: 1.5x faster than removal (0.4 / 1.5  0.27s)\n    await this.animateFlight(timeline, entity, sprite, params, 0.27);\n    await this.animateSettle(timeline, sprite, TRAY_SLOT_SCALE);\n  }\n\n  /** Create flight parameters for transfer animation (no pop-out). */\n  private createTransferFlightParams(\n    start: { x: number; y: number },\n    end: { x: number; y: number }\n  ): FlightParams {\n    return {\n      startX: start.x,\n      startY: start.y,\n      controlX: (start.x + end.x) / 2,\n      controlY: Math.min(start.y, end.y) - TRANSFER_ARC_HEIGHT,\n      endX: end.x,\n      endY: end.y,\n      startScale: BUFFER_SLOT_SCALE,\n      endScale: TRAY_SLOT_SCALE,\n    };\n  }\n\n  /** Complete the transfer and emit event. */\n  private complete(\n    screwEntity: Entity,\n    targetTray: Entity,\n    slotIndex: number\n  ): void {\n    const screw =\n      this.ctx.getComponents<ScrewComponentAccess>(screwEntity).screw;\n    screw.state = 'inTray';\n    screw.trayEntityId = String(targetTray.UID);\n    screw.slotIndex = slotIndex;\n    screw.isAnimating = false;\n\n    const screwEntity2D = screwEntity as Entity2D;\n\n    // Move screw view to coloredTrayLayer after animation\n    const coloredTrayLayer = this.ctx.getColoredTrayLayer();\n    if (coloredTrayLayer) {\n      coloredTrayLayer.addChild(screwEntity2D.view);\n    }\n\n    // Check if position matches expected - logs warning if mismatch\n    this.checkScrewPosition(screwEntity2D, targetTray, slotIndex);\n\n    // Hide placeholder when screw lands in colored tray\n    this.hidePlaceholder(targetTray as Entity2D, slotIndex);\n\n    gameEvents.emit('screw:transferComplete', { screwEntity });\n  }\n\n  /** Check if screw position matches expected slot position. */\n  private checkScrewPosition(\n    screwEntity: Entity2D,\n    targetTray: Entity,\n    slotIndex: number\n  ): void {\n    const screw =\n      this.ctx.getComponents<ScrewComponentAccess>(screwEntity).screw;\n    const tray = this.ctx.getComponents<TrayComponentAccess>(targetTray).tray;\n    const expected = this.ctx.getTraySlotTargetPosition(\n      tray.displayOrder,\n      slotIndex,\n      tray.capacity\n    );\n    const dX = Math.abs(screwEntity.position.x - expected.x);\n    const dY = Math.abs(screwEntity.position.y - expected.y);\n\n    if (dX > 0.5 || dY > 0.5) {\n      gameTick.warn(\n        'POSITION_MISMATCH',\n        `${screw.color} screw at (${screwEntity.position.x.toFixed(1)}, ${screwEntity.position.y.toFixed(1)}) ` +\n          `expected (${String(expected.x)}, ${String(expected.y)}) ` +\n          `delta=(${dX.toFixed(1)}, ${dY.toFixed(1)}) ` +\n          `tray.displayOrder=${String(tray.displayOrder)} tray.isAnimating=${String(tray.isAnimating)}`\n      );\n    }\n  }\n}\n","/**\n * Tray hide animation handler.\n *\n * Handles the tray:startHide event to scale down and hide a filled tray.\n * Reparents screws to the tray view so they scale together during the\n * hide animation.\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-example */\n\nimport type { Entity, Entity2D } from '@play-co/odie';\nimport gsap from 'gsap';\nimport type { AnimatorContext } from './types';\nimport { gameEvents } from '../../utils';\nimport type { TrayHideEvent } from '../TrayManagementSystem';\n\n/**\n * Animator for tray hide (scale down and disappear).\n *\n * When a tray fills up completely, it animates out with a scale-to-zero\n * effect. The screws in the tray are reparented to the tray's view so\n * they shrink together as a unit.\n *\n * Emits `tray:hideComplete` when animation finishes.\n *\n * @example\n * const animator = new TrayHideAnimator(ctx);\n * await animator.handle(event);\n */\nexport class TrayHideAnimator {\n  private ctx: AnimatorContext;\n\n  constructor(ctx: AnimatorContext) {\n    this.ctx = ctx;\n  }\n\n  /**\n   * Handle tray hide animation with scale-down effect.\n   * @param event - The tray hide event data\n   * @example\n   */\n  async handle(event: TrayHideEvent): Promise<void> {\n    const { trayEntity } = event;\n    const entity2D = trayEntity as Entity2D;\n    const screwsInTray = this.ctx.getScrewsInTray(String(trayEntity.UID));\n\n    this.reparentScrewsToTray(screwsInTray, entity2D);\n    this.setupPivotForCenterScale(entity2D);\n    await this.animateScaleDown(entity2D);\n\n    gameEvents.emit('tray:hideComplete', { trayEntity, screwsInTray });\n  }\n\n  /**\n   * Set up tray pivot for center-based scaling animation.\n   * Adjusts position to compensate for pivot change.\n   * @param entity - The tray entity\n   * @example\n   */\n  private setupPivotForCenterScale(entity: Entity2D): void {\n    // Tray dimensions: 185x150\n    const pivotX = 185 / 2;\n    const pivotY = 150 / 2;\n    entity.view.pivot.set(pivotX, pivotY);\n    entity.position.x += pivotX;\n    entity.position.y += pivotY;\n  }\n\n  /**\n   * Animate tray scale-down smoothly from 1 to 0.\n   * @param entity - The tray entity to animate\n   * @example\n   */\n  private async animateScaleDown(entity: Entity2D): Promise<void> {\n    const timeline = gsap.timeline();\n    this.ctx.activeTimelines.add(timeline);\n\n    try {\n      // Single smooth scale animation from 1  0\n      await timeline.to(entity.scale, {\n        x: 0,\n        y: 0,\n        duration: 0.4,\n        ease: 'power2.in',\n      });\n    } finally {\n      this.ctx.activeTimelines.delete(timeline);\n    }\n  }\n\n  /**\n   * Reparent screw visuals to tray view so they scale together.\n   * Converts screw positions to tray-local coordinates.\n   * @param screws - Array of screw entities to reparent\n   * @param trayEntity - The tray entity to parent screws to\n   * @example\n   */\n  private reparentScrewsToTray(screws: Entity[], trayEntity: Entity2D): void {\n    // Use trayEntity.view (the container) instead of the tray sprite\n    // This is because we scale trayEntity.scale, not the sprite\n    const trayView = trayEntity.view;\n\n    for (const screwEntity of screws) {\n      const screwEntity2D = screwEntity as Entity2D;\n      const screwVisual = this.ctx.getGameVisual(screwEntity2D);\n      if (!screwVisual) continue;\n\n      // Calculate local position relative to tray\n      // Screw is at entity world position, tray is at tray entity position\n      // Local position = screw world position - tray world position\n      const localX = screwEntity2D.position.x - trayEntity.position.x;\n      const localY = screwEntity2D.position.y - trayEntity.position.y;\n\n      // Remove from current parent first to avoid PixiJS warning\n      if (screwVisual.parent) {\n        screwVisual.parent.removeChild(screwVisual);\n      }\n\n      // Reparent visual to tray view container\n      screwVisual.position.set(localX, localY);\n      trayView.addChild(screwVisual);\n    }\n  }\n}\n","/**\n * Tray shift animation handler.\n *\n * Handles the tray:startShift event to slide a tray left to a new display\n * position when another tray hides. Also moves any screws in the tray so\n * they stay aligned.\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-example */\n\nimport type { Entity, Entity2D } from '@play-co/odie';\nimport gsap from 'gsap';\nimport type { AnimatorContext } from './types';\nimport { gameEvents, TRAY_DISPLAY_POSITIONS } from '../../utils';\nimport type { TrayShiftEvent } from '../TrayManagementSystem';\n\n/**\n * Animator for tray shift (slide left to new position).\n *\n * When a tray at displayOrder 0 hides, the tray at displayOrder 1 shifts\n * left to take its place. This animator handles both the tray movement\n * and any screws currently in that tray.\n *\n * Emits `tray:shiftComplete` when animation finishes.\n *\n * @example\n * const animator = new TrayShiftAnimator(ctx);\n * await animator.handle(event);\n */\nexport class TrayShiftAnimator {\n  private ctx: AnimatorContext;\n\n  constructor(ctx: AnimatorContext) {\n    this.ctx = ctx;\n  }\n\n  /**\n   * Handle tray shift animation (slide left to new position).\n   * @param event - The tray shift event data\n   * @example\n   */\n  async handle(event: TrayShiftEvent): Promise<void> {\n    const { trayEntity, newDisplayOrder } = event;\n    const entity2D = trayEntity as Entity2D;\n    const targetPos = TRAY_DISPLAY_POSITIONS[newDisplayOrder];\n\n    if (!targetPos) {\n      gameEvents.emit('tray:shiftComplete', { trayEntity });\n      return;\n    }\n\n    const screwsInTray = this.ctx.getScrewsInTray(String(trayEntity.UID));\n    const deltaX = targetPos.x - entity2D.position.x;\n\n    const timeline = gsap.timeline();\n    this.ctx.activeTimelines.add(timeline);\n\n    try {\n      this.addShiftAnimations(\n        timeline,\n        entity2D,\n        targetPos.x,\n        screwsInTray,\n        deltaX\n      );\n      await timeline;\n    } finally {\n      this.ctx.activeTimelines.delete(timeline);\n    }\n\n    gameEvents.emit('tray:shiftComplete', { trayEntity });\n  }\n\n  /**\n   * Add tray and screw shift animations to a timeline.\n   * @param timeline - GSAP timeline\n   * @param trayEntity - The tray entity to animate\n   * @param targetX - Target X position for tray\n   * @param screws - Screws in the tray to move\n   * @param deltaX - X distance to move\n   * @example\n   */\n  private addShiftAnimations(\n    timeline: gsap.core.Timeline,\n    trayEntity: Entity2D,\n    targetX: number,\n    screws: Entity[],\n    deltaX: number\n  ): void {\n    timeline.to(\n      trayEntity.position,\n      { x: targetX, duration: 0.3, ease: 'power2.inOut' },\n      0\n    );\n\n    for (const screwEntity of screws) {\n      const screw2D = screwEntity as Entity2D;\n      timeline.to(\n        screw2D.position,\n        { x: screw2D.position.x + deltaX, duration: 0.3, ease: 'power2.inOut' },\n        0\n      );\n    }\n  }\n}\n","/**\n * Tray reveal animation handler.\n *\n * Handles the tray:startReveal event to slide a tray in from the right\n * when a hidden tray needs to become visible after another tray is filled.\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-example */\n\nimport type { Entity2D } from '@play-co/odie';\nimport gsap from 'gsap';\nimport type { AnimatorContext } from './types';\nimport { gameEvents, TRAY_DISPLAY_POSITIONS, TRAY_SPAWN_X } from '../../utils';\nimport type { TrayRevealEvent } from '../TrayManagementSystem';\n\n/**\n * Animator for tray reveal (slide in from right).\n *\n * When a tray fills up and hides, the next hidden tray slides in from the\n * right side to take its place. This animator handles that transition.\n *\n * Emits `tray:revealComplete` when animation finishes.\n *\n * @example\n * const animator = new TrayRevealAnimator(ctx);\n * await animator.handle(event);\n */\nexport class TrayRevealAnimator {\n  private ctx: AnimatorContext;\n\n  constructor(ctx: AnimatorContext) {\n    this.ctx = ctx;\n  }\n\n  /**\n   * Handle tray reveal animation (slide in from right).\n   * @param event - The tray reveal event data\n   * @example\n   */\n  async handle(event: TrayRevealEvent): Promise<void> {\n    const { trayEntity, displayOrder } = event;\n    const entity2D = trayEntity as Entity2D;\n    const targetPos = TRAY_DISPLAY_POSITIONS[displayOrder];\n\n    if (!targetPos) {\n      gameEvents.emit('tray:revealComplete', { trayEntity });\n      return;\n    }\n\n    // Start tray at rightmost covered slot position (hidden under cover)\n    entity2D.position.x = TRAY_SPAWN_X;\n    entity2D.position.y = targetPos.y;\n\n    const timeline = gsap.timeline();\n    this.ctx.activeTimelines.add(timeline);\n\n    try {\n      await timeline.to(entity2D.position, {\n        x: targetPos.x,\n        duration: 0.3,\n        ease: 'power2.out',\n      });\n    } finally {\n      this.ctx.activeTimelines.delete(timeline);\n    }\n\n    gameEvents.emit('tray:revealComplete', { trayEntity });\n  }\n}\n","import type { Entity, Entity2D, Time } from '@play-co/odie';\nimport type { Sprite } from 'pixi.js';\nimport gsap from 'gsap';\nimport { BaseSystem } from './BaseSystem';\nimport { ScrewComponent } from '../components';\nimport { getGameVisual, getTrayPlaceholders } from '../factories';\nimport {\n  getTraySlotPosition,\n  getTraySlotTargetPosition,\n  gameEvents,\n  getAnimationLayer,\n  getColoredTrayLayer,\n} from '../utils';\nimport type { ScrewRemovalEvent } from './ScrewInteractionSystem';\nimport type {\n  TrayHideEvent,\n  TrayShiftEvent,\n  TrayRevealEvent,\n} from './TrayManagementSystem';\nimport type { ScrewComponentAccess } from '../types';\nimport {\n  type AnimatorContext,\n  type ScrewTransferEvent,\n  ScrewRemovalAnimator,\n  ScrewTransferAnimator,\n  TrayHideAnimator,\n  TrayShiftAnimator,\n  TrayRevealAnimator,\n} from './animation';\n\n// Re-export types for external use\nexport type {\n  ScrewRemovalCompleteEvent,\n  ScrewTransferCompleteEvent,\n  ScrewTransferEvent,\n} from './animation';\n\n/**\n * System for coordinating all game animations.\n *\n * This system acts as a coordinator that delegates animation work to\n * specialized animator classes. It manages the shared resources (timeline\n * tracking, layer access) and event listener registration.\n *\n * Animation types:\n * - Screw removal: Unscrew and fly to target tray\n * - Screw transfer: Move from buffer to colored tray\n * - Tray hide: Scale down and disappear when full\n * - Tray shift: Slide left when another tray hides\n * - Tray reveal: Slide in from right to replace hidden tray\n *\n * Listens for:\n * - `screw:startRemoval` - Begin removal animation\n * - `screw:startTransfer` - Begin transfer animation\n * - `tray:startHide` - Begin tray hide animation\n * - `tray:startShift` - Begin tray shift animation\n * - `tray:startReveal` - Begin tray reveal animation\n *\n * Emits (via animators):\n * - `screw:removalComplete`\n * - `screw:transferComplete`\n * - `tray:hideComplete`\n * - `tray:shiftComplete`\n * - `tray:revealComplete`\n */\nexport class AnimationSystem extends BaseSystem {\n  static readonly NAME = 'animation';\n  static Queries = {\n    screws: { components: [ScrewComponent] },\n  };\n\n  /** Active GSAP timelines for cleanup */\n  private activeTimelines = new Set<gsap.core.Timeline>();\n\n  /** Screw removal animator */\n  private screwRemoval!: ScrewRemovalAnimator;\n\n  /** Screw transfer animator */\n  private screwTransfer!: ScrewTransferAnimator;\n\n  /** Tray hide animator */\n  private trayHide!: TrayHideAnimator;\n\n  /** Tray shift animator */\n  private trayShift!: TrayShiftAnimator;\n\n  /** Tray reveal animator */\n  private trayReveal!: TrayRevealAnimator;\n\n  // Bound event handlers\n  private handleRemovalEvent = (event: ScrewRemovalEvent): void => {\n    void this.screwRemoval.handle(event);\n  };\n\n  private handleTransferEvent = (event: ScrewTransferEvent): void => {\n    void this.screwTransfer.handle(event);\n  };\n\n  private handleTrayHideEvent = (event: TrayHideEvent): void => {\n    void this.trayHide.handle(event);\n  };\n\n  private handleTrayShiftEvent = (event: TrayShiftEvent): void => {\n    void this.trayShift.handle(event);\n  };\n\n  private handleTrayRevealEvent = (event: TrayRevealEvent): void => {\n    void this.trayReveal.handle(event);\n  };\n\n  /**\n   * Initialize animators and event listeners.\n   * @example\n   * system.init(); // Called automatically by ECS\n   */\n  init(): void {\n    // Create animator context with shared resources\n    const ctx = this.createAnimatorContext();\n\n    // Initialize all animators\n    this.screwRemoval = new ScrewRemovalAnimator(ctx);\n    this.screwTransfer = new ScrewTransferAnimator(ctx);\n    this.trayHide = new TrayHideAnimator(ctx);\n    this.trayShift = new TrayShiftAnimator(ctx);\n    this.trayReveal = new TrayRevealAnimator(ctx);\n\n    // Register event listeners\n    gameEvents.on<ScrewRemovalEvent>(\n      'screw:startRemoval',\n      this.handleRemovalEvent\n    );\n    gameEvents.on<ScrewTransferEvent>(\n      'screw:startTransfer',\n      this.handleTransferEvent\n    );\n    gameEvents.on<TrayHideEvent>('tray:startHide', this.handleTrayHideEvent);\n    gameEvents.on<TrayShiftEvent>('tray:startShift', this.handleTrayShiftEvent);\n    gameEvents.on<TrayRevealEvent>(\n      'tray:startReveal',\n      this.handleTrayRevealEvent\n    );\n  }\n\n  /**\n   * Create the animator context with shared resources.\n   * @returns Context object for animators\n   * @example\n   */\n  private createAnimatorContext(): AnimatorContext {\n    return {\n      activeTimelines: this.activeTimelines,\n      getScrewsInTray: (trayUID) => this.getScrewsInTray(trayUID),\n      getComponents: (entity) => this.getComponents(entity),\n      getAnimationLayer: () => getAnimationLayer(),\n      getColoredTrayLayer: () => getColoredTrayLayer(),\n      getGameVisual: (entity) => getGameVisual(entity) as Sprite | null,\n      getTrayPlaceholders: (entity) => getTrayPlaceholders(entity) ?? null,\n      getTraySlotTargetPosition: (displayOrder, slotIndex, capacity) =>\n        getTraySlotTargetPosition(displayOrder, slotIndex, capacity),\n      getTraySlotPosition: (trayEntity, slotIndex, isBuffer, capacity) =>\n        getTraySlotPosition(trayEntity, slotIndex, isBuffer, capacity),\n    };\n  }\n\n  /**\n   * Find all screw entities currently in a specific tray.\n   * @param trayUID - The UID of the tray to search\n   * @returns Array of screw entities in the tray\n   * @example\n   */\n  private getScrewsInTray(trayUID: string): Entity[] {\n    const screws: Entity[] = [];\n    this.forEachEntity('screws', (entity) => {\n      const screw = this.getComponents<ScrewComponentAccess>(entity).screw;\n      if (screw.state === 'inTray' && screw.trayEntityId === trayUID) {\n        screws.push(entity);\n      }\n    });\n    return screws;\n  }\n\n  /**\n   * Hide a placeholder sprite when a screw fills that slot.\n   * @param trayEntity - The tray entity\n   * @param slotIndex - The slot index that was filled\n   * @example\n   * animationSystem.hidePlaceholder(trayEntity, 0);\n   */\n  public hidePlaceholder(trayEntity: Entity2D, slotIndex: number): void {\n    const placeholders = getTrayPlaceholders(trayEntity);\n    const placeholder = placeholders?.[slotIndex];\n    if (placeholder) {\n      gsap.to(placeholder, { alpha: 0, duration: 0.15, ease: 'linear' });\n    }\n  }\n\n  /**\n   * Update is a no-op for this system.\n   * @param _time - Frame time info (unused)\n   * @example\n   * // Called automatically by ECS each frame\n   * system.update(time);\n   */\n  update(_time: Time): void {\n    // No per-frame updates needed - animations run via GSAP\n  }\n\n  /**\n   * Clean up event listeners and active timelines when system is destroyed.\n   * @example\n   * system.destroy(); // Called automatically by ECS\n   */\n  destroy(): void {\n    // Unregister event listeners\n    gameEvents.off('screw:startRemoval', this.handleRemovalEvent);\n    gameEvents.off('screw:startTransfer', this.handleTransferEvent);\n    gameEvents.off('tray:startHide', this.handleTrayHideEvent);\n    gameEvents.off('tray:startShift', this.handleTrayShiftEvent);\n    gameEvents.off('tray:startReveal', this.handleTrayRevealEvent);\n\n    // Kill active timelines\n    for (const timeline of this.activeTimelines) {\n      timeline.kill();\n    }\n    this.activeTimelines.clear();\n  }\n}\n","import type { Entity, Time } from '@play-co/odie';\nimport { BaseSystem } from './BaseSystem';\nimport {\n  ScrewComponent,\n  TrayComponent,\n  BufferTrayComponent,\n} from '../components';\nimport { ScrewPlacementSystem } from './ScrewPlacementSystem';\nimport { TrayManagementSystem } from './TrayManagementSystem';\nimport type { ScrewTransferEvent } from './AnimationSystem';\nimport type { TrayRevealedEvent } from './TrayManagementSystem';\nimport { gameEvents, gameTick } from '../utils';\nimport type {\n  ScrewComponentAccess,\n  TrayComponentAccess,\n  BufferTrayComponentAccess,\n} from '../types';\n\n/**\n * System for automatically transferring screws from buffer to colored trays.\n *\n * When a screw is removed and placed in a colored tray (or when a new tray\n * is revealed), this system checks if any screws in the buffer can now be\n * moved to their matching colored tray.\n *\n * Transfer rules:\n * - Screws are processed in FIFO order (first in, first out)\n * - Only one transfer happens at a time for visual clarity\n * - Transfer only occurs if the colored tray has space and is visible\n *\n * Listens for:\n * - `screw:removalComplete` - Check for auto-transfer opportunity\n * - `screw:transferComplete` - Check for more transfers\n * - `tray:revealed` - New tray revealed, check for matching buffer screws\n *\n * Emits:\n * - `screw:startTransfer` - Begin transfer animation\n */\nexport class AutoTransferSystem extends BaseSystem {\n  static readonly NAME = 'autoTransfer';\n  static Queries = {\n    coloredTrays: { components: [TrayComponent] },\n    bufferTrays: { components: [BufferTrayComponent] },\n    screws: { components: [ScrewComponent] },\n  };\n\n  /** Flag to prevent multiple simultaneous transfers */\n  private isTransferring = false;\n\n  /**\n   * Bound handler for screw:removalComplete event.\n   * Defers check to allow TrayManagementSystem to process first.\n   * @internal\n   */\n  private handleRemovalComplete = (): void => {\n    // Defer to allow TrayManagementSystem to set isTransitioning first\n    // Both systems listen to screw:removalComplete - if a tray fills,\n    // we need TrayManagement to mark itself busy before we check\n    queueMicrotask(() => {\n      this.checkAutoTransfer();\n    });\n  };\n\n  /**\n   * Bound handler for screw:transferComplete event.\n   * Defers check to allow TrayManagementSystem to process first.\n   * @internal\n   */\n  private handleTransferComplete = (): void => {\n    // Defer to allow TrayManagementSystem to process tray fullness first\n    queueMicrotask(() => {\n      this.onTransferComplete();\n    });\n  };\n\n  /**\n   * Bound handler for tray:revealed event.\n   * Defers check to allow TrayManagementSystem to finalize first.\n   * @internal\n   */\n  private handleTrayRevealed = (): void => {\n    // Defer to ensure tray animations are fully complete\n    queueMicrotask(() => {\n      this.checkAutoTransfer();\n    });\n  };\n\n  /**\n   * Initialize event listeners.\n   * @example\n   * system.init(); // Called automatically by ECS\n   */\n  init(): void {\n    gameEvents.on('screw:removalComplete', this.handleRemovalComplete);\n    gameEvents.on('screw:transferComplete', this.handleTransferComplete);\n    gameEvents.on<TrayRevealedEvent>('tray:revealed', this.handleTrayRevealed);\n  }\n\n  /**\n   * Clean up event listeners.\n   * @example\n   * system.destroy(); // Called automatically by ECS\n   */\n  destroy(): void {\n    gameEvents.off('screw:removalComplete', this.handleRemovalComplete);\n    gameEvents.off('screw:transferComplete', this.handleTransferComplete);\n    gameEvents.off('tray:revealed', this.handleTrayRevealed);\n    this.isTransferring = false;\n  }\n\n  /**\n   * Called when a transfer animation completes.\n   * @example\n   * this.onTransferComplete(); // Called via event\n   */\n  private onTransferComplete(): void {\n    this.isTransferring = false;\n    // Check for more transfers\n    this.checkAutoTransfer();\n  }\n\n  /**\n   * Check if any screws in the buffer can be transferred to colored trays.\n   * @example\n   * this.checkAutoTransfer();\n   */\n  private checkAutoTransfer(): void {\n    if (this.shouldSkipTransferCheck()) return;\n\n    const bufferTray = this.getFirstEntity('bufferTrays');\n    if (!bufferTray) return;\n\n    const buffer =\n      this.getComponents<BufferTrayComponentAccess>(bufferTray).bufferTray;\n    if (buffer.screwIds.length === 0) {\n      gameTick.log('AUTO_TRANSFER_CHECK', ' skipped (buffer empty)');\n      return;\n    }\n\n    this.processBufferScrews(buffer.screwIds, bufferTray);\n  }\n\n  /**\n   * Check if transfer check should be skipped and log reason.\n   * @returns True if should skip\n   * @example\n   * if (this.shouldSkipTransferCheck()) return;\n   */\n  private shouldSkipTransferCheck(): boolean {\n    const transferring = this.isTransferring;\n    const animating = this.anyTrayAnimating();\n    const busy = this.trayManagementBusy();\n\n    gameTick.log(\n      'AUTO_TRANSFER_CHECK',\n      `transferring=${String(transferring)} animating=${String(animating)} busy=${String(busy)}`\n    );\n\n    if (transferring) {\n      gameTick.log('AUTO_TRANSFER_CHECK', ' skipped (already transferring)');\n      return true;\n    }\n    if (animating) {\n      gameTick.log('AUTO_TRANSFER_CHECK', ' skipped (trays animating)');\n      return true;\n    }\n    if (busy) {\n      gameTick.log('AUTO_TRANSFER_CHECK', ' skipped (tray management busy)');\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Process buffer screws in FIFO order, initiating transfer if possible.\n   * @param screwIds - Array of screw UIDs in buffer\n   * @param bufferTray - The buffer tray entity\n   * @example\n   * this.processBufferScrews(buffer.screwIds, bufferTray);\n   */\n  private processBufferScrews(screwIds: string[], bufferTray: Entity): void {\n    gameTick.log(\n      'AUTO_TRANSFER_CHECK',\n      `buffer has ${String(screwIds.length)} screws`\n    );\n\n    for (const screwId of screwIds) {\n      if (this.tryTransferScrew(screwId, bufferTray)) {\n        return; // Only one transfer at a time\n      }\n    }\n  }\n\n  /**\n   * Attempt to transfer a single screw from buffer to colored tray.\n   * @param screwId - The screw UID to transfer\n   * @param bufferTray - The buffer tray entity\n   * @returns True if transfer was initiated\n   * @example\n   * if (this.tryTransferScrew(screwId, bufferTray)) return;\n   */\n  private tryTransferScrew(screwId: string, bufferTray: Entity): boolean {\n    const placementSystem = this.scene.getSystem(ScrewPlacementSystem);\n    const screwEntity = placementSystem.findScrewByUid(screwId);\n\n    if (!screwEntity) {\n      gameTick.log('AUTO_TRANSFER_CHECK', ` screw ${screwId} not found`);\n      return false;\n    }\n\n    const screw = this.getComponents<ScrewComponentAccess>(screwEntity).screw;\n    if (screw.isAnimating) {\n      gameTick.log(\n        'AUTO_TRANSFER_CHECK',\n        ` ${screw.color} screw still animating`\n      );\n      return false;\n    }\n\n    const matchingTray = placementSystem.findAvailableColoredTray(screw.color);\n    if (matchingTray) {\n      this.initiateTransfer(screwEntity, matchingTray, bufferTray);\n      return true;\n    }\n\n    gameTick.log(\n      'AUTO_TRANSFER_CHECK',\n      ` ${screw.color} screw has no matching visible tray`\n    );\n    return false;\n  }\n\n  /**\n   * Check if any colored tray is currently animating.\n   * Used to prevent transfers while trays are shifting/revealing.\n   * @returns True if any tray is animating\n   * @example\n   * if (this.anyTrayAnimating()) return;\n   */\n  private anyTrayAnimating(): boolean {\n    const coloredTrays = this.getEntities('coloredTrays');\n    for (const tray of coloredTrays) {\n      const trayComp = this.getComponents<TrayComponentAccess>(tray).tray;\n      if (trayComp.isAnimating) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Check if TrayManagementSystem is processing or has pending transitions.\n   * This prevents starting transfers when more tray shifts may occur.\n   * @returns True if tray management is busy\n   * @example\n   * if (this.trayManagementBusy()) return;\n   */\n  private trayManagementBusy(): boolean {\n    const trayManagement = this.scene.getSystem(TrayManagementSystem);\n    return trayManagement.isBusy();\n  }\n\n  /**\n   * Start the transfer animation for a screw.\n   * @param screwEntity - The screw entity\n   * @param targetTray - The target tray entity\n   * @param bufferTray - The buffer tray entity\n   * @example\n   * this.initiateTransfer(screwEntity, coloredTray, bufferTray);\n   */\n  private initiateTransfer(\n    screwEntity: Entity,\n    targetTray: Entity,\n    bufferTray: Entity\n  ): void {\n    this.isTransferring = true;\n\n    const buffer =\n      this.getComponents<BufferTrayComponentAccess>(bufferTray).bufferTray;\n    const tray = this.getComponents<TrayComponentAccess>(targetTray).tray;\n    const screw = this.getComponents<ScrewComponentAccess>(screwEntity).screw;\n\n    // Remove from buffer\n    const screwUid = String(screwEntity.UID);\n    const bufferIndex = buffer.screwIds.indexOf(screwUid);\n    if (bufferIndex >= 0) {\n      buffer.screwIds.splice(bufferIndex, 1);\n    }\n\n    // Reserve slot in colored tray\n    const slotIndex = tray.screwCount;\n    tray.screwCount++;\n\n    // Log transfer action for debugging/test reproduction\n    gameTick.log(\n      'TRANSFER',\n      `${screw.color} screw from buffer  ${tray.color} tray [slot ${String(slotIndex)}]`\n    );\n\n    // Update screw state\n    screw.isAnimating = true;\n\n    // Emit transfer event for AnimationSystem\n    const event: ScrewTransferEvent = {\n      screwEntity,\n      targetTray,\n      slotIndex,\n    };\n\n    gameEvents.emit('screw:startTransfer', event);\n  }\n\n  /**\n   * Update is a no-op for this system.\n   * @param _time - Frame time info (unused)\n   * @example\n   * system.update(time); // Called automatically by ECS\n   */\n  update(_time: Time): void {\n    // No per-frame updates needed - all logic is event-driven\n  }\n}\n","import type { Time } from '@play-co/odie';\nimport { BaseSystem } from './BaseSystem';\nimport { ScrewComponent, GameStateComponent } from '../components';\nimport { ScrewPlacementSystem } from './ScrewPlacementSystem';\nimport { gameEvents } from '../utils';\nimport type { ScrewComponentAccess, GameStateComponentAccess } from '../types';\n\n/**\n * System for detecting win and stuck conditions.\n *\n * This system monitors the game state after each screw removal and\n * determines if the player has won or is stuck (soft lock).\n *\n * Win conditions:\n * - `allScrewsRemoved`: All screws have been removed from the puzzle\n *\n * Stuck condition:\n * - No valid moves available (buffer full and no matching tray space)\n *\n * Listens for:\n * - `screw:removalComplete` - Check win/stuck after removal\n * - `screw:transferComplete` - Re-check stuck condition after transfer\n *\n * Emits:\n * - `game:won` - Player has won the level\n * - `game:stuck` - Player is stuck (soft lock)\n */\nexport class WinConditionSystem extends BaseSystem {\n  static readonly NAME = 'winCondition';\n  static Queries = {\n    gameState: { components: [GameStateComponent] },\n    screws: { components: [ScrewComponent] },\n  };\n\n  /**\n   * Bound handler for screw:removalComplete event.\n   * @internal\n   */\n  private handleRemovalComplete = (): void => {\n    this.checkConditions();\n  };\n\n  /**\n   * Bound handler for screw:transferComplete event.\n   * @internal\n   */\n  private handleTransferComplete = (): void => {\n    this.checkStuckCondition();\n  };\n\n  /**\n   * Initialize event listeners.\n   * @example\n   * system.init(); // Called automatically by ECS\n   */\n  init(): void {\n    gameEvents.on('screw:removalComplete', this.handleRemovalComplete);\n    gameEvents.on('screw:transferComplete', this.handleTransferComplete);\n  }\n\n  /**\n   * Clean up event listeners.\n   * @example\n   * system.destroy(); // Called automatically by ECS\n   */\n  destroy(): void {\n    gameEvents.off('screw:removalComplete', this.handleRemovalComplete);\n    gameEvents.off('screw:transferComplete', this.handleTransferComplete);\n  }\n\n  /**\n   * Check both win and stuck conditions.\n   * @example\n   * this.checkConditions();\n   */\n  private checkConditions(): void {\n    const gameStateEntity = this.getFirstEntity('gameState');\n    if (!gameStateEntity) return;\n\n    const gameState =\n      this.getComponents<GameStateComponentAccess>(gameStateEntity).gameState;\n\n    // Skip if game is already over\n    if (gameState.phase !== 'playing') return;\n\n    // Update removed count\n    gameState.removedScrews++;\n\n    // Check win condition\n    if (this.checkWinCondition(gameState.winConditionType)) {\n      gameState.phase = 'won';\n      gameEvents.emit('game:won');\n      return;\n    }\n\n    // Check stuck condition\n    this.checkStuckCondition();\n  }\n\n  /**\n   * Check if the win condition is met.\n   * @param winType - The type of win condition to check\n   * @returns True if the win condition is met\n   * @example\n   * const won = this.checkWinCondition('allScrewsRemoved');\n   */\n  private checkWinCondition(winType: string): boolean {\n    switch (winType) {\n      case 'allScrewsRemoved':\n        return this.checkAllScrewsRemoved();\n\n      // Future win conditions can be added here\n      // case 'partsRemoved':\n      // case 'targetFreed':\n\n      default:\n        return this.checkAllScrewsRemoved();\n    }\n  }\n\n  /**\n   * Count how many screws are still in the board.\n   * @returns Number of screws with state 'inBoard'\n   * @example\n   * const remaining = this.countInBoardScrews();\n   */\n  private countInBoardScrews(): number {\n    return this.getEntities('screws').filter(\n      (entity) =>\n        this.getComponents<ScrewComponentAccess>(entity).screw.state ===\n        'inBoard'\n    ).length;\n  }\n\n  /**\n   * Check if all screws have been removed from the puzzle.\n   * @returns True if no screws remain in the board\n   * @example\n   * const allRemoved = this.checkAllScrewsRemoved();\n   */\n  private checkAllScrewsRemoved(): boolean {\n    return this.countInBoardScrews() === 0;\n  }\n\n  /**\n   * Check if the player is stuck (no valid moves).\n   * @example\n   * this.checkStuckCondition();\n   */\n  private checkStuckCondition(): void {\n    const gameStateEntity = this.getFirstEntity('gameState');\n    if (!gameStateEntity) return;\n\n    const gameState =\n      this.getComponents<GameStateComponentAccess>(gameStateEntity).gameState;\n\n    // Skip if game is already over\n    if (gameState.phase !== 'playing') return;\n\n    // Get placement system to check valid moves\n    const placementSystem = this.scene.getSystem(ScrewPlacementSystem);\n\n    if (!placementSystem.hasValidMoves()) {\n      // Only stuck if there are screws remaining\n      if (this.countInBoardScrews() > 0) {\n        gameState.phase = 'stuck';\n        gameEvents.emit('game:stuck');\n      }\n    }\n  }\n\n  /**\n   * Update is a no-op for this system.\n   * @param _time - Frame time info (unused)\n   * @example\n   * system.update(time); // Called automatically by ECS\n   */\n  update(_time: Time): void {\n    // No per-frame updates needed - all logic is event-driven\n  }\n}\n","/**\n * Global Error Capture for Test Harness\n *\n * This module sets up global error handlers that capture all uncaught\n * errors and unhandled promise rejections into the test harness.\n * This enables E2E tests to verify that no errors occurred during test runs.\n *\n * @example\n * // Verify no errors in E2E test\n * const errors = await page.evaluate(() => window.__gameTest?.errors);\n * expect(errors).toHaveLength(0);\n *\n * @module\n */\n\n/**\n * Sets up global error handlers to capture errors into the test harness.\n *\n * Captures:\n * - Uncaught exceptions (window 'error' event)\n * - Unhandled promise rejections (window 'unhandledrejection' event)\n *\n * Errors are stored in `window.__gameTest.errors` with:\n * - Error message\n * - Stack trace (if available)\n * - Timestamp\n * - Source location\n *\n * This function is called automatically by `initTestHarness()`.\n *\n * @example\n * // Already called by initTestHarness, but can be called directly\n * import { setupErrorCapture } from './errorCapture';\n *\n * setupErrorCapture();\n *\n * @example\n * // In E2E test, check for errors after an action\n * await page.click('#dangerousButton');\n *\n * const errors = await page.evaluate(() => window.__gameTest?.errors);\n * if (errors && errors.length > 0) {\n *   console.error('Errors occurred:', errors);\n *   throw new Error(`Found ${errors.length} error(s)`);\n * }\n */\nexport function setupErrorCapture(): void {\n  // Capture uncaught errors\n  window.addEventListener('error', (event) => {\n    const error: unknown = event.error;\n    if (window.__gameTest) {\n      window.__gameTest.captureError(\n        error instanceof Error ? error : new Error(event.message),\n        `${event.filename}:${String(event.lineno)}:${String(event.colno)}`\n      );\n    }\n  });\n\n  // Capture unhandled promise rejections\n  window.addEventListener('unhandledrejection', (event) => {\n    if (window.__gameTest) {\n      const reason: unknown = event.reason;\n      window.__gameTest.captureError(\n        reason instanceof Error ? reason : new Error(String(reason)),\n        'unhandledrejection'\n      );\n    }\n  });\n}\n","/**\n * URL Parameter Utilities for Test Configuration\n *\n * This module provides functions to parse URL parameters that control\n * test behavior. These parameters allow E2E tests to configure the game\n * for deterministic, reproducible testing.\n *\n * @example\n * // Common test URLs:\n * // Basic test mode\n * // http://localhost:5173/?testMode\n *\n * // Skip intro and mute audio\n * // http://localhost:5173/?testMode&skipIntro&muteAudio\n *\n * // Deterministic seed for randomness\n * // http://localhost:5173/?testMode&seed=12345\n *\n * // Skip to specific scene\n * // http://localhost:5173/?testMode&scene=BossLevel\n *\n * @module\n */\n\n/**\n * Configuration parameters parsed from the URL query string.\n *\n * These parameters control test behavior and can be used to make\n * tests more deterministic and faster.\n *\n * @example\n * // Check parameters in game code\n * import { getTestParams } from '@shared/debug';\n *\n * const params = getTestParams();\n * if (params.muteAudio) {\n *   // Don't play audio\n * }\n * if (params.skipIntro) {\n *   // Skip splash screen\n * }\n * if (params.seed !== undefined) {\n *   // Use seed for deterministic random\n *   Math.seedrandom(params.seed);\n * }\n */\nexport interface TestParams {\n  /** True if running in test mode (testMode param present) */\n  testMode: boolean;\n  /** Random seed for deterministic randomness */\n  seed?: number | undefined;\n  /** Scene name to skip directly to */\n  scene?: string | undefined;\n  /** True to mute all audio (muteAudio param present) */\n  muteAudio: boolean;\n  /** True to skip intro/splash screens (skipIntro param present) */\n  skipIntro: boolean;\n  /** Region ID to load (e.g., 'test' loads regions/region-test.json) */\n  region?: string | undefined;\n  /** Level index within the region (0-based) */\n  level?: number | undefined;\n}\n\n/**\n * Parses URL query parameters for test configuration.\n *\n * Supported parameters:\n * - `testMode` - Enables test mode and harness\n * - `seed=<number>` - Sets random seed for determinism\n * - `scene=<name>` - Skip to specific scene\n * - `muteAudio` - Disables all audio\n * - `skipIntro` - Skips intro/splash screens\n *\n * @returns Parsed test parameters with defaults\n *\n * @example\n * import { getTestParams } from '@shared/debug';\n *\n * // URL: /?testMode&seed=42&skipIntro\n * const params = getTestParams();\n * // params = {\n * //   testMode: true,\n * //   seed: 42,\n * //   scene: undefined,\n * //   muteAudio: false,\n * //   skipIntro: true\n * // }\n *\n * @example\n * // Use in game initialization\n * const params = getTestParams();\n *\n * if (params.scene) {\n *   // Skip to the specified scene\n *   screens.show(params.scene);\n * } else if (params.skipIntro) {\n *   // Skip intro, go directly to game\n *   screens.show('GameScreen');\n * } else {\n *   // Normal flow\n *   screens.show('IntroScreen');\n * }\n */\nexport function getTestParams(): TestParams {\n  const params = new URLSearchParams(window.location.search);\n  const seedParam = params.get('seed');\n  const levelParam = params.get('level');\n\n  return {\n    testMode: params.has('testMode') || params.get('testMode') === '1',\n    seed: seedParam !== null ? parseInt(seedParam, 10) : undefined,\n    scene: params.get('scene') ?? undefined,\n    muteAudio: params.has('muteAudio') || params.get('muteAudio') === '1',\n    skipIntro: params.has('skipIntro') || params.get('skipIntro') === '1',\n    region: params.get('region') ?? undefined,\n    level: levelParam !== null ? parseInt(levelParam, 10) : undefined,\n  };\n}\n\n/**\n * Checks if the application is running in test mode.\n *\n * Test mode is enabled when either:\n * - The `testMode` URL parameter is present\n * - Running with Vite's test mode (`import.meta.env.MODE === 'test'`)\n *\n * @returns True if in test mode\n *\n * @example\n * import { isTestMode } from '@shared/debug';\n *\n * if (isTestMode()) {\n *   // Disable animations for faster tests\n *   gsap.globalTimeline.timeScale(100);\n * }\n *\n * @example\n * // Conditional test-only features\n * if (isTestMode()) {\n *   // Register scene with test harness\n *   window.__gameTest?.registerScene(this.scene);\n * }\n */\nexport function isTestMode(): boolean {\n  return getTestParams().testMode || import.meta.env.MODE === 'test';\n}\n","/**\n * ECS Access Layer for Test Harness\n *\n * This module provides the ECS access implementation that allows E2E tests\n * to inspect ODIE entities and their components. It handles serialization\n * of entity state to plain objects for cross-context access.\n *\n * @example\n * // In E2E tests, access via the harness\n * const entities = await page.evaluate(() =>\n *   window.__gameTest?.ecs.getEntities()\n * );\n *\n * @module\n */\n\nimport type { EntitySnapshot, ECSAccess } from '../types';\n\n/**\n * Internal interface for ECS access that includes the scene setter.\n *\n * The `_setScene` method is used internally by the harness when a scene\n * is registered. Application code should use `registerScene()` on the\n * harness instead.\n */\nexport interface ECSAccessInternal extends ECSAccess {\n  /**\n   * Internal method to set the scene reference.\n   * @internal\n   */\n  _setScene(scene: unknown): void;\n}\n\n/**\n * Checks if a property should be skipped during serialization.\n *\n * @param key - Property key\n * @param value - Property value\n * @returns True if the property should be skipped\n *\n * @example\n * shouldSkipProperty('_internal', {}); // true\n */\n/** Properties to skip entirely during component serialization */\nconst SKIP_PROPERTIES = new Set([\n  'constructor',\n  'entity', // Circular ref: component  entity (not needed, entity ID is in parent)\n  'scene', // Circular ref to scene\n  'parent', // Circular ref to parent container\n  'children', // Can be huge and redundant with display tree\n]);\n\n/** Properties to convert to UID references */\nconst UID_REF_PROPERTIES = new Set([\n  'view', // Convert view (display object) to viewUid reference\n]);\n\nfunction shouldSkipProperty(key: string, value: unknown): boolean {\n  return (\n    typeof value === 'function' ||\n    key.startsWith('_') ||\n    SKIP_PROPERTIES.has(key)\n  );\n}\n\n/**\n * Extracts serializable value from a property.\n * @param v - The value to extract\n * @param depth - Current recursion depth\n * @returns Object with include flag and extracted value\n * @example\n */\nfunction extractPropertyValue(\n  v: unknown,\n  depth: number\n): { include: boolean; value: unknown } {\n  if (v === null || v === undefined) return { include: true, value: v };\n  if (typeof v !== 'object') return { include: true, value: v };\n  if (Array.isArray(v) && (v.length === 0 || typeof v[0] !== 'object')) {\n    return { include: true, value: v };\n  }\n  if (!Array.isArray(v)) {\n    const nested = serializeObjectValue(v, depth + 1);\n    if (nested !== '[max depth]') return { include: true, value: nested };\n  }\n  return { include: false, value: null };\n}\n\n/**\n * Serializes an object value with fallback handling.\n * For complex objects that can't be directly serialized, extracts primitive values.\n *\n * @param value - The object to serialize\n * @param depth - Current recursion depth (max 3)\n * @returns Serialized representation of the value\n *\n * @example\n * serializeObjectValue({ x: 1, y: 2 }); // { x: 1, y: 2 }\n */\nfunction serializeObjectValue(value: unknown, depth = 0): unknown {\n  if (depth > 3) return '[max depth]';\n\n  // Try direct JSON serialization first\n  try {\n    return JSON.parse(JSON.stringify(value)) as unknown;\n  } catch {\n    // Fall through to manual extraction\n  }\n\n  if (typeof value !== 'object' || value === null) return value;\n\n  const obj = value as Record<string, unknown>;\n  const result: Record<string, unknown> = {};\n\n  for (const key of Object.keys(obj)) {\n    if (shouldSkipProperty(key, obj[key])) continue;\n    const { include, value: v } = extractPropertyValue(obj[key], depth);\n    if (include) result[key] = v;\n  }\n\n  return Object.keys(result).length > 0 ? result : '[complex object]';\n}\n\n/**\n * Extracts UID from a display object if available.\n * @param obj - The object to extract UID from\n * @returns The UID string or null\n * @example\n */\nfunction extractUid(obj: unknown): string | null {\n  if (obj && typeof obj === 'object') {\n    const o = obj as Record<string, unknown>;\n    const uid = o.uid ?? o.UID;\n    if (typeof uid === 'string') return uid;\n    if (typeof uid === 'number') return uid.toString();\n  }\n  return null;\n}\n\n/**\n * Serializes a component instance to a plain object.\n *\n * @param component - The component instance to serialize\n * @returns Plain object with component data\n *\n * @example\n * serializeComponent({ health: 100, _internal: {} }); // { health: 100 }\n */\nfunction serializeComponent(component: unknown): unknown {\n  if (component === null || component === undefined) {\n    return null;\n  }\n\n  const result: Record<string, unknown> = {};\n  const comp = component as Record<string, unknown>;\n\n  for (const key of Object.keys(comp)) {\n    const value = comp[key];\n    if (shouldSkipProperty(key, value)) {\n      continue;\n    }\n    // Convert view to viewUid reference\n    if (UID_REF_PROPERTIES.has(key)) {\n      const uid = extractUid(value);\n      if (uid !== null) {\n        result[`${key}Uid`] = uid;\n      }\n      continue;\n    }\n    if (value === null || typeof value !== 'object') {\n      result[key] = value;\n    } else if (Array.isArray(value)) {\n      result[key] = value;\n    } else {\n      result[key] = serializeObjectValue(value);\n    }\n  }\n\n  return result;\n}\n\n/** Entity shape for type casting. */\ninterface EntityShape {\n  UID?: string;\n  uid?: string;\n  constructor?: { name: string };\n  position?: { x: number; y: number };\n  scale?: { x: number; y: number };\n  rotation?: number;\n  visible?: boolean;\n  alpha?: number;\n  view?: {\n    getBounds?: () => { x: number; y: number; width: number; height: number };\n    children?: unknown[];\n  };\n  c?: Map<string, unknown> | Record<string, unknown>;\n  components?: Map<string, unknown> | Record<string, unknown>;\n}\n\n/**\n * Extracts and serializes components from an entity.\n *\n * @param e - The entity shape\n * @returns Serialized components object\n *\n * @example\n * const components = extractComponents(entity);\n */\nfunction extractComponents(e: EntityShape): Record<string, unknown> {\n  const components: Record<string, unknown> = {};\n  const source = e.c ?? e.components;\n  if (source instanceof Map) {\n    source.forEach((c, name) => {\n      components[name] = serializeComponent(c);\n    });\n  } else if (source && typeof source === 'object') {\n    for (const [name, c] of Object.entries(source)) {\n      components[name] = serializeComponent(c);\n    }\n  }\n  return components;\n}\n\n/**\n * Gets the bounds of an entity's view safely.\n *\n * @param e - The entity shape\n * @returns Bounds object or null\n *\n * @example\n * const bounds = getEntityBounds(entity);\n */\nfunction getEntityBounds(e: EntityShape): EntitySnapshot['bounds'] {\n  try {\n    if (e.view?.getBounds) {\n      const b = e.view.getBounds();\n      return { x: b.x, y: b.y, width: b.width, height: b.height };\n    }\n  } catch {\n    // Bounds calculation may fail\n  }\n  return null;\n}\n\n/**\n * Serializes an ODIE Entity2D to an EntitySnapshot.\n *\n * @param entity - The ODIE entity to serialize\n * @returns EntitySnapshot with serialized entity state\n *\n * @example\n * const snapshot = serializeEntity(entity);\n */\nfunction serializeEntity(entity: unknown): EntitySnapshot {\n  const e = entity as EntityShape;\n  return {\n    id: e.UID ?? e.uid ?? 'unknown',\n    type: e.constructor?.name ?? 'Entity',\n    position: { x: e.position?.x ?? 0, y: e.position?.y ?? 0 },\n    scale: { x: e.scale?.x ?? 1, y: e.scale?.y ?? 1 },\n    rotation: e.rotation ?? 0,\n    visible: e.visible ?? true,\n    alpha: e.alpha ?? 1,\n    bounds: getEntityBounds(e),\n    components: extractComponents(e),\n    childCount: e.view?.children?.length ?? 0,\n  };\n}\n\n/**\n * Gets all entities from a scene reference.\n *\n * @param sceneRef - The scene reference\n * @returns Array of serialized entity snapshots\n *\n * @example\n * const entities = getAllEntities(sceneRef);\n */\nfunction getAllEntities(sceneRef: unknown): EntitySnapshot[] {\n  if (!sceneRef) {\n    return [];\n  }\n  const scene = sceneRef as { allEntities?: { children?: unknown[] } };\n  const entities = scene.allEntities?.children ?? [];\n  return entities.map((entity) => serializeEntity(entity));\n}\n\n/**\n * Extracts system names from a Scene2D reference.\n *\n * ODIE Scene2D stores systems in an internal map. This function\n * attempts to extract system names via the NAME static property.\n *\n * @param sceneRef - The scene reference\n * @returns Array of system names, or empty array if unavailable\n *\n * @example\n * const systems = getSystemNames(sceneRef);\n * // Returns: ['screwPlacement', 'animation', 'screwInteraction', ...]\n */\nfunction getSystemNames(sceneRef: unknown): string[] {\n  if (!sceneRef) {\n    return [];\n  }\n\n  // ODIE Scene2D has a systems Map<string, System>\n  const scene = sceneRef as { systems?: Map<string, unknown> };\n  if (!scene.systems || !(scene.systems instanceof Map)) {\n    return [];\n  }\n\n  // The Map keys are the system names\n  return Array.from(scene.systems.keys());\n}\n\n/**\n * Creates an ECS access layer for the test harness.\n *\n * @returns ECSAccessInternal instance with query methods and scene setter\n *\n * @example\n * const ecsAccess = createECSAccess();\n * ecsAccess._setScene(scene);\n * const entities = ecsAccess.getEntities();\n */\nexport function createECSAccess(): ECSAccessInternal {\n  let sceneRef: unknown = null;\n\n  const getEntities = (): EntitySnapshot[] => getAllEntities(sceneRef);\n\n  const getEntity = (id: string): EntitySnapshot | null =>\n    getEntities().find((e) => String(e.id) === id) ?? null;\n\n  return {\n    getScene: (): unknown => sceneRef,\n    getEntities,\n    getEntity,\n    queryByComponent: (name: string): EntitySnapshot[] =>\n      getEntities().filter((e) => name in e.components),\n    getEntityCount: (): number => getEntities().length,\n    hasEntity: (id: string): boolean => getEntity(id) !== null,\n    getSystems: (): string[] => getSystemNames(sceneRef),\n    _setScene: (scene: unknown): void => {\n      sceneRef = scene;\n    },\n  };\n}\n","/**\n * Render Signature Generation\n *\n * This module creates deterministic snapshots of the render state that can\n * be used to detect changes between frames. The signature includes all\n * entity state and a hash for quick comparison.\n *\n * @example\n * // Check if render state changed\n * const sig1 = harness.getRenderSignature();\n * // ... perform action ...\n * const sig2 = harness.getRenderSignature();\n *\n * if (sig1.hash !== sig2.hash) {\n *   console.log('Render state changed');\n * }\n *\n * @module\n */\n\nimport type { EntitySnapshot, RenderSignature } from '../types';\n\n/** Frame counter for tracking render iterations */\nlet frameCounter = 0;\n\n/**\n * Creates a simple hash from a string using the djb2 algorithm.\n *\n * This provides fast, reasonably distributed hashes suitable for\n * quick equality comparisons (not cryptographic use).\n *\n * @param str - String to hash\n * @returns Hexadecimal hash string\n * @internal\n */\nfunction simpleHash(str: string): string {\n  let hash = 5381;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = (hash << 5) + hash + char; // hash * 33 + char\n    hash = hash & hash; // Convert to 32bit integer\n  }\n  // Convert to unsigned and then to hex\n  return (hash >>> 0).toString(16);\n}\n\n/**\n * Converts an entity snapshot to a deterministic string for hashing.\n *\n * The string includes all entity properties in a consistent order\n * to ensure the same entity state always produces the same string.\n *\n * @param entity - Entity snapshot to convert\n * @returns Deterministic string representation\n * @internal\n */\nfunction entityToHashString(entity: EntitySnapshot): string {\n  const pos = `${entity.position.x.toFixed(2)},${entity.position.y.toFixed(2)}`;\n  const scale = `${entity.scale.x.toFixed(2)},${entity.scale.y.toFixed(2)}`;\n  const rot = entity.rotation.toFixed(4);\n  const vis = entity.visible ? '1' : '0';\n  const alpha = entity.alpha.toFixed(2);\n\n  // Sort component keys for determinism\n  const componentKeys = Object.keys(entity.components).sort();\n  const componentsStr = componentKeys\n    .map((k) => `${k}:${JSON.stringify(entity.components[k])}`)\n    .join(';');\n\n  const idStr =\n    typeof entity.id === 'number' ? entity.id.toString() : entity.id;\n  return `${idStr}|${entity.type}|${pos}|${scale}|${rot}|${vis}|${alpha}|${componentsStr}`;\n}\n\n/**\n * Creates a render signature generator function.\n *\n * The generator captures the current state of all entities and produces\n * a RenderSignature object with a deterministic hash. This can be used\n * to detect state changes between calls.\n *\n * @param getEntities - Function that returns all entity snapshots\n * @param getSceneState - Function that returns current scene state\n * @param getSystems - Optional function that returns system names\n * @returns Function that generates RenderSignature on each call\n *\n * @example\n * const getRenderSignature = createRenderSignatureGenerator(\n *   () => ecsAccess.getEntities(),\n *   () => sceneState,\n *   () => ecsAccess.getSystems()\n * );\n *\n * const sig = getRenderSignature();\n * console.log(`Frame ${sig.frame}: ${sig.entityCount} entities, hash=${sig.hash}`);\n */\nexport function createRenderSignatureGenerator(\n  getEntities: () => EntitySnapshot[],\n  getSceneState: () => 'running' | 'paused' | 'stopped',\n  getSystems?: () => string[]\n): () => RenderSignature {\n  return (): RenderSignature => {\n    const entities = getEntities();\n    const timestamp = performance.now();\n    const currentFrame = frameCounter++;\n\n    // Sort entities by ID for deterministic ordering\n    // Handle both string and numeric IDs\n    const sortedEntities = [...entities].sort((a, b) => {\n      const aId = typeof a.id === 'number' ? a.id.toString() : a.id;\n      const bId = typeof b.id === 'number' ? b.id.toString() : b.id;\n      return aId.localeCompare(bId);\n    });\n\n    // Generate deterministic hash from entity state\n    const hashInput = sortedEntities.map(entityToHashString).join('||');\n    const hash = simpleHash(hashInput);\n\n    return {\n      timestamp,\n      frame: currentFrame,\n      entityCount: entities.length,\n      entities: sortedEntities,\n      systems: getSystems?.() ?? [],\n      sceneState: getSceneState(),\n      hash,\n    };\n  };\n}\n\n/**\n * Resets the frame counter to zero.\n *\n * Useful for unit tests that need deterministic frame numbers.\n * Not typically needed in E2E tests.\n *\n * @example\n * // In unit test setup\n * beforeEach(() => {\n *   resetFrameCounter();\n * });\n */\nexport function resetFrameCounter(): void {\n  frameCounter = 0;\n}\n","/**\n * Action DSL Executor for Test Harness\n *\n * This module implements the action execution system that allows E2E tests\n * to manipulate game state and simulate user input. Actions are declarative\n * objects that describe what should happen.\n *\n * Supported action types:\n * - Entity manipulation: setPosition, setComponent, setVisible, destroyEntity\n * - Scene control: pause, resume, tick\n * - Input simulation: pointerDown, pointerUp, pointerMove, keyDown, keyUp\n * - Timing: wait\n *\n * @example\n * // Move an entity and wait\n * await harness.actMany([\n *   { type: 'setPosition', entityId: '123', x: 100, y: 200 },\n *   { type: 'wait', ms: 100 }\n * ]);\n *\n * @module\n */\n\nimport type { TestAction, ActionResult, RecordedAction } from '../types';\n\n// ============================================================================\n// Action Recording for Bug Reports\n// ============================================================================\n\n/** Maximum number of actions to retain in the recording buffer */\nconst MAX_RECORDED_ACTIONS = 200;\n\n/** Storage for recorded actions */\nlet recordedActions: RecordedAction[] = [];\n\n/**\n * Record an action for later inclusion in bug reports.\n * Only records pointer and keyboard actions (not entity manipulation).\n *\n * @param action - The action that was executed\n * @internal\n */\nfunction recordAction(action: TestAction): void {\n  // Only record user input actions, not entity manipulation\n  const inputTypes = [\n    'pointerDown',\n    'pointerUp',\n    'pointerMove',\n    'keyDown',\n    'keyUp',\n  ];\n  if (!inputTypes.includes(action.type)) {\n    return;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  const tick = window.__gameTest?.tick?.current ?? -1;\n  const entry: RecordedAction = {\n    action,\n    tick,\n    timestamp: performance.now(),\n  };\n\n  recordedActions.push(entry);\n\n  // Trim to max size (circular buffer behavior)\n  if (recordedActions.length > MAX_RECORDED_ACTIONS) {\n    recordedActions = recordedActions.slice(-MAX_RECORDED_ACTIONS);\n  }\n}\n\n/**\n * Get a copy of all recorded actions.\n * Used for including user input history in bug reports.\n *\n * @returns Array of recorded action entries\n *\n * @example\n * const actions = getRecordedActions();\n * console.log(`Recorded ${actions.length} user actions`);\n */\nexport function getRecordedActions(): RecordedAction[] {\n  return [...recordedActions];\n}\n\n/**\n * Clear all recorded actions.\n *\n * @example\n * // Clear after submitting bug report\n * clearRecordedActions();\n */\nexport function clearRecordedActions(): void {\n  recordedActions = [];\n}\n\n/**\n * Finds an entity by ID in the ODIE scene.\n *\n * @param scene - ODIE Scene2D instance\n * @param entityId - Entity ID to find\n * @returns Entity or null if not found\n *\n * @example\n * const entity = findEntity(scene, '123');\n */\nfunction findEntity(scene: unknown, entityId: string | number): unknown {\n  const s = scene as { allEntities?: { children?: unknown[] } };\n  const entities = s.allEntities?.children ?? [];\n  const targetId =\n    typeof entityId === 'number' ? entityId.toString() : entityId;\n\n  return (\n    entities.find((e: unknown) => {\n      const entity = e as { UID?: string | number; uid?: string };\n      const id = entity.UID ?? entity.uid;\n      const idStr = typeof id === 'number' ? id.toString() : id;\n      return idStr === targetId;\n    }) ?? null\n  );\n}\n\n/**\n * Gets a component from an entity by name.\n *\n * @param entity - The entity to query\n * @param componentName - Name of the component\n * @returns The component or null if not found\n *\n * @example\n * const health = getEntityComponent(entity, 'health');\n */\nfunction getEntityComponent(entity: unknown, componentName: string): unknown {\n  const e = entity as {\n    c?: Record<string, unknown>;\n    components?: Map<string, unknown>;\n  };\n  const source = e.c ?? e.components;\n  if (!source) {\n    return null;\n  }\n  if (source instanceof Map) {\n    return source.get(componentName) ?? null;\n  }\n  return source[componentName] ?? null;\n}\n\n/**\n * Executes a setPosition action on an entity.\n *\n * @param scene - The ODIE scene\n * @param entityId - Target entity ID\n * @param x - New X position\n * @param y - New Y position\n * @returns Action result indicating success or failure\n *\n * @example\n * executeSetPosition(scene, '123', 100, 200);\n */\nfunction executeSetPosition(\n  scene: unknown,\n  entityId: string,\n  x: number,\n  y: number\n): ActionResult {\n  if (!scene) {\n    return { success: false, error: 'Scene not available' };\n  }\n  const entity = findEntity(scene, entityId);\n  if (!entity) {\n    return { success: false, error: `Entity ${entityId} not found` };\n  }\n  const e = entity as { position?: { set: (x: number, y: number) => void } };\n  if (!e.position?.set) {\n    return { success: false, error: 'Entity has no position property' };\n  }\n  e.position.set(x, y);\n  return { success: true };\n}\n\n/**\n * Executes a setComponent action to update component data.\n *\n * @param scene - The ODIE scene\n * @param entityId - Target entity ID\n * @param componentName - Name of the component to update\n * @param data - Data to merge into the component\n * @returns Action result indicating success or failure\n *\n * @example\n * executeSetComponent(scene, '123', 'health', { current: 50 });\n */\nfunction executeSetComponent(\n  scene: unknown,\n  entityId: string,\n  componentName: string,\n  data: Record<string, unknown>\n): ActionResult {\n  if (!scene) {\n    return { success: false, error: 'Scene not available' };\n  }\n  const entity = findEntity(scene, entityId);\n  if (!entity) {\n    return { success: false, error: `Entity ${entityId} not found` };\n  }\n  const component = getEntityComponent(entity, componentName);\n  if (!component) {\n    return { success: false, error: `Component ${componentName} not found` };\n  }\n  Object.assign(component, data);\n  return { success: true };\n}\n\n/**\n * Executes a setVisible action on an entity.\n *\n * @param scene - The ODIE scene\n * @param entityId - Target entity ID\n * @param visible - New visibility state\n * @returns Action result indicating success or failure\n *\n * @example\n * executeSetVisible(scene, '123', false);\n */\nfunction executeSetVisible(\n  scene: unknown,\n  entityId: string,\n  visible: boolean\n): ActionResult {\n  if (!scene) {\n    return { success: false, error: 'Scene not available' };\n  }\n  const entity = findEntity(scene, entityId);\n  if (!entity) {\n    return { success: false, error: `Entity ${entityId} not found` };\n  }\n  (entity as { visible?: boolean }).visible = visible;\n  return { success: true };\n}\n\n/**\n * Executes a destroyEntity action.\n *\n * @param scene - The ODIE scene\n * @param entityId - Target entity ID to destroy\n * @returns Action result indicating success or failure\n *\n * @example\n * executeDestroyEntity(scene, '123');\n */\nfunction executeDestroyEntity(scene: unknown, entityId: string): ActionResult {\n  if (!scene) {\n    return { success: false, error: 'Scene not available' };\n  }\n  const entity = findEntity(scene, entityId);\n  if (!entity) {\n    return { success: false, error: `Entity ${entityId} not found` };\n  }\n  const s = scene as { removeChild?: (entity: unknown) => void };\n  if (!s.removeChild) {\n    return { success: false, error: 'Scene has no removeChild method' };\n  }\n  s.removeChild(entity);\n  return { success: true };\n}\n\n/**\n * Executes a pause action on the scene.\n *\n * @param scene - The ODIE scene to pause\n * @returns Action result indicating success or failure\n *\n * @example\n * executePause(scene);\n */\nfunction executePause(scene: unknown): ActionResult {\n  if (!scene) {\n    return { success: false, error: 'Scene not available' };\n  }\n  (scene as { paused?: boolean }).paused = true;\n  return { success: true };\n}\n\n/**\n * Executes a resume action on the scene.\n *\n * @param scene - The ODIE scene to resume\n * @returns Action result indicating success or failure\n *\n * @example\n * executeResume(scene);\n */\nfunction executeResume(scene: unknown): ActionResult {\n  if (!scene) {\n    return { success: false, error: 'Scene not available' };\n  }\n  (scene as { paused?: boolean }).paused = false;\n  return { success: true };\n}\n\n/**\n * Executes a tick action to manually advance the scene.\n *\n * @param scene - The ODIE scene\n * @param deltaMs - Time delta in milliseconds\n * @returns Action result indicating success or failure\n *\n * @example\n * executeTick(scene, 16.67);\n */\nfunction executeTick(scene: unknown, deltaMs: number): ActionResult {\n  if (!scene) {\n    return { success: false, error: 'Scene not available' };\n  }\n  const s = scene as { update?: (delta: number) => void };\n  if (!s.update) {\n    return { success: false, error: 'Scene has no update method' };\n  }\n  s.update(deltaMs);\n  return { success: true };\n}\n\n/**\n * Executes a pointer event on the canvas.\n *\n * Coordinates are in game-space (logical canvas coordinates). These are\n * automatically scaled to screen-space based on the canvas's display size\n * vs its logical dimensions.\n *\n * @param eventType - Type of pointer event\n * @param canvas - Target canvas element\n * @param x - X coordinate in game-space (logical canvas coordinates)\n * @param y - Y coordinate in game-space (logical canvas coordinates)\n * @param button - Mouse button (default 0)\n * @returns Action result indicating success or failure\n *\n * @example\n * executePointerEvent('pointerdown', canvas, 100, 200, 0);\n */\nfunction executePointerEvent(\n  eventType: 'pointerdown' | 'pointerup' | 'pointermove',\n  canvas: HTMLCanvasElement | null,\n  x: number,\n  y: number,\n  button?: number\n): ActionResult {\n  if (!canvas) {\n    return { success: false, error: 'Canvas not available' };\n  }\n  const rect = canvas.getBoundingClientRect();\n\n  // Scale game-space coordinates to screen-space\n  // canvas.width/height = logical (game) dimensions\n  // rect.width/height = actual display dimensions\n  const scaleX = rect.width / canvas.width;\n  const scaleY = rect.height / canvas.height;\n  const screenX = x * scaleX;\n  const screenY = y * scaleY;\n\n  const event = new PointerEvent(eventType, {\n    bubbles: true,\n    cancelable: true,\n    clientX: rect.left + screenX,\n    clientY: rect.top + screenY,\n    button: button ?? 0,\n    pointerType: 'mouse',\n  });\n  canvas.dispatchEvent(event);\n  return { success: true };\n}\n\n/**\n * Executes a keyboard event.\n *\n * @param eventType - Type of keyboard event\n * @param key - The key value\n * @param code - The key code\n * @returns Action result indicating success or failure\n *\n * @example\n * executeKeyEvent('keydown', ' ', 'Space');\n */\nfunction executeKeyEvent(\n  eventType: 'keydown' | 'keyup',\n  key: string,\n  code: string\n): ActionResult {\n  const event = new KeyboardEvent(eventType, {\n    bubbles: true,\n    cancelable: true,\n    key,\n    code,\n  });\n  window.dispatchEvent(event);\n  return { success: true };\n}\n\n/**\n * Dispatches entity-related actions.\n *\n * @param action - The entity action to dispatch\n * @param scene - The current scene\n * @returns Action result or null if not an entity action\n *\n * @example\n * const result = dispatchEntityAction(action, scene);\n */\nfunction dispatchEntityAction(\n  action: TestAction,\n  scene: unknown\n): ActionResult | null {\n  switch (action.type) {\n    case 'setPosition':\n      return executeSetPosition(scene, action.entityId, action.x, action.y);\n    case 'setComponent':\n      return executeSetComponent(\n        scene,\n        action.entityId,\n        action.component,\n        action.data\n      );\n    case 'setVisible':\n      return executeSetVisible(scene, action.entityId, action.visible);\n    case 'destroyEntity':\n      return executeDestroyEntity(scene, action.entityId);\n    case 'pause':\n      return executePause(scene);\n    case 'resume':\n      return executeResume(scene);\n    case 'tick':\n      return executeTick(scene, action.deltaMs);\n    default:\n      return null;\n  }\n}\n\n/**\n * Dispatches pointer actions to the canvas.\n *\n * @param action - The pointer action\n * @param canvas - The canvas element\n * @returns Action result or null if not a pointer action\n * @internal\n */\nfunction dispatchPointerAction(\n  action: TestAction,\n  canvas: HTMLCanvasElement | null\n): ActionResult | null {\n  switch (action.type) {\n    case 'pointerDown':\n      return executePointerEvent(\n        'pointerdown',\n        canvas,\n        action.x,\n        action.y,\n        action.button\n      );\n    case 'pointerUp':\n      return executePointerEvent(\n        'pointerup',\n        canvas,\n        action.x,\n        action.y,\n        action.button\n      );\n    case 'pointerMove':\n      return executePointerEvent('pointermove', canvas, action.x, action.y, 0);\n    default:\n      return null;\n  }\n}\n\n/**\n * Dispatches input-related actions.\n *\n * @param action - The input action to dispatch\n * @param canvas - The canvas element\n * @returns Action result or null if not an input action\n *\n * @example\n * const result = await dispatchInputAction(action, canvas);\n */\nasync function dispatchInputAction(\n  action: TestAction,\n  canvas: HTMLCanvasElement | null\n): Promise<ActionResult | null> {\n  const pointerResult = dispatchPointerAction(action, canvas);\n  if (pointerResult) {\n    return pointerResult;\n  }\n  switch (action.type) {\n    case 'keyDown':\n      return executeKeyEvent('keydown', action.key, action.code);\n    case 'keyUp':\n      return executeKeyEvent('keyup', action.key, action.code);\n    case 'wait':\n      await new Promise((resolve) => setTimeout(resolve, action.ms));\n      return { success: true };\n    default:\n      return null;\n  }\n}\n\n/**\n * Dispatches an action to the appropriate executor.\n *\n * @param action - The action to dispatch\n * @param getScene - Function to get the current scene\n * @param getCanvas - Function to get the canvas element\n * @returns Promise resolving to action result\n *\n * @example\n * const result = await dispatchAction(action, getScene, getCanvas);\n */\nasync function dispatchAction(\n  action: TestAction,\n  getScene: () => unknown,\n  getCanvas: () => HTMLCanvasElement | null\n): Promise<ActionResult> {\n  const entityResult = dispatchEntityAction(action, getScene());\n  if (entityResult) {\n    return entityResult;\n  }\n  const inputResult = await dispatchInputAction(action, getCanvas());\n  if (inputResult) {\n    return inputResult;\n  }\n  return { success: false, error: `Unknown action type: ${action.type}` };\n}\n\n/**\n * Creates an action executor function for the test harness.\n *\n * The executor handles all TestAction types, executing them against\n * the scene and canvas. Each action returns an ActionResult indicating\n * success or failure.\n *\n * @param getScene - Function that returns the ODIE scene\n * @param getCanvas - Function that returns the game canvas element\n * @returns Async function that executes TestActions\n *\n * @example\n * const executeAction = createActionExecutor(\n *   () => ecsAccess.getScene(),\n *   () => document.querySelector('canvas')\n * );\n *\n * const result = await executeAction({ type: 'pause' });\n * if (!result.success) {\n *   console.error('Failed:', result.error);\n * }\n */\nexport function createActionExecutor(\n  getScene: () => unknown,\n  getCanvas: () => HTMLCanvasElement | null\n): (action: TestAction) => Promise<ActionResult> {\n  return async (action: TestAction): Promise<ActionResult> => {\n    try {\n      // Record action for bug reports (only records user input actions)\n      recordAction(action);\n      return await dispatchAction(action, getScene, getCanvas);\n    } catch (err) {\n      return {\n        success: false,\n        error: err instanceof Error ? err.message : String(err),\n      };\n    }\n  };\n}\n","/**\n * Console Log Capture System\n *\n * This module captures all console output (log, warn, error) into an array\n * for inclusion in bug reports. Each log entry includes the message type,\n * timestamp, current game tick, and stringified arguments.\n *\n * @example\n * // Initialize early in app startup\n * initConsoleCapture();\n *\n * // Later, get all captured logs\n * const logs = getCapturedLogs();\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-returns, jsdoc/require-param, jsdoc/require-example */\n/* eslint-disable no-console */\n\n/**\n * Represents a captured console log entry.\n */\nexport interface CapturedLog {\n  /** Log type: log, warn, or error */\n  type: 'log' | 'warn' | 'error';\n  /** Performance timestamp when the log occurred (ms since page load) */\n  timestamp: number;\n  /** Game tick number when the log occurred (-1 if not available) */\n  tick: number;\n  /** Stringified log arguments */\n  args: string[];\n}\n\n/** Maximum number of logs to retain */\nconst MAX_LOGS = 1000;\n\n/** Storage for captured logs */\nlet capturedLogs: CapturedLog[] = [];\n\n/** Original console methods (saved before override) */\nlet originalConsole: {\n  log: typeof console.log;\n  warn: typeof console.warn;\n  error: typeof console.error;\n} | null = null;\n\n/** Whether capture has been initialized */\nlet isInitialized = false;\n\n/**\n * Safely stringify a value for logging.\n * Handles circular references and non-serializable values.\n */\nfunction safeStringify(obj: unknown): string {\n  try {\n    if (typeof obj === 'object' && obj !== null) {\n      return JSON.stringify(obj, null, 2);\n    }\n    return String(obj);\n  } catch {\n    // Handle circular references\n    return Object.prototype.toString.call(obj);\n  }\n}\n\n/**\n * Get the current game tick from the test harness.\n * Returns -1 if not available.\n */\nfunction getCurrentTick(): number {\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  return window.__gameTest?.tick?.current ?? -1;\n}\n\n/**\n * Add a log entry to the captured logs array.\n * Removes oldest entries if exceeding MAX_LOGS.\n */\nfunction addLog(type: CapturedLog['type'], args: unknown[]): void {\n  const entry: CapturedLog = {\n    type,\n    timestamp: performance.now(),\n    tick: getCurrentTick(),\n    args: args.map(safeStringify),\n  };\n\n  capturedLogs.push(entry);\n\n  // Trim to max size\n  if (capturedLogs.length > MAX_LOGS) {\n    capturedLogs = capturedLogs.slice(-MAX_LOGS);\n  }\n}\n\n/**\n * Initialize console capture by overriding console methods.\n * Safe to call multiple times - only initializes once.\n *\n * @example\n * // Call early in app initialization\n * initConsoleCapture();\n */\nexport function initConsoleCapture(): void {\n  if (isInitialized) {\n    return;\n  }\n\n  // Save original methods\n  originalConsole = {\n    log: console.log.bind(console),\n    warn: console.warn.bind(console),\n    error: console.error.bind(console),\n  };\n\n  // Override console.log\n  console.log = (...args: unknown[]): void => {\n    originalConsole?.log(...args);\n    addLog('log', args);\n  };\n\n  // Override console.warn\n  console.warn = (...args: unknown[]): void => {\n    originalConsole?.warn(...args);\n    addLog('warn', args);\n  };\n\n  // Override console.error\n  console.error = (...args: unknown[]): void => {\n    originalConsole?.error(...args);\n    addLog('error', args);\n  };\n\n  isInitialized = true;\n}\n\n/**\n * Get a copy of all captured logs.\n *\n * @returns Array of captured log entries\n *\n * @example\n * const logs = getCapturedLogs();\n * console.log(`Captured ${logs.length} log entries`);\n */\nexport function getCapturedLogs(): CapturedLog[] {\n  return [...capturedLogs];\n}\n\n/**\n * Clear all captured logs.\n *\n * @example\n * // Clear logs after submitting bug report\n * clearCapturedLogs();\n */\nexport function clearCapturedLogs(): void {\n  capturedLogs = [];\n}\n\n/**\n * Get the original console methods (for direct logging that bypasses capture).\n * Returns null if capture hasn't been initialized.\n *\n * @example\n * const original = getOriginalConsole();\n * original?.log('This will not be captured');\n */\nexport function getOriginalConsole(): typeof originalConsole {\n  return originalConsole;\n}\n\n/**\n * Format captured logs as a text string for saving to file.\n *\n * @returns Formatted log text with timestamps and tick numbers\n *\n * @example\n * const logText = formatLogsAsText();\n * await fs.writeFile('console-log.txt', logText);\n */\nexport function formatLogsAsText(): string {\n  return capturedLogs\n    .map((log) => {\n      const tickStr = log.tick >= 0 ? `T${String(log.tick)}` : '---';\n      const timeStr = log.timestamp.toFixed(0).padStart(8);\n      const typeStr = log.type.toUpperCase().padEnd(5);\n      const message = log.args.join(' ');\n      return `[${timeStr}ms] [${tickStr}] [${typeStr}] ${message}`;\n    })\n    .join('\\n');\n}\n","/**\n * Bug Report Client\n *\n * This module provides functions to capture game state, screenshots, and logs,\n * then submit them to the Vite dev server for saving as bug reports.\n *\n * @example\n * // Show the bug report modal when user clicks \"Report Bug\"\n * import { showBugReportModal } from '@shared/debug/bugReport';\n * reportButton.onclick = () => showBugReportModal();\n *\n * @module\n */\n\n/* eslint-disable jsdoc/require-returns, jsdoc/require-param, jsdoc/require-example */\n/* eslint-disable max-lines-per-function */\n/* eslint-disable @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-call */\n/* eslint-disable @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-return */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n\nimport type { RecordedAction } from './types';\nimport { getCapturedLogs, type CapturedLog } from './consoleCapture';\nimport { getRecordedActions } from './harness/actionDsl';\n\n/**\n * Snapshot of a display object from the PixiJS render tree.\n */\nexport interface DisplayObjectSnapshot {\n  /** Type of the display object */\n  type: string;\n  /** PixiJS internal uid for this display object */\n  uid?: string;\n  /** Label/identifier (if available) */\n  label?: string;\n  /** Entity UID if this display object is an ODIE Entity2D */\n  entityUid?: string;\n  /** Position in world coordinates */\n  position: { x: number; y: number };\n  /** Scale */\n  scale: { x: number; y: number };\n  /** Rotation in radians */\n  rotation: number;\n  /** Visibility */\n  visible: boolean;\n  /** Alpha/opacity */\n  alpha: number;\n  /** Bounds (if calculable) */\n  bounds?: { x: number; y: number; width: number; height: number };\n  /** Texture key/path (for sprites) */\n  texture?: string;\n  /** Child display objects */\n  children?: DisplayObjectSnapshot[];\n}\n\n/**\n * Full render state including display tree and ECS entities.\n */\nexport interface RenderState {\n  /** Performance timestamp */\n  timestamp: number;\n  /** Display object hierarchy */\n  displayTree: DisplayObjectSnapshot;\n  /** Number of display objects in tree */\n  displayObjectCount: number;\n  /** ECS entity data (if test harness available) */\n  entities?: {\n    id: string;\n    type: string;\n    position: { x: number; y: number };\n    components: Record<string, unknown>;\n  }[];\n  /** Scene state */\n  sceneState: 'running' | 'paused' | 'stopped' | 'unknown';\n}\n\n/**\n * Complete bug report data structure.\n */\nexport interface BugReport {\n  /** ISO timestamp when the report was created */\n  timestamp: string;\n  /** Current URL including query parameters */\n  url: string;\n  /** Optional user description of the bug */\n  description?: string;\n  /** Base64-encoded PNG screenshot */\n  screenshot: string;\n  /** Full render state including display tree */\n  gameState: RenderState | null;\n  /** Captured console logs */\n  consoleLogs: CapturedLog[];\n  /** Recorded user actions */\n  userActions: RecordedAction[];\n}\n\n/**\n * Response from the bug report API endpoint.\n */\nexport interface BugReportResponse {\n  /** Whether the report was saved successfully */\n  success: boolean;\n  /** Path where the report was saved (on success) */\n  path?: string;\n  /** Error message (on failure) */\n  error?: string;\n}\n\n/**\n * Get the PixiJS renderer from the Astro app.\n * Dynamically imports to avoid circular dependency issues.\n */\nasync function getPixiRenderer(): Promise<any> {\n  try {\n    const { getApp } = await import('@app/bootstrap');\n    const { StagePlugin } = await import('@play-co/astro');\n    const app = getApp();\n    if (!app) return null;\n    const stage = app.get(StagePlugin);\n    return (stage as any).renderer ?? null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Get the PixiJS stage from the Astro app.\n */\nasync function getPixiStage(): Promise<any> {\n  try {\n    const { getApp } = await import('@app/bootstrap');\n    const { StagePlugin } = await import('@play-co/astro');\n    const app = getApp();\n    if (!app) return null;\n    const stage = app.get(StagePlugin);\n    return (stage as any).stage ?? null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Capture a screenshot of the game canvas using PixiJS extract.\n *\n * Uses renderer.extract.base64() for proper WebGL screenshot capture.\n * Falls back to canvas.toDataURL() if extract is unavailable.\n *\n * @returns Base64-encoded PNG data URL\n * @throws Error if canvas is not found\n *\n * @example\n * const screenshot = await captureScreenshot();\n */\nexport async function captureScreenshot(): Promise<string> {\n  // Try PixiJS renderer extract first (works with WebGL)\n  const renderer = await getPixiRenderer();\n  const stage = await getPixiStage();\n\n  if (renderer?.extract && stage) {\n    try {\n      // Use PixiJS extract to get base64 PNG\n      const base64 = await renderer.extract.base64(stage, 'image/png');\n      return base64;\n    } catch (error) {\n      // eslint-disable-next-line no-console\n      console.warn(\n        '[BugReport] Extract failed, falling back to toDataURL:',\n        error\n      );\n    }\n  }\n\n  // Fallback to direct canvas access\n  const canvas = document.querySelector<HTMLCanvasElement>('canvas');\n  if (!canvas) {\n    throw new Error('Canvas not found');\n  }\n\n  return canvas.toDataURL('image/png');\n}\n\n/**\n * Snapshot a PixiJS display object to a plain object.\n */\nfunction snapshotDisplayObject(\n  displayObject: any,\n  depth = 0,\n  maxDepth = 10\n): DisplayObjectSnapshot | null {\n  if (!displayObject || depth > maxDepth) return null;\n\n  const snapshot: DisplayObjectSnapshot = {\n    type: displayObject.constructor?.name ?? 'Unknown',\n    position: {\n      x: displayObject.x ?? 0,\n      y: displayObject.y ?? 0,\n    },\n    scale: {\n      x: displayObject.scale?.x ?? 1,\n      y: displayObject.scale?.y ?? 1,\n    },\n    rotation: displayObject.rotation ?? 0,\n    visible: displayObject.visible ?? true,\n    alpha: displayObject.alpha ?? 1,\n  };\n\n  // Add PixiJS internal uid for correlation with view2d.viewUid\n  if (displayObject.uid !== undefined) {\n    snapshot.uid = String(displayObject.uid);\n  }\n\n  // Add label if available\n  if (displayObject.label) {\n    snapshot.label = displayObject.label;\n  }\n\n  // Add entity UID if this is an ODIE Entity2D (has UID property)\n  if (displayObject.UID !== undefined) {\n    snapshot.entityUid = String(displayObject.UID);\n  }\n\n  // Try to get bounds\n  try {\n    if (typeof displayObject.getBounds === 'function') {\n      const b = displayObject.getBounds();\n      if (b && typeof b.x === 'number') {\n        snapshot.bounds = {\n          x: b.x,\n          y: b.y,\n          width: b.width,\n          height: b.height,\n        };\n      }\n    }\n  } catch {\n    // Ignore bounds errors\n  }\n\n  // Get texture info for sprites\n  if (displayObject.texture) {\n    const tex = displayObject.texture;\n    snapshot.texture = tex.label ?? tex.uid ?? 'texture';\n  }\n\n  // Process children\n  if (displayObject.children && displayObject.children.length > 0) {\n    const children: DisplayObjectSnapshot[] = [];\n    for (const child of displayObject.children) {\n      const childSnapshot = snapshotDisplayObject(child, depth + 1, maxDepth);\n      if (childSnapshot) {\n        children.push(childSnapshot);\n      }\n    }\n    if (children.length > 0) {\n      snapshot.children = children;\n    }\n  }\n\n  return snapshot;\n}\n\n/**\n * Count total display objects in a snapshot tree.\n */\nfunction countDisplayObjects(snapshot: DisplayObjectSnapshot): number {\n  let count = 1;\n  if (snapshot.children) {\n    for (const child of snapshot.children) {\n      count += countDisplayObjects(child);\n    }\n  }\n  return count;\n}\n\n/**\n * Capture the full render state including display tree.\n */\nasync function captureRenderState(): Promise<RenderState | null> {\n  const stage = await getPixiStage();\n  if (!stage) {\n    return null;\n  }\n\n  // Capture display tree\n  const displayTree = snapshotDisplayObject(stage);\n  if (!displayTree) {\n    return null;\n  }\n\n  // Get entity data from test harness if available\n  let entities: RenderState['entities'];\n  let sceneState: RenderState['sceneState'] = 'unknown';\n\n  if (window.__gameTest) {\n    const sig = window.__gameTest.getRenderSignature();\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    if (sig) {\n      sceneState = sig.sceneState;\n      entities = sig.entities.map((e) => ({\n        id: String(e.id),\n        type: e.type,\n        position: e.position,\n        components: e.components,\n      }));\n    }\n  }\n\n  const renderState: RenderState = {\n    timestamp: performance.now(),\n    displayTree,\n    displayObjectCount: countDisplayObjects(displayTree),\n    sceneState,\n  };\n\n  // Only add entities if they exist\n  if (entities) {\n    renderState.entities = entities;\n  }\n\n  return renderState;\n}\n\n/**\n * Collect all bug report data.\n *\n * @param description - Optional user description of the bug\n * @returns Complete bug report data\n *\n * @example\n * const report = await collectBugReport('Red screw went to wrong tray');\n */\nexport async function collectBugReport(\n  description?: string\n): Promise<BugReport> {\n  // Pause the game to capture stable state\n  await window.__gameTest?.act({ type: 'pause' });\n\n  // Capture screenshot using PixiJS extract\n  let screenshot = '';\n  try {\n    screenshot = await captureScreenshot();\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('[BugReport] Failed to capture screenshot:', error);\n  }\n\n  // Capture full render state including display tree\n  const gameState = await captureRenderState();\n\n  // Get console logs\n  const consoleLogs = getCapturedLogs();\n\n  // Get recorded user actions\n  const userActions = getRecordedActions();\n\n  // Resume the game\n  await window.__gameTest?.act({ type: 'resume' });\n\n  const report: BugReport = {\n    timestamp: new Date().toISOString(),\n    url: window.location.href,\n    screenshot,\n    gameState,\n    consoleLogs,\n    userActions,\n  };\n\n  // Only add description if provided\n  if (description) {\n    report.description = description;\n  }\n\n  return report;\n}\n\n/**\n * Submit a bug report to the dev server.\n *\n * @param report - The bug report to submit\n * @returns API response indicating success or failure\n *\n * @example\n * const report = await collectBugReport('Bug description');\n * const result = await submitBugReport(report);\n * if (result.success) {\n *   console.log('Report saved to:', result.path);\n * }\n */\nexport async function submitBugReport(\n  report: BugReport\n): Promise<BugReportResponse> {\n  try {\n    const response = await fetch('/__bug-report', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(report),\n    });\n\n    const result = (await response.json()) as BugReportResponse;\n    return result;\n  } catch (error) {\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n// ============================================================================\n// Bug Report Modal UI\n// ============================================================================\n\n/** Reference to the current modal element */\nlet currentModal: HTMLElement | null = null;\n\n/**\n * Create the modal overlay element.\n */\nfunction createModalOverlay(): HTMLDivElement {\n  const overlay = document.createElement('div');\n  overlay.style.cssText = `\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.7);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    z-index: 10000;\n  `;\n  return overlay;\n}\n\n/**\n * Create the modal content container.\n */\nfunction createModalContent(): HTMLDivElement {\n  const content = document.createElement('div');\n  content.style.cssText = `\n    background: #1a1a1a;\n    border: 1px solid #333;\n    border-radius: 8px;\n    padding: 20px;\n    width: 400px;\n    max-width: 90vw;\n    color: #fff;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  `;\n  return content;\n}\n\n/**\n * Create the modal title.\n */\nfunction createModalTitle(): HTMLHeadingElement {\n  const title = document.createElement('h2');\n  title.textContent = 'Report Bug';\n  title.style.cssText = `\n    margin: 0 0 16px 0;\n    font-size: 18px;\n    font-weight: 600;\n  `;\n  return title;\n}\n\n/**\n * Create the description textarea.\n */\nfunction createDescriptionTextarea(): HTMLTextAreaElement {\n  const textarea = document.createElement('textarea');\n  textarea.placeholder = 'Describe the bug (optional)...';\n  textarea.style.cssText = `\n    width: 100%;\n    height: 100px;\n    padding: 10px;\n    border: 1px solid #444;\n    border-radius: 4px;\n    background: #222;\n    color: #fff;\n    font-family: inherit;\n    font-size: 14px;\n    resize: vertical;\n    box-sizing: border-box;\n  `;\n  return textarea;\n}\n\n/**\n * Create a button element.\n */\nfunction createButton(text: string, isPrimary: boolean): HTMLButtonElement {\n  const button = document.createElement('button');\n  button.textContent = text;\n  button.style.cssText = `\n    padding: 8px 16px;\n    border: none;\n    border-radius: 4px;\n    font-size: 14px;\n    cursor: pointer;\n    transition: background 0.2s;\n    ${\n      isPrimary\n        ? 'background: #4CAF50; color: white;'\n        : 'background: #444; color: #ddd;'\n    }\n  `;\n  button.onmouseenter = (): void => {\n    button.style.background = isPrimary ? '#45a049' : '#555';\n  };\n  button.onmouseleave = (): void => {\n    button.style.background = isPrimary ? '#4CAF50' : '#444';\n  };\n  return button;\n}\n\n/**\n * Create the button container.\n */\nfunction createButtonContainer(): HTMLDivElement {\n  const container = document.createElement('div');\n  container.style.cssText = `\n    display: flex;\n    justify-content: flex-end;\n    gap: 10px;\n    margin-top: 16px;\n  `;\n  return container;\n}\n\n/**\n * Create the status message element.\n */\nfunction createStatusMessage(): HTMLDivElement {\n  const status = document.createElement('div');\n  status.style.cssText = `\n    margin-top: 12px;\n    padding: 10px;\n    border-radius: 4px;\n    font-size: 14px;\n    display: none;\n  `;\n  return status;\n}\n\n/**\n * Show a status message in the modal.\n */\nfunction showStatus(\n  element: HTMLDivElement,\n  message: string,\n  isError: boolean\n): void {\n  element.textContent = message;\n  element.style.display = 'block';\n  element.style.background = isError ? '#5c2020' : '#1e3a1e';\n  element.style.color = isError ? '#ff8080' : '#80ff80';\n}\n\n/**\n * Close and remove the modal.\n */\nfunction closeModal(): void {\n  if (currentModal) {\n    currentModal.remove();\n    currentModal = null;\n  }\n}\n\n/**\n * Show the bug report modal.\n * Allows user to add an optional description before submitting.\n *\n * @example\n * // Show modal when user clicks Report Bug button\n * reportButton.onclick = () => showBugReportModal();\n */\nexport function showBugReportModal(): void {\n  // Close any existing modal\n  closeModal();\n\n  // Create modal elements\n  const overlay = createModalOverlay();\n  const content = createModalContent();\n  const title = createModalTitle();\n  const textarea = createDescriptionTextarea();\n  const buttonContainer = createButtonContainer();\n  const cancelButton = createButton('Cancel', false);\n  const submitButton = createButton('Submit Report', true);\n  const statusMessage = createStatusMessage();\n\n  // Assemble modal\n  buttonContainer.appendChild(cancelButton);\n  buttonContainer.appendChild(submitButton);\n  content.appendChild(title);\n  content.appendChild(textarea);\n  content.appendChild(buttonContainer);\n  content.appendChild(statusMessage);\n  overlay.appendChild(content);\n\n  // Handle cancel\n  cancelButton.onclick = closeModal;\n  overlay.onclick = (e): void => {\n    if (e.target === overlay) {\n      closeModal();\n    }\n  };\n\n  // Handle submit\n  submitButton.onclick = async (): Promise<void> => {\n    // Disable buttons during submission\n    submitButton.disabled = true;\n    cancelButton.disabled = true;\n    submitButton.textContent = 'Submitting...';\n    submitButton.style.background = '#666';\n\n    try {\n      // Collect and submit report\n      const description = textarea.value.trim() || undefined;\n      const report = await collectBugReport(description);\n      const result = await submitBugReport(report);\n\n      if (result.success) {\n        showStatus(\n          statusMessage,\n          `Report saved to: ${result.path ?? 'unknown'}`,\n          false\n        );\n        // Auto-close after success\n        setTimeout(closeModal, 2000);\n      } else {\n        showStatus(\n          statusMessage,\n          `Error: ${result.error ?? 'Unknown error'}`,\n          true\n        );\n        // Re-enable buttons on error\n        submitButton.disabled = false;\n        cancelButton.disabled = false;\n        submitButton.textContent = 'Submit Report';\n        submitButton.style.background = '#4CAF50';\n      }\n    } catch (error) {\n      showStatus(\n        statusMessage,\n        `Error: ${error instanceof Error ? error.message : String(error)}`,\n        true\n      );\n      // Re-enable buttons on error\n      submitButton.disabled = false;\n      cancelButton.disabled = false;\n      submitButton.textContent = 'Submit Report';\n      submitButton.style.background = '#4CAF50';\n    }\n  };\n\n  // Add to DOM and focus textarea\n  document.body.appendChild(overlay);\n  currentModal = overlay;\n  textarea.focus();\n}\n","/**\n * Debug Console UI Component\n *\n * A floating, draggable debug console panel that displays console logs\n * and provides buttons for Copy, Clear, and Report Bug actions.\n *\n * @example\n * // Initialize in dev/test mode\n * import { createDebugConsole } from '@shared/debug/ui/debugConsole';\n *\n * const console = createDebugConsole();\n * document.body.appendChild(console);\n *\n * @module\n */\n\n/* eslint-disable max-lines-per-function */\n/* eslint-disable no-console */\n\nimport {\n  initConsoleCapture,\n  clearCapturedLogs,\n  getOriginalConsole,\n} from '../consoleCapture';\nimport { showBugReportModal } from '../bugReport';\n\n// ============================================================================\n// Constants\n// ============================================================================\n\nconst STORAGE_KEY = 'debugConsole';\nconst DEFAULT_WIDTH = 350;\nconst DEFAULT_HEIGHT = 200;\nconst HEADER_HEIGHT = 30;\nconst FOOTER_HEIGHT = 36;\n\n// ============================================================================\n// State Management\n// ============================================================================\n\ninterface ConsoleState {\n  x: number;\n  y: number;\n  minimized: boolean;\n  visible: boolean;\n}\n\nfunction loadState(): ConsoleState {\n  try {\n    const saved = localStorage.getItem(STORAGE_KEY);\n    if (saved) {\n      return JSON.parse(saved) as ConsoleState;\n    }\n  } catch {\n    // Ignore localStorage errors\n  }\n  return {\n    x: 10,\n    y: window.innerHeight - DEFAULT_HEIGHT - 10,\n    minimized: false,\n    visible: true,\n  };\n}\n\nfunction saveState(state: ConsoleState): void {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n  } catch {\n    // Ignore localStorage errors\n  }\n}\n\n// ============================================================================\n// DOM Creation Helpers\n// ============================================================================\n\nfunction createContainer(state: ConsoleState): HTMLDivElement {\n  const container = document.createElement('div');\n  container.id = 'debug-console';\n  const height = state.minimized ? HEADER_HEIGHT : DEFAULT_HEIGHT;\n  container.style.cssText = `\n    position: fixed;\n    left: ${String(state.x)}px;\n    top: ${String(state.y)}px;\n    width: ${String(DEFAULT_WIDTH)}px;\n    height: ${String(height)}px;\n    background: rgba(17, 17, 17, 0.95);\n    border: 1px solid #333;\n    border-radius: 6px;\n    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;\n    font-size: 11px;\n    z-index: 9999;\n    display: ${state.visible ? 'flex' : 'none'};\n    flex-direction: column;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);\n    overflow: hidden;\n  `;\n  return container;\n}\n\nfunction createHeader(): HTMLDivElement {\n  const header = document.createElement('div');\n  header.style.cssText = `\n    height: ${String(HEADER_HEIGHT)}px;\n    background: #222;\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 8px;\n    cursor: move;\n    user-select: none;\n    border-bottom: 1px solid #333;\n    flex-shrink: 0;\n  `;\n  return header;\n}\n\nfunction createHeaderTitle(): HTMLSpanElement {\n  const title = document.createElement('span');\n  title.textContent = 'Debug Console';\n  title.style.cssText = `\n    color: #888;\n    font-size: 12px;\n    font-weight: 500;\n  `;\n  return title;\n}\n\nfunction createHeaderButtons(): HTMLDivElement {\n  const buttons = document.createElement('div');\n  buttons.style.cssText = `\n    display: flex;\n    gap: 6px;\n  `;\n  return buttons;\n}\n\nfunction createHeaderButton(\n  symbol: string,\n  title: string,\n  onClick: () => void\n): HTMLButtonElement {\n  const button = document.createElement('button');\n  button.textContent = symbol;\n  button.title = title;\n  button.style.cssText = `\n    width: 20px;\n    height: 20px;\n    background: #333;\n    border: none;\n    border-radius: 3px;\n    color: #888;\n    font-size: 14px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    line-height: 1;\n  `;\n  button.onmouseenter = (): void => {\n    button.style.background = '#444';\n    button.style.color = '#fff';\n  };\n  button.onmouseleave = (): void => {\n    button.style.background = '#333';\n    button.style.color = '#888';\n  };\n  button.onclick = (e): void => {\n    e.stopPropagation();\n    onClick();\n  };\n  return button;\n}\n\nfunction createLogArea(): HTMLDivElement {\n  const logArea = document.createElement('div');\n  logArea.style.cssText = `\n    flex: 1;\n    overflow-y: auto;\n    overflow-x: hidden;\n    padding: 6px 8px;\n    color: #0f0;\n  `;\n  return logArea;\n}\n\nfunction createFooter(): HTMLDivElement {\n  const footer = document.createElement('div');\n  footer.style.cssText = `\n    height: ${String(FOOTER_HEIGHT)}px;\n    background: #222;\n    display: flex;\n    align-items: center;\n    justify-content: flex-end;\n    padding: 0 8px;\n    gap: 8px;\n    border-top: 1px solid #333;\n    flex-shrink: 0;\n  `;\n  return footer;\n}\n\nfunction createFooterButton(\n  text: string,\n  isPrimary: boolean,\n  onClick: () => void\n): HTMLButtonElement {\n  const button = document.createElement('button');\n  button.textContent = text;\n  button.style.cssText = `\n    padding: 4px 10px;\n    background: ${isPrimary ? '#2a5a2a' : '#333'};\n    border: 1px solid ${isPrimary ? '#3d7a3d' : '#444'};\n    border-radius: 4px;\n    color: ${isPrimary ? '#6f6' : '#aaa'};\n    font-family: inherit;\n    font-size: 11px;\n    cursor: pointer;\n  `;\n  button.onmouseenter = (): void => {\n    button.style.background = isPrimary ? '#3d7a3d' : '#444';\n    button.style.color = isPrimary ? '#8f8' : '#fff';\n  };\n  button.onmouseleave = (): void => {\n    button.style.background = isPrimary ? '#2a5a2a' : '#333';\n    button.style.color = isPrimary ? '#6f6' : '#aaa';\n  };\n  button.onclick = onClick;\n  return button;\n}\n\nfunction createLogLine(\n  type: 'log' | 'warn' | 'error',\n  message: string\n): HTMLDivElement {\n  const line = document.createElement('div');\n  line.style.cssText = `\n    color: ${type === 'error' ? '#f66' : type === 'warn' ? '#ff0' : '#0f0'};\n    word-wrap: break-word;\n    white-space: pre-wrap;\n    margin-bottom: 2px;\n    line-height: 1.4;\n  `;\n  const prefix = type === 'error' ? 'ERR' : type === 'warn' ? 'WRN' : 'LOG';\n  line.textContent = `[${prefix}] ${message}`;\n  return line;\n}\n\n// ============================================================================\n// Drag Handling\n// ============================================================================\n\nfunction setupDragging(\n  container: HTMLDivElement,\n  header: HTMLDivElement,\n  state: ConsoleState\n): void {\n  let isDragging = false;\n  let dragOffsetX = 0;\n  let dragOffsetY = 0;\n\n  // Helper to start drag\n  const startDrag = (clientX: number, clientY: number): void => {\n    isDragging = true;\n    dragOffsetX = clientX - state.x;\n    dragOffsetY = clientY - state.y;\n    document.body.style.userSelect = 'none';\n  };\n\n  // Helper to move during drag\n  const moveDrag = (clientX: number, clientY: number): void => {\n    if (!isDragging) return;\n    const newX = clientX - dragOffsetX;\n    const newY = clientY - dragOffsetY;\n\n    // Constrain to viewport\n    const maxX = window.innerWidth - container.offsetWidth;\n    const maxY = window.innerHeight - container.offsetHeight;\n    state.x = Math.max(0, Math.min(newX, maxX));\n    state.y = Math.max(0, Math.min(newY, maxY));\n\n    container.style.left = `${String(state.x)}px`;\n    container.style.top = `${String(state.y)}px`;\n  };\n\n  // Helper to end drag\n  const endDrag = (): void => {\n    if (isDragging) {\n      isDragging = false;\n      document.body.style.userSelect = '';\n      saveState(state);\n    }\n  };\n\n  // Mouse events (desktop)\n  header.addEventListener('mousedown', (e: MouseEvent): void => {\n    if ((e.target as HTMLElement).tagName === 'BUTTON') return;\n    e.preventDefault();\n    startDrag(e.clientX, e.clientY);\n  });\n\n  document.addEventListener('mousemove', (e: MouseEvent) => {\n    moveDrag(e.clientX, e.clientY);\n  });\n\n  document.addEventListener('mouseup', endDrag);\n\n  // Touch events (mobile/device emulation)\n  header.addEventListener(\n    'touchstart',\n    (e: TouchEvent): void => {\n      if ((e.target as HTMLElement).tagName === 'BUTTON') return;\n      const touch = e.touches[0];\n      if (!touch) return;\n      e.preventDefault();\n      startDrag(touch.clientX, touch.clientY);\n    },\n    { passive: false }\n  );\n\n  document.addEventListener(\n    'touchmove',\n    (e: TouchEvent) => {\n      if (!isDragging) return;\n      const touch = e.touches[0];\n      if (!touch) return;\n      e.preventDefault();\n      moveDrag(touch.clientX, touch.clientY);\n    },\n    { passive: false }\n  );\n\n  document.addEventListener('touchend', endDrag);\n  document.addEventListener('touchcancel', endDrag);\n}\n\n// ============================================================================\n// Keyboard Shortcut\n// ============================================================================\n\nfunction setupKeyboardShortcut(\n  container: HTMLDivElement,\n  state: ConsoleState\n): void {\n  document.addEventListener('keydown', (e) => {\n    // Backtick key toggles visibility\n    if (e.key === '`' && !e.ctrlKey && !e.metaKey && !e.altKey) {\n      const target = e.target as HTMLElement;\n      // Don't toggle if user is typing in an input/textarea\n      if (target.tagName === 'INPUT' || target.tagName === 'TEXTAREA') {\n        return;\n      }\n      state.visible = !state.visible;\n      container.style.display = state.visible ? 'flex' : 'none';\n      saveState(state);\n    }\n  });\n}\n\n// ============================================================================\n// Log Display Management\n// ============================================================================\n\ninterface LogDisplayManager {\n  addLog: (type: 'log' | 'warn' | 'error', message: string) => void;\n  clear: () => void;\n  getLogText: () => string;\n}\n\nfunction createLogDisplayManager(logArea: HTMLDivElement): LogDisplayManager {\n  const logLines: HTMLDivElement[] = [];\n  const MAX_DISPLAY_LOGS = 500;\n\n  return {\n    addLog(type: 'log' | 'warn' | 'error', message: string): void {\n      const line = createLogLine(type, message);\n      logArea.appendChild(line);\n      logLines.push(line);\n\n      // Trim old logs\n      while (logLines.length > MAX_DISPLAY_LOGS) {\n        const oldLine = logLines.shift();\n        oldLine?.remove();\n      }\n\n      // Auto-scroll to bottom\n      logArea.scrollTop = logArea.scrollHeight;\n    },\n\n    clear(): void {\n      logArea.innerHTML = '';\n      logLines.length = 0;\n    },\n\n    getLogText(): string {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      return logLines.map((line) => line.textContent ?? '').join('\\n');\n    },\n  };\n}\n\n// ============================================================================\n// Console Override Integration\n// ============================================================================\n\nfunction setupConsoleIntegration(logManager: LogDisplayManager): void {\n  // Initialize console capture first\n  initConsoleCapture();\n\n  // Get original console for our own logging\n  const original = getOriginalConsole();\n\n  // Now override again to also update the display\n  const prevLog = console.log;\n  const prevWarn = console.warn;\n  const prevError = console.error;\n\n  console.log = (...args: unknown[]): void => {\n    prevLog(...args);\n    const msg = args.map((a) => safeStringify(a)).join(' ');\n    logManager.addLog('log', msg);\n  };\n\n  console.warn = (...args: unknown[]): void => {\n    prevWarn(...args);\n    const msg = args.map((a) => safeStringify(a)).join(' ');\n    logManager.addLog('warn', msg);\n  };\n\n  console.error = (...args: unknown[]): void => {\n    prevError(...args);\n    const msg = args.map((a) => safeStringify(a)).join(' ');\n    logManager.addLog('error', msg);\n  };\n\n  // Log to original console that we're initialized\n  original?.log('[DebugConsole] Initialized - Press ` to toggle');\n}\n\nfunction safeStringify(obj: unknown): string {\n  try {\n    if (typeof obj === 'object' && obj !== null) {\n      return JSON.stringify(obj, null, 2);\n    }\n    return String(obj);\n  } catch {\n    return Object.prototype.toString.call(obj);\n  }\n}\n\n// ============================================================================\n// Main Export\n// ============================================================================\n\n/**\n * Create and return the debug console element.\n * Should be appended to document.body.\n *\n * @returns The debug console container element\n *\n * @example\n * if (import.meta.env.DEV || isTestMode()) {\n *   const console = createDebugConsole();\n *   document.body.appendChild(console);\n * }\n */\nexport function createDebugConsole(): HTMLDivElement {\n  // Load saved state\n  const state = loadState();\n\n  // Create DOM structure\n  const container = createContainer(state);\n  const header = createHeader();\n  const headerTitle = createHeaderTitle();\n  const headerButtons = createHeaderButtons();\n  const logArea = createLogArea();\n  const footer = createFooter();\n\n  // Create log manager\n  const logManager = createLogDisplayManager(logArea);\n\n  // Create header buttons\n  const minimizeBtn = createHeaderButton(\n    state.minimized ? '+' : '-',\n    'Minimize/Expand',\n    () => {\n      state.minimized = !state.minimized;\n      container.style.height = state.minimized\n        ? `${String(HEADER_HEIGHT)}px`\n        : `${String(DEFAULT_HEIGHT)}px`;\n      minimizeBtn.textContent = state.minimized ? '+' : '-';\n      logArea.style.display = state.minimized ? 'none' : 'block';\n      footer.style.display = state.minimized ? 'none' : 'flex';\n      saveState(state);\n    }\n  );\n\n  const closeBtn = createHeaderButton('x', 'Close (` to reopen)', () => {\n    state.visible = false;\n    container.style.display = 'none';\n    saveState(state);\n  });\n\n  // Create footer buttons\n  const copyBtn = createFooterButton('Copy', false, () => {\n    const text = logManager.getLogText();\n    void navigator.clipboard.writeText(text).then(() => {\n      const originalText = copyBtn.textContent;\n      copyBtn.textContent = 'Copied!';\n      setTimeout(() => {\n        copyBtn.textContent = originalText;\n      }, 1000);\n    });\n  });\n\n  const clearBtn = createFooterButton('Clear', false, () => {\n    logManager.clear();\n    clearCapturedLogs();\n  });\n\n  const reportBtn = createFooterButton('Report Bug', true, () => {\n    showBugReportModal();\n  });\n\n  // Assemble header\n  headerButtons.appendChild(minimizeBtn);\n  headerButtons.appendChild(closeBtn);\n  header.appendChild(headerTitle);\n  header.appendChild(headerButtons);\n\n  // Assemble footer\n  footer.appendChild(copyBtn);\n  footer.appendChild(clearBtn);\n  footer.appendChild(reportBtn);\n\n  // Assemble container\n  container.appendChild(header);\n  container.appendChild(logArea);\n  container.appendChild(footer);\n\n  // Apply minimized state\n  if (state.minimized) {\n    logArea.style.display = 'none';\n    footer.style.display = 'none';\n  }\n\n  // Setup behaviors\n  setupDragging(container, header, state);\n  setupKeyboardShortcut(container, state);\n  setupConsoleIntegration(logManager);\n\n  return container;\n}\n","/**\n * Game Test Harness Module\n *\n * Provides E2E testing infrastructure for the game application. The test harness\n * exposes game state and action simulation capabilities via `window.__gameTest`\n * for use with Playwright or other E2E testing frameworks.\n *\n * The harness is automatically initialized in dev mode or when the `testMode`\n * URL parameter is present.\n *\n * @example\n * // Initialize the harness in your app bootstrap\n * import { initTestHarness, markGameReady } from '@shared/debug';\n *\n * // Call early in bootstrap\n * initTestHarness();\n *\n * // ... initialize game ...\n *\n * // Call when game is ready\n * markGameReady('GameScene');\n *\n * @example\n * // Use in Playwright E2E tests\n * import { test, expect } from '@playwright/test';\n *\n * test('game initializes correctly', async ({ page }) => {\n *   await page.goto('/?testMode');\n *\n *   // Wait for game to be ready\n *   await page.waitForFunction(() => window.__gameTest?.ready);\n *\n *   // Verify no errors\n *   const errors = await page.evaluate(() => window.__gameTest?.errors);\n *   expect(errors).toHaveLength(0);\n *\n *   // Query entities\n *   const entities = await page.evaluate(() =>\n *     window.__gameTest?.ecs.getEntities()\n *   );\n *   expect(entities?.length).toBeGreaterThan(0);\n * });\n *\n * @module\n */\n\nimport type {\n  GameTestHarness,\n  GameTestError,\n  TestAction,\n  ActionResult,\n  TickAccess,\n} from './types';\nimport { setupErrorCapture } from './errorCapture';\nimport { isTestMode, getTestParams } from './urlParams';\nimport {\n  createECSAccess,\n  createRenderSignatureGenerator,\n  createActionExecutor,\n} from './harness';\n\n/** Reference to gameTick, set via registerTickCounter */\nlet tickCounterRef: TickAccess | null = null;\n\n/**\n * Creates a tick access wrapper.\n * Returns a proxy that delegates to the registered tick counter.\n * @returns TickAccess interface\n * @example\n * const tick = createTickAccess();\n * console.log(tick.current); // 42\n */\nfunction createTickAccess(): TickAccess {\n  return {\n    get current(): number {\n      return tickCounterRef?.current ?? 0;\n    },\n    reset(): void {\n      tickCounterRef?.reset();\n    },\n    setLoggingEnabled(enabled: boolean): void {\n      tickCounterRef?.setLoggingEnabled(enabled);\n    },\n  };\n}\n\n/**\n * Register the gameTick counter with the test harness.\n * Called by GameScene or TickSystem to expose tick counter to E2E tests.\n *\n * @param tick - The gameTick object from game utils\n *\n * @example\n * import { registerTickCounter } from '@shared/debug';\n * import { gameTick } from './utils';\n *\n * registerTickCounter(gameTick);\n */\nexport function registerTickCounter(tick: TickAccess): void {\n  tickCounterRef = tick;\n}\n\nexport type {\n  GameTestHarness,\n  GameTestError,\n  TestAction,\n  ActionResult,\n  EntitySnapshot,\n  RenderSignature,\n  ECSAccess,\n  TickAccess,\n  RecordedAction,\n} from './types';\nexport { getTestParams, isTestMode } from './urlParams';\n\n// Console capture exports\nexport {\n  initConsoleCapture,\n  getCapturedLogs,\n  clearCapturedLogs,\n  formatLogsAsText,\n  type CapturedLog,\n} from './consoleCapture';\n\n// Action recording exports\nexport { getRecordedActions, clearRecordedActions } from './harness/actionDsl';\n\n// Bug report exports\nexport {\n  captureScreenshot,\n  collectBugReport,\n  submitBugReport,\n  showBugReportModal,\n  type BugReport,\n  type BugReportResponse,\n  type RenderState,\n  type DisplayObjectSnapshot,\n} from './bugReport';\n\n// Debug console UI\nexport { createDebugConsole } from './ui/debugConsole';\n\n/** Internal state for the harness. */\ninterface HarnessState {\n  errors: GameTestError[];\n  ready: boolean;\n  scene: string;\n  bootStartTime: number;\n  bootEndTime: number | undefined;\n  sceneState: 'running' | 'paused' | 'stopped';\n}\n\n/**\n * Creates harness action methods.\n *\n * @param state - The harness state object\n * @param executeAction - Action executor function\n * @returns Object with action methods\n *\n * @example\n * const actions = createActionMethods(state, executeAction);\n */\nfunction createActionMethods(\n  state: HarnessState,\n  executeAction: (action: TestAction) => Promise<ActionResult>\n): Pick<GameTestHarness, 'act' | 'actMany'> {\n  const act = async (action: TestAction): Promise<ActionResult> => {\n    if (action.type === 'pause') {\n      state.sceneState = 'paused';\n    } else if (action.type === 'resume') {\n      state.sceneState = 'running';\n    }\n    return executeAction(action);\n  };\n\n  return {\n    act,\n    async actMany(actions: TestAction[]): Promise<ActionResult[]> {\n      const results: ActionResult[] = [];\n      for (const a of actions) {\n        results.push(await act(a));\n      }\n      return results;\n    },\n  };\n}\n\n/**\n * Creates snapshot and error capture methods.\n *\n * @param state - The harness state\n * @returns Object with snapshot and captureError methods\n * @internal\n */\nfunction createSnapshotMethods(\n  state: HarnessState\n): Pick<GameTestHarness, 'captureError' | 'snapshot'> {\n  return {\n    captureError(error: Error | string, source?: string): void {\n      state.errors.push({\n        message: error instanceof Error ? error.message : error,\n        stack: error instanceof Error ? error.stack : undefined,\n        timestamp: performance.now(),\n        source,\n      });\n    },\n    snapshot: () => ({\n      ready: state.ready,\n      scene: state.scene,\n      errors: [...state.errors],\n      bootTimeMs: state.bootEndTime\n        ? state.bootEndTime - state.bootStartTime\n        : undefined,\n    }),\n  };\n}\n\n/**\n * Creates harness lifecycle methods.\n *\n * @param state - The harness state\n * @param ecsAccess - The ECS access layer\n * @returns Object with lifecycle methods\n *\n * @example\n * const lifecycle = createLifecycleMethods(state, ecsAccess);\n */\nfunction createLifecycleMethods(\n  state: HarnessState,\n  ecsAccess: ReturnType<typeof createECSAccess>\n): Pick<\n  GameTestHarness,\n  'markReady' | 'captureError' | 'snapshot' | 'registerScene'\n> {\n  return {\n    markReady(sceneName: string): void {\n      state.ready = true;\n      state.scene = sceneName;\n      state.sceneState = 'running';\n      state.bootEndTime = performance.now();\n    },\n    ...createSnapshotMethods(state),\n    registerScene(sceneInstance: unknown): void {\n      ecsAccess._setScene(sceneInstance);\n    },\n  };\n}\n\n/**\n * Defines reactive state getters on the harness object.\n *\n * Using Object.defineProperties ensures getters remain reactive\n * (object spread would capture static values at spread time).\n *\n * @private\n * @param harness - The harness object to define getters on\n * @param state - The state to read from\n */\nfunction defineStateGetters(\n  harness: GameTestHarness,\n  state: HarnessState\n): void {\n  Object.defineProperties(harness, {\n    ready: { get: () => state.ready, enumerable: true },\n    scene: { get: () => state.scene, enumerable: true },\n    bootStartTime: { get: () => state.bootStartTime, enumerable: true },\n    bootEndTime: { get: () => state.bootEndTime, enumerable: true },\n    errors: { get: () => state.errors, enumerable: true },\n  });\n}\n\n/**\n * Creates initial harness state.\n *\n * @private\n * @returns Fresh harness state object\n */\nfunction createInitialState(): HarnessState {\n  return {\n    errors: [],\n    ready: false,\n    scene: '',\n    bootStartTime: performance.now(),\n    bootEndTime: undefined,\n    sceneState: 'stopped',\n  };\n}\n\n/**\n * Creates the test harness instance.\n *\n * @returns Configured GameTestHarness\n *\n * @example\n * const harness = createHarness();\n */\nfunction createHarness(): GameTestHarness {\n  const state = createInitialState();\n  const ecsAccess = createECSAccess();\n  const executeAction = createActionExecutor(\n    () => ecsAccess.getScene(),\n    () => document.querySelector<HTMLCanvasElement>('canvas')\n  );\n\n  const harness = {\n    ...createActionMethods(state, executeAction),\n    ...createLifecycleMethods(state, ecsAccess),\n    metrics: {},\n    ecs: ecsAccess,\n    tick: createTickAccess(),\n    getRenderSignature: createRenderSignatureGenerator(\n      () => ecsAccess.getEntities(),\n      () => state.sceneState,\n      () => ecsAccess.getSystems()\n    ),\n    // Placeholders - overwritten by defineStateGetters\n    ready: false,\n    scene: '',\n    bootStartTime: 0,\n    bootEndTime: undefined,\n    errors: [],\n  } as GameTestHarness;\n\n  defineStateGetters(harness, state);\n  return harness;\n}\n\n/**\n * Initializes the test harness if running in dev or test mode.\n *\n * This function should be called early in the application bootstrap process,\n * before any game logic runs. It creates the `window.__gameTest` object and\n * sets up global error capture.\n *\n * The harness is only created when:\n * - Running in Vite dev mode (`import.meta.env.DEV`)\n * - The `testMode` URL parameter is present\n *\n * @example\n * // In app bootstrap\n * import { initTestHarness } from '@shared/debug';\n *\n * async function bootstrap() {\n *   // Initialize harness first\n *   initTestHarness();\n *\n *   // Then bootstrap the app...\n *   const app = new Application();\n *   await app.start();\n * }\n *\n * @example\n * // Access via URL parameter\n * // http://localhost:5173/?testMode\n * // http://localhost:5173/?testMode&skipIntro&muteAudio\n */\nexport function initTestHarness(): void {\n  // Only initialize in dev mode or when testMode param is present\n  if (import.meta.env.DEV || isTestMode()) {\n    // eslint-disable-next-line no-console\n    console.log('[TestHarness] Initializing test harness...');\n\n    window.__gameTest = createHarness();\n    setupErrorCapture();\n\n    const params = getTestParams();\n    // eslint-disable-next-line no-console\n    console.log('[TestHarness] Test params:', params);\n  }\n}\n\n/**\n * Marks the game as ready for testing.\n *\n * Call this function after all initialization is complete and the game is\n * in a stable state for E2E tests to begin. This sets `harness.ready = true`\n * and records the boot time.\n *\n * In E2E tests, you typically wait for this:\n * ```typescript\n * await page.waitForFunction(() => window.__gameTest?.ready === true);\n * ```\n *\n * @param scene - Name of the current scene/screen (e.g., 'GameScene')\n *\n * @example\n * // In your screen's onShow method\n * import { markGameReady } from '@shared/debug';\n *\n * class GameScreen implements Screen {\n *   async onEnter(): Promise<void> {\n *     await this.gameScene.init();\n *     this.gameScene.start();\n *\n *     // Signal that game is ready for testing\n *     markGameReady('GameScene');\n *   }\n * }\n */\nexport function markGameReady(scene: string): void {\n  if (window.__gameTest) {\n    window.__gameTest.markReady(scene);\n  }\n}\n","import type { Time } from '@play-co/odie';\n\nimport { BaseSystem } from './BaseSystem';\nimport { gameTick } from '../utils';\nimport { registerTickCounter } from '@shared/debug';\n\n/**\n * System that increments the global tick counter each frame.\n *\n * This system should be registered first to ensure the tick counter\n * is updated before other systems run their update logic.\n *\n * The tick counter enables deterministic debug logging by providing\n * a frame reference for all log messages.\n *\n * @example\n * // Register in GameScene\n * scene.addSystem(TickSystem);\n *\n * // In other systems, use gameTick.log() for tick-prefixed logs\n * gameTick.log('TAP', `(${x}, ${y})  ${color} screw`);\n */\nexport class TickSystem extends BaseSystem {\n  static readonly NAME = 'tick';\n\n  /** Whether the tick counter has been registered with test harness */\n  private registered = false;\n\n  /**\n   * Update tick counter each frame.\n   * @param _time - Frame time info (unused)\n   * @example\n   * system.update(time); // Called automatically by ECS\n   */\n  update(_time: Time): void {\n    // Register gameTick with test harness on first update\n    if (!this.registered) {\n      registerTickCounter(gameTick);\n      this.registered = true;\n    }\n    gameTick.update();\n  }\n}\n","import { Scene2D, createEntity, type Entity2D } from '@play-co/odie';\nimport { TouchInput } from '@play-co/astro';\nimport { Assets, Container, Graphics, Sprite, type Texture } from 'pixi.js';\n\nimport { loadRegion, getLevelByIndex } from '@shared/levels';\nimport { getPart } from '@shared/parts';\nimport type {\n  LevelDefinition,\n  ScrewColor,\n  PartInstance,\n  PartDefinition,\n  Position,\n} from '@shared/types';\nimport { localToWorld } from '@shared/utils';\n\nimport {\n  createTrayEntity,\n  createPartEntity,\n  createScrewEntity,\n  createBufferTrayEntity,\n} from './factories';\nimport { GameStateEntity } from './entities';\nimport {\n  TickSystem,\n  ScrewPlacementSystem,\n  ScrewInteractionSystem,\n  AnimationSystem,\n  AutoTransferSystem,\n  WinConditionSystem,\n  TrayManagementSystem,\n} from './systems';\nimport {\n  gameEvents,\n  gameTick,\n  TRAY_DISPLAY_POSITIONS,\n  TRAY_HIDDEN_Y,\n  TRAY_FRAME_LAYOUT,\n  GAME_LAYOUT,\n  registerAnimationLayer,\n  registerColoredTrayLayer,\n  clearLayerRegistry,\n} from './utils';\n\n/**\n * Configuration options for creating a GameScene.\n */\nexport interface GameSceneOptions {\n  /** The PixiJS container to use as the scene's stage */\n  stage: Container;\n}\n\n/**\n * Main game scene implementing the Figma design.\n *\n * GameScene manages the complete game UI including:\n * - Background and puzzle base\n * - Colored trays for sorted screws\n * - Buffer tray for temporary storage\n * - Restart button\n * - Puzzle area with boards and screws\n *\n * @example\n * const stage = new Container();\n * const gameScene = new GameScene({ stage });\n * await gameScene.init();\n * gameScene.start();\n */\nexport class GameScene {\n  private scene: Scene2D;\n  private isInitialized = false;\n\n  // UI layer containers\n  private backgroundLayer: Container;\n  private uiLayer: Container;\n  private puzzleLayer: Container;\n  private coloredTrayLayer: Container; // For colored tray entities (between bg and covers)\n  private animationLayer: Container; // For animated screws (on top of everything)\n\n  // UI sprites\n  private restartButton: Sprite | null = null;\n  private restartInput: TouchInput | null = null;\n  private trayCovers: Sprite[] = [];\n\n  // Entity references\n  private trayEntities = new Map<ScrewColor, Entity2D>();\n  private bufferTrayEntity: Entity2D | null = null;\n  private gameStateEntity: Entity2D | null = null;\n  private partEntities: Entity2D[] = [];\n  private screwEntities: Entity2D[] = [];\n  private currentLevel: LevelDefinition | null = null;\n  private currentRegionPath: string | null = null;\n  private currentLevelIndex = 0;\n\n  constructor(options: GameSceneOptions) {\n    this.scene = new Scene2D({\n      stage: options.stage,\n    });\n\n    // Create layer containers\n    this.backgroundLayer = new Container();\n    this.uiLayer = new Container();\n    this.puzzleLayer = new Container();\n    this.coloredTrayLayer = new Container();\n    this.animationLayer = new Container();\n\n    // Add layers to scene stage in order\n    options.stage.addChild(this.backgroundLayer);\n    options.stage.addChild(this.puzzleLayer);\n    options.stage.addChild(this.uiLayer);\n    // animationLayer added on top in fixLayerOrder() after entityContainer is available\n  }\n\n  /**\n   * Initializes the game scene.\n   *\n   * Loads all assets and creates the UI layout.\n   *\n   * @example\n   * await gameScene.init();\n   */\n  public async init(): Promise<void> {\n    if (this.isInitialized) {\n      return;\n    }\n\n    // Register scene with test harness for ECS access (even in dev mode for bug reports)\n    if (window.__gameTest) {\n      window.__gameTest.registerScene(this.scene);\n    }\n\n    // Load assets and create UI\n    await this.loadAssets();\n    await this.createBackground();\n    await this.createTrayArea();\n    await this.createBufferTray();\n    await this.createRestartButton();\n\n    // Fix z-ordering: Move View2DSystem's entity container above puzzleLayer\n    // The puzzleLayer contains background elements (puzzle base)\n    // Entity views should render on top of the puzzle base but below the UI\n    this.fixLayerOrder();\n\n    // Register gameplay systems\n    this.registerSystems();\n\n    // Set up game event listeners\n    this.setupGameEvents();\n\n    this.isInitialized = true;\n  }\n\n  /**\n   * Registers all gameplay systems with the scene.\n   * @private\n   */\n  private registerSystems(): void {\n    // TickSystem must be first to update tick counter before other systems\n    this.scene.addSystem(TickSystem);\n    // Order matters: placement system first (no dependencies)\n    this.scene.addSystem(ScrewPlacementSystem);\n    this.scene.addSystem(AnimationSystem);\n    this.scene.addSystem(ScrewInteractionSystem);\n    this.scene.addSystem(AutoTransferSystem);\n    this.scene.addSystem(WinConditionSystem);\n    this.scene.addSystem(TrayManagementSystem);\n  }\n\n  /**\n   * Sets up game event listeners.\n   * @private\n   */\n  private setupGameEvents(): void {\n    gameEvents.on('game:won', () => {\n      this.handleGameWon();\n    });\n    gameEvents.on('game:stuck', () => {\n      this.handleGameStuck();\n    });\n  }\n\n  /**\n   * Handles the game won event.\n   * @private\n   */\n  private handleGameWon(): void {\n    gameTick.log('WIN', 'Level complete! You won!');\n    // TODO: Show win UI, transition to next level, etc.\n  }\n\n  /**\n   * Handles the game stuck event (soft lock).\n   * @private\n   */\n  private handleGameStuck(): void {\n    gameTick.log('STUCK', 'No moves available. Tap restart to try again.');\n    // TODO: Show stuck UI with restart prompt\n  }\n\n  /**\n   * Fixes z-ordering of stage children.\n   *\n   * Ensures entity views (managed by View2DSystem) render above the puzzleLayer\n   * but below the uiLayer. Animation layer is on top for animated screws.\n   * @private\n   */\n  private fixLayerOrder(): void {\n    const stage = this.scene.view2d.stage;\n    const entityContainer = this.scene.view2d.innerContainer;\n\n    // Remove and re-add in correct order:\n    // 1. backgroundLayer (bottom)\n    // 2. puzzleLayer (puzzle base background)\n    // 3. entityContainer (parts and screws from View2DSystem)\n    // 4. uiLayer (UI frames, covers, buttons)\n    // 5. animationLayer (animated screws on top of everything)\n    stage.removeChild(this.backgroundLayer);\n    stage.removeChild(this.puzzleLayer);\n    stage.removeChild(entityContainer);\n    stage.removeChild(this.uiLayer);\n\n    stage.addChild(this.backgroundLayer);\n    stage.addChild(this.puzzleLayer);\n    stage.addChild(entityContainer);\n    stage.addChild(this.uiLayer);\n    stage.addChild(this.animationLayer);\n\n    // Register layers for AnimationSystem access\n    registerAnimationLayer(this.animationLayer);\n    registerColoredTrayLayer(this.coloredTrayLayer);\n  }\n\n  /**\n   * Registers asset bundles and loads them.\n   * @private\n   */\n  private async loadAssets(): Promise<void> {\n    this.registerAssetBundles();\n    await Assets.loadBundle([\n      'common',\n      'ui',\n      'trays',\n      'screws',\n      'placeholders',\n    ]);\n  }\n\n  /**\n   * Registers all asset bundles.\n   * @private\n   */\n  private registerAssetBundles(): void {\n    this.registerCommonBundle();\n    this.registerUIBundle();\n    this.registerPlaceholderBundle();\n    this.registerTrayBundle();\n    this.registerScrewBundle();\n  }\n\n  private registerCommonBundle(): void {\n    Assets.addBundle('common', [\n      {\n        alias: 'scene-background',\n        src: 'images/backgrounds/scene-background.png',\n      },\n      { alias: 'puzzle-base', src: 'images/ui/puzzle-base.png' },\n    ]);\n  }\n\n  private registerUIBundle(): void {\n    Assets.addBundle('ui', [\n      { alias: 'restart-button', src: 'images/ui/restart-button.png' },\n      { alias: 'colored-tray-frame', src: 'images/ui/colored-tray-frame.png' },\n      { alias: 'buffer-tray-frame', src: 'images/ui/buffer-tray-frame.png' },\n      { alias: 'tray-cover', src: 'images/ui/tray-cover.png' },\n    ]);\n  }\n\n  private registerPlaceholderBundle(): void {\n    Assets.addBundle('placeholders', [\n      {\n        alias: 'placeholder-red',\n        src: 'images/placeholders/placeholder-red.png',\n      },\n      {\n        alias: 'placeholder-yellow',\n        src: 'images/placeholders/placeholder-yellow.png',\n      },\n      {\n        alias: 'placeholder-green',\n        src: 'images/placeholders/placeholder-green.png',\n      },\n      {\n        alias: 'placeholder-blue',\n        src: 'images/placeholders/placeholder-blue.png',\n      },\n    ]);\n  }\n\n  private registerTrayBundle(): void {\n    Assets.addBundle('trays', [\n      { alias: 'tray-red', src: 'images/trays/tray-red.png' },\n      { alias: 'tray-yellow', src: 'images/trays/tray-yellow.png' },\n      { alias: 'tray-green', src: 'images/trays/tray-green.png' },\n      { alias: 'tray-blue', src: 'images/trays/tray-blue.png' },\n    ]);\n  }\n\n  private registerScrewBundle(): void {\n    Assets.addBundle('screws', [\n      { alias: 'short-screw-red', src: 'images/screws/short-screw-red.png' },\n      {\n        alias: 'short-screw-yellow',\n        src: 'images/screws/short-screw-yellow.png',\n      },\n      {\n        alias: 'short-screw-green',\n        src: 'images/screws/short-screw-green.png',\n      },\n      { alias: 'short-screw-blue', src: 'images/screws/short-screw-blue.png' },\n      { alias: 'screw-red', src: 'images/screws/screw-red.png' },\n      { alias: 'screw-yellow', src: 'images/screws/screw-yellow.png' },\n      { alias: 'screw-green', src: 'images/screws/screw-green.png' },\n      { alias: 'screw-blue', src: 'images/screws/screw-blue.png' },\n    ]);\n  }\n\n  /**\n   * Creates the background and puzzle base.\n   * @private\n   */\n  private async createBackground(): Promise<void> {\n    // Scene background\n    const bgTexture = await Assets.load<Texture>('scene-background');\n    const background = new Sprite(bgTexture);\n    background.position.set(GAME_LAYOUT.background.x, GAME_LAYOUT.background.y);\n    this.backgroundLayer.addChild(background);\n\n    // Puzzle base (metal frame)\n    const baseTexture = await Assets.load<Texture>('puzzle-base');\n    const puzzleBase = new Sprite(baseTexture);\n    puzzleBase.position.set(GAME_LAYOUT.puzzleBase.x, GAME_LAYOUT.puzzleBase.y);\n    this.puzzleLayer.addChild(puzzleBase);\n  }\n\n  /**\n   * Creates the colored tray area frame and cover.\n   * Tray entities are created dynamically per level in createLevelTrays().\n   *\n   * Z-order (bottom to top):\n   * 1. Background (dark gray behind slots)\n   * 2. Colored tray layer (tray entity views added here)\n   * 3. Covers (behind frame, on top of colored trays)\n   * 4. Frame (always on top)\n   * @private\n   */\n  private async createTrayArea(): Promise<void> {\n    // 1. Background layer (dark gray behind slot openings) - bottom\n    const bg = new Graphics();\n    bg.rect(\n      0,\n      0,\n      TRAY_FRAME_LAYOUT.background.width,\n      TRAY_FRAME_LAYOUT.background.height\n    );\n    bg.fill({ color: TRAY_FRAME_LAYOUT.background.color });\n    bg.position.set(\n      GAME_LAYOUT.coloredTrayFrame.x + TRAY_FRAME_LAYOUT.background.offsetX,\n      GAME_LAYOUT.coloredTrayFrame.y + TRAY_FRAME_LAYOUT.background.offsetY\n    );\n    this.uiLayer.addChild(bg);\n\n    // 2. Colored tray layer (tray entity views will be added here in createLevelTrays)\n    this.uiLayer.addChild(this.coloredTrayLayer);\n\n    // 3. Tray covers (for hidden tray slots) - behind frame, on top of colored trays\n    const coverTexture = await Assets.load<Texture>('tray-cover');\n    for (const coverPos of GAME_LAYOUT.trayCovers) {\n      const cover = new Sprite(coverTexture);\n      cover.position.set(coverPos.x, coverPos.y);\n      this.uiLayer.addChild(cover);\n      this.trayCovers.push(cover);\n    }\n\n    // 4. Tray frame (always on top)\n    const frameTexture = await Assets.load<Texture>('colored-tray-frame');\n    const frame = new Sprite(frameTexture);\n    frame.position.set(\n      GAME_LAYOUT.coloredTrayFrame.x,\n      GAME_LAYOUT.coloredTrayFrame.y\n    );\n    this.uiLayer.addChild(frame);\n  }\n\n  /**\n   * Creates tray entities based on level configuration.\n   * Array order in level.trays determines displayOrder:\n   * - Index 0-1: Visible trays (displayOrder 0-1)\n   * - Index 2-4: Hidden trays below visible area (displayOrder 2-4)\n   * Levels can have 4-5 trays.\n   *\n   * Tray views are added to coloredTrayLayer for proper z-ordering\n   * (between background and covers).\n   * @param level - The level definition containing tray configs\n   * @private\n   */\n  private async createLevelTrays(level: LevelDefinition): Promise<void> {\n    const trayConfigs = level.trays;\n\n    for (let i = 0; i < trayConfigs.length; i++) {\n      const config = trayConfigs[i];\n      if (!config) continue;\n\n      const displayOrder = i;\n      const isVisible = displayOrder < 2;\n\n      // Visible trays use display positions, hidden trays start below\n      const displayPosition = TRAY_DISPLAY_POSITIONS[displayOrder];\n      const position = isVisible\n        ? { x: displayPosition?.x ?? 40, y: displayPosition?.y ?? 202 }\n        : { x: displayPosition?.x ?? 40, y: TRAY_HIDDEN_Y };\n\n      const tray = await createTrayEntity({\n        color: config.color,\n        position,\n        capacity: config.capacity,\n        displayOrder,\n      });\n      // Add entity to scene for ECS management\n      this.scene.addChild(tray);\n      this.trayEntities.set(config.color, tray);\n\n      // Move tray view to coloredTrayLayer for proper z-ordering\n      // (between background and covers in uiLayer)\n      this.coloredTrayLayer.addChild(tray.view);\n    }\n  }\n\n  /**\n   * Creates the buffer tray area.\n   * @private\n   */\n  private async createBufferTray(): Promise<void> {\n    const frameTexture = await Assets.load<Texture>('buffer-tray-frame');\n    const frame = new Sprite(frameTexture);\n    frame.position.set(\n      GAME_LAYOUT.bufferTrayFrame.x,\n      GAME_LAYOUT.bufferTrayFrame.y\n    );\n    this.uiLayer.addChild(frame);\n  }\n\n  /**\n   * Creates the restart button.\n   * @private\n   */\n  private async createRestartButton(): Promise<void> {\n    const texture = await Assets.load<Texture>('restart-button');\n    this.restartButton = new Sprite(texture);\n    this.restartButton.position.set(\n      GAME_LAYOUT.restartButton.x,\n      GAME_LAYOUT.restartButton.y\n    );\n\n    // Make interactive\n    this.restartButton.eventMode = 'static';\n    this.restartButton.cursor = 'pointer';\n\n    this.restartInput = new TouchInput(this.restartButton);\n    this.restartInput.onTap = (): Promise<void> => {\n      this.handleRestartClick();\n      return Promise.resolve();\n    };\n\n    this.uiLayer.addChild(this.restartButton);\n  }\n\n  /**\n   * Handles restart button click.\n   * @private\n   */\n  private handleRestartClick(): void {\n    if (this.currentRegionPath && this.currentLevel) {\n      gameTick.log('RESTART', 'Restarting level...');\n      void this.loadLevel(this.currentRegionPath, this.currentLevelIndex);\n    }\n  }\n\n  /**\n   * Gets a tray entity by color.\n   *\n   * @param color - The screw color to get the tray for\n   * @returns The tray entity or undefined if not found\n   *\n   * @example\n   * const redTray = gameScene.getTrayByColor(ScrewColor.Red);\n   */\n  public getTrayByColor(color: ScrewColor): Entity2D | undefined {\n    return this.trayEntities.get(color);\n  }\n\n  /**\n   * Gets the animation layer container.\n   * Used by AnimationSystem to move screws to top during animation.\n   *\n   * @returns The animation layer container\n   * @example\n   * const layer = gameScene.getAnimationLayer();\n   * layer.addChild(screwSprite);\n   */\n  public getAnimationLayer(): Container {\n    return this.animationLayer;\n  }\n\n  /**\n   * Gets the colored tray layer container.\n   * Used by AnimationSystem to move screws to correct layer after animation.\n   *\n   * @returns The colored tray layer container\n   * @example\n   * const layer = gameScene.getColoredTrayLayer();\n   * layer.addChild(screwSprite);\n   */\n  public getColoredTrayLayer(): Container {\n    return this.coloredTrayLayer;\n  }\n\n  /**\n   * Gets the currently loaded level.\n   *\n   * @returns The current level definition or null if no level is loaded\n   * @example\n   * const level = gameScene.getCurrentLevel();\n   * if (level) console.log(level.parts.length);\n   */\n  public getCurrentLevel(): LevelDefinition | null {\n    return this.currentLevel;\n  }\n\n  /**\n   * Loads a level from a region file.\n   *\n   * Creates part and screw entities based on the level definition.\n   * Clears any existing level entities before loading.\n   *\n   * @param regionPath - Path to the region JSON file\n   * @param levelIndex - Index of the level within the region (0-based)\n   *\n   * @example\n   * await gameScene.loadLevel('regions/region-test.json', 0);\n   */\n  public async loadLevel(\n    regionPath: string,\n    levelIndex: number\n  ): Promise<void> {\n    this.clearLevel();\n\n    // Store for restart\n    this.currentRegionPath = regionPath;\n    this.currentLevelIndex = levelIndex;\n\n    const region = await loadRegion(regionPath);\n    const level = getLevelByIndex(region, levelIndex);\n    this.currentLevel = level;\n\n    await this.loadPartAssets(level);\n    await this.createLevelEntities(level);\n  }\n\n  /**\n   * Creates part and screw entities for a level.\n   * @param level - The level definition to create entities from\n   * @private\n   */\n  private async createLevelEntities(level: LevelDefinition): Promise<void> {\n    this.createGameStateEntity(level);\n    await this.createLevelTrays(level);\n    await this.createBufferTrayEntity(level);\n    await this.createPartsAndScrews(level);\n  }\n\n  /**\n   * Creates the game state entity for tracking level progress.\n   * @param level - The level definition\n   * @example\n   * this.createGameStateEntity(level);\n   */\n  private createGameStateEntity(level: LevelDefinition): void {\n    const totalScrews = level.parts.reduce(\n      (sum, part) => sum + part.screws.length,\n      0\n    );\n    this.gameStateEntity = createEntity(GameStateEntity, {\n      gameState: {\n        phase: 'playing',\n        totalScrews,\n        removedScrews: 0,\n        winConditionType: level.win.type,\n      },\n    });\n    this.scene.addChild(this.gameStateEntity);\n  }\n\n  /**\n   * Creates the buffer tray entity for the level.\n   * @param level - The level definition\n   * @example\n   * await this.createBufferTrayEntity(level);\n   */\n  private async createBufferTrayEntity(level: LevelDefinition): Promise<void> {\n    this.bufferTrayEntity = await createBufferTrayEntity({\n      position: {\n        x: GAME_LAYOUT.bufferTrayFrame.x,\n        y: GAME_LAYOUT.bufferTrayFrame.y,\n      },\n      capacity: level.bufferCapacity ?? 5,\n    });\n    this.scene.addChild(this.bufferTrayEntity);\n  }\n\n  /**\n   * Creates part and screw entities from level definition.\n   *\n   * Level data uses centered local coordinates where (0,0) is the center\n   * of the play area. This method transforms those coordinates to world\n   * coordinates for rendering.\n   *\n   * @param level - The level definition\n   * @example\n   * await this.createPartsAndScrews(level);\n   */\n  private async createPartsAndScrews(level: LevelDefinition): Promise<void> {\n    // Sort parts by layer (low to high) so higher layers render on top and block clicks\n    const sortedParts = [...level.parts].sort((a, b) => a.layer - b.layer);\n\n    for (const partInstance of sortedParts) {\n      const partDef = getPart(partInstance.partId);\n      const partWorldPosition = localToWorld(partInstance.position);\n\n      const partEntity = await createPartEntity({\n        assetAlias: partDef.id,\n        partDefinitionId: partDef.id,\n        position: partWorldPosition,\n        layer: partInstance.layer,\n      });\n      this.scene.addChild(partEntity);\n      this.partEntities.push(partEntity);\n\n      await this.createScrewsForPart(\n        partInstance,\n        partDef,\n        partWorldPosition,\n        partEntity\n      );\n    }\n  }\n\n  /**\n   * Creates screw entities for a part instance.\n   * @param partInstance - The part instance from level data\n   * @param partDef - The part definition\n   * @param partWorldPosition - The part's world position\n   * @param partEntity - The created part entity\n   * @internal\n   */\n  private async createScrewsForPart(\n    partInstance: PartInstance,\n    partDef: PartDefinition,\n    partWorldPosition: Position,\n    partEntity: Entity2D\n  ): Promise<void> {\n    // Get part dimensions - screws are relative to part's top-left corner\n    const partWidth =\n      partDef.collision.type === 'box' ? partDef.collision.width : 0;\n    const partHeight =\n      partDef.collision.type === 'box' ? partDef.collision.height : 0;\n\n    for (const screw of partInstance.screws) {\n      // Convert to world position: partCenter - halfSize + screwLocal\n      const screwWorldPosition = {\n        x: partWorldPosition.x - partWidth / 2 + screw.position.x,\n        y: partWorldPosition.y - partHeight / 2 + screw.position.y,\n      };\n      const screwEntity = await createScrewEntity({\n        color: screw.color,\n        position: screwWorldPosition,\n        partEntityId: String(partEntity.UID),\n      });\n      this.scene.addChild(screwEntity);\n      this.screwEntities.push(screwEntity);\n    }\n  }\n\n  /**\n   * Clears all level entities (parts, screws, trays, game state, buffer tray).\n   * @private\n   */\n  private clearLevel(): void {\n    // Reset tick counter for new level\n    gameTick.reset();\n\n    // Remove game state entity\n    if (this.gameStateEntity) {\n      this.scene.removeChild(this.gameStateEntity);\n      this.gameStateEntity = null;\n    }\n\n    // Remove buffer tray entity\n    if (this.bufferTrayEntity) {\n      this.scene.removeChild(this.bufferTrayEntity);\n      this.bufferTrayEntity = null;\n    }\n\n    // Remove tray entities (they're recreated per level)\n    // Clear the coloredTrayLayer which holds tray views\n    this.coloredTrayLayer.removeChildren();\n    for (const tray of this.trayEntities.values()) {\n      this.scene.removeChild(tray);\n    }\n    this.trayEntities.clear();\n\n    // Remove part entities\n    for (const entity of this.partEntities) {\n      this.scene.removeChild(entity);\n    }\n\n    // Remove screw entities\n    for (const entity of this.screwEntities) {\n      this.scene.removeChild(entity);\n    }\n\n    // Clear animation layer (screws in buffer tray are left here after animation)\n    this.animationLayer.removeChildren();\n\n    this.partEntities = [];\n    this.screwEntities = [];\n    this.currentLevel = null;\n  }\n\n  /** Tracks which part asset bundles have been registered */\n  private loadedPartBundles = new Set<string>();\n\n  /**\n   * Loads asset bundles for parts used in the level.\n   * @param level - The level definition containing parts to load assets for\n   * @private\n   */\n  private async loadPartAssets(level: LevelDefinition): Promise<void> {\n    // Collect unique part IDs\n    const partIds = new Set(level.parts.map((p) => p.partId));\n\n    // Filter to only parts that haven't been loaded yet\n    const assets: { alias: string; src: string }[] = [];\n    for (const partId of partIds) {\n      if (this.loadedPartBundles.has(partId)) continue;\n\n      const partDef = getPart(partId);\n      if (partDef.asset) {\n        assets.push({ alias: partDef.id, src: partDef.asset });\n        this.loadedPartBundles.add(partId);\n      }\n    }\n\n    if (assets.length > 0) {\n      // Use unique bundle name to avoid overwrite warnings\n      const bundleName = `level-parts-${String(Date.now())}`;\n      Assets.addBundle(bundleName, assets);\n      await Assets.loadBundle(bundleName);\n    }\n  }\n\n  /**\n   * Starts the game scene.\n   *\n   * @example\n   * gameScene.start();\n   */\n  public start(): void {\n    this.scene.start();\n  }\n\n  /**\n   * Pauses the game scene.\n   *\n   * @example\n   * gameScene.pause();\n   */\n  public pause(): void {\n    this.scene.paused = true;\n  }\n\n  /**\n   * Resumes a paused game scene.\n   *\n   * @example\n   * gameScene.resume();\n   */\n  public resume(): void {\n    this.scene.paused = false;\n  }\n\n  /**\n   * Updates the game scene.\n   *\n   * @param _deltaTime - Time elapsed since last frame in seconds\n   *\n   * @example\n   * gameScene.update(0.016);\n   */\n  public update(_deltaTime: number): void {\n    // Scene updates automatically via View2DSystem\n  }\n\n  /**\n   * Destroys the game scene and cleans up resources.\n   *\n   * @example\n   * gameScene.destroy();\n   */\n  public destroy(): void {\n    // Cleanup touch input\n    if (this.restartInput) {\n      this.restartInput.enabled = false;\n      this.restartInput = null;\n    }\n\n    this.restartButton = null;\n    this.trayEntities.clear();\n\n    // Clear layers\n    this.backgroundLayer.removeChildren();\n    this.uiLayer.removeChildren();\n    this.puzzleLayer.removeChildren();\n    this.animationLayer.removeChildren();\n\n    // Clear layer registry\n    clearLayerRegistry();\n\n    this.scene.reset();\n  }\n}\n","import { BaseScreen } from './BaseScreen';\nimport { GameScene } from '@scenes/game/GameScene';\nimport { getTestParams } from '@shared/debug';\n\n/**\n * Game screen that hosts the main ODIE ECS game scene.\n *\n * This screen manages the lifecycle of a GameScene, bridging the Astro\n * screen system with ODIE's Scene2D. It handles:\n * - Scene initialization during `onPrepare()`\n * - Starting the scene on `onShow()`\n * - Pausing/resuming on visibility changes\n * - Cleanup on `onHidden()`\n *\n * @augments {BaseScreen}\n *\n * @example\n * // Registering the screen (typically done in bootstrap)\n * import { ScreensPlugin } from '@play-co/astro';\n * import { GameScreen } from '@ui/screens';\n *\n * const screens = app.get(ScreensPlugin);\n * screens.main.add(GameScreen, undefined, 'game');\n * await screens.main.show('game');\n *\n * @example\n * // Navigating to the game screen from another screen\n * import { getApp } from '@app';\n * import { ScreensPlugin } from '@play-co/astro';\n *\n * const app = getApp();\n * if (app) {\n *   const screens = app.get(ScreensPlugin);\n *   await screens.main.show('game');\n * }\n */\nexport class GameScreen extends BaseScreen {\n  /**\n   * The ODIE game scene instance.\n   * Created during onPrepare() and destroyed during onHidden().\n   */\n  private gameScene: GameScene | null = null;\n\n  /**\n   * Prepares the screen before it becomes visible.\n   *\n   * Creates and initializes the ODIE GameScene.\n   * If URL params specify a region and level, loads that level.\n   * @protected\n   */\n  protected override async onPrepare(): Promise<void> {\n    this.gameScene = new GameScene({\n      stage: this.view,\n    });\n\n    await this.gameScene.init();\n\n    // Load level from URL params, defaulting to test region\n    const params = getTestParams();\n    const region = params.region ?? 'test';\n    const regionPath = `regions/region-${region}.json`;\n    const levelIndex = params.level ?? 0;\n    await this.gameScene.loadLevel(regionPath, levelIndex);\n  }\n\n  /**\n   * Called when the screen becomes visible.\n   *\n   * Starts the game scene game loop.\n   * @protected\n   */\n  protected override onShow(): void {\n    this.gameScene?.start();\n  }\n\n  /**\n   * Called each frame while the screen is visible.\n   *\n   * @param dt - Delta time since last frame in seconds\n   * @protected\n   */\n  protected override onUpdate(dt: number): void {\n    this.gameScene?.update(dt);\n  }\n\n  /**\n   * Called when the screen starts hiding.\n   *\n   * Pauses the game scene.\n   * @protected\n   */\n  protected override onHide(): void {\n    this.gameScene?.pause();\n  }\n\n  /**\n   * Called when the screen is fully hidden.\n   *\n   * Destroys the game scene and cleans up resources.\n   * @protected\n   */\n  protected override onHidden(): void {\n    this.gameScene?.destroy();\n    this.gameScene = null;\n  }\n\n  /**\n   * Called when the app is paused (e.g., tab loses focus).\n   * @protected\n   */\n  protected override onPause(): void {\n    this.gameScene?.pause();\n  }\n\n  /**\n   * Called when the app is resumed (e.g., tab gains focus).\n   * @protected\n   */\n  protected override onResume(): void {\n    this.gameScene?.resume();\n  }\n}\n","/**\n * Application configuration constants.\n *\n * These values configure the game's display settings and are used during\n * bootstrap. The configuration is immutable (defined with `as const`).\n *\n * @property width - Canvas width in pixels (default: 1080)\n * @property height - Canvas height in pixels (default: 1920)\n * @property backgroundColor - Background color as hex number (default: 0x1a1a2e - dark blue)\n * @property antialias - Enable antialiasing for smoother graphics (default: true)\n *\n * @example\n * // Centering an entity on screen\n * import { APP_CONFIG } from '@app';\n *\n * entity.position.set(\n *   APP_CONFIG.width / 2,\n *   APP_CONFIG.height / 2\n * );\n *\n * @example\n * // Creating a full-screen background\n * import { APP_CONFIG } from '@app';\n * import { Graphics } from 'pixi.js';\n *\n * const bg = new Graphics();\n * bg.rect(0, 0, APP_CONFIG.width, APP_CONFIG.height);\n * bg.fill({ color: APP_CONFIG.backgroundColor });\n *\n * @example\n * // Using in resize calculations\n * import { APP_CONFIG } from '@app';\n *\n * const aspectRatio = APP_CONFIG.width / APP_CONFIG.height;\n * const scale = Math.min(\n *   window.innerWidth / APP_CONFIG.width,\n *   window.innerHeight / APP_CONFIG.height\n * );\n */\nexport const APP_CONFIG = {\n  width: 1080,\n  height: 1920,\n  backgroundColor: 0x1a1a2e,\n  antialias: true,\n} as const;\n\n/**\n * Type representing the application configuration shape.\n *\n * Use this type when you need to accept or pass configuration values\n * that match the APP_CONFIG structure.\n *\n * @example\n * import type { AppConfig } from '@app';\n *\n * function logConfig(config: AppConfig): void {\n *   console.log(`Game size: ${config.width}x${config.height}`);\n * }\n */\nexport type AppConfig = typeof APP_CONFIG;\n","/**\n * Application bootstrap module.\n *\n * This module initializes and configures the Astro application with all\n * necessary plugins and the initial game screen.\n *\n * @module\n */\n\nimport {\n  Application,\n  StagePlugin,\n  ResizePlugin,\n  ScreensPlugin,\n  KeyboardPlugin,\n  ResourcePlugin,\n  aspectResize,\n} from '@play-co/astro';\n\nimport { GameScreen } from '@ui/screens/GameScreen';\nimport { markGameReady } from '@shared/debug';\n\nimport { APP_CONFIG } from './config';\n\n/** Singleton application instance */\nlet app: Application | null = null;\n\n/**\n * Initializes and starts the game application.\n *\n * This function performs the following setup:\n * 1. Creates the Astro Application instance\n * 2. Configures core plugins:\n *    - **StagePlugin** - PixiJS renderer and canvas management\n *    - **ResizePlugin** - Responsive viewport scaling\n *    - **ResourcePlugin** - Asset loading via PixiJS Assets\n *    - **KeyboardPlugin** - Keyboard input handling\n *    - **ScreensPlugin** - Screen management with main/overlay layers\n * 3. Mounts the canvas to the DOM (#app element)\n * 4. Shows the initial GameScreen\n * 5. Marks the game as ready for the test harness\n *\n * The function is idempotent - calling it multiple times returns the\n * same Application instance.\n *\n * @returns A promise resolving to the initialized Application instance\n * @throws {Error} If the app container element (#app) is not found in the DOM\n *\n * @example\n * // Basic usage in main.ts\n * import { bootstrap } from '@app';\n *\n * async function main(): Promise<void> {\n *   const app = await bootstrap();\n *   console.log('Game started!');\n * }\n *\n * main().catch(console.error);\n *\n * @example\n * // Accessing plugins after bootstrap\n * import { bootstrap, getApp } from '@app';\n * import { ScreensPlugin, KeyboardPlugin } from '@play-co/astro';\n *\n * await bootstrap();\n *\n * const app = getApp();\n * if (app) {\n *   // Access screen management\n *   const screens = app.get(ScreensPlugin);\n *   await screens.main.show('menu');\n *\n *   // Bind keyboard controls\n *   const keyboard = app.get(KeyboardPlugin);\n *   keyboard.bindKeyDown('Space', () => {\n *     console.log('Space pressed!');\n *   });\n * }\n *\n * @example\n * // Using ResourcePlugin for asset loading\n * import { getApp } from '@app';\n * import { ResourcePlugin } from '@play-co/astro';\n * import { Assets } from 'pixi.js';\n *\n * const app = getApp();\n * if (app) {\n *   // ResourcePlugin initializes PixiJS Assets automatically\n *   const texture = await Assets.load('images/player.png');\n * }\n */\nexport async function bootstrap(): Promise<Application> {\n  if (app !== null) {\n    return app;\n  }\n\n  app = new Application();\n\n  configurePlugins(app);\n  await app.init();\n  mountToDOM(app);\n  await showInitialScreen(app);\n\n  return app;\n}\n\n/**\n * Configures all core plugins for the application.\n *\n * @param application - The Astro Application instance to configure\n *\n * @example\n * const app = new Application();\n * configurePlugins(app);\n */\nfunction configurePlugins(application: Application): void {\n  application.add(StagePlugin, {\n    backgroundColor: APP_CONFIG.backgroundColor,\n    antialias: APP_CONFIG.antialias,\n    autoAddToDocument: false,\n  });\n\n  application.add(ResizePlugin, {\n    resizeFunction: aspectResize(APP_CONFIG.width, APP_CONFIG.height, true),\n  });\n\n  application.add(ResourcePlugin);\n  application.add(KeyboardPlugin);\n\n  // Note: Using type assertion because Application.add's generic inference\n  // doesn't correctly handle ScreenPluginOptions\n  (application.add as (plugin: typeof ScreensPlugin, options: unknown) => void)(\n    ScreensPlugin,\n    {\n      main: { loadBeforeTransition: true },\n      overlay: { loadBeforeTransition: true },\n    }\n  );\n}\n\n/**\n * Mounts the application canvas to the DOM.\n *\n * @param application - The initialized Astro Application\n * @throws Error if the app container element is not found\n *\n * @example\n * await app.init();\n * mountToDOM(app);\n */\nfunction mountToDOM(application: Application): void {\n  const stage = application.get(StagePlugin);\n  const container = document.getElementById('app');\n\n  if (container === null) {\n    throw new Error('App container element not found');\n  }\n\n  container.appendChild(stage.view);\n}\n\n/**\n * Shows the initial screen and marks the game as ready.\n *\n * @param application - The initialized Astro Application\n * @returns Promise that resolves when the screen is shown\n *\n * @example\n * await showInitialScreen(app);\n */\nasync function showInitialScreen(application: Application): Promise<void> {\n  const screens = application.get(ScreensPlugin);\n  screens.main.add(GameScreen, undefined, 'game');\n  await screens.main.show('game' as 'empty');\n  markGameReady('game');\n}\n\n/**\n * Returns the current Application instance.\n *\n * Use this function to access the application after bootstrap has been called.\n * Returns null if bootstrap() has not been called yet.\n *\n * @returns The Application instance or null if not yet bootstrapped\n *\n * @example\n * import { getApp } from '@app';\n * import { ScreensPlugin } from '@play-co/astro';\n *\n * const app = getApp();\n * if (app) {\n *   const screens = app.get(ScreensPlugin);\n *   // Navigate to a different screen\n *   await screens.main.show('menu');\n * }\n *\n * @example\n * // Checking if app is ready\n * import { getApp } from '@app';\n *\n * function isAppReady(): boolean {\n *   return getApp() !== null;\n * }\n */\nexport function getApp(): Application | null {\n  return app;\n}\n","import { bootstrap } from '@app/bootstrap';\nimport { initTestHarness, isTestMode } from '@shared/debug';\nimport { createDebugConsole } from '@shared/debug/ui/debugConsole';\n\n// Initialize test harness early (before any errors can occur)\ninitTestHarness();\n\n// Create debug console in dev/test mode\nif (import.meta.env.DEV || isTestMode()) {\n  const debugConsole = createDebugConsole();\n  document.body.appendChild(debugConsole);\n}\n\nasync function main(): Promise<void> {\n  try {\n    // eslint-disable-next-line no-console\n    console.log('Starting application...');\n    await bootstrap();\n    // eslint-disable-next-line no-console\n    console.log('Application started successfully');\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Failed to initialize application:', error);\n    // Capture in test harness\n    if (window.__gameTest) {\n      window.__gameTest.captureError(\n        error instanceof Error ? error : new Error(String(error)),\n        'main'\n      );\n    }\n    // Display error on page\n    const appDiv = document.getElementById('app');\n    if (appDiv) {\n      appDiv.innerHTML = `<pre style=\"color: red; padding: 20px;\">${String(error)}\\n\\n${error instanceof Error ? (error.stack ?? '') : ''}</pre>`;\n    }\n  }\n}\n\nvoid main();\n"],"file":"index-DpbyZGxI.js"}