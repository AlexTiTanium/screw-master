import{T as Ht,S as Ss,b as _e,l as fe,c as me,R as _s,d as x,f as xs,g as je,h as Ts,s as Cs,e as yi,C as M,i as Es,j as ht,E as ks,G as wi,k as $,m as Ke,_ as Ut}from"./pixi-v3tV1XBX.js";import{g as U}from"./vendor-DDlvirwQ.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function As(s,t){const e=Math.pow(10,t);return Math.round(s*e)/e}class Et{constructor(t,e){this.x=t||0,this.y=e||0}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}setScalar(t){return this.x=t,this.y=t,this}set(t,e){return this.x=t,this.y=e,this}clone(){return new Et(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return Ve.set(t,t),Xe.set(e,e),this.clamp(Ve,Xe)}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){let t=Math.atan2(this.y,this.x);return t<0&&(t+=2*Math.PI),t}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.subVectors(e,t).multiplyScalar(i).add(t)}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e){return e===void 0&&(e=0),this.x=t[e],this.y=t[e+1],this}toArray(t,e){return t===void 0&&(t=[]),e===void 0&&(e=0),t[e]=this.x,t[e+1]=this.y,t}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*i-o*n+t.x,this.y=r*n+o*i+t.y,this}}const Ve=new Et,Xe=new Et,_t=new Map;function bi(s,t=100,e){if(!_t.has(s)){let i=null;const n=(...r)=>{if(_t.get(s).args=r,i)return;const o=()=>{i=null;const a=_t.get(s).args;e?s.call(e,...a):s(...a)};t===0?o():i=setTimeout(o,t)};_t.set(s,{throttledFunction:n,args:null})}return _t.get(s).throttledFunction}class Ps{constructor(){this._locked=!1}get locked(){return this._locked}lock(){return this._locked?!1:(this._locked=!0,!0)}unlock(){this._locked=!1}}class vi extends Promise{constructor(t){let e,i;super((n,r)=>{e=n,i=r,t?.(n,r)}),this.resolve=e,this.reject=i}}class Is{constructor(t){this._params=this._getParams(t??location.search)}get(t,e){const i=typeof e;return i==="number"?this.getNumber(t,e):i==="boolean"?this.getBoolean(t,e):this.getString(t,e)}getString(t,e){return this._params.paramsString.has(t)?this._params.paramsString.get(t):e}getNumber(t,e){return this._params.paramsNumber.has(t)?this._params.paramsNumber.get(t):e}getBoolean(t,e){return this._params.paramsBoolean.has(t)?this._params.paramsBoolean.get(t):e}getAll(){return this._params.paramsString}_getParams(t){const e=t.slice(t.indexOf("?")+1).split("&"),i=new Map,n=new Map,r=new Map;for(const o of e){const a=o.split("="),d=a[0],p=a[1]??"true";i.set(d,p),n.set(d,Number(p)),r.set(d,p.toLowerCase()!=="false")}return{paramsString:i,paramsNumber:n,paramsBoolean:r}}}function Si(s=60){Ht.shared.maxFPS=s,Ht.system.maxFPS=s,U.ticker.fps(s)}function _i(s){return{name:s._name,items:s.items}}class xi{constructor(t,e,i){this._priorities=[],this._result={priority:"after",runner:"start",plugin1:null,plugin2:null},this._runners=t,this._getRunner=e,this._getItem=i||(n=>n)}get prioritise(){return this._runnerChain||this._buildChain(),this._runnerChain}applyPrioritise(){this._priorities.forEach(t=>{this._prioritise(t)})}_buildChain(){this._actionChain={before:(e,i)=>{this._result.priority="before",this._result.plugin2={item:e,data:i},this._priorities.push({...this._result})},after:(e,i)=>{this._result.priority="after",this._result.plugin2={item:e,data:i},this._priorities.push({...this._result})},first:()=>{this._result.priority="first",this._priorities.push({...this._result})},last:()=>{this._result.priority="last",this._priorities.push({...this._result})}};const t=this._runners;this._runnerChain=this._runnerChain??t.reduce((e,i)=>{const n=this._getRunner(i).name;return e[n]=(r,o)=>(this._result.plugin1={item:r,data:o},this._result.runner=n,this._actionChain),e},{})}_prioritise(t){const e=this._runners.find(o=>this._getRunner(o).name===t.runner);if(!e)return;const i=this._getItem(t.plugin1.item,t.plugin1.data),n=this._getRunner(e).items,r=n.indexOf(i);if(r!==-1)if(n.splice(r,1),t.priority==="first")n.unshift(i);else if(t.priority==="last")n.push(i);else{const o=this._getItem(t.plugin2.item,t.plugin2.data),a=n.indexOf(o);if(a===-1)return;t.priority==="before"?n.splice(a,0,i):t.priority==="after"&&n.splice(a+1,0,i)}}}async function zt(s){const{items:t,name:e}=s;for(const i of t)await i[e]()}async function Ti(s){const t=[],{items:e,name:i}=s;for(const n of e)t.push(n[i]());await Promise.all(t)}class Ms{constructor(){this.blockingAssetsTrackingState={state:"blockingAssets",size:0,startTime:performance.now(),endTime:0,count:0},this.gameAssetsTrackingState={state:"gameAssets",size:0,count:0},this.currentAssetState="blockingAssets"}start(){this.blockingAssetsTrackingState.startTime=performance.now()}getState(){return{blockingAssetsCount:this.blockingAssetsTrackingState.count,blockingAssetsSize:this.blockingAssetsTrackingState.size,blockingAssetsTime:this.blockingAssetsTrackingState.endTime&&this.blockingAssetsTrackingState.startTime?this.blockingAssetsTrackingState.endTime-this.blockingAssetsTrackingState.startTime:0,gameAssetsCount:this.gameAssetsTrackingState.count,gameAssetsSize:this.gameAssetsTrackingState.size,allAssetsSize:this.blockingAssetsTrackingState.size+this.gameAssetsTrackingState.size,allAssetsCount:this.blockingAssetsTrackingState.count+this.gameAssetsTrackingState.count}}trackAsset(t){this.currentAssetState==="blockingAssets"?(this.blockingAssetsTrackingState.count+=t.length,this.blockingAssetsTrackingState.size+=t.reduce((e,i)=>e+i,0)):(this.gameAssetsTrackingState.count+=t.length,this.gameAssetsTrackingState.size+=t.reduce((e,i)=>e+i,0))}switchAssetState(t){this.currentAssetState==="blockingAssets"&&t==="gameAssets"&&(this.blockingAssetsTrackingState.endTime=performance.now(),this.gameAssetsTrackingState.startTime=this.blockingAssetsTrackingState.endTime),this.currentAssetState=t}}class Rs{constructor(t,e=!0){this._TAIL_WINDOW_SECONDS=3,this._SESSION_FPS_SAMPLE_MAX=5e3,this._SEGMENT_FPS_SAMPLE_MAX=1e3,this._realtime={stdDevCount:0,stdDevMean:0,stdDevSquared:0,ticks:0,fpsTime:0},this.id=t,this.startTime=performance.now(),this.perf={stdDevCount:0,stdDevMean:0,stdDevSquared:0,ticks:0,fpsTime:0},this.fpsSamples=[],this.fpsSampleCount=0,this.worstWindowFPS=1/0,this.trackTail=e,e&&(this.frameWindow=[])}update(t,e){const i=Math.min(1e3/t,60);this.id==="session"&&(this._updateVariance(t,this._realtime),this._updateFPS(t,this._realtime)),this._updateVariance(t,this.perf),this._updateFPS(t,this.perf),this.addFPSSample(this,i),this.trackTail&&this.frameWindow&&this.updateRollingWindow(e,this)}getStats(t,e=performance.now()){const i=this._getFPS(this.perf),n=this._getVariance(this.perf),r=this._getVarianceSample(this.perf),{fpsPercentile1:o,fpsPercentile5:a,fpsPercentile95:d,fpsPercentile99:p}=this._computePercentiles(this.fpsSamples);return{id:this.id,startTime:this.startTime,endTime:t?e:void 0,durationMs:e-this.startTime,frames:this.perf.ticks,fps:i,choppiness:n,choppinessSample:r,fpsPercentile1:o,fpsPercentile5:a,fpsPercentile95:d,fpsPercentile99:p,tailFPS:this.trackTail&&isFinite(this.worstWindowFPS)?this.worstWindowFPS:void 0,active:!t}}resetRealTimeStats(){this._realtime.fpsTime=0,this._realtime.stdDevCount=0,this._realtime.stdDevMean=0,this._realtime.stdDevSquared=0,this._realtime.ticks=0}get fps(){return this._getFPS(this.perf)}get realtimeFPS(){return this._getFPS(this._realtime)}get choppiness(){return this._getVariance(this.perf)}get choppinessSample(){return this._getVarianceSample(this.perf)}get realtimeChoppiness(){return this._getVariance(this._realtime)}get realtimeChoppinessSample(){return this._getVarianceSample(this._realtime)}get tailFPS(){return isFinite(this.worstWindowFPS)?this.worstWindowFPS:void 0}get tailWindowSeconds(){return this._TAIL_WINDOW_SECONDS}_updateVariance(t,e){e.stdDevCount++;const i=t-e.stdDevMean;e.stdDevMean+=i/e.stdDevCount;const n=t-e.stdDevMean;e.stdDevSquared+=i*n}_getVariance(t){return t.stdDevCount===0?0:t.stdDevSquared/t.stdDevCount}_getVarianceSample(t){return t.stdDevCount===0?0:t.stdDevSquared/(t.stdDevCount-1)}_updateFPS(t,e){e.fpsTime+=t,e.ticks++}_getFPS(t){if(t.ticks===0)return 0;const e=1e3/(t.fpsTime/t.ticks);return Math.min(e,60)}addFPSSample(t,e){t.fpsSampleCount++;const i=t.fpsSampleCount,n=t.id==="session"?this._SESSION_FPS_SAMPLE_MAX:this._SEGMENT_FPS_SAMPLE_MAX;if(t.fpsSamples.length<n)t.fpsSamples.push(e);else{const r=Math.floor(Math.random()*i);r<n&&(t.fpsSamples[r]=e)}}updateRollingWindow(t,e){const i=this._TAIL_WINDOW_SECONDS*1e3,n=e.frameWindow;for(n.push({t});n.length&&t-n[0].t>i;)n.shift();if(n.length>1){const r=t-n[0].t;if(r>0){const o=Math.min((n.length-1)/(r/1e3),60);o<e.worstWindowFPS&&(e.worstWindowFPS=o)}}}_computePercentiles(t){if(!t.length)return{fpsPercentile1:0,fpsPercentile5:0,fpsPercentile95:0,fpsPercentile99:0};const e=[...t].sort((n,r)=>n-r),i=n=>{const r=Math.min(e.length,Math.max(1,Math.ceil(n/100*e.length)));return e[r-1]};return{fpsPercentile1:i(1),fpsPercentile5:i(5),fpsPercentile95:i(95),fpsPercentile99:i(99)}}}const Qe={r8unorm:1,r8snorm:1,r8uint:1,r8sint:1,r16uint:2,r16sint:2,r16float:2,rg8unorm:2,rg8snorm:2,rg8uint:2,rg8sint:2,r32float:4,r32uint:4,r32sint:4,rg16uint:4,rg16sint:4,rg16float:4,rgba8unorm:4,"rgba8unorm-srgb":4,rgba8snorm:4,rgba8uint:4,rgba8sint:4,bgra8unorm:4,"bgra8unorm-srgb":4,rgb10a2unorm:4,rg11b10ufloat:4,rgb9e5ufloat:4,rg32float:8,rg32uint:8,rg32sint:8,rgba16uint:8,rgba16sint:8,rgba16float:8,rgba32float:16,rgba32uint:16,rgba32sint:16,depth16unorm:2,depth24plus:3,"depth24plus-stencil8":4,depth32float:4,stencil8:1,"depth32float-stencil8":5},Je={6408:4,6407:3,33319:2,6403:1,36249:4,36248:3,33320:2,36244:1,6406:1,6409:1,6410:2,6402:1,34041:2};class Ds{constructor(){this._gpuTextureSize=new Map}start(t){this._renderer=t}update(){if(!this._renderer)return{textureCount:0,sizeInMb:0};const t=this._get();let e=0,i=0;for(const r of t)!r.destroyed&&r.isLoaded&&(e++,i+=r.gpuSize);const n=As(i/1024/1024,1);return{textureCount:e,sizeInMb:n}}_get(){const t=this._renderer.texture.managedTextures,e=this._getWebTextures(),i=[];return t.forEach(n=>{if(n?.resource){if(!this._gpuTextureSize.has(n.uid)){const r=this._getMemorySize(n,e[n.uid]);r&&this._gpuTextureSize.set(n.uid,r)}i.push({gpuSize:this._gpuTextureSize.get(n.uid)||0,destroyed:n.destroyed,isLoaded:!!e[n.uid]})}}),i}_getWebTextures(){const t=this._renderer;let e={};const i=t.texture;return"_glTextures"in i||"_gpuSources"in i?e="_glTextures"in i?i._glTextures:i._gpuSources:e=i.managedTextures.reduce((r,o)=>{if(!o)return r;const a=o._gpuData[this._renderer.uid];return a&&(r[o.uid]="gpuTexture"in a?a.gpuTexture:a),r},{}),e}_getMemorySize(t,e){return e?Array.isArray(t.resource)&&t.resource[0]instanceof Uint8Array?t.resource.reduce((i,n)=>i+n.byteLength,0):typeof e.format=="string"&&Qe[e.format]?e.width*e.height*Qe[e.format]:typeof e.format=="number"&&Je[e.format]?e.width*e.height*Je[e.format]:null:null}}const Ls=60*1e3,Os=2*1e3,Bs=20*1e3;class zs{constructor(){this.assetMonitor=new Ms,this._paused=!1,this._isFirstEvent=!0,this._lastTickTime=0,this._systemThrottled=!1,this._peakSizeInMb=0,this._deviceScreenRefresh=0,this._LIKELY_HZ=[15,30,60,90,120],this._rafSamplingStarted=!1,this._timeTo={},this._gpuMonitor=new Ds,this._segments=new Map,this._warningLastEmit=Object.create(null),this._GPU_WARNING_THRESHOLD_MB=200*.9}init(t,e=!0,i){this._trackFunction=t,this._warningFunction=i,this.startSegment("session",{trackTail:!0}),setInterval(()=>this._trackAnalytics(),Ls),this._startDisplayHzSampling(),e&&Ht.shared.add(this.update,this)}startSegment(t,e){if(this._segments.has(t))return;const i=e?.trackTail??!0;this._segments.set(t,new Rs(t,i))}endSegment(t){const e=this._segments.get(t);if(!e)return;const i=this._buildSegmentData(e,!0);return this._segments.delete(t),i}getActiveSegments(){return Array.from(this._segments.keys())}get jsHeapSizeUsed(){var t;return(t=performance?.memory)==null?void 0:t.usedJSHeapSize}get jsHeapSizeTotal(){var t;return(t=performance?.memory)==null?void 0:t.totalJSHeapSize}get jsHeapSizeLimit(){var t;return(t=performance?.memory)==null?void 0:t.jsHeapSizeLimit}get fps(){var t;return((t=this._segments.get("session"))==null?void 0:t.fps)??0}get realtimeFPS(){var t;return((t=this._segments.get("session"))==null?void 0:t.realtimeFPS)??0}get choppiness(){var t;return((t=this._segments.get("session"))==null?void 0:t.choppiness)??0}get choppinessSample(){var t;return((t=this._segments.get("session"))==null?void 0:t.choppinessSample)??0}get realtimeChoppiness(){var t;return((t=this._segments.get("session"))==null?void 0:t.realtimeChoppiness)??0}get realtimeChoppinessSample(){var t;return((t=this._segments.get("session"))==null?void 0:t.realtimeChoppinessSample)??0}get tailFPS(){var t;return((t=this._segments.get("session"))==null?void 0:t.tailFPS)??0}get tailWindowSeconds(){var t;return((t=this._segments.get("session"))==null?void 0:t.tailWindowSeconds)??0}get deviceScreenRefresh(){return this._deviceScreenRefresh||void 0}get peakSizeInMb(){return this._peakSizeInMb}get vramPeakExceeded(){return this._peakSizeInMb>=200}get systemThrottled(){return this._systemThrottled}startGPUMonitoring(t){this._gpuMonitor.start(t)}update(){if(this._paused)return;const t=performance.now(),e=t-this._lastTickTime;if(this._lastTickTime!==0&&e<Os&&t>Bs){const i=this._capDeltaFor60(e);if(this._segments.size)for(const n of this._segments.values())n.update(i,t)}this._lastTickTime=t}pause(){this._paused=!0}resume(){this._paused=!1}reset(){return this.assetMonitor.blockingAssetsTrackingState={state:"blockingAssets",size:0,startTime:performance.now(),endTime:0,count:0},this.assetMonitor.gameAssetsTrackingState={state:"gameAssets",size:0,count:0},this.assetMonitor.currentAssetState="blockingAssets",this._paused=!1,this._isFirstEvent=!0,this._lastTickTime=0,this._systemThrottled=!1,this._peakSizeInMb=0,this._deviceScreenRefresh=0,this._rafSamplingStarted=!1,this._timeTo={},this._segments.clear(),this._warningLastEmit=Object.create(null),this.startSegment("session",{trackTail:!0}),this._startDisplayHzSampling(),this}trackTimeTo(t){const e=`timeTo${t.charAt(0).toUpperCase()+t.slice(1)}`;this._timeTo[e]=Math.round(window.performance.now())/1e3}_trackAnalytics(){if(this._paused)return;const t=this._gpuMonitor.update();t.sizeInMb>this._peakSizeInMb&&(this._peakSizeInMb=t.sizeInMb),this._checkGpuWarning(t.sizeInMb),this._checkSystemMemoryWarning();const e=[],i=performance.now();let n;if(this._segments.size)for(const a of this._segments.values()){const d=this._buildSegmentData(a,!1,i);a.id==="session"?n=d:e.push(d)}const r=this._segments.get("session"),o={...n,isFirst:this._isFirstEvent,realtimeFPS:r.realtimeFPS,realtimeChoppiness:r.realtimeChoppiness,realtimeChoppinessSample:r.realtimeChoppinessSample,jsHeapSizeLimit:this.jsHeapSizeLimit,jsHeapSizeTotal:this.jsHeapSizeTotal,jsHeapSizeUsed:this.jsHeapSizeUsed,tailWindowSeconds:r.tailWindowSeconds,textureCount:t.textureCount,sizeInMb:t.sizeInMb,peakSizeInMb:this._peakSizeInMb,vramPeakExceeded:this.vramPeakExceeded,deviceScreenRefresh:this.deviceScreenRefresh,...this.assetMonitor.getState(),...this._timeTo};this._trackFunction(o,e),r.resetRealTimeStats(),this._isFirstEvent=!1}_capDeltaFor60(t){const e=16.666666666666668;return t<e?e:t}_startDisplayHzSampling(){var t;if(this._deviceScreenRefresh||this._rafSamplingStarted)return;const e=typeof window<"u"?window:void 0,i=(t=e?.requestAnimationFrame)==null?void 0:t.bind(e);if(!i)return;this._rafSamplingStarted=!0;let n=0;const r=performance.now(),o=1e3,a=2500,d=m=>{if(this._deviceScreenRefresh)return;const w=Math.max(1,m-r),c=n/(w/1e3);this._deviceScreenRefresh=this._snapHz(c),this._deviceScreenRefresh<=30&&(this._systemThrottled=!0)},p=m=>{if(this._deviceScreenRefresh)return;if(n++,m-r>=o||n>=300){d(m);return}i(p)};i(p),setTimeout(()=>{this._deviceScreenRefresh||d(performance.now())},a)}_snapHz(t){let e=t,i=1/0;for(const n of this._LIKELY_HZ){const r=Math.abs(n-t);r<i&&(i=r,e=n)}return Math.abs(e-t)/t>.15?Math.round(t):Math.round(e)}_buildSegmentData(t,e,i=performance.now()){return{...t.getStats(e,i),systemThrottled:this._systemThrottled}}emitWarning(t,e,i=120*1e3){if(!this._warningFunction)return!1;const n=performance.now(),r=this._warningLastEmit[t];return r!==void 0&&n-r<i?!1:(this._warningLastEmit[t]=n,this._warningFunction({type:t,data:e,at:n}),!0)}_checkGpuWarning(t){t>=this._GPU_WARNING_THRESHOLD_MB&&this.emitWarning("gpuMemoryHigh",{sizeInMb:t,peakSizeInMb:this._peakSizeInMb,thresholdMb:this._GPU_WARNING_THRESHOLD_MB})}_checkSystemMemoryWarning(){const t=this.jsHeapSizeUsed,e=this.jsHeapSizeLimit;if(!t||!e||e<=0)return;const i=t/e;i>=.9&&this.emitWarning("systemMemoryHigh",{jsHeapSizeUsed:t,jsHeapSizeLimit:e,ratio:i})}}const xe=new zs;class Ci{constructor(t={}){this._defaultPluginName="default",this.runners=[],this.setupRunner=this.addRunner("setup"),this.initRunner=this.addRunner("init"),this.prepareRunner=this.addRunner("prepare"),this.startRunner=this.addRunner("start"),this.updateRunner=this.addRunner("update"),this.config=t,this.verbose=this.config.verbose??!1,this.plugins=new Map,this.pluginDefaults=new Map,this.config.limitFPS=this.config.limitFPS??60,this.config.limitFPS&&Si(this.config.limitFPS),this._prioritiser=new xi(this.runners,_i,(e,i)=>this.get(e,i))}add(t,e){e=e||{};const i=e.name,n=i??this._defaultPluginName;e=Object.assign(e,this.config[i]||{});const r=new t(this,e),o=this.plugins.get(t)||{};if(o[n])throw new Error(`app plugin ${n} already exists`);return o[n]=r,this.pluginDefaults.get(t)||this.pluginDefaults.set(t,n),this.runners.forEach(a=>{a.add(r)}),this.plugins.set(t,o),r}get(t,e){const i=e??this.pluginDefaults.get(t);return this.plugins.get(t)[i]}async init(){this._prioritiser.applyPrioritise(),await Ti(this.setupRunner),await zt(this.initRunner),Ht.system.add(this.update,this),await zt(this.prepareRunner),await zt(this.startRunner),xe.assetMonitor.switchAssetState("gameAssets")}update(t){this.updateRunner.emit(t.deltaTime)}addRunner(t){const e=new Ss(t);return this.runners.push(e),e}get prioritise(){return this._prioritiser.prioritise}}class dt{constructor(t,e){this.app=t,this.options=e||{},this.verbose=e?.verbose??t.verbose??!1}}function Ei(s){var t,e;for(const i of s){const n=(t=i.data)==null?void 0:t.tags,r=(e=i.asset)==null?void 0:e.source;r&&n&&(n.REPEAT&&(r.style.addressMode="repeat"),n.NEAREST&&(r.style.scaleMode="nearest"))}}const ki={...fe,extension:_e.LoadParser,async load(s,t,e){var i,n;const r=await((n=(i=fe).load)==null?void 0:n.call(i,s,t,e));return t&&Ei([{asset:r,data:t.data}]),r}},Ai={...me,extension:_e.LoadParser,async load(s,t){var e;const i=["normal","bold","100","200","300","400","500","600","700","800","900"];let n=[];const r=((e=t?.data)==null?void 0:e.tags)||{};return r.w&&(Array.isArray(r.w)?n.push(...r.w.map(o=>o.toString())):r.w==="all"?n=i:n.push(r.w.toString())),n.length===0&&(n=["normal"]),n.every(o=>i.includes(o))||console.warn(`[loadWebFont] A font weight provided for ${s} is invalid`),r.w&&(t.data.weights=n),r.family&&(t.data.family=r.family),me.load(s,t)}},Pi={extension:{type:_e.ResolveParser,name:"resolveSpineAtlas"},test:s=>{const e=s.split("?")[0].split("."),i=e.pop(),n=e.pop();return i==="atlas"&&["png","webp","avif"].includes(n)},parse:s=>{var t;const e=s.split(".");return{resolution:parseFloat(((t=_s.RETINA_PREFIX.exec(s))==null?void 0:t[1])??"1"),format:e[e.length-2],src:s}}},Ze={};let ti=!0;const Fs=x.load,$s=x.backgroundLoad,ei=s=>{if(ti){const i=x.resolver._manifest;i&&(i.bundles.forEach(n=>{n.assets.forEach(o=>{o.data.tags.tps&&o.data.frameNames&&o.data.frameNames.forEach(a=>{Ze[a]=o})})}),ti=!1)}const t={},e=Ts(s,i=>{const n=Ze[i];return n?(t[i]=n,n):i});return{urlToSpritesheetMap:t,res:e}};function Ns(){x.load=async(s,t)=>{const{res:e,urlToSpritesheetMap:i}=ei(s),n=await Fs.bind(x)(e.length===1?e[0]:e,t);let r;Object.entries(i).forEach(([p,m])=>{if(!n[p]&&!(n instanceof xs)){n[p]=je.get(p);return}r=je.get(p)});const a=(Array.isArray(s)?s:[s]).map(p=>typeof p=="string"?p:p.alias[0]),d=Object.values(x.resolver.resolve(a)).map(p=>p.progressSize??1);return xe.assetMonitor.trackAsset(d),r??n},x.backgroundLoad=async s=>{const{res:t}=ei(s),e=t.map(i=>typeof i=="string"?i:i.alias[0]);await $s.bind(x)(e)}}const ii={};function Ii(s,t,e=3){if(ii[t])return;let i=new Error().stack;typeof i>"u"?console.warn("Astro Deprecation Warning: ",`${t}
Deprecated since v${s}`):(i=i.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cAstro Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${s}`),console.warn(i),console.groupEnd()):(console.warn("Astro Deprecation Warning: ",`${t}
Deprecated since v${s}`),console.warn(i))),ii[t]=!0}var xt={exports:{}},Hs=xt.exports,si;function Us(){return si||(si=1,(function(s,t){(function(e,i){var n="1.0.41",r="",o="?",a="function",d="undefined",p="object",m="string",w="major",c="model",u="name",l="type",h="vendor",f="version",I="architecture",Q="console",b="mobile",v="tablet",R="smarttv",D="wearable",j="embedded",B=500,A="Amazon",W="Apple",pt="ASUS",ft="BlackBerry",J="Browser",Z="Chrome",et="Edge",it="Firefox",st="Google",K="Honor",mt="Huawei",ys="Lenovo",Mt="LG",te="Microsoft",ee="Motorola",ie="Nvidia",ze="OnePlus",gt="Opera",se="OPPO",yt="Samsung",Fe="Sharp",wt="Sony",ne="Xiaomi",re="Zebra",$e="Facebook",Ne="Chromium OS",He="Mac OS",Ue=" Browser",ws=function(_,T){var S={};for(var k in _)T[k]&&T[k].length%2===0?S[k]=T[k].concat(_[k]):S[k]=_[k];return S},Rt=function(_){for(var T={},S=0;S<_.length;S++)T[_[S].toUpperCase()]=_[S];return T},We=function(_,T){return typeof _===m?bt(T).indexOf(bt(_))!==-1:!1},bt=function(_){return _.toLowerCase()},bs=function(_){return typeof _===m?_.replace(/[^\d\.]/g,r).split(".")[0]:i},oe=function(_,T){if(typeof _===m)return _=_.replace(/^\s\s*/,r),typeof T===d?_:_.substring(0,B)},vt=function(_,T){for(var S=0,k,V,q,C,y,G;S<T.length&&!y;){var ae=T[S],Ye=T[S+1];for(k=V=0;k<ae.length&&!y&&ae[k];)if(y=ae[k++].exec(_),y)for(q=0;q<Ye.length;q++)G=y[++V],C=Ye[q],typeof C===p&&C.length>0?C.length===2?typeof C[1]==a?this[C[0]]=C[1].call(this,G):this[C[0]]=C[1]:C.length===3?typeof C[1]===a&&!(C[1].exec&&C[1].test)?this[C[0]]=G?C[1].call(this,G,C[2]):i:this[C[0]]=G?G.replace(C[1],C[2]):i:C.length===4&&(this[C[0]]=G?C[3].call(this,G.replace(C[1],C[2])):i):this[C]=G||i;S+=2}},St=function(_,T){for(var S in T)if(typeof T[S]===p&&T[S].length>0){for(var k=0;k<T[S].length;k++)if(We(T[S][k],_))return S===o?i:S}else if(We(T[S],_))return S===o?i:S;return T.hasOwnProperty("*")?T["*"]:_},vs={"1.0":"/8","1.2":"/1","1.3":"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"},qe={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2","8.1":"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Ge={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,f],[/opios[\/ ]+([\w\.]+)/i],[f,[u,gt+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[f,[u,gt+" GX"]],[/\bopr\/([\w\.]+)/i],[f,[u,gt]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[f,[u,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[f,[u,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[u,f],[/quark(?:pc)?\/([-\w\.]+)/i],[f,[u,"Quark"]],[/\bddg\/([\w\.]+)/i],[f,[u,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[u,"UC"+J]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[f,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[u,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[u,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[f,[u,"Smart Lenovo "+J]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+J],f],[/\bfocus\/([\w\.]+)/i],[f,[u,it+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[u,gt+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[u,gt+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[u,"MIUI"+Ue]],[/fxios\/([\w\.-]+)/i],[f,[u,it]],[/\bqihoobrowser\/?([\w\.]*)/i],[f,[u,"360"]],[/\b(qq)\/([\w\.]+)/i],[[u,/(.+)/,"$1Browser"],f],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1"+Ue],f],[/samsungbrowser\/([\w\.]+)/i],[f,[u,yt+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[f,[u,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[u,"Sogou Mobile"],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[u,f],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[u],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[f,u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,$e],f],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/(daum)apps[\/ ]([\w\.]+)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[u,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[u,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[u,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[u,Z+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,Z+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[u,"Android "+J]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[f,St,vs]],[/(webkit|khtml)\/([\w\.]+)/i],[u,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],f],[/(wolvic|librewolf)\/([\w\.]+)/i],[u,f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[u,it+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(amaya|dillo|doris|icab|ladybird|lynx|mosaic|netsurf|obigo|polaris|w3m|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/\b(links) \(([\w\.]+)/i],[u,[f,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[u,[f,/master.|lts./,""]]],cpu:[[/\b((amd|x|x86[-_]?|wow|win)64)\b/i],[[I,"amd64"]],[/(ia32(?=;))/i,/\b((i[346]|x)86)(pc)?\b/i],[[I,"ia32"]],[/\b(aarch64|arm(v?[89]e?l?|_?64))\b/i],[[I,"arm64"]],[/\b(arm(v[67])?ht?n?[fl]p?)\b/i],[[I,"armhf"]],[/( (ce|mobile); ppc;|\/[\w\.]+arm\b)/i],[[I,"arm"]],[/((ppc|powerpc)(64)?)( mac|;|\))/i],[[I,/ower/,r,bt]],[/ sun4\w[;\)]/i],[[I,"sparc"]],[/\b(avr32|ia64(?=;)|68k(?=\))|\barm(?=v([1-7]|[5-7]1)l?|;|eabi)|(irix|mips|sparc)(64)?\b|pa-risc)/i],[[I,bt]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[h,yt],[l,v]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[c,[h,yt],[l,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[c,[h,W],[l,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[h,W],[l,v]],[/(macintosh);/i],[c,[h,W]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[h,Fe],[l,b]],[/\b((?:brt|eln|hey2?|gdi|jdn)-a?[lnw]09|(?:ag[rm]3?|jdn2|kob2)-a?[lw]0[09]hn)(?: bui|\)|;)/i],[c,[h,K],[l,v]],[/honor([-\w ]+)[;\)]/i],[c,[h,K],[l,b]],[/\b((?:ag[rs][2356]?k?|bah[234]?|bg[2o]|bt[kv]|cmr|cpn|db[ry]2?|jdn2|got|kob2?k?|mon|pce|scm|sht?|[tw]gr|vrd)-[ad]?[lw][0125][09]b?|605hw|bg2-u03|(?:gem|fdr|m2|ple|t1)-[7a]0[1-4][lu]|t1-a2[13][lw]|mediapad[\w\. ]*(?= bui|\)))\b(?!.+d\/s)/i],[c,[h,mt],[l,v]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[h,mt],[l,b]],[/oid[^\)]+; (2[\dbc]{4}(182|283|rp\w{2})[cgl]|m2105k81a?c)(?: bui|\))/i,/\b((?:red)?mi[-_ ]?pad[\w- ]*)(?: bui|\))/i],[[c,/_/g," "],[h,ne],[l,v]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i,/ ([\w ]+) miui\/v?\d/i],[[c,/_/g," "],[h,ne],[l,b]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[h,se],[l,b]],[/\b(opd2(\d{3}a?))(?: bui|\))/i],[c,[h,St,{OnePlus:["304","403","203"],"*":se}],[l,v]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[h,"Vivo"],[l,b]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[c,[h,"Realme"],[l,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto(?! 360)[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[h,ee],[l,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[h,ee],[l,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[h,Mt],[l,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv|watch)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[h,Mt],[l,b]],[/(ideatab[-\w ]+|602lv|d-42a|a101lv|a2109a|a3500-hv|s[56]000|pb-6505[my]|tb-?x?\d{3,4}(?:f[cu]|xu|[av])|yt\d?-[jx]?\d+[lfmx])( bui|;|\)|\/)/i,/lenovo ?(b[68]0[08]0-?[hf]?|tab(?:[\w- ]+?)|tb[\w-]{6,7})( bui|;|\)|\/)/i],[c,[h,ys],[l,v]],[/(nokia) (t[12][01])/i],[h,c,[l,v]],[/(?:maemo|nokia).*(n900|lumia \d+|rm-\d+)/i,/nokia[-_ ]?(([-\w\. ]*))/i],[[c,/_/g," "],[l,b],[h,"Nokia"]],[/(pixel (c|tablet))\b/i],[c,[h,st],[l,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[h,st],[l,b]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[h,wt],[l,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[h,wt],[l,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[h,ze],[l,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[h,A],[l,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[h,A],[l,b]],[/(playbook);[-\w\),; ]+(rim)/i],[c,h,[l,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[h,ft],[l,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[h,pt],[l,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[h,pt],[l,b]],[/(nexus 9)/i],[c,[h,"HTC"],[l,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[c,/_/g," "],[l,b]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[c,[h,"TCL"],[l,v]],[/(itel) ((\w+))/i],[[h,bt],c,[l,St,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[h,"Acer"],[l,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[h,"Meizu"],[l,b]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[c,[h,"Ulefone"],[l,b]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[c,[h,"Energizer"],[l,b]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[c,[h,"Cat"],[l,b]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[c,[h,"Smartfren"],[l,b]],[/droid.+; (a(?:015|06[35]|142p?))/i],[c,[h,"Nothing"],[l,b]],[/; (x67 5g|tikeasy \w+|ac[1789]\d\w+)( b|\))/i,/archos ?(5|gamepad2?|([\w ]*[t1789]|hello) ?\d+[\w ]*)( b|\))/i],[c,[h,"Archos"],[l,v]],[/archos ([\w ]+)( b|\))/i,/; (ac[3-6]\d\w{2,8})( b|\))/i],[c,[h,"Archos"],[l,b]],[/(imo) (tab \w+)/i,/(infinix) (x1101b?)/i],[h,c,[l,v]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus(?! zenw)|dell|jolla|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (hmd|imo) ([\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w ]+?)(?: bui|\)|\/)/i,/(oppo) ?([\w ]+) bui/i],[h,c,[l,b]],[/(kobo)\s(ereader|touch)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,c,[l,v]],[/(surface duo)/i],[c,[h,te],[l,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[h,"Fairphone"],[l,b]],[/(u304aa)/i],[c,[h,"AT&T"],[l,b]],[/\bsie-(\w*)/i],[c,[h,"Siemens"],[l,b]],[/\b(rct\w+) b/i],[c,[h,"RCA"],[l,v]],[/\b(venue[\d ]{2,7}) b/i],[c,[h,"Dell"],[l,v]],[/\b(q(?:mv|ta)\w+) b/i],[c,[h,"Verizon"],[l,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[h,"Barnes & Noble"],[l,v]],[/\b(tm\d{3}\w+) b/i],[c,[h,"NuVision"],[l,v]],[/\b(k88) b/i],[c,[h,"ZTE"],[l,v]],[/\b(nx\d{3}j) b/i],[c,[h,"ZTE"],[l,b]],[/\b(gen\d{3}) b.+49h/i],[c,[h,"Swiss"],[l,b]],[/\b(zur\d{3}) b/i],[c,[h,"Swiss"],[l,v]],[/\b((zeki)?tb.*\b) b/i],[c,[h,"Zeki"],[l,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],c,[l,v]],[/\b(ns-?\w{0,9}) b/i],[c,[h,"Insignia"],[l,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[h,"NextBook"],[l,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],c,[l,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],c,[l,b]],[/\b(ph-1) /i],[c,[h,"Essential"],[l,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[h,"Envizen"],[l,v]],[/\b(trio[-\w\. ]+) b/i],[c,[h,"MachSpeed"],[l,v]],[/\btu_(1491) b/i],[c,[h,"Rotor"],[l,v]],[/((?:tegranote|shield t(?!.+d tv))[\w- ]*?)(?: b|\))/i],[c,[h,ie],[l,v]],[/(sprint) (\w+)/i],[h,c,[l,b]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[h,te],[l,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[h,re],[l,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[h,re],[l,b]],[/smart-tv.+(samsung)/i],[h,[l,R]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[h,yt],[l,R]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,Mt],[l,R]],[/(apple) ?tv/i],[h,[c,W+" TV"],[l,R]],[/crkey/i],[[c,Z+"cast"],[h,st],[l,R]],[/droid.+aft(\w+)( bui|\))/i],[c,[h,A],[l,R]],[/(shield \w+ tv)/i],[c,[h,ie],[l,R]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[h,Fe],[l,R]],[/(bravia[\w ]+)( bui|\))/i],[c,[h,wt],[l,R]],[/(mi(tv|box)-?\w+) bui/i],[c,[h,ne],[l,R]],[/Hbbtv.*(technisat) (.*);/i],[h,c,[l,R]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,oe],[c,oe],[l,R]],[/droid.+; ([\w- ]+) (?:android tv|smart[- ]?tv)/i],[c,[l,R]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,R]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,c,[l,Q]],[/droid.+; (shield)( bui|\))/i],[c,[h,ie],[l,Q]],[/(playstation \w+)/i],[c,[h,wt],[l,Q]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[h,te],[l,Q]],[/\b(sm-[lr]\d\d[0156][fnuw]?s?|gear live)\b/i],[c,[h,yt],[l,D]],[/((pebble))app/i,/(asus|google|lg|oppo) ((pixel |zen)?watch[\w ]*)( bui|\))/i],[h,c,[l,D]],[/(ow(?:19|20)?we?[1-3]{1,3})/i],[c,[h,se],[l,D]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[h,W],[l,D]],[/(opwwe\d{3})/i],[c,[h,ze],[l,D]],[/(moto 360)/i],[c,[h,ee],[l,D]],[/(smartwatch 3)/i],[c,[h,wt],[l,D]],[/(g watch r)/i],[c,[h,Mt],[l,D]],[/droid.+; (wt63?0{2,3})\)/i],[c,[h,re],[l,D]],[/droid.+; (glass) \d/i],[c,[h,st],[l,D]],[/(pico) (4|neo3(?: link|pro)?)/i],[h,c,[l,D]],[/; (quest( \d| pro)?)/i],[c,[h,$e],[l,D]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[l,j]],[/(aeobc)\b/i],[c,[h,A],[l,j]],[/(homepod).+mac os/i],[c,[h,W],[l,j]],[/windows iot/i],[[l,j]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[c,[l,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[l,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,b]],[/droid .+?; ([\w\. -]+)( bui|\))/i],[c,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[u,et+"HTML"]],[/(arkweb)\/([\w\.]+)/i],[u,f],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[u,f],[/ladybird\//i],[[u,"LibWeb"]],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,f],[/(windows (?:phone(?: os)?|mobile|iot))[\/ ]?([\d\.\w ]*)/i],[u,[f,St,qe]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,St,qe],[u,"Windows"]],[/[adehimnop]{4,7}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,He],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,u],[/(ubuntu) ([\w\.]+) like android/i],[[u,/(.+)/,"$1 Touch"],f],[/(android|bada|blackberry|kaios|maemo|meego|openharmony|qnx|rim tablet os|sailfish|series40|symbian|tizen|webos)\w*[-\/; ]?([\d\.]*)/i],[u,f],[/\(bb(10);/i],[f,[u,ft]],[/(?:symbian ?os|symbos|s60(?=;)|series ?60)[-\/ ]?([\w\.]*)/i],[f,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[u,it+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[u,Z+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,Ne],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux)(?: arm\w*| x86\w*| ?)([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,f],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[u,f]]},H=function(_,T){if(typeof _===p&&(T=_,_=i),!(this instanceof H))return new H(_,T).getResult();var S=typeof e!==d&&e.navigator?e.navigator:i,k=_||(S&&S.userAgent?S.userAgent:r),V=S&&S.userAgentData?S.userAgentData:i,q=T?ws(Ge,T):Ge,C=S&&S.userAgent==k;return this.getBrowser=function(){var y={};return y[u]=i,y[f]=i,vt.call(y,k,q.browser),y[w]=bs(y[f]),C&&S&&S.brave&&typeof S.brave.isBrave==a&&(y[u]="Brave"),y},this.getCPU=function(){var y={};return y[I]=i,vt.call(y,k,q.cpu),y},this.getDevice=function(){var y={};return y[h]=i,y[c]=i,y[l]=i,vt.call(y,k,q.device),C&&!y[l]&&V&&V.mobile&&(y[l]=b),C&&y[c]=="Macintosh"&&S&&typeof S.standalone!==d&&S.maxTouchPoints&&S.maxTouchPoints>2&&(y[c]="iPad",y[l]=v),y},this.getEngine=function(){var y={};return y[u]=i,y[f]=i,vt.call(y,k,q.engine),y},this.getOS=function(){var y={};return y[u]=i,y[f]=i,vt.call(y,k,q.os),C&&!y[u]&&V&&V.platform&&V.platform!="Unknown"&&(y[u]=V.platform.replace(/chrome os/i,Ne).replace(/macos/i,He)),y},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return k},this.setUA=function(y){return k=typeof y===m&&y.length>B?oe(y,B):y,this},this.setUA(k),this};H.VERSION=n,H.BROWSER=Rt([u,f,w]),H.CPU=Rt([I]),H.DEVICE=Rt([c,h,l,Q,b,R,v,D,j]),H.ENGINE=H.OS=Rt([u,f]),s.exports&&(t=s.exports=H),t.UAParser=H;var ot=typeof e!==d&&(e.jQuery||e.Zepto);if(ot&&!ot.ua){var Dt=new H;ot.ua=Dt.getResult(),ot.ua.get=function(){return Dt.getUA()},ot.ua.set=function(_){Dt.setUA(_);var T=Dt.getResult();for(var S in T)ot.ua[S]=T[S]}}})(typeof window=="object"?window:Hs)})(xt,xt.exports)),xt.exports}var Ws=Us(),Wt=(s=>(s.LOCAL="local",s.SESSION="session",s))(Wt||{});function ge(s){let t;try{t=s==="local"?window.localStorage:window.sessionStorage;const e="__storage_test__";return t.setItem(e,e),t.removeItem(e),!0}catch(e){return e instanceof DOMException&&(e.code===22||e.code===1014||e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED")&&t&&t.length!==0}}function Mi(s){return s.type==="device"&&s.value==="iPhone6"?!!(N.ios&&window.outerHeight===667&&window.outerWidth===375&&window.devicePixelRatio===3):!1}function Ri(s){return s.type==="device"&&s.value==="s5"?!!(N.android&&window.outerHeight===560&&window.outerWidth===360&&window.devicePixelRatio===3):!1}function Di(s){if(!(s.type==="device"&&s.value==="kindle"))return!1;const t=navigator.userAgent;return/Kindle|Silk|KFAPW|KFARWI|KFASWI|KFFOWI|KFJW|KFMEWI|KFOT|KFSAW|KFSOWI|KFTBW|KFTHW|KFTT|WFFOWI/i.test(t)}function Li(s){var t,e;if(!(s.type==="browser"&&s.value==="safari-18.4"))return!1;const i=N.uaData,n=(t=i?.browser)==null?void 0:t.version;if(((e=i?.browser)==null?void 0:e.name)==="Mobile Safari"){if(!n)return!1;const[o,a]=n.split(".").map(Number);if(o===18&&a===4)return!0}return!1}function Oi(s){var t,e;if(!(s.type==="browser"&&s.value==="safari-18"))return!1;const i=N.uaData,n=(t=i?.browser)==null?void 0:t.version;if(((e=i?.browser)==null?void 0:e.name)==="Mobile Safari"){if(!n)return!1;const[o]=n.split(".").map(Number);if(o===18)return!0}return!1}class Bi{constructor(){this.allowGPUData=!0,this.customQueries=[],this.caches={query:{},browser:{},os:{},device:{},custom:{}},this.uaData=new Ws.UAParser().getResult(),this.isLocalStorageAllowed=ge(Wt.LOCAL),this.isSessionStorageAllowed=ge(Wt.SESSION),this._checkIPadPro()}get supportedFileFormats(){return console.warn("[Device] File format detection is no longer supported. Returning default values of false"),{webp:!1,avif:!1}}get desktop(){return!(this.uaData.device.type==="tablet"||this.uaData.device.type==="mobile")}get mobile(){return this.isDevice("mobile")}get phone(){return this.isDevice("phone")}get tablet(){return this.isDevice("tablet")}get android(){return this.uaData.os.name==="Android"}get ios(){return this.uaData.os.name==="iOS"||this.uaData.os.name==="Mac OS"&&this.uaData.device.type==="tablet"}get kindle(){return this.isDevice("kindle")}get ie(){return this.uaData.browser.name==="IE"}get gpu(){return console.warn("[Device] GPU data is no longer supported. Returning default value of 2"),2}async init(){this.gpuData||(this.gpuData={tier:2,type:null})}addQuery(...t){this.customQueries.push(...t)}query(t){const e=this.checkCache(t,"query");if(e!==null)return e;const i=this.parseQuery(t);let n=!0;for(const r of i){const o=r;switch(o.type){case"browser":n=this.isBrowser(o.value);break;case"os":n=this.isOS(o.value);break;case"device":n=this.isDevice(o.value);break;case"gpu":console.warn("[Device] GPU data is no longer supported. Returning default value of 2"),n=this.isGPU(o.value);break;default:n=this.checkCustom(o);break}if(!n)break}return this.addToCache(t,n,"query"),n}isBrowser(t){const e=this.checkCache(t,"browser");if(e!==null)return e;const i=[()=>this.checkCustom({type:"browser",value:t}),()=>{const n=t.split(":");return n.length>1?this.uaData.browser.version.split(".")[0]===n[1]:!1},()=>this.uaData.browser.name.toLowerCase().replace(" ","-")===t];return this.checkTests(i,t,"browser")}isOS(t){const e=this.checkCache(t,"os");if(e!==null)return e;const i=[()=>this.checkCustom({type:"os",value:t}),()=>{const n=t.split(":");return n.length>1?this.uaData.os.version.split(".")[0]===n[1]:!1},()=>t==="mobile"||t==="desktop"?t==="mobile"?!this.desktop:this.desktop:!1,()=>this.uaData.os.name.toLowerCase().replace(" ","-")===t];return this.checkTests(i,t,"os")}isDevice(t){const e=this.checkCache(t,"device");if(e!==null)return e;const i=[()=>this.checkCustom({type:"device",value:t}),()=>t==="tablet"?this.uaData.device.type==="tablet":!1,()=>t==="mobile"?this.uaData.device.type==="tablet"||this.uaData.device.type==="mobile":!1,()=>t==="phone"?this.uaData.device.type==="mobile":!1,()=>this.uaData.device.model===t];return this.checkTests(i,t,"device")}isGPU(t){return this.gpu===Number(t)}parseQuery(t){return t.split("--").map(e=>{const i=e.split(":").filter(n=>n!==":");return{type:i.shift(),value:i.join(":")}})}checkCustom(t){const e=this.checkCache(JSON.stringify(t),"custom");if(e!==null)return e;for(const i of this.customQueries)if(i(t))return this.addToCache(JSON.stringify(t),!0,"custom"),!0;return this.addToCache(JSON.stringify(t),!1,"custom"),!1}checkCache(t,e){return this.caches[e][t]?this.caches[e][t]:null}checkTests(t,e,i){let n=!1;for(const r of t)if(n=r(),n)break;return this.addToCache(e,n,i),n}addToCache(t,e,i){this.caches[i][t]=e}_checkIPadPro(){const t=this.uaData.ua,e=t.includes("Mac OS")&&!t.includes("like Mac OS"),i="ontouchstart"in window;e&&i&&(this.uaData.device.type="tablet",this.uaData.device.vendor="apple",this.uaData.device.model="ipad-pro",console.warn("[Device]: OS cannot be determined on this device"))}}const N=new Bi;N.addQuery(Mi,Ri,Di,Li,Oi);Ns();class zi extends dt{constructor(){super(...arguments),this.initialised=new vi}async setup(){N.isBrowser("safari-18")&&(Cs.ogg=!1,console.warn("iOS 18 has a bug with ogg support. Ogg files have been disabled.")),await x.init(this.options),this.initialised.resolve()}async load(t){return Ii("8.4.0","Please use PixiJS Assets instead of ResourcePlugin. e.g Assets.load()"),typeof t=="string"?x.load(t):t.map(e=>x.load(e))}}yi.remove(me,fe);yi.add(Ai,ki,Pi);const qs={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",space:" "};class ye{constructor(){this.map={}}add(t){Object.entries(qs).forEach(([i,n])=>{i===t.key&&(t.key=n)});const e=this.map[t.key]||[];e.push(t),this.map[t.key]=e}remove(t){const e=this.map[t.key];if(!e)return;const i=e.indexOf(t);i<0||e.splice(i,1)}bindingsByKey(t){return this.map[t]||[]}}class Fi extends dt{constructor(t,e){super(t,e),this.enabled=!0,this._onKeyDown=i=>{if(!this.enabled||i.repeat)return;const n=i.key,r=this._keyDownBindings.bindingsByKey(n);for(const o of r)o.action&&o.action(),o.isDown=!0},this._onBlur=()=>{if(!this.enabled)return;const i=this._keyDownBindings.map;for(const n in i){const r=i[n];for(const o of r)o.isDown&&this._keyUpBindings.bindingsByKey(o.key).forEach(a=>{var d;(d=a.action)==null||d.call(a)}),o.isDown=!1}},this._onKeyUp=i=>{if(!this.enabled||i.repeat)return;const n=i.key;let r=this._keyUpBindings.bindingsByKey(n);for(const o of r)o.action&&o.action(),o.isDown=!1;r=this._keyDownBindings.bindingsByKey(n);for(const o of r)o.isDown=!1},this._keyDownBindings=new ye,this._keyUpBindings=new ye,window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),window.addEventListener("blur",this._onBlur)}dispose(){this._keyDownBindings.map={},this._keyUpBindings.map={},window.removeEventListener("keydown",this._onKeyDown),window.removeEventListener("keyup",this._onKeyUp),window.removeEventListener("blur",this._onBlur)}bindKeyDown(t,e,i){return typeof t=="string"?this._bindKeyDown(t,e,i):t.map(n=>this._bindKeyDown(n,e,i))}_bindKeyDown(t,e,i){const n=i?.allowHold||!1,r=i?.holdTime||.1,o={key:t,action:e,allowHold:n,currentHoldTime:r,holdTime:r};return this._keyDownBindings.add(o),o}bindKeyUp(t,e){return typeof t=="string"?this._bindKeyUp(t,e):t.map(i=>this.bindKeyUp(i,e))}_bindKeyUp(t,e){const i={key:t,action:e};return this._keyUpBindings.add(i),i}unbind(t){this._keyDownBindings.remove(t),this._keyUpBindings.remove(t)}update(t){const e=this._keyDownBindings.map;for(const i in e){const n=e[i];for(const r of n){const o=r;o.allowHold&&o.isDown&&(o.currentHoldTime>=0?o.currentHoldTime-=t/60:(o.currentHoldTime=o.holdTime,o.action&&o.action()))}}}getBindings(t){return this._keyDownBindings.bindingsByKey(t)}isKeyDown(t){if(typeof t=="string")return this._isKeyDown(t);const e=t.map(i=>this._isKeyDown(i));for(const i of e)if(i===!0)return!0;return!1}_isKeyDown(t){let e=!1;const i=this.getBindings(t);if(!i)return!1;for(const n in i)if(i[n].isDown){e=!0;break}return e}}class Te{constructor(t){this._enabled=!0,this._bubble=!0,this._down=!1,this._tapLock=new Ps,this._source=t,t?.on("pointertap",e=>{this._onTap(e)}).on("pointerdown",e=>{this._onDown(e)}).on("pointerup",e=>{this._onUp(e)}).on("pointerupoutside",e=>{this._onUp(e)}).on("pointerout",e=>{var i;(i=this.onOut)==null||i.call(this,this._convertEvent(e))}).on("pointermove",e=>{var i;(i=this.onMove)==null||i.call(this,this._convertEvent(e))}),this._updateEnabled()}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._updateEnabled()}get bubble(){return this._bubble}set bubble(t){this._bubble=t}async triggerTap(){this._down=!0,await this._onTap({pointerId:0,global:{x:0,y:0}})}_updateEnabled(){const t=this._source;t.interactive=this.enabled,t.cursor=this.enabled?"pointer":"default"}async _onTap(t){var e;this._bubble||t?.stopImmediatePropagation(),this._down&&this._tapLock.lock()&&(await((e=this.onTap)==null?void 0:e.call(this,this._convertEvent(t))),this._tapLock.unlock()),this._down=!1}_onDown(t){var e;this._bubble||t?.stopImmediatePropagation(),this._down=!0,(e=this.onDown)==null||e.call(this,this._convertEvent(t))}_onUp(t){var e;(e=this.onUp)!=null&&e.call(this,this._convertEvent(t))&&(this._down=!1)}_convertEvent(t){return{id:t.pointerId,position:new Et(t.global.x,t.global.y)}}}function $i(){return Math.min(window.devicePixelRatio,2)}function Ni(){return N.desktop}function Hi(){const s=document.createElement("canvas");let t,e,i,n=!1;try{t=s.getContext("webgl"),e=t.getExtension("WEBGL_debug_renderer_info"),i=t.getParameter(e.UNMASKED_RENDERER_WEBGL);const r=i.substring(0,8);(r==="Mali-400"||r==="Mali-450")&&(n=!0)}catch{console.warn("WebGL or renderer info not supported!")}return n}N.android||N.ios;class Y extends dt{constructor(t,e){super(t,e),e.resolution=e.resolution??$i(),e.antialias=e.antialias??Ni(),e.powerPreference=e.powerPreference??"high-performance",e.backgroundAlpha=e.backgroundAlpha??Hi()?0:1,this.canvas=e.canvas=e.canvas||this._setupCanvas(),this.wrapper=document.createElement("div"),this.wrapper.style.transformOrigin="0 0",this.wrapper.appendChild(e.canvas),(e.autoAddToDocument??!0)&&document.body.appendChild(this.wrapper),this.stage=new M,this.mainContainer=new M,this.overlayContainer=new M,this.stage.addChild(this.mainContainer),this.stage.addChild(this.overlayContainer),this.useHalfFPS=e.useHalfFPS??!1,this._halfTick=0,this.rendererPromise=Es({canvas:this.canvas,...this.options})}async init(){this.renderer=await this.rendererPromise,this.renderer.accessibility&&(this.renderer.accessibility.debug=this.options.accessibilityDebug??!1,(this.options.alwaysOnAccessibility??!1)&&(this.renderer.accessibility._isMobileAccessibility=!0,this.renderer.accessibility._activate(),this.renderer.accessibility._destroyTouchHook()))}_setupCanvas(){const t=document.createElement("canvas");return t.id="pixi-canvas",t.style.position="absolute",t.style.left="0px",t.style.right="0px",t.style.top="0px",t.style.bottom="0px",t.style.width="100%",t.style.height="100%",t.style.overflow="visible",t.style.display="block",t.style.margin="0 auto",t}start(){this.app.updateRunner.remove(this.update),this.app.updateRunner.add(this.update)}update(t){(!N.ios||t>.8)&&(this._halfTick++,(!this.useHalfFPS||this._halfTick%2)&&this.renderer.render(this.stage))}get view(){return this.renderer.canvas}get element(){return this.renderer.canvas}set interactive(t){this.stage.interactive=t,this.stage.interactiveChildren=t}get interactive(){return this.stage.interactive}}function Ui(s,t){return{rendererWidth:s,rendererHeight:t,canvasWidth:s,canvasHeight:t}}class Ce extends dt{constructor(t,e){var i;super(t,e),this.onResize=new ht.Signal,this._w=0,this._h=0,this._canvasWidth=0,this._canvasHeight=0,this.autoResize=e.autoResize??!0,this.resizeFunction=e?.resizeFunction||Ui,this.fitToCanvasParent=e.fitToCanvasParent,this.orientationLock=e.orientationLock??"none",((i=screen?.orientation)==null?void 0:i.type)===void 0&&(this.orientationLock="none")}prepare(){var t,e;if(this.orientationLock!=="none"&&this._overrideMapPositionToPoint(),this.autoResize){const i=(e=(t=this.app.get(Y))==null?void 0:t.view)==null?void 0:e.parentElement,n=this.fitToCanvasParent?i:null;window.addEventListener("resize",()=>{const{width:a,height:d}=this._getMeasurements(n);bi(this.resize,N.desktop?0:100,this)(a,d)});const{width:r,height:o}=this._getMeasurements(n);this.resize(r,o)}}_getMeasurements(t){if(!t||!this.fitToCanvasParent)return{width:t?.clientWidth??window.innerWidth,height:t?.clientHeight??window.innerHeight};const e=this.app.get(Y),i=e?.canvas;if(!i?.style)return{width:t.clientWidth,height:t.clientHeight};const n=i.style.display,r=n!=="none";try{r&&(i.style.display="none");const o=t.clientWidth,a=t.clientHeight;return{width:o,height:a}}finally{r&&(i.style.display=n)}}_overrideMapPositionToPoint(){ks.prototype.mapPositionToPoint=(t,e,i)=>{const n=1/this.resolution,o=this.app.get(Y).canvas,a=o.width,d=o.height,p=parseFloat(o.style.width),m=parseFloat(o.style.height),w=this.orientationLock==="portrait",c={x:e,y:i};switch(screen.orientation.type){case"portrait-primary":w||(c.x=i,c.y=m-e);break;case"landscape-primary":w&&(c.x=p-i,c.y=e);break;case"landscape-secondary":w&&(c.x=i,c.y=m-e);break;case"portrait-secondary":w||(c.y=p-i);break}t.x=c.x*(a/p)*n,t.y=c.y*(d/m)*n}}set resolution(t){const e=this.app.get(Y).renderer;e.resolution=t,this.resize(this._w,this._h,!0)}get resolution(){return this.app.get(Y).renderer.resolution}resize(t,e,i=!1){var n;const r=this.app.get(Y),o=r.renderer,a=((n=screen?.orientation)==null?void 0:n.type)??"unknown",d=this.orientationLock==="none"||a.includes(this.orientationLock),{canvasWidth:p,canvasHeight:m,rendererWidth:w,rendererHeight:c}=d?this.resizeFunction(t,e):this.resizeFunction(e,t);if(i||this._w!==w||this._h!==c||this._canvasWidth!==p||this._canvasHeight!==m||this.currentOrientation!==a){this._w=w,this._h=c,this._canvasWidth=p,this._canvasHeight=m,this.currentOrientation=a;const u=r.canvas;if(u.style.width=`${p}px`,u.style.height=`${m}px`,this.orientationLock!=="none"&&this.currentOrientation!=="unknown"){const l=this.orientationLock==="portrait";switch(a){case"portrait-primary":r.wrapper.style.transform=l?"":`rotate(90deg) translate(0, -${m}px)`;break;case"landscape-primary":r.wrapper.style.transform=l?`rotate(-90deg) translate(-${p}px, 0)`:"";break;case"landscape-secondary":r.wrapper.style.transform=l?`rotate(90deg) translate(0, -${m}px)`:"";break;case"portrait-secondary":r.wrapper.style.transform=l?"":`rotate(-90deg) translate(-${p}px, 0)`;break}}window.scrollTo(0,0),o.resize(this.w,this.h),this.onResize.emit(this.w,this.h)}}get w(){return this._w}get h(){return this._h}get width(){return this._w}get height(){return this._h}get canvasWidth(){return this._canvasWidth}get canvasHeight(){return this._canvasHeight}get isCorrectOrientation(){return this.orientationLock==="none"||this.currentOrientation.includes(this.orientationLock)}}class we{constructor(t){this.app=t,this.view=new M}async init(){}async show(){}shown(){}async hide(){}async hidden(){}resize(t,e){}}class Wi{constructor(){this.history=[],this.currentIndex=-1}navigate(t,e){this.history=this.history.slice(0,this.currentIndex+1),this.history.push({id:t,data:e}),this.currentIndex++}back(){return this.canGoBack()?(this.currentIndex--,this.currentScreen()):null}forward(){return this.canGoForward()?(this.currentIndex++,this.currentScreen()):null}canGoBack(){return this.currentIndex>0}canGoForward(){return this.currentIndex<this.history.length-1}currentScreen(){return this.history[this.currentIndex]}}class qi extends M{constructor(t={}){super(),this.barWidth=t.width??100;const e=this.getPixiObject(t.bg,this.barWidth),i=this.getPixiObject(t.frame,this.barWidth),n=this.getPixiObject(t.bar??16711680,this.barWidth);t.frameTint!==void 0&&(i.tint=4144959),this._easing=t.easing??1,this._easeRatio=0,this._ratio=0,e&&(this.bg=e,this.addChild(e)),n&&(this.addChild(n),this.bar=n),i&&(i.width>n.width&&(i.x=-(i.width-n.width)/2),i.height>n.height&&(i.y=-(i.height-n.height)/2),this.addChild(i));const r=this.getPixiObject(t.mask,this.barWidth);r&&(this._barMask=r,this.addChild(this._barMask),this.bar.mask=this._barMask,this._barMask.x-=this.bar.width),this.onRender=this._updateTransform}_updateTransform(){this._easeRatio+=(this._ratio-this._easeRatio)*this._easing,this.bar&&!this._barMask?this.bar.scale.x=this._easeRatio:this._barMask&&(this._barMask.x=-this._barMask.width+this._barMask.width/100*(this._easeRatio*100))}getPixiObject(t,e){let i=null;return typeof t=="number"?(i=new wi,i.context.fill({color:t}).rect(0,0,e,40)):typeof t=="string"?i=$.from(t):i=t,i}set ratio(t){this._ratio=Math.max(Math.min(t,1),0)}get ratio(){return this._ratio}}class Gi{constructor(){this.view=new M,this.bar=new qi({bg:0,bar:16711680,width:300}),this.view.addChild(this.bar)}updateProgress(t){this.bar.ratio=t}show(){this.view.alpha=0,U.to(this.view,.4,{alpha:1})}hide(){return new Promise(t=>{U.to(this.view,.4,{alpha:0,onComplete:t})})}resize(t,e){this.bar.x=t/2-this.bar.barWidth/2,this.bar.y=e/2}}class Yi{constructor(){this._transitionMap={}}get default(){return this._transitionMap.all?this._transitionMap.all.all:null}set default(t){"transition"in t?this.register(t):this.register({transition:t})}register(t){const e={from:"all",to:"all",both:!1},i=Object.fromEntries(Object.entries(t).filter(([m,w])=>w!=null)),{from:n,to:r,both:o,transition:a,...d}={...e,...i};let p=this._transitionMap[n];p||(p=this._transitionMap[n]={}),p[r]={transition:a,...d},o&&this.register({transition:a,from:r,to:n,...d})}get(t,e){const i=(n,r)=>this._transitionMap[n]?this._transitionMap[n][r]||this._transitionMap[n].all:null;return i(t,e)||i("all",e)||this.default}}class ji{constructor(t={}){this.autoManageContainers=!0,this.duration=.4,this.prepare(t)}prepare(t){this.duration=t.duration||this.duration}hide(t,e){return new Promise(i=>{U.to(e.view,{duration:this.duration,alpha:0,onComplete:()=>{e.view.alpha=1,i()}})})}show(t,e,i){return new Promise(n=>{i.view.alpha=0,U.to(i.view,{duration:this.duration,alpha:1,onComplete:()=>{n()}})})}}class be{constructor(t,e){this.onChange=new ht.Signal,this.onShown=new ht.Signal,this.w=0,this.h=0,this.history=new Wi,this._loaderActive=!1,this._applyLoaderAsOverlay=!1,this._loadingScreenDelay=1e3,this.options=e,this.app=t,this.view=e?.view||new M,this.transitionManager=new Yi,e?.defaultTransitionClass?this.transitionManager.default=new e.defaultTransitionClass(e.defaultTransitionOptions):this.transitionManager.default=new ji(e?.defaultTransitionOptions),this.screens={},this.add(we,{},"empty",!0),this.currentScreenId="empty",this.visibleScreens=[],this._applyLoaderAsOverlay=e?.applyLoaderAsOverlay??!1,this._loadingScreenDelay=e?.loadingScreenDelay??1e3}getVisibleScreens(){return this.visibleScreens.map(t=>t.instance)}get(t){var e;return(e=this.screens[t])==null?void 0:e.instance}getScreen(t){return this.get(t)}add(t,e,i,n=!1){if(this.screens[i])throw new Error(`Screen id ${i} has already been assigned`);const r={instance:null,class:t,options:e,id:i};n&&(r.instance=new t(this.app,r.options)),this.screens[i]=r}async back(){const t=this.history.back();t&&await this.show(t.id,{force:!0,data:t.data},!0)}async forward(){const t=this.history.forward();t&&await this.show(t.id,{force:!0,data:t.data},!0)}async show(t,e={},i=!1){if(!(this.currentScreenId===t&&!e.force)){if(!this.screens[t])throw new Error(`Screen id ${t} does not exist`);if(this.nextScreenId=t,this.nextData=e,this.transitionPromise){if(this.nextScreenId===t)return;await this.transitionPromise;return}else if(this.currentScreenId===t&&!e.force)return;this.onChange.emit(t,e),this.transitionPromise=this.createTransitionPromise(this.nextData.data,i,this.nextData.transitionOptions),await this.transitionPromise,this.transitionPromise=null,this.onShown.emit(t,e)}}async goto(t,e={}){return this.show(t,e)}async hide(){return this.show("empty")}async preloadScreen(t,e){var i,n;const r=this.screens[t];if(!r)throw new Error(`Screen id ${t} does not exist`);const o=r.instance;r.instance||(r.instance=new r.class(this.app,r.options)),await this._loadScreen(r,e?.data),o||await((n=(i=r.instance).init)==null?void 0:n.call(i,r.options))}createTransitionPromise(t,e=!1,i){return new Promise(async n=>{var r,o,a,d,p,m,w,c,u,l,h,f;this.view.interactiveChildren=!1;const{transition:I,loadingScreenDelay:Q,applyLoaderAsOverlay:b,loaderOptions:v,loaderScreenClass:R,loadBeforeTransition:D}=i??this.transitionManager.get(this.currentScreenId,this.nextScreenId),j=I.autoManageContainers,B=this.screens[this.currentScreenId],A=this.screens[this.nextScreenId],W=!A.instance,pt=this.currentScreenId==="empty"||B?.instance instanceof we,ft=b??this._applyLoaderAsOverlay;W&&(A.instance=new A.class(this.app,A.options));let J=Promise.resolve(),Z=!1,et=this.loader;const it=D??this.options.loadBeforeTransition;J=this._loadScreen(A,t).then(()=>{var K;Z=!0,(K=et?.complete)==null||K.call(et)}),it&&(et=this._initLoader(R,v),await this._awaitLoad(J,Q??this._loadingScreenDelay,Z,async()=>{})),await((r=I.prepare)==null?void 0:r.call(I,i?.data||{})),(o=I.resize)==null||o.call(I,this.w,this.h),B&&(await((d=(a=B.instance).hide)==null?void 0:d.call(a)),(!pt||pt&&I.forceHideOnEmptyScreen)&&await I.hide(this.view,B.instance,A.instance),ft||this._hideScreen(B,j)),it?W&&await((m=(p=A.instance).init)==null?void 0:m.call(p,A.options)):(et=this._initLoader(),await this._awaitLoad(J,Q??this._loadingScreenDelay,Z,async()=>{var K,mt;W&&await((mt=(K=A.instance).init)==null?void 0:mt.call(K,A.options))})),this.currentScreenId=A.id,e||this.history.navigate(this.currentScreenId,t),ft&&this._hideScreen(B,j),await((c=(w=A.instance).prepare)==null?void 0:c.call(w,t)),A.instance.resize(this.w,this.h),await((l=(u=A.instance).show)==null?void 0:l.call(u)),this.view.interactiveChildren=!0,this.visibleScreens.push(A),j&&this.view.addChild(A.instance.view),await I.show(this.view,B?.instance,A.instance),(f=(h=A.instance).shown)==null||f.call(h);const st=this.visibleScreens.indexOf(B);st!==-1&&this.visibleScreens.splice(st,1),this.currentScreenId!==this.nextScreenId&&await this.createTransitionPromise(this.nextData.data,void 0,this.nextData.transitionOptions),n()})}resize(t,e){this.w=t,this.h=e,this.screens[this.currentScreenId]&&this.screens[this.currentScreenId].instance.resize(t,e),this.loader&&this.loader.resize(t,e)}update(t){var e,i;const n=this.visibleScreens;for(const r of n)r.instance.update&&r.instance.update(t);this._loaderActive&&((i=(e=this.loader).update)==null||i.call(e,t))}_initLoader(t,e){var i,n,r,o,a;if(this.loader)(a=(o=this.loader).prepare)==null||a.call(o,e??this.options.loaderOptions??{}),this.loader.resize(this.w,this.h);else{const d=t??(((i=this.options)==null?void 0:i.loaderScreenClass)||Gi);this.loader=new d(this.app),(r=(n=this.loader).prepare)==null||r.call(n,e??this.options.loaderOptions??{}),this.loader.resize(this.w,this.h)}return this.loader}async _awaitLoad(t,e,i,n){const r=setTimeout(()=>{var o,a;i||(this.view.addChild(this.loader.view),this.loader.show(),(a=(o=this.loader).start)==null||a.call(o),this._loaderActive=!0)},e);await t,await n(),this._loaderActive?(await this.loader.hide(),this._loaderActive=!1,this.view.removeChild(this.loader.view)):clearTimeout(r)}_loadScreen(t,e){return new Promise(async i=>{const n=t.instance,r=[],o=[],a=[];let d=0,p=0,m=0,w=0;if(n.preload&&n.preload){const c=await n.preload(e);c&&(r.push(...c.manifests??[]),o.push(...c.assets??[]),a.push(...c.promises??[]))}(n.manifests||n.assets)&&(n.manifests&&r.push(...n.manifests),n.assets&&o.push(...n.assets)),r.length&&++w,o.length&&++w,a.length&&++w,await Promise.all([x.loadBundle(r,c=>{var u,l;d=c,(l=(u=this.loader)==null?void 0:u.updateProgress)==null||l.call(u,(d+p+m)/w)}),x.load(o,c=>{var u,l;p=c,(l=(u=this.loader)==null?void 0:u.updateProgress)==null||l.call(u,(d+p+m)/w)}),...a.map(async c=>{var u,l;await c,m+=1/a.length,(l=(u=this.loader)==null?void 0:u.updateProgress)==null||l.call(u,(d+p+m)/w)})]),i()})}_hideScreen(t,e){e&&this.view.removeChild(t?.instance.view),t?.instance.hidden&&t.instance.hidden()}}class Ee extends dt{constructor(t,e){super(t,e),this.w=0,this.h=0,this.stack=[],this.view=new M;const i={},n=e?.config?Object.entries(e.config):[];if(n.find(([r])=>r==="main")||n.unshift(["main",{options:e.main}]),!n.find(([r])=>r==="overlay")){const r=n.findIndex(([o])=>o==="main");n.splice(r+1,0,["overlay",{options:e.overlay}])}n.forEach(([r,o])=>{var a;const d=new be(this.app,o.options);this.view.addChild(d.view),i[r]=d,this.stack.push(d);for(const p in o.screens){const m=o.screens[p],w=typeof m=="function",c=w?m:m.screen,u=w?{}:m.options,l=w?!1:m.async;d.add(c,u,p,l),!w&&((a=m.transitions)==null||a.forEach(h=>{d.transitionManager.register({...h,from:h.from??p})}))}}),this.layers=i}get main(){return this.layers.main}get overlay(){return this.layers.overlay}prepare(){const t=this.app.get(Ce),e=this.app.get(Y);t&&(t.onResize.connect(this.resize.bind(this)),this.resize(t.w,t.h)),e.mainContainer.addChild(this.view)}add(t,e,i,n=!1){this.addToLayer("main",t,e,i,n)}addToLayer(t,e,i,n,r=!1){const o=this.layers[t];if(!o)throw new Error(`Layer ${t} does not exist`);o.add(e,i,n,r)}addScreens(t){t.forEach(e=>{var i;const n=this.layers[e.layer];n.add(e.screen,e.options,e.id,e.async),(i=e.transitions)==null||i.forEach(r=>{n.transitionManager.register({...r,from:r.from??e.id})})})}async goto(t,e={}){return this.main.goto(t,e)}getLayer(t){return this.layers[t]}gotoLayer(t,e,i={}){const n=this.layers[t];if(!n)throw new Error(`Layer '${t}' does not exist`);return n.goto(e,i)}addLayer(t,e){this.addLayerAt(t,e,this.stack.length)}removeLayer(t){const e=this.layers[t];if(!e)throw new Error(`Layer '${t}' does not exist`);this.view.removeChild(e.view),delete this.layers[t],this.stack.splice(this.stack.indexOf(e),1)}addLayerAt(t,e,i){if(i>this.stack.length||i<0)throw new Error(`Layer index ${i}, is out of bound`);if(this.layers[t])throw new Error(`Layer '${t}' already exists`);const n=new be(this.app,e);this.view.addChildAt(n.view,i),this.layers[t]=n,this.stack.splice(i,0,n)}setLayerIndex(t,e){if(e>=this.stack.length)throw new Error(`Layer index ${e}, is out of bound`);const i=this.layers[t];if(!i)throw new Error(`Layer '${t}' does not exist`);this.view.setChildIndex(i.view,e),this.stack.splice(this.stack.indexOf(i),1),this.stack.splice(e,0,i)}resize(t,e){this.w=t,this.h=e,this.stack.forEach(i=>{i.resize(t,e)})}update(t){this.stack.forEach(e=>{e.update(t)})}}function Ki(s,t,e=!1){const i=s/t;return(n,r)=>{let o=n,a=r;e&&(a=r,o=Math.min(n,s,a*i));const d=o<s?s/o:1,p=a<t?t/a:1,m=d>p?d:p,w=Math.floor(o*m),c=Math.floor(a*m);return{rendererWidth:w,rendererHeight:c,canvasWidth:o,canvasHeight:a}}}new Is;const Vi=Object.freeze(Object.defineProperty({__proto__:null,AlphaTransition:ji,Application:Ci,Bar:qi,Device:N,DeviceClass:Bi,EmptyScreen:we,History:Wi,KeyBindingCollection:ye,KeyboardPlugin:Fi,LoaderScreen:Gi,NakedPromise:vi,PerformanceTracker:xe,Plugin:dt,Prioritiser:xi,ResizePlugin:Ce,ResourcePlugin:zi,ScreenGroup:be,ScreensPlugin:Ee,StagePlugin:Y,StorageType:Wt,TouchInput:Te,TransitionManager:Yi,aspectResize:Ki,atlasResolver:Pi,autoDetectAntialias:Ni,autoDetectResolution:$i,autoDetectStorage:ge,autoDetectTransparency:Hi,deprecation:Ii,formatTextures:Ei,getPixiRunnerData:_i,isGalaxyS5:Ri,isIPhone6:Mi,isKindle:Di,isSafari18:Oi,isSafari18Dot4:Li,limitFPS:Si,loadTexturesWrapper:ki,loadWebFontWrapper:Ai,promiseAllRunner:Ti,promiseRunner:zt,resizeDefault:Ui,throttle:bi},Symbol.toStringTag,{value:"Module"}));class Gs{app;view;constructor(t,e){this.app=t,this.view=new M}onPrepare(){}onShow(){}onUpdate(t){}onHide(){}onHidden(){}onPause(){}onResume(){}onResize(t,e){}async prepare(){await this.onPrepare()}async show(){await this.onShow()}update(t){this.onUpdate(t)}async hide(){await this.onHide()}async hidden(){await this.onHidden()}pause(){this.onPause()}resume(){this.onResume()}resize(t,e){this.onResize(t,e)}}const Xi=class Ft{constructor(t,e=0){this.items=[],this._name=t,this.running=!1,this.dispatch=Ft._generateRun(t,e),this.run=this.dispatch,this.emit=this.dispatch,this._dummy={},this._dummy[t]=()=>{}}static _generateRun(t,e){const i=`${t}|${e}`;let n=Ft._hash[i];if(!n){if(e>0){let r="arg0";for(let a=1;a<e;a++)r+=`,arg${a}`;const o=`this.running = true;
                            var items = this.items;
                            for(var i=0;i<items.length;i++)
                            { items[i].${t}(${r});}
                            this.running = false;
                            if( this.needsTidy) this.tidy()`;n=new Function(r,o)}else n=new Function(`this.running = true;
                                    var items = this.items;
                                    for(var i=0;i<items.length;i++)
                                    { items[i].${t}(); }
                                    this.running = false;
                                    if( this.needsTidy) this.tidy() `);Ft._hash[i]=n}return n}add(t){return t[this._name]&&(this.remove(t),this.items.push(t),this._toRemove=[],this.needsTidy=!1),this}remove(t){const e=this.items.indexOf(t);return this.running?(this.needsTidy=!0,this._toRemove.push(e),this.items[e]=this._dummy):e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){this.items.length=0}destroy(){this.removeAll(),this.items=null}tidy(){for(let t=this._toRemove.length-1;t>=0;t--){const e=this._toRemove[t];e!==-1&&this.items.splice(e,1)}}get empty(){return this.items.length===0}};Xi._hash={};let F=Xi;class lt{constructor(){this.id=new Int32Array(4)}setIndex(t){const e=t/31|0;this.id[e]=this.id[e]|1<<t%31}unsetIndex(t){const e=t/31|0;this.id[e]=this.id[e]&~(1<<t%31)}matchIndex(t){const e=this.id[0],i=this.id[1],n=this.id[2],r=this.id[3],o=t.id;return(o[0]&e^e)+(o[1]&i^i)+(o[2]&n^n)+(o[3]&r^r)===0}matchAnyIndex(t){const e=this.id[0],i=this.id[1],n=this.id[2],r=this.id[3],o=t.id;return(o[0]&e)+(o[1]&i)+(o[2]&n)+(o[3]&r)>0}}const qt={_ENTITY:0,_COMPONENT:0,_ENTITY_CLASS:0},Qi=class{constructor(){this.c={},this.UID=qt._ENTITY++,this.componentBitHash=new lt,this.queries=[],this.name=`item${this.UID}`,this.runners={init:new F("init",1),reset:new F("reset")},this._gc=!1,this._released=!1,this._pooled=!1,this._initialised=!1,this._staticComponents=this._staticComponents||new Set,this._addStaticComponents()}init(t){var e;if(this._initialised)return;this._addStaticComponents();const i=this.runners.init.items;for(let n=0;n<i.length;n++){const r=i[n];(e=r.init)==null||e.call(r,t?.[r.name]||{})}this._initialised=!0}reset(){this._gc=!1,this.runners.reset.run();for(const t in this.c){const e=this.c[t];if(e.signals){const i=e.signals;for(const n in i)i[n].disconnectAll()}e.dynamic&&this._removeComponent(e.name,e.id)}this._initialised=!1}addComponent(t,e,i=!1){var n;if(!t.NAME)throw new Error("[Entity] cannot add component that does not have a name");if(this.c[t.NAME])return this.c[t.NAME];t.ID===void 0&&(t.ID=qt._COMPONENT++);const r=new t;r.name=t.NAME,r.id=t.ID,r.entity=this,this.c[t.NAME]=r;for(const o in this.runners)this.runners[o].add(r);return this.componentBitHash.setIndex(t.ID),this._initialised&&((n=r.init)==null||n.call(r,e||{})),this.scene&&this.scene.queryManager.onEntityComponentAdded(this),i&&!this._staticComponents.has(t)&&this._staticComponents.add(t),this._staticComponents.has(t)||(r.dynamic=!0),r}removeComponent(t){return this._removeComponent(t.NAME,t.ID),this}removeAllComponents(){for(const t in this.c){const e=this.c[t];this._removeComponent(e.name,e.id)}return this}getComponent(t){return this.c[t.NAME]}setModified(t,e){for(let i=0;i<this.queries.length;i++)this.queries[i].modifiedQuery(this,t,e)}_addStaticComponents(){for(const t of this._staticComponents)this.addComponent(t,void 0,!0);return this}_removeComponent(t,e){var i;const n=this.c[t];if(n){for(const r in this.runners)this.runners[r].remove(n);this.componentBitHash.unsetIndex(e),this.scene&&this.scene.queryManager.onEntityComponentRemoved(this),(i=n.reset)==null||i.call(n),delete this.c[t]}}};Qi.POOL=!0;let Ys=Qi;class js{constructor(t,e){this._pool=[],this._count=0,this._debug=!1,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool.push(new this._classType);this._count+=t}get(){this._pool.length<=0&&this.prepopulate(Math.round(this._count*.2)+1);let t=this._pool.pop();return t||(t=new this._classType),t}return(t){if(this._pool.indexOf(t)!==-1){this._debug&&console.warn("Object already in pool",t);return}this._pool.push(t)}get totalSize(){return this._count}get totalFree(){return this._pool.length}get totalUsed(){return this._count-this._pool.length}}class Ks{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){var i;const r=this.getPool(t).get();return r._pooled=!0,(i=r.init)==null||i.call(r,e),r}return(t){var e;(e=t.reset)==null||e.call(t),t._pooled=!1,this._returnToPool(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new js(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const i=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[i]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}_returnToPool(t){this.getPool(t.constructor).return(t)}}const Ji=new Ks,ni=new Map;function ut(s,...t){const e=ni.get(s.ID)??new Set,i=class extends s{},n=new Set([...e,...t]);return i.ID=qt._ENTITY_CLASS++,ni.set(i.ID,n),Object.defineProperty(i.prototype,"_staticComponents",{value:n,writable:!0}),i}function kt(s,t){if(!s.POOL){const e=new s;return e.init(t),e}return Ji.get(s,t)}const Zi=class{init(t={}){this.layer=t.layer||"default",this.view=t.view||new M}};Zi.NAME="view2d";let ke=Zi;class At extends ut(Ys,ke){get view(){return this.c.view2d.view}get transform(){return this.c.view2d.view.transform}get position(){return this.view.position}get scale(){return this.view.scale}get rotation(){return this.view.rotation}get x(){return this.view.position.x}set x(t){this.view.position.x=t}get y(){return this.view.position.y}set y(t){this.view.position.y=t}get scaleX(){return this.view.scale.x}set scaleX(t){this.view.scale.x=t}get scaleY(){return this.view.scale.y}set scaleY(t){this.view.scale.y=t}}class Vs{constructor(){this.signals={}}register(...t){for(let e=0;e<t.length;e++){const i=t[e];this.signals[i]||(this.signals[i]=new ht.Signal)}}resetSignals(){for(const t in this.signals)this.signals[t].disconnectAll()}}class ts{constructor(t={}){this.timeScale=1,this.maxDeltaTime=1e3/20,this._fps=60,this._deltaTime=0,this._frameTime=0,this.timeScale=t.timeScale??1,this._lastTime=performance.now(),this.fps=t.fps??60}nextUpdate(){const t=performance.now();this._deltaTime=Math.min(t-this._lastTime,this.maxDeltaTime),this._frameTime=this._deltaTime/this._frameDuration,this._lastTime=t}get deltaTime(){return this._deltaTime*this.timeScale}get unscaledDeltaTime(){return this._deltaTime}get frameTime(){return this._frameTime*this.timeScale}get unscaledFrameTime(){return this._frameTime}get fps(){return this._fps}set fps(t){this._fps=t,this._frameDuration=1e3/this._fps}}class Xs extends ts{constructor(t={}){super(t),this.smooth=t.smooth??.2}nextUpdate(){const t=performance.now(),e=Math.min(t-this._lastTime,this.maxDeltaTime);this.smooth>0&&this.smooth<1?this._deltaTime-=(this._deltaTime-e)*this.smooth:this._deltaTime=e,this._frameTime=this._deltaTime/this._frameDuration,this._lastTime=t}}class Qs{constructor(t=[]){this.onAdded=new ht.Signal,this.onRemoved=new ht.Signal,this.children=t}add(t){this.children.indexOf(t)===-1&&(this.children.push(t),this.onAdded.emit(t))}remove(t){const e=this.children.indexOf(t);return e===-1?!1:(this.children.splice(e,1),this.onRemoved.emit(t),!0)}contains(t){return this.children.indexOf(t)!==-1}getIndex(t){return this.children.indexOf(t)}getItem(t){return this.children[t]}run(t,e){let i;if(e)for(i=0;i<this.children.length;i++)t.call(e,this.children[i]);else for(i=0;i<this.children.length;i++)t(this.children[i])}empty(){this.children.length=0,this.onAdded.disconnectAll(),this.onRemoved.disconnectAll()}get length(){return this.children.length}}function Js(s,t){if(s.Queries)for(const e in s.Queries){const i=s.Queries[e],n=i.components;if(!n||n.length===0)throw new Error("'components' attribute can't be empty in a query");const r=t.scene.queryManager.getQuery(n,e);t.queries||(t.queries={}),t.queries[e]=r,i.modified&&(r.reactive=!0,r.runners.modified.add(t)),i.added&&(r.reactive=!0,r.runners.added.add(t)),i.removed&&(r.reactive=!0,r.runners.removed.add(t))}}class Zs{constructor(t,e,i){this.reactive=!1,this.runners={added:new F("addedToQuery",2),removed:new F("removedFromQuery",2),modified:new F("modifiedQuery",5)},this.componentID=new lt,this.notComponentID=new lt,this.orComponentIDs=[],this.entities=[],this.key=e.name,this.componentID=e.componentID,this.notComponentID=e.notComponentID,this.orComponentIDs=e.orComponentIDs,this.name=i;for(let n=0;n<t.allEntities.children.length;n++){const r=t.allEntities.children[n];this.match(r.componentBitHash)&&this.entities.push(r)}}get first(){return this.entities[0]}forEach(t){for(let e=this.entities.length-1;e>=0;--e){const i=this.entities[e];t(i,e,this.entities)}}addEntity(t){~this.entities.indexOf(t)||(t.queries.push(this),this.entities.push(t),this.runners.added.run(t,this))}removeEntity(t){let e=this.entities.indexOf(t);~e&&(this.entities.splice(e,1),e=t.queries.indexOf(this),t.queries.splice(e,1),this.runners.removed.run(t,this))}modifiedQuery(t,e,i){this.runners.modified.run(t,t.c[e.NAME],i,this,e)}hasEntity(t){return!!~this.entities.indexOf(t)}match(t){const e=this.componentID.matchIndex(t),i=this.notComponentID.matchAnyIndex(t);let n=!0;return this.orComponentIDs.length>0&&(n=this.orComponentIDs.every(r=>r.matchAnyIndex(t))),e&&!i&&n}}class tn{constructor(t){this._scene=t,this._queries={}}onEntityComponentAdded(t){for(const e in this._queries){const i=this._queries[e];i.match(t.componentBitHash)?i.addEntity(t):i.removeEntity(t)}}onEntityComponentRemoved(t){for(const e in this._queries){const i=this._queries[e];i.match(t.componentBitHash)?i.addEntity(t):i.removeEntity(t)}}onEntityAdded(t){this.onEntityComponentAdded(t)}onEntityRemoved(t){for(const e in this._queries)this._queries[e].removeEntity(t)}getQuery(t,e){if(t.length===0)throw Error("[QueryManager] cannot create empty query");const i=this.generateQueryKey(t);let n=this._queries[i.name];return n||(this._queries[i.name]=n=new Zs(this._scene,i,e)),n}generateQueryKey(t){const e=new lt,i=new lt,n=[];let r="";const o=a=>{a.ID===void 0&&(a.ID=qt._COMPONENT++)};return t.forEach(a=>{if(typeof a=="object")if(a.operator==="not")a=a.component,o(a),i.setIndex(a.ID);else{const d=new lt;a.components.forEach(p=>{o(p),d.setIndex(p.ID)}),n.push(d),r+=`${d.id.toString()}||`}else o(a),e.setIndex(a.ID)}),{name:`${e.id.toString()}!${i.id.toString()}||${r}`,componentID:e,notComponentID:i,orComponentIDs:n}}}class en extends Vs{constructor(t={}){super(),this.allSystems=new Map,this.allEntities=new Qs,this.queryManager=new tn(this),this.paused=!1,this.runners={resize:new F("resize",2),preupdate:new F("preupdate",1),update:new F("update",1),postupdate:new F("postupdate",1),prerender:new F("prerender",1),render:new F("render",1),postrender:new F("postrender",1),reset:new F("reset",1)},this._enabled=!1,this._width=100,this._height=100,this._entitiesToRemove=[],this._systemsToStart=[],this.time=t.smoothTime?new Xs({smooth:t.smoothTime}):new ts,this._updateAndRender=t.updateAndRender??!0,t.autoStart=t.autoStart??!1,t.autoStart&&this.start()}start(){this._enabled||(this.allSystems.forEach(t=>{var e;(e=t.awake)==null||e.call(t)}),this._enabled=!0)}addSystem(t,e){var i,n;const r=t.NAME;if(!r)throw new Error("[SystemManager]: cannot add System without name");if(this.allSystems.has(r))return this.allSystems.get(r);const o=new t;o.scene=this,o.queries={},Js(t,o),(i=o.init)==null||i.call(o,e),this._enabled&&((n=o.awake)==null||n.call(o));const{runners:a}=this;for(const d in a)a[d].add(o);return this._systemsToStart.push(o),this.allSystems.set(t.NAME,o),o}getSystem(t){return this.allSystems.get(t.NAME)}addToScene(t){if(t._gc){const e=this._entitiesToRemove.indexOf(t);this._entitiesToRemove.splice(e,1),t._gc=!1}if(t.scene){if(t.scene===this)return;this._removeEntity(t)}t.scene=this,this.allEntities.add(t),this.queryManager.onEntityAdded(t)}removeFromScene(t){t._gc||!t.scene||(t._gc=!0,this._entitiesToRemove.push(t))}renderStart(){this._updateAndRender&&this.update(),this.runners.prerender.run(this.time),this.runners.render.run(this.time)}renderFinish(){this.runners.postrender.run(this.time)}update(){this.paused||!this._enabled||(this.time.nextUpdate(),this._startSystems(),this._removeEntities(),this.runners.preupdate.run(this.time),this._removeEntities(),this.runners.update.run(this.time),this._removeEntities(),this.runners.postupdate.run(this.time))}restart(){this.reset(),this.start()}reset(){this._removeEntities(),this.runners.reset.run();for(let t=this.allEntities.children.length-1;t>=0;--t){const e=this.allEntities.children[t];e._released=!0,this._removeEntity(e)}this.allEntities.empty();for(const t in this.runners)this.runners[t].removeAll();this._entitiesToRemove.length=0,this.allSystems.forEach(t=>{for(const e in this.runners)this.runners[e].add(t);this._systemsToStart.push(t)}),this._enabled=!1}resize(t,e){this._width=t,this._height=e,this.runners.resize.run(t,e)}_removeEntities(){const t=this._entitiesToRemove;if(t.length){for(let e=0;e<t.length;e++){const i=t[e];this._removeEntity(i)}t.length=0}}_removeEntity(t){var e;t._released&&(t._pooled?Ji.return(t):(e=t.reset)==null||e.call(t)),this.queryManager.onEntityRemoved(t),this.allEntities.remove(t),t._gc=!1,t.scene=null,t._released=!1}_startSystems(){var t;for(let e=0;e<this._systemsToStart.length;e++){const i=this._systemsToStart[e];(t=i.start)==null||t.call(i)}this._systemsToStart.length=0}get width(){return this._width}get height(){return this._height}}const Ae=class{constructor(){this.w=-1,this.h=-1,this.camera={x:0,y:0,zoom:1,offset:{x:0,y:0}},this._activeItemsContainer=new M,this._layers={},this._innerContainer=new M}init(t={}){this.stage=t.stage||new M;const e=new Ke({render:()=>{this.scene.renderStart()}}),i=new Ke({render:()=>{this.scene.renderFinish()}});this.stage.isRenderGroup=!0,this.stage.addChild(e),this.stage.addChild(this._innerContainer),this._innerContainer.addChild(this._activeItemsContainer),this.stage.addChild(i),this.addLayer("back"),this.addLayer("default"),this.addLayer("front"),this.resize(1,1)}setCamera(t){this.camera=t,this.resize(this.w,this.h)}render(){const t=this.camera.zoom,e=this.stage;e.scale.set(t),e.position.x=this.w/2-this.w/2*t+this.camera.offset.x*2,e.position.y=this.h/2-this.h/2*t+this.camera.offset.y;const i=this._innerContainer.scale.x,n=this._innerContainer.scale.y;this._innerContainer.x=-this.camera.x*i+this.w/2,this._innerContainer.y=-this.camera.y*n+this.h/2}addedToQuery(t){const e=t,i=e.c.view2d.view;this._layers[e.c.view2d.layer].addChild(i)}removedFromQuery(t){const e=t,i=e.c.view2d.view;this._layers[e.c.view2d.layer].removeChild(i)}reset(){}addLayer(t,e=-1){this._layers[t]=new M,e===-1&&(e=this._activeItemsContainer.children.length),this._activeItemsContainer.addChildAt(this._layers[t],e)}setEntityLayer(t,e,i=-1){if(!this._layers[e])throw new Error(`Layer doesn't exist: ${e}`);const n=t.getComponent(ke);if(n){const r=n.view,o=this._layers[n.layer];o.children.indexOf(r)!==-1&&o.removeChild(r),i===-1&&(i=this._layers[e].children.length),this._layers[e].addChildAt(r,i),n.layer=e}}setLayerAt(t,e){const i=this.layers[t];i&&this.activeItemsContainer.addChildAt(i,e)}resize(t,e){this.w===t&&this.h===e||(this.w=t,this.h=e)}get layers(){return this._layers}get activeItemsContainer(){return this._activeItemsContainer}get innerContainer(){return this._innerContainer}};Ae.NAME="view2d";Ae.Queries={view2d:{components:[ke],added:!0,removed:!0}};let sn=Ae;class nn extends en{constructor(t){super(t),this.register("onGameover"),this.register("onGameComplete"),this.view2d=this.addSystem(sn,{stage:t.stage})}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addToScene(t[e]);else this.addToScene(t[0])}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeFromScene(t[e]);else this.removeFromScene(t[0])}}const Gt=new Map;function tt(s){if(Gt.has(s.id))throw new Error(`Part "${s.id}" is already registered`);Gt.set(s.id,s)}function Yt(s){const t=Gt.get(s);if(!t)throw new Error(`Part "${s}" not found in registry`);return t}function rn(s){return Gt.has(s)}const on={id:"simple-plate",name:"Simple Plate",asset:"images/parts/simple-plate.png",collision:{type:"box",width:200,height:100},material:"metal",constraint:{type:"static"},screwMounts:[{id:"top-left",localPosition:{x:20,y:20}},{id:"top-right",localPosition:{x:180,y:20}},{id:"bottom-left",localPosition:{x:20,y:80}},{id:"bottom-right",localPosition:{x:180,y:80}}]};tt(on);const an={id:"sliding-cover",name:"Sliding Cover",asset:"images/parts/sliding-cover.png",collision:{type:"box",width:150,height:80},material:"metal",constraint:{type:"slider",axis:"x",min:0,max:100},screwMounts:[{id:"left",localPosition:{x:25,y:40}},{id:"center",localPosition:{x:75,y:40}},{id:"right",localPosition:{x:125,y:40}}]};tt(an);const cn={id:"board-walnut-square",name:"Walnut Square Board",asset:"images/parts/board-walnut-square.png",collision:{type:"box",width:270,height:260},material:"wood",constraint:{type:"friction",screwThreshold:1},screwMounts:[{id:"top-left",localPosition:{x:30,y:30}},{id:"top-right",localPosition:{x:240,y:30}},{id:"bottom-left",localPosition:{x:30,y:230}},{id:"bottom-right",localPosition:{x:240,y:230}}]};tt(cn);const ln={id:"board-oak-horizontal",name:"Oak Horizontal Board",asset:"images/parts/board-oak-horizontal.png",collision:{type:"box",width:755,height:317},material:"wood",constraint:{type:"friction",screwThreshold:1},screwMounts:[{id:"top-left",localPosition:{x:30,y:30}},{id:"top-right",localPosition:{x:725,y:30}},{id:"bottom-left",localPosition:{x:30,y:287}},{id:"bottom-right",localPosition:{x:725,y:287}}]};tt(ln);const hn={id:"board-oak-vertical",name:"Oak Vertical Board",asset:"images/parts/board-oak-vertical.png",collision:{type:"box",width:270,height:417},material:"wood",constraint:{type:"friction",screwThreshold:1},screwMounts:[{id:"top-left",localPosition:{x:30,y:30}},{id:"top-right",localPosition:{x:240,y:30}},{id:"bottom-left",localPosition:{x:30,y:387}},{id:"bottom-right",localPosition:{x:240,y:387}}]};tt(hn);const dn={id:"board-birch-square",name:"Birch Square Board",asset:"images/parts/board-birch-square.png",collision:{type:"box",width:270,height:260},material:"wood",constraint:{type:"friction",screwThreshold:1},screwMounts:[{id:"top-left",localPosition:{x:30,y:30}},{id:"top-right",localPosition:{x:240,y:30}},{id:"bottom-left",localPosition:{x:30,y:230}},{id:"bottom-right",localPosition:{x:240,y:230}}]};tt(dn);const un={id:"board-mahogany-square",name:"Mahogany Square Board",asset:"images/parts/board-mahogany-square.png",collision:{type:"box",width:270,height:260},material:"wood",constraint:{type:"friction",screwThreshold:1},screwMounts:[{id:"top-left",localPosition:{x:30,y:30}},{id:"top-right",localPosition:{x:240,y:30}},{id:"bottom-left",localPosition:{x:30,y:230}},{id:"bottom-right",localPosition:{x:240,y:230}}]};tt(un);const pn={id:"board-pine-horizontal",name:"Pine Horizontal Board",asset:"images/parts/board-pine-horizontal.png",collision:{type:"box",width:501,height:317},material:"wood",constraint:{type:"friction",screwThreshold:1},screwMounts:[{id:"top-left",localPosition:{x:30,y:30}},{id:"top-right",localPosition:{x:471,y:30}},{id:"bottom-left",localPosition:{x:30,y:287}},{id:"bottom-right",localPosition:{x:471,y:287}}]};tt(pn);const es=40;function fn(s,t,e){return s.x-t>=0&&s.x+t<=e.width&&s.y-t>=0&&s.y+t<=e.height}function mn(s,t){let e=!1;const i=t.length;for(let n=0,r=i-1;n<i;r=n++){const o=t[n],a=t[r];o===void 0||a===void 0||o.y>s.y!=a.y>s.y&&s.x<(a.x-o.x)*(s.y-o.y)/(a.y-o.y)+o.x&&(e=!e)}return e}function gn(s,t,e){return[s,{x:s.x-t,y:s.y},{x:s.x+t,y:s.y},{x:s.x,y:s.y-t},{x:s.x,y:s.y+t}].every(n=>mn(n,e))}function yn(s,t,e=es){return t.type==="box"?fn(s,e,t):gn(s,e,t.points)}const z={centerX:540,centerY:1199,bounds:{minX:-407,maxX:407,minY:-430,maxY:430}};function wn(s){return{x:z.centerX+s.x,y:z.centerY+s.y}}function bn(s,t,e){const i=t/2,n=e/2,r=s.x-i,o=s.x+i,a=s.y-n,d=s.y+n;return r>=z.bounds.minX&&o<=z.bounds.maxX&&a>=z.bounds.minY&&d<=z.bounds.maxY}function vn(s,t,e){const i=t/2,n=e/2,r=s.x-i,o=s.x+i,a=s.y-n,d=s.y+n;return{leftEdge:r,rightEdge:o,topEdge:a,bottomEdge:d,exceedsLeft:r<z.bounds.minX,exceedsRight:o>z.bounds.maxX,exceedsTop:a<z.bounds.minY,exceedsBottom:d>z.bounds.maxY}}function Sn(s,t,e,i){const n=Yt(t.partId);if(!yn(s.position,n.collision)){const r=n.collision.type==="box"?`${String(n.collision.width)}x${String(n.collision.height)}`:`${String(n.collision.points.length)}-point polygon`;return{message:`Screw at (${String(s.position.x)}, ${String(s.position.y)}) extends beyond part bounds (${r}). Screw radius is ${String(es)}px.`,path:`parts[${String(i)}].screws[${String(e)}].position`}}return null}function _n(s){const t=Yt(s);if(t.collision.type==="box")return{width:t.collision.width,height:t.collision.height};const e=t.collision.points,i=e.map(r=>r.x),n=e.map(r=>r.y);return{width:Math.max(...i)-Math.min(...i),height:Math.max(...n)-Math.min(...n)}}function xn(s){const t=[];return s.exceedsLeft&&t.push(`left (${String(s.leftEdge)} < ${String(z.bounds.minX)})`),s.exceedsRight&&t.push(`right (${String(s.rightEdge)} > ${String(z.bounds.maxX)})`),s.exceedsTop&&t.push(`top (${String(s.topEdge)} < ${String(z.bounds.minY)})`),s.exceedsBottom&&t.push(`bottom (${String(s.bottomEdge)} > ${String(z.bounds.maxY)})`),t}function Tn(s,t){const{width:e,height:i}=_n(s.partId);if(bn(s.position,e,i))return null;const n=vn(s.position,e,i),r=xn(n),o=`(${String(s.position.x)}, ${String(s.position.y)})`,a=`${String(e)}x${String(i)}`;return{message:`Part "${s.partId}" at ${o} with size ${a} exceeds play area bounds. Exceeded: ${r.join(", ")}`,path:`parts[${String(t)}].position`}}function Cn(s,t){const e=[],i=[];if(!rn(s.partId)){const o=`parts[${String(t)}].partId`;return e.push({message:`Unknown part "${s.partId}"`,path:o}),{errors:e,warnings:i}}const n=Tn(s,t);n&&e.push(n);const r=new Set;return s.screws.forEach((o,a)=>{const d=Sn(o,s,a,t);d&&e.push(d);const p=`${String(o.position.x)},${String(o.position.y)}`;if(r.has(p)){const m=`parts[${String(t)}].screws[${String(a)}].position`,w=`Multiple screws at position (${String(o.position.x)}, ${String(o.position.y)})`;i.push({message:w,path:m})}r.add(p)}),{errors:e,warnings:i}}function En(s){const t=[];return s.trays.forEach((e,i)=>{(e.capacity<1||e.capacity>4)&&t.push({message:`Tray capacity must be 1-4, got ${String(e.capacity)}`,path:`trays[${String(i)}].capacity`})}),t}function kn(s){const t=[],e=[],i=new Map;s.parts.forEach((n,r)=>{const o=Cn(n,r);t.push(...o.errors),e.push(...o.warnings);const a=i.get(n.layer)??0;i.set(n.layer,a+1)});for(const[n,r]of i)r>1&&e.push({message:`${String(r)} parts share layer ${String(n)} - occlusion order may be ambiguous`,path:"parts"});return{errors:t,warnings:e}}function An(s){const t=[];if(s.win.type==="partsRemoved")for(const e of s.win.partIndices)(e<0||e>=s.parts.length)&&t.push({message:`Invalid part index ${String(e)} in win condition (valid: 0-${String(s.parts.length-1)})`,path:"win.partIndices"});else if(s.win.type==="targetFreed"){const{targetPartIndex:e}=s.win;(e<0||e>=s.parts.length)&&t.push({message:`Invalid target part index ${String(e)} in win condition`,path:"win.targetPartIndex"})}return t}function Pn(s){const t=[],e=[];t.push(...En(s)),s.bufferCapacity!==void 0&&s.bufferCapacity<1&&t.push({message:`Buffer capacity must be at least 1, got ${String(s.bufferCapacity)}`,path:"bufferCapacity"});const i=kn(s);return t.push(...i.errors),e.push(...i.warnings),t.push(...An(s)),{valid:t.length===0,errors:t,warnings:e}}function In(s,t,e,i){for(const n of s.errors)e.push({message:n.message,path:`levels[${String(t)}].${n.path}`});for(const n of s.warnings)i.push({message:n.message,path:`levels[${String(t)}].${n.path}`})}function Mn(s){const t=[],e=[],i=new Set;return s.levels.forEach((n,r)=>{i.has(n.id)&&t.push({message:`Duplicate level ID "${n.id}"`,path:`levels[${String(r)}].id`}),i.add(n.id),In(Pn(n),r,t,e)}),{errors:t,warnings:e}}function Rn(s){const t=[];s.levels.length!==10&&t.push({message:`Expected 10 levels, got ${String(s.levels.length)}`,path:"levels"});const e=Mn(s);return{valid:e.errors.length===0,errors:e.errors,warnings:[...t,...e.warnings]}}async function Dn(s){const t=await fetch(s);if(!t.ok)throw new Error(`Failed to load region from ${s}: ${String(t.status)}`);const e=await t.json(),i=Rn(e);if(!i.valid){const n=i.errors.map(r=>`  ${r.path}: ${r.message}`).join(`
`);throw new Error(`Region "${e.id}" validation failed:
${n}`)}return e}function Ln(s,t){const e=s.levels[t];if(e===void 0)throw new Error(`Level index ${String(t)} out of bounds (0-${String(s.levels.length-1)})`);return e}var P=(s=>(s.Red="red",s.Blue="blue",s.Green="green",s.Yellow="yellow",s))(P||{});function Pt(s,t){const e=class{static NAME=s;constructor(){Object.assign(this,structuredClone(t))}init(i){Object.assign(this,i)}reset(){Object.assign(this,structuredClone(t))}};return Object.keys(t).forEach(i=>{Object.defineProperty(e.prototype,i,{value:t[i],writable:!0,enumerable:!0,configurable:!0})}),e}const nt=Pt("screw",{color:P.Red,partEntityId:"",state:"inBoard",trayEntityId:"",slotIndex:-1,isAnimating:!1}),On=Pt("part",{partDefinitionId:"",layer:0,screwCount:0,state:"static"}),Xt=Pt("tray",{color:P.Red,capacity:3,screwCount:0,displayOrder:0,isAnimating:!1}),Pe=Pt("bufferTray",{capacity:5,screwIds:[]}),Ie=Pt("gameState",{phase:"playing",totalScrews:0,removedScrews:0,winConditionType:"allScrewsRemoved"}),Bn=ut(At,nt),zn=ut(At,On),Fn=ut(At,Xt),$n=ut(At,Pe),It=new WeakMap;function Nn(s){return It.get(s)}const Hn={[P.Red]:"short-screw-red",[P.Yellow]:"short-screw-yellow",[P.Green]:"short-screw-green",[P.Blue]:"short-screw-blue"},Un={[P.Red]:"screw-red",[P.Yellow]:"screw-yellow",[P.Green]:"screw-green",[P.Blue]:"screw-blue"},Wn={[P.Red]:"tray-red",[P.Yellow]:"tray-yellow",[P.Green]:"tray-green",[P.Blue]:"tray-blue"},qn={[P.Red]:"placeholder-red",[P.Yellow]:"placeholder-yellow",[P.Green]:"placeholder-green",[P.Blue]:"placeholder-blue"},Gn=185,ri=40,oi=40,Yn=75,is=new WeakMap;function ai(s){return is.get(s)}async function jn(s){const t=s.state??"inBoard",i=(t==="inBoard"?Hn:Un)[s.color],n=await x.load(i),r=kt(Bn,{screw:{color:s.color,state:t,partEntityId:s.partEntityId??""}}),o=new $(n);return o.anchor.set(.5),It.set(r,o),r.view.addChild(o),r.position.set(s.position.x,s.position.y),r}async function Kn(s){const t=await x.load(s.assetAlias),e=kt(zn,{part:{partDefinitionId:s.partDefinitionId,layer:s.layer??0,screwCount:0,state:"static"}}),i=new $(t);return i.anchor.set(.5),i.eventMode="static",It.set(e,i),e.view.addChild(i),e.position.set(s.position.x,s.position.y),e}async function Vn(s){const t=s.capacity??3,e=s.displayOrder??0,[i,n]=await Xn(s.color),r=Qn(s.color,t,e);return Jn(r,i),Zn(r,n,t),r.position.set(s.position.x,s.position.y),r}function Xn(s){return Promise.all([x.load(Wn[s]),x.load(qn[s])])}function Qn(s,t,e){return kt(Fn,{tray:{color:s,capacity:t,screwCount:0,displayOrder:e,isAnimating:!1}})}function Jn(s,t){const e=new $(t);It.set(s,e),s.view.addChild(e)}function Zn(s,t,e){const i=[],n=(e-1)*oi+ri,r=(Gn-n)/2+ri/2;for(let o=0;o<e;o++){const a=new $(t);a.anchor.set(.5),a.position.set(r+o*oi,Yn),a.alpha=.7,s.view.addChild(a),i.push(a)}is.set(s,i)}async function tr(s){const t=await x.load("buffer-tray-frame"),e=kt($n,{bufferTray:{capacity:s.capacity??5,screwIds:[]}}),i=new $(t);return It.set(e,i),e.view.addChild(i),e.position.set(s.position.x,s.position.y),e}const er=ut(At,Ie);class rt{forEachEntity(t,e){const i=this.queries[t];i&&i.forEach(e)}getEntities(t){return this.queries[t]?.entities??[]}getFirstEntity(t){return this.queries[t]?.first}getEntityCount(t){return this.queries[t]?.entities.length??0}getComponents(t,e){return t.c}}const O={framePosition:{x:32,y:187},background:{width:990,height:190,offsetX:15,offsetY:10,color:5460819},traySprite:{width:185},placeholder:{width:40},slotOffsets:[{x:25,y:16},{x:220,y:16},{x:419,y:19},{x:614,y:18},{x:808,y:18}]};function ss(s){const t=O.slotOffsets[s];if(!t)throw new Error(`Invalid slot index: ${String(s)}`);return{x:O.framePosition.x+t.x,y:O.framePosition.y+t.y}}function ce(s){return ss(s)}const ve={frame:{x:150,y:438},slotPositions:[{x:257,y:524},{x:409,y:524},{x:540,y:524},{x:676,y:524},{x:821,y:524}]},Qt=O.slotOffsets.map((s,t)=>ss(t)),ir=450,sr=O.framePosition.x+O.slotOffsets[4].x,ns=O.traySprite.width,jt=O.placeholder.width,Kt=40,rs=75;function nr(s,t,e,i){if(e){const a=ve.slotPositions[t];if(a)return{x:a.x,y:a.y};const d=ve.slotPositions[0];return{x:d.x+t*80,y:d.y}}const r=((i??3)-1)*Kt+jt,o=(ns-r)/2+jt/2;return{x:s.position.x+o+t*Kt,y:s.position.y+rs}}function rr(s,t,e){const i=Qt[s];if(!i)throw new Error(`Invalid displayOrder: ${String(s)}`);const n=(e-1)*Kt+jt,r=(ns-n)/2+jt/2;return{x:i.x+r+t*Kt,y:i.y+rs}}class or{listeners=new Map;on(t,e){let i=this.listeners.get(t);i||(i=new Set,this.listeners.set(t,i)),i.add(e)}off(t,e){const i=this.listeners.get(t);i&&i.delete(e)}emit(t,e){const i=this.listeners.get(t);if(i)for(const n of i)n(e)}clear(t){t?this.listeners.delete(t):this.listeners.clear()}}const g=new or;let Me=null,Re=null;function ar(s){Me=s}function cr(s){Re=s}function lr(){return Me}function hr(){return Re}function dr(){Me=null,Re=null}const L={background:{x:0,y:0},puzzleBase:{x:32,y:676},restartButton:{x:918,y:21},coloredTrayFrame:{x:O.framePosition.x,y:O.framePosition.y},trayCovers:[ce(2),ce(3),ce(4)],bufferTrayFrame:ve.frame};let at=0,Lt=!0;const E={get current(){return at},update(){at++},reset(){at=0},setLoggingEnabled(s){Lt=s},log(s,t){Lt&&console.log(`[T${String(at)}] ${s}: ${t}`)},debug(s){Lt&&console.log(`[T${String(at)}] ${s}`)},warn(s,t){Lt&&console.warn(`[T${String(at)}] ${s}: ${t}`)}};class De extends rt{static NAME="trayManagement";static Queries={trays:{components:[Xt]},screws:{components:[nt]}};transitionQueue=[];isTransitioning=!1;isBusy(){return this.isTransitioning||this.transitionQueue.length>0}init(){g.on("screw:removalComplete",this.handleScrewRemovalComplete),g.on("screw:transferComplete",this.handleScrewTransferComplete),g.on("tray:hideComplete",this.handleAnimationComplete),g.on("tray:shiftComplete",this.handleAnimationComplete),g.on("tray:revealComplete",this.handleRevealComplete)}handleScrewRemovalComplete=t=>{const e=t.screwEntity,i=this.getComponents(e).screw;if(i.state!=="inTray")return;const n=i.trayEntityId,r=this.findTrayByUID(n);if(!r)return;const o=this.getComponents(r).tray;if(o.screwCount>=o.capacity){const a=this.countScrewsInFlightToTray(n);if(a>0){E.log("TRAY",`${o.color} tray full but ${String(a)} screws still in-flight, waiting...`);return}this.queueTransition(r)}};handleScrewTransferComplete=t=>{this.handleScrewRemovalComplete(t)};countScrewsInFlightToTray(t){return this.getEntities("screws").filter(i=>{const n=this.getComponents(i).screw;return n.isAnimating&&n.state==="dragging"&&n.trayEntityId===t}).length}findTrayByUID(t){return this.getEntities("trays").find(i=>String(i.UID)===t)}queueTransition(t){this.transitionQueue.includes(t)||(this.transitionQueue.push(t),this.processNextTransition())}async processNextTransition(){if(this.isTransitioning||this.transitionQueue.length===0)return;this.isTransitioning=!0;const t=this.transitionQueue.shift();if(!t){this.isTransitioning=!1;return}const e=this.getComponents(t).tray;e.isAnimating=!0;const i=this.getSortedTrays(),n=this.findNextHiddenTray(i,t);await this.hideTray(t);const r=this.findTraysToShift(i,e.displayOrder,t);await this.shiftAndRevealTrays(r,n),this.finalizeTransition(e,r,n),this.processNextTransition()}getSortedTrays(){return this.getEntities("trays").sort((e,i)=>{const n=this.getComponents(e).tray.displayOrder,r=this.getComponents(i).tray.displayOrder;return n-r})}findNextHiddenTray(t,e){return t.find(i=>this.getComponents(i).tray.displayOrder>=2&&i!==e)}async hideTray(t){const e=this.getComponents(t).tray;E.log("TRAY",`${e.color} tray hidden (was full)`),g.emit("tray:startHide",{trayEntity:t});const i=await this.waitForEventWithData("tray:hideComplete");for(const n of i.screwsInTray)this.scene.removeChild(n);this.scene.removeChild(t)}findTraysToShift(t,e,i){return t.filter(n=>{const r=this.getComponents(n).tray;return r.displayOrder>e&&r.displayOrder<2&&n!==i})}async shiftAndRevealTrays(t,e){const i=this.emitShiftEvents(t),n=this.emitRevealEvent(e),r=n?[...i,n]:i;r.length>0&&await Promise.all(r)}emitShiftEvents(t){const e=[];for(const i of t){const n=this.getComponents(i).tray,r=n.displayOrder-1;n.displayOrder=r,n.isAnimating=!0,e.push(this.waitForEvent("tray:shiftComplete")),g.emit("tray:startShift",{trayEntity:i,newDisplayOrder:r})}return e}emitRevealEvent(t){if(!t)return null;const e=this.getComponents(t).tray,i=1;e.displayOrder=i,e.isAnimating=!0,E.log("TRAY",`${e.color} tray revealed at position ${String(i)}`);const n=this.waitForEvent("tray:revealComplete");return g.emit("tray:startReveal",{trayEntity:t,displayOrder:i}),n}finalizeTransition(t,e,i){E.log("TRAY_FINALIZE",`queueLen=${String(this.transitionQueue.length)} isTransitioning=${String(this.isTransitioning)}`),t.displayOrder=99,t.isAnimating=!1;for(const n of e){const r=this.getComponents(n).tray;r.isAnimating=!1}if(i){const n=this.getComponents(i).tray;n.isAnimating=!1}this.isTransitioning=!1,E.log("TRAY_FINALIZE"," isTransitioning=false, emitting tray:revealed, then processNextTransition"),i&&g.emit("tray:revealed",{trayEntity:i})}waitForEvent(t){return new Promise(e=>{const i=()=>{g.off(t,i),e()};g.on(t,i)})}waitForEventWithData(t){return new Promise(e=>{const i=n=>{g.off(t,i),e(n)};g.on(t,i)})}handleAnimationComplete=()=>{};handleRevealComplete=()=>{};update(t){}destroy(){g.off("screw:removalComplete",this.handleScrewRemovalComplete),g.off("screw:transferComplete",this.handleScrewTransferComplete),g.off("tray:hideComplete",this.handleAnimationComplete),g.off("tray:shiftComplete",this.handleAnimationComplete),g.off("tray:revealComplete",this.handleRevealComplete),this.transitionQueue=[],this.isTransitioning=!1}}class Jt extends rt{static NAME="screwPlacement";static Queries={coloredTrays:{components:[Xt]},bufferTrays:{components:[Pe]},screws:{components:[nt]}};findPlacementTarget(t){const e=this.anyTrayAnimating(),i=this.trayManagementBusy();if(E.log("PLACEMENT",`${t} screw  animating=${String(e)} busy=${String(i)}`),!e&&!i){const r=this.findColoredTrayTarget(t);if(r){const o=this.getComponents(r.tray).tray;if(o.displayOrder===1&&this.willDisplayOrder0Fill())E.log("PLACEMENT",` ${o.color} tray at displayOrder 1 would race, redirecting to buffer`);else return E.log("PLACEMENT",` ${o.color} tray [slot ${String(r.slotIndex)}]`),r}}const n=this.findBufferTrayTarget();return n?E.log("PLACEMENT",` buffer [slot ${String(n.slotIndex)}]`):E.log("PLACEMENT"," NO VALID TARGET"),n}trayManagementBusy(){return this.scene.getSystem(De).isBusy()}anyTrayAnimating(){return this.getEntities("coloredTrays").some(e=>this.getComponents(e).tray.isAnimating)}isBufferFull(){const t=this.getFirstEntity("bufferTrays");if(!t)return!0;const e=this.getComponents(t).bufferTray,i=e.screwIds.length,n=this.countScrewsAnimatingToBuffer();return i+n>=e.capacity}countScrewsAnimatingToBuffer(){const t=this.getFirstEntity("bufferTrays");if(!t)return 0;const e=String(t.UID);return this.getEntities("screws").filter(n=>{const r=this.getComponents(n).screw;return r.isAnimating&&r.state==="dragging"&&r.trayEntityId===e}).length}findColoredTrayTarget(t){const i=this.getEntities("coloredTrays").find(r=>{const o=this.getComponents(r).tray;return o.color===t&&o.displayOrder<2&&!o.isAnimating&&o.screwCount<o.capacity});if(!i)return null;const n=this.getComponents(i).tray;return{type:"colored",tray:i,slotIndex:n.screwCount}}findBufferTrayTarget(){const t=this.getFirstEntity("bufferTrays");if(!t)return null;const e=this.getComponents(t).bufferTray;return e.screwIds.length>=e.capacity?null:{type:"buffer",tray:t,slotIndex:e.screwIds.length}}reserveSlot(t,e){const i=this.getComponents(e).screw;if(t.type==="colored"){const n=this.getComponents(t.tray).tray;n.screwCount++}else this.getComponents(t.tray).bufferTray.screwIds.push(String(e.UID));i.trayEntityId=String(t.tray.UID),i.slotIndex=t.slotIndex}findAvailableColoredTray(t){return this.getEntities("coloredTrays").find(i=>{const n=this.getComponents(i).tray;return n.color===t&&n.displayOrder<2&&!n.isAnimating&&n.screwCount<n.capacity})??null}findScrewByUid(t){return this.getEntities("screws").find(i=>String(i.UID)===t)}hasValidMoves(){return this.getEntities("screws").some(e=>{const i=this.getComponents(e).screw;return i.state!=="inBoard"||i.isAnimating?!1:this.findPlacementTarget(i.color)!==null})}willDisplayOrder0Fill(){const t=this.getEntities("coloredTrays"),e=this.getEntities("screws");for(const i of t){const n=this.getComponents(i).tray;if(n.displayOrder!==0)continue;const r=String(i.UID),o=e.filter(a=>{const d=this.getComponents(a).screw;return d.isAnimating&&d.state==="dragging"&&d.trayEntityId===r}).length;if(n.screwCount+o>=n.capacity)return!0}return!1}update(t){}}class ur extends rt{static NAME="screwInteraction";static Queries={screws:{components:[nt]},gameState:{components:[Ie]}};touchInputs=new Map;initialized=!1;initTouchInputs(){this.initialized||(this.initialized=!0,this.forEachEntity("screws",t=>{this.setupTouchInput(t)}))}setupTouchInput(t){if(this.touchInputs.has(t.UID))return;const i=t.view;if(!i)return;i.eventMode="static",i.cursor="pointer";const n=new Te(i);n.onTap=()=>(this.handleScrewTap(t),Promise.resolve()),this.touchInputs.set(t.UID,n)}handleScrewTap(t){const e=this.getComponents(t).screw;if(!this.canInteractWithScrew(e))return;const i=this.scene.getSystem(Jt),n=i.findPlacementTarget(e.color);n&&(this.isInteractionBlocked(i)||(this.logTapAction(t,e.color,n),i.reserveSlot(n,t),e.isAnimating=!0,e.state="dragging",g.emit("screw:startRemoval",{screwEntity:t,targetTray:n.tray,slotIndex:n.slotIndex,isBuffer:n.type==="buffer"})))}isInteractionBlocked(t){const e=t.isBufferFull(),i=t.anyTrayAnimating(),n=t.trayManagementBusy();return e&&(i||n)?(E.log("BLOCKED",`bufferFull=${String(e)} animating=${String(i)} busy=${String(n)}`),!0):!1}logTapAction(t,e,i){const n=t,r=Math.round(n.position.x),o=Math.round(n.position.y),a=i.type==="colored"?this.getComponents(i.tray).tray.color:"buffer";E.log("TAP",`(${String(r)}, ${String(o)})  ${e} screw  ${a} tray [slot ${String(i.slotIndex)}]`)}canInteractWithScrew(t){if(t.state!=="inBoard"||t.isAnimating)return!1;const e=this.getFirstEntity("gameState");return!(e&&this.getComponents(e).gameState.phase!=="playing")}cleanupTouchInput(t){const e=this.touchInputs.get(t.UID);e&&(e.enabled=!1,this.touchInputs.delete(t.UID))}update(t){if(!this.initialized){this.initTouchInputs();return}this.forEachEntity("screws",e=>{this.touchInputs.has(e.UID)||this.setupTouchInput(e)})}destroy(){for(const[t]of this.touchInputs){const e=this.getEntities("screws").find(i=>i.UID===t);e&&this.cleanupTouchInput(e)}this.touchInputs.clear(),this.initialized=!1}}const pr={[P.Red]:"screw-red",[P.Yellow]:"screw-yellow",[P.Green]:"screw-green",[P.Blue]:"screw-blue"},Se=.5,os=.7,fr=20,ci=.8,mr=130,gr=80;function li(s,t,e,i){const n=1-s;return n*n*t+2*n*s*e+s*s*i}class as{ctx;constructor(t){this.ctx=t}setupAnimationTimeline(t){const e=U.timeline();this.ctx.activeTimelines.add(e);const i=this.ctx.getAnimationLayer();return i&&i.addChild(t.view),e}cleanupTimeline(t){this.ctx.activeTimelines.delete(t)}async animateFlight(t,e,i,n,r){const o={t:0},a=()=>{this.updateFlightPosition(o.t,e,i,n)};await t.to(o,{t:1,duration:r,ease:"power2.inOut",onUpdate:a})}updateFlightPosition(t,e,i,n){e.position.x=li(t,n.startX,n.controlX,n.endX),e.position.y=li(t,n.startY,n.controlY,n.endY),i.scale.set(n.startScale+(n.endScale-n.startScale)*t)}async animateSettle(t,e,i){await t.to(e.scale,{x:i,y:i,duration:.1,ease:"bounce.out"})}hidePlaceholder(t,e){const n=this.ctx.getTrayPlaceholders(t)?.[e];n&&U.to(n,{alpha:0,duration:.15,ease:"linear"})}}class yr extends as{async handle(t){const{screwEntity:e,targetTray:i,slotIndex:n,isBuffer:r}=t,o=e,a=this.ctx.getGameVisual(o);if(o.view.eventMode="none",!a){this.complete(e,r,i,n);return}await this.animateRemoval(o,a,t),this.complete(e,r,i,n)}async animateRemoval(t,e,i){const n=this.setupAnimationTimeline(t);try{await this.executeAnimation(t,e,i,n)}finally{this.cleanupTimeline(n)}}async executeAnimation(t,e,i,n){const{targetTray:r,slotIndex:o,isBuffer:a}=i,d=this.ctx.getComponents(t).screw;await this.swapToLongScrew(e,d.color);const p={x:t.position.x,y:t.position.y},m=a?this.getSlotTargetPosition(r,o,a):this.getColoredTrayTargetPosition(r,o),w=a?os:Se,c=this.createFlightParams(p,m,w,mr);await this.animateFlight(n,t,e,c,.45),await this.animateSettle(n,e,w)}async swapToLongScrew(t,e){t.scale.set(ci);const i=await x.load(pr[e]);t.texture=i}createFlightParams(t,e,i,n){const r=t.y-fr;return{startX:t.x,startY:r,controlX:(t.x+e.x)/2,controlY:Math.min(r,e.y)-n,endX:e.x,endY:e.y,startScale:ci,endScale:i}}getColoredTrayTargetPosition(t,e){const i=this.ctx.getComponents(t).tray;return this.ctx.getTraySlotTargetPosition(i.displayOrder,e,i.capacity)}getSlotTargetPosition(t,e,i){const n=i?void 0:this.ctx.getComponents(t).tray.capacity;return this.ctx.getTraySlotPosition(t,e,i,n)}complete(t,e,i,n){const r=this.ctx.getComponents(t).screw;r.state=e?"inBuffer":"inTray",r.isAnimating=!1;const o=t;if(!e){const a=this.ctx.getColoredTrayLayer();a&&a.addChild(o.view),i&&n!==void 0&&(this.checkScrewPosition(o,i,n),this.hidePlaceholder(i,n))}g.emit("screw:removalComplete",{screwEntity:t})}checkScrewPosition(t,e,i){const n=this.ctx.getComponents(t).screw,r=this.ctx.getComponents(e).tray,o=this.ctx.getTraySlotTargetPosition(r.displayOrder,i,r.capacity),a=Math.abs(t.position.x-o.x),d=Math.abs(t.position.y-o.y);(a>.5||d>.5)&&E.warn("POSITION_MISMATCH",`${n.color} screw at (${t.position.x.toFixed(1)}, ${t.position.y.toFixed(1)}) expected (${String(o.x)}, ${String(o.y)}) delta=(${a.toFixed(1)}, ${d.toFixed(1)}) tray.displayOrder=${String(r.displayOrder)} tray.isAnimating=${String(r.isAnimating)}`)}}class wr extends as{async handle(t){const{screwEntity:e,targetTray:i,slotIndex:n}=t,r=e,o=this.ctx.getGameVisual(r);if(r.view.eventMode="none",!o){this.complete(e,i,n);return}const a=this.setupAnimationTimeline(r);try{await this.executeAnimation(r,o,t,a)}finally{this.cleanupTimeline(a)}this.complete(e,i,n)}async executeAnimation(t,e,i,n){const{targetTray:r,slotIndex:o}=i,a={x:t.position.x,y:t.position.y},d=this.ctx.getComponents(r).tray,p=this.ctx.getTraySlotTargetPosition(d.displayOrder,o,d.capacity),m=this.createTransferFlightParams(a,p);await this.animateFlight(n,t,e,m,.27),await this.animateSettle(n,e,Se)}createTransferFlightParams(t,e){return{startX:t.x,startY:t.y,controlX:(t.x+e.x)/2,controlY:Math.min(t.y,e.y)-gr,endX:e.x,endY:e.y,startScale:os,endScale:Se}}complete(t,e,i){const n=this.ctx.getComponents(t).screw;n.state="inTray",n.trayEntityId=String(e.UID),n.slotIndex=i,n.isAnimating=!1;const r=t,o=this.ctx.getColoredTrayLayer();o&&o.addChild(r.view),this.checkScrewPosition(r,e,i),this.hidePlaceholder(e,i),g.emit("screw:transferComplete",{screwEntity:t})}checkScrewPosition(t,e,i){const n=this.ctx.getComponents(t).screw,r=this.ctx.getComponents(e).tray,o=this.ctx.getTraySlotTargetPosition(r.displayOrder,i,r.capacity),a=Math.abs(t.position.x-o.x),d=Math.abs(t.position.y-o.y);(a>.5||d>.5)&&E.warn("POSITION_MISMATCH",`${n.color} screw at (${t.position.x.toFixed(1)}, ${t.position.y.toFixed(1)}) expected (${String(o.x)}, ${String(o.y)}) delta=(${a.toFixed(1)}, ${d.toFixed(1)}) tray.displayOrder=${String(r.displayOrder)} tray.isAnimating=${String(r.isAnimating)}`)}}class br{ctx;constructor(t){this.ctx=t}async handle(t){const{trayEntity:e}=t,i=e,n=this.ctx.getScrewsInTray(String(e.UID));this.reparentScrewsToTray(n,i),this.setupPivotForCenterScale(i),await this.animateScaleDown(i),g.emit("tray:hideComplete",{trayEntity:e,screwsInTray:n})}setupPivotForCenterScale(t){t.view.pivot.set(92.5,75),t.position.x+=92.5,t.position.y+=75}async animateScaleDown(t){const e=U.timeline();this.ctx.activeTimelines.add(e);try{await e.to(t.scale,{x:0,y:0,duration:.4,ease:"power2.in"})}finally{this.ctx.activeTimelines.delete(e)}}reparentScrewsToTray(t,e){const i=e.view;for(const n of t){const r=n,o=this.ctx.getGameVisual(r);if(!o)continue;const a=r.position.x-e.position.x,d=r.position.y-e.position.y;o.parent&&o.parent.removeChild(o),o.position.set(a,d),i.addChild(o)}}}class vr{ctx;constructor(t){this.ctx=t}async handle(t){const{trayEntity:e,newDisplayOrder:i}=t,n=e,r=Qt[i];if(!r){g.emit("tray:shiftComplete",{trayEntity:e});return}const o=this.ctx.getScrewsInTray(String(e.UID)),a=r.x-n.position.x,d=U.timeline();this.ctx.activeTimelines.add(d);try{this.addShiftAnimations(d,n,r.x,o,a),await d}finally{this.ctx.activeTimelines.delete(d)}g.emit("tray:shiftComplete",{trayEntity:e})}addShiftAnimations(t,e,i,n,r){t.to(e.position,{x:i,duration:.3,ease:"power2.inOut"},0);for(const o of n){const a=o;t.to(a.position,{x:a.position.x+r,duration:.3,ease:"power2.inOut"},0)}}}class Sr{ctx;constructor(t){this.ctx=t}async handle(t){const{trayEntity:e,displayOrder:i}=t,n=e,r=Qt[i];if(!r){g.emit("tray:revealComplete",{trayEntity:e});return}n.position.x=sr,n.position.y=r.y;const o=U.timeline();this.ctx.activeTimelines.add(o);try{await o.to(n.position,{x:r.x,duration:.3,ease:"power2.out"})}finally{this.ctx.activeTimelines.delete(o)}g.emit("tray:revealComplete",{trayEntity:e})}}class _r extends rt{static NAME="animation";static Queries={screws:{components:[nt]}};activeTimelines=new Set;screwRemoval;screwTransfer;trayHide;trayShift;trayReveal;handleRemovalEvent=t=>{this.screwRemoval.handle(t)};handleTransferEvent=t=>{this.screwTransfer.handle(t)};handleTrayHideEvent=t=>{this.trayHide.handle(t)};handleTrayShiftEvent=t=>{this.trayShift.handle(t)};handleTrayRevealEvent=t=>{this.trayReveal.handle(t)};init(){const t=this.createAnimatorContext();this.screwRemoval=new yr(t),this.screwTransfer=new wr(t),this.trayHide=new br(t),this.trayShift=new vr(t),this.trayReveal=new Sr(t),g.on("screw:startRemoval",this.handleRemovalEvent),g.on("screw:startTransfer",this.handleTransferEvent),g.on("tray:startHide",this.handleTrayHideEvent),g.on("tray:startShift",this.handleTrayShiftEvent),g.on("tray:startReveal",this.handleTrayRevealEvent)}createAnimatorContext(){return{activeTimelines:this.activeTimelines,getScrewsInTray:t=>this.getScrewsInTray(t),getComponents:t=>this.getComponents(t),getAnimationLayer:()=>lr(),getColoredTrayLayer:()=>hr(),getGameVisual:t=>Nn(t),getTrayPlaceholders:t=>ai(t)??null,getTraySlotTargetPosition:(t,e,i)=>rr(t,e,i),getTraySlotPosition:(t,e,i,n)=>nr(t,e,i,n)}}getScrewsInTray(t){const e=[];return this.forEachEntity("screws",i=>{const n=this.getComponents(i).screw;n.state==="inTray"&&n.trayEntityId===t&&e.push(i)}),e}hidePlaceholder(t,e){const n=ai(t)?.[e];n&&U.to(n,{alpha:0,duration:.15,ease:"linear"})}update(t){}destroy(){g.off("screw:startRemoval",this.handleRemovalEvent),g.off("screw:startTransfer",this.handleTransferEvent),g.off("tray:startHide",this.handleTrayHideEvent),g.off("tray:startShift",this.handleTrayShiftEvent),g.off("tray:startReveal",this.handleTrayRevealEvent);for(const t of this.activeTimelines)t.kill();this.activeTimelines.clear()}}class xr extends rt{static NAME="autoTransfer";static Queries={coloredTrays:{components:[Xt]},bufferTrays:{components:[Pe]},screws:{components:[nt]}};isTransferring=!1;handleRemovalComplete=()=>{queueMicrotask(()=>{this.checkAutoTransfer()})};handleTransferComplete=()=>{queueMicrotask(()=>{this.onTransferComplete()})};handleTrayRevealed=()=>{queueMicrotask(()=>{this.checkAutoTransfer()})};init(){g.on("screw:removalComplete",this.handleRemovalComplete),g.on("screw:transferComplete",this.handleTransferComplete),g.on("tray:revealed",this.handleTrayRevealed)}destroy(){g.off("screw:removalComplete",this.handleRemovalComplete),g.off("screw:transferComplete",this.handleTransferComplete),g.off("tray:revealed",this.handleTrayRevealed),this.isTransferring=!1}onTransferComplete(){this.isTransferring=!1,this.checkAutoTransfer()}checkAutoTransfer(){if(this.shouldSkipTransferCheck())return;const t=this.getFirstEntity("bufferTrays");if(!t)return;const e=this.getComponents(t).bufferTray;if(e.screwIds.length===0){E.log("AUTO_TRANSFER_CHECK"," skipped (buffer empty)");return}this.processBufferScrews(e.screwIds,t)}shouldSkipTransferCheck(){const t=this.isTransferring,e=this.anyTrayAnimating(),i=this.trayManagementBusy();return E.log("AUTO_TRANSFER_CHECK",`transferring=${String(t)} animating=${String(e)} busy=${String(i)}`),t?(E.log("AUTO_TRANSFER_CHECK"," skipped (already transferring)"),!0):e?(E.log("AUTO_TRANSFER_CHECK"," skipped (trays animating)"),!0):i?(E.log("AUTO_TRANSFER_CHECK"," skipped (tray management busy)"),!0):!1}processBufferScrews(t,e){E.log("AUTO_TRANSFER_CHECK",`buffer has ${String(t.length)} screws`);for(const i of t)if(this.tryTransferScrew(i,e))return}tryTransferScrew(t,e){const i=this.scene.getSystem(Jt),n=i.findScrewByUid(t);if(!n)return E.log("AUTO_TRANSFER_CHECK",` screw ${t} not found`),!1;const r=this.getComponents(n).screw;if(r.isAnimating)return E.log("AUTO_TRANSFER_CHECK",` ${r.color} screw still animating`),!1;const o=i.findAvailableColoredTray(r.color);return o?(this.initiateTransfer(n,o,e),!0):(E.log("AUTO_TRANSFER_CHECK",` ${r.color} screw has no matching visible tray`),!1)}anyTrayAnimating(){const t=this.getEntities("coloredTrays");for(const e of t)if(this.getComponents(e).tray.isAnimating)return!0;return!1}trayManagementBusy(){return this.scene.getSystem(De).isBusy()}initiateTransfer(t,e,i){this.isTransferring=!0;const n=this.getComponents(i).bufferTray,r=this.getComponents(e).tray,o=this.getComponents(t).screw,a=String(t.UID),d=n.screwIds.indexOf(a);d>=0&&n.screwIds.splice(d,1);const p=r.screwCount;r.screwCount++,E.log("TRANSFER",`${o.color} screw from buffer  ${r.color} tray [slot ${String(p)}]`),o.isAnimating=!0;const m={screwEntity:t,targetTray:e,slotIndex:p};g.emit("screw:startTransfer",m)}update(t){}}class Tr extends rt{static NAME="winCondition";static Queries={gameState:{components:[Ie]},screws:{components:[nt]}};handleRemovalComplete=()=>{this.checkConditions()};handleTransferComplete=()=>{this.checkStuckCondition()};init(){g.on("screw:removalComplete",this.handleRemovalComplete),g.on("screw:transferComplete",this.handleTransferComplete)}destroy(){g.off("screw:removalComplete",this.handleRemovalComplete),g.off("screw:transferComplete",this.handleTransferComplete)}checkConditions(){const t=this.getFirstEntity("gameState");if(!t)return;const e=this.getComponents(t).gameState;if(e.phase==="playing"){if(e.removedScrews++,this.checkWinCondition(e.winConditionType)){e.phase="won",g.emit("game:won");return}this.checkStuckCondition()}}checkWinCondition(t){return t==="allScrewsRemoved"?this.checkAllScrewsRemoved():this.checkAllScrewsRemoved()}countInBoardScrews(){return this.getEntities("screws").filter(t=>this.getComponents(t).screw.state==="inBoard").length}checkAllScrewsRemoved(){return this.countInBoardScrews()===0}checkStuckCondition(){const t=this.getFirstEntity("gameState");if(!t)return;const e=this.getComponents(t).gameState;if(e.phase!=="playing")return;this.scene.getSystem(Jt).hasValidMoves()||this.countInBoardScrews()>0&&(e.phase="stuck",g.emit("game:stuck"))}update(t){}}function Cr(){window.addEventListener("error",s=>{const t=s.error;window.__gameTest&&window.__gameTest.captureError(t instanceof Error?t:new Error(s.message),`${s.filename}:${String(s.lineno)}:${String(s.colno)}`)}),window.addEventListener("unhandledrejection",s=>{if(window.__gameTest){const t=s.reason;window.__gameTest.captureError(t instanceof Error?t:new Error(String(t)),"unhandledrejection")}})}function Le(){const s=new URLSearchParams(window.location.search),t=s.get("seed"),e=s.get("level");return{testMode:s.has("testMode")||s.get("testMode")==="1",seed:t!==null?parseInt(t,10):void 0,scene:s.get("scene")??void 0,muteAudio:s.has("muteAudio")||s.get("muteAudio")==="1",skipIntro:s.has("skipIntro")||s.get("skipIntro")==="1",region:s.get("region")??void 0,level:e!==null?parseInt(e,10):void 0}}function cs(){return Le().testMode||!1}const Er=new Set(["constructor","entity","scene","parent","children"]),kr=new Set(["view"]);function ls(s,t){return typeof t=="function"||s.startsWith("_")||Er.has(s)}function Ar(s,t){if(s==null)return{include:!0,value:s};if(typeof s!="object")return{include:!0,value:s};if(Array.isArray(s)&&(s.length===0||typeof s[0]!="object"))return{include:!0,value:s};if(!Array.isArray(s)){const e=hs(s,t+1);if(e!=="[max depth]")return{include:!0,value:e}}return{include:!1,value:null}}function hs(s,t=0){if(t>3)return"[max depth]";try{return JSON.parse(JSON.stringify(s))}catch{}if(typeof s!="object"||s===null)return s;const e=s,i={};for(const n of Object.keys(e)){if(ls(n,e[n]))continue;const{include:r,value:o}=Ar(e[n],t);r&&(i[n]=o)}return Object.keys(i).length>0?i:"[complex object]"}function Pr(s){if(s&&typeof s=="object"){const t=s,e=t.uid??t.UID;if(typeof e=="string")return e;if(typeof e=="number")return e.toString()}return null}function hi(s){if(s==null)return null;const t={},e=s;for(const i of Object.keys(e)){const n=e[i];if(!ls(i,n)){if(kr.has(i)){const r=Pr(n);r!==null&&(t[`${i}Uid`]=r);continue}n===null||typeof n!="object"||Array.isArray(n)?t[i]=n:t[i]=hs(n)}}return t}function Ir(s){const t={},e=s.c??s.components;if(e instanceof Map)e.forEach((i,n)=>{t[n]=hi(i)});else if(e&&typeof e=="object")for(const[i,n]of Object.entries(e))t[i]=hi(n);return t}function Mr(s){try{if(s.view?.getBounds){const t=s.view.getBounds();return{x:t.x,y:t.y,width:t.width,height:t.height}}}catch{}return null}function Rr(s){const t=s;return{id:t.UID??t.uid??"unknown",type:t.constructor?.name??"Entity",position:{x:t.position?.x??0,y:t.position?.y??0},scale:{x:t.scale?.x??1,y:t.scale?.y??1},rotation:t.rotation??0,visible:t.visible??!0,alpha:t.alpha??1,bounds:Mr(t),components:Ir(t),childCount:t.view?.children?.length??0}}function Dr(s){return s?(s.allEntities?.children??[]).map(i=>Rr(i)):[]}function Lr(s){if(!s)return[];const t=s;return!t.systems||!(t.systems instanceof Map)?[]:Array.from(t.systems.keys())}function Or(){let s=null;const t=()=>Dr(s),e=i=>t().find(n=>String(n.id)===i)??null;return{getScene:()=>s,getEntities:t,getEntity:e,queryByComponent:i=>t().filter(n=>i in n.components),getEntityCount:()=>t().length,hasEntity:i=>e(i)!==null,getSystems:()=>Lr(s),_setScene:i=>{s=i}}}let Br=0;function zr(s){let t=5381;for(let e=0;e<s.length;e++){const i=s.charCodeAt(e);t=(t<<5)+t+i,t=t&t}return(t>>>0).toString(16)}function Fr(s){const t=`${s.position.x.toFixed(2)},${s.position.y.toFixed(2)}`,e=`${s.scale.x.toFixed(2)},${s.scale.y.toFixed(2)}`,i=s.rotation.toFixed(4),n=s.visible?"1":"0",r=s.alpha.toFixed(2),a=Object.keys(s.components).sort().map(p=>`${p}:${JSON.stringify(s.components[p])}`).join(";");return`${typeof s.id=="number"?s.id.toString():s.id}|${s.type}|${t}|${e}|${i}|${n}|${r}|${a}`}function $r(s,t,e){return()=>{const i=s(),n=performance.now(),r=Br++,o=[...i].sort((p,m)=>{const w=typeof p.id=="number"?p.id.toString():p.id,c=typeof m.id=="number"?m.id.toString():m.id;return w.localeCompare(c)}),a=o.map(Fr).join("||"),d=zr(a);return{timestamp:n,frame:r,entityCount:i.length,entities:o,systems:e?.()??[],sceneState:t(),hash:d}}}const di=200;let Tt=[];function Nr(s){if(!["pointerDown","pointerUp","pointerMove","keyDown","keyUp"].includes(s.type))return;const e=window.__gameTest?.tick?.current??-1,i={action:s,tick:e,timestamp:performance.now()};Tt.push(i),Tt.length>di&&(Tt=Tt.slice(-di))}function Hr(){return[...Tt]}function Zt(s,t){const i=s.allEntities?.children??[],n=typeof t=="number"?t.toString():t;return i.find(r=>{const o=r,a=o.UID??o.uid;return(typeof a=="number"?a.toString():a)===n})??null}function Ur(s,t){const e=s,i=e.c??e.components;return i?i instanceof Map?i.get(t)??null:i[t]??null:null}function Wr(s,t,e,i){if(!s)return{success:!1,error:"Scene not available"};const n=Zt(s,t);if(!n)return{success:!1,error:`Entity ${t} not found`};const r=n;return r.position?.set?(r.position.set(e,i),{success:!0}):{success:!1,error:"Entity has no position property"}}function qr(s,t,e,i){if(!s)return{success:!1,error:"Scene not available"};const n=Zt(s,t);if(!n)return{success:!1,error:`Entity ${t} not found`};const r=Ur(n,e);return r?(Object.assign(r,i),{success:!0}):{success:!1,error:`Component ${e} not found`}}function Gr(s,t,e){if(!s)return{success:!1,error:"Scene not available"};const i=Zt(s,t);return i?(i.visible=e,{success:!0}):{success:!1,error:`Entity ${t} not found`}}function Yr(s,t){if(!s)return{success:!1,error:"Scene not available"};const e=Zt(s,t);if(!e)return{success:!1,error:`Entity ${t} not found`};const i=s;return i.removeChild?(i.removeChild(e),{success:!0}):{success:!1,error:"Scene has no removeChild method"}}function jr(s){return s?(s.paused=!0,{success:!0}):{success:!1,error:"Scene not available"}}function Kr(s){return s?(s.paused=!1,{success:!0}):{success:!1,error:"Scene not available"}}function Vr(s,t){if(!s)return{success:!1,error:"Scene not available"};const e=s;return e.update?(e.update(t),{success:!0}):{success:!1,error:"Scene has no update method"}}function le(s,t,e,i,n){if(!t)return{success:!1,error:"Canvas not available"};const r=t.getBoundingClientRect(),o=r.width/t.width,a=r.height/t.height,d=e*o,p=i*a,m=new PointerEvent(s,{bubbles:!0,cancelable:!0,clientX:r.left+d,clientY:r.top+p,button:n??0,pointerType:"mouse"});return t.dispatchEvent(m),{success:!0}}function ui(s,t,e){const i=new KeyboardEvent(s,{bubbles:!0,cancelable:!0,key:t,code:e});return window.dispatchEvent(i),{success:!0}}function Xr(s,t){switch(s.type){case"setPosition":return Wr(t,s.entityId,s.x,s.y);case"setComponent":return qr(t,s.entityId,s.component,s.data);case"setVisible":return Gr(t,s.entityId,s.visible);case"destroyEntity":return Yr(t,s.entityId);case"pause":return jr(t);case"resume":return Kr(t);case"tick":return Vr(t,s.deltaMs);default:return null}}function Qr(s,t){switch(s.type){case"pointerDown":return le("pointerdown",t,s.x,s.y,s.button);case"pointerUp":return le("pointerup",t,s.x,s.y,s.button);case"pointerMove":return le("pointermove",t,s.x,s.y,0);default:return null}}async function Jr(s,t){const e=Qr(s,t);if(e)return e;switch(s.type){case"keyDown":return ui("keydown",s.key,s.code);case"keyUp":return ui("keyup",s.key,s.code);case"wait":return await new Promise(i=>setTimeout(i,s.ms)),{success:!0};default:return null}}async function Zr(s,t,e){const i=Xr(s,t());if(i)return i;const n=await Jr(s,e());return n||{success:!1,error:`Unknown action type: ${s.type}`}}function to(s,t){return async e=>{try{return Nr(e),await Zr(e,s,t)}catch(i){return{success:!1,error:i instanceof Error?i.message:String(i)}}}}const pi=1e3;let ct=[],Ct=null,fi=!1;function eo(s){try{return typeof s=="object"&&s!==null?JSON.stringify(s,null,2):String(s)}catch{return Object.prototype.toString.call(s)}}function io(){return window.__gameTest?.tick?.current??-1}function he(s,t){const e={type:s,timestamp:performance.now(),tick:io(),args:t.map(eo)};ct.push(e),ct.length>pi&&(ct=ct.slice(-pi))}function so(){fi||(Ct={log:console.log.bind(console),warn:console.warn.bind(console),error:console.error.bind(console)},console.log=(...s)=>{Ct?.log(...s),he("log",s)},console.warn=(...s)=>{Ct?.warn(...s),he("warn",s)},console.error=(...s)=>{Ct?.error(...s),he("error",s)},fi=!0)}function no(){return[...ct]}function ro(){ct=[]}function oo(){return Ct}async function ao(){try{const{getApp:s}=await Ut(async()=>{const{getApp:n}=await Promise.resolve().then(()=>gs);return{getApp:n}},void 0),{StagePlugin:t}=await Ut(async()=>{const{StagePlugin:n}=await Promise.resolve().then(()=>Vi);return{StagePlugin:n}},void 0),e=s();return e?e.get(t).renderer??null:null}catch{return null}}async function ds(){try{const{getApp:s}=await Ut(async()=>{const{getApp:n}=await Promise.resolve().then(()=>gs);return{getApp:n}},void 0),{StagePlugin:t}=await Ut(async()=>{const{StagePlugin:n}=await Promise.resolve().then(()=>Vi);return{StagePlugin:n}},void 0),e=s();return e?e.get(t).stage??null:null}catch{return null}}async function co(){const s=await ao(),t=await ds();if(s?.extract&&t)try{return await s.extract.base64(t,"image/png")}catch(i){console.warn("[BugReport] Extract failed, falling back to toDataURL:",i)}const e=document.querySelector("canvas");if(!e)throw new Error("Canvas not found");return e.toDataURL("image/png")}function us(s,t=0,e=10){if(!s||t>e)return null;const i={type:s.constructor?.name??"Unknown",position:{x:s.x??0,y:s.y??0},scale:{x:s.scale?.x??1,y:s.scale?.y??1},rotation:s.rotation??0,visible:s.visible??!0,alpha:s.alpha??1};s.uid!==void 0&&(i.uid=String(s.uid)),s.label&&(i.label=s.label),s.UID!==void 0&&(i.entityUid=String(s.UID));try{if(typeof s.getBounds=="function"){const n=s.getBounds();n&&typeof n.x=="number"&&(i.bounds={x:n.x,y:n.y,width:n.width,height:n.height})}}catch{}if(s.texture){const n=s.texture;i.texture=n.label??n.uid??"texture"}if(s.children&&s.children.length>0){const n=[];for(const r of s.children){const o=us(r,t+1,e);o&&n.push(o)}n.length>0&&(i.children=n)}return i}function ps(s){let t=1;if(s.children)for(const e of s.children)t+=ps(e);return t}async function lo(){const s=await ds();if(!s)return null;const t=us(s);if(!t)return null;let e,i="unknown";if(window.__gameTest){const r=window.__gameTest.getRenderSignature();r&&(i=r.sceneState,e=r.entities.map(o=>({id:String(o.id),type:o.type,position:o.position,components:o.components})))}const n={timestamp:performance.now(),displayTree:t,displayObjectCount:ps(t),sceneState:i};return e&&(n.entities=e),n}async function ho(s){await window.__gameTest?.act({type:"pause"});let t="";try{t=await co()}catch(o){console.error("[BugReport] Failed to capture screenshot:",o)}const e=await lo(),i=no(),n=Hr();await window.__gameTest?.act({type:"resume"});const r={timestamp:new Date().toISOString(),url:window.location.href,screenshot:t,gameState:e,consoleLogs:i,userActions:n};return s&&(r.description=s),r}async function uo(s){try{return await(await fetch("/__bug-report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json()}catch(t){return{success:!1,error:t instanceof Error?t.message:String(t)}}}let $t=null;function po(){const s=document.createElement("div");return s.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
  `,s}function fo(){const s=document.createElement("div");return s.style.cssText=`
    background: #1a1a1a;
    border: 1px solid #333;
    border-radius: 8px;
    padding: 20px;
    width: 400px;
    max-width: 90vw;
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  `,s}function mo(){const s=document.createElement("h2");return s.textContent="Report Bug",s.style.cssText=`
    margin: 0 0 16px 0;
    font-size: 18px;
    font-weight: 600;
  `,s}function go(){const s=document.createElement("textarea");return s.placeholder="Describe the bug (optional)...",s.style.cssText=`
    width: 100%;
    height: 100px;
    padding: 10px;
    border: 1px solid #444;
    border-radius: 4px;
    background: #222;
    color: #fff;
    font-family: inherit;
    font-size: 14px;
    resize: vertical;
    box-sizing: border-box;
  `,s}function mi(s,t){const e=document.createElement("button");return e.textContent=s,e.style.cssText=`
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.2s;
    ${t?"background: #4CAF50; color: white;":"background: #444; color: #ddd;"}
  `,e.onmouseenter=()=>{e.style.background=t?"#45a049":"#555"},e.onmouseleave=()=>{e.style.background=t?"#4CAF50":"#444"},e}function yo(){const s=document.createElement("div");return s.style.cssText=`
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 16px;
  `,s}function wo(){const s=document.createElement("div");return s.style.cssText=`
    margin-top: 12px;
    padding: 10px;
    border-radius: 4px;
    font-size: 14px;
    display: none;
  `,s}function de(s,t,e){s.textContent=t,s.style.display="block",s.style.background=e?"#5c2020":"#1e3a1e",s.style.color=e?"#ff8080":"#80ff80"}function Ot(){$t&&($t.remove(),$t=null)}function bo(){Ot();const s=po(),t=fo(),e=mo(),i=go(),n=yo(),r=mi("Cancel",!1),o=mi("Submit Report",!0),a=wo();n.appendChild(r),n.appendChild(o),t.appendChild(e),t.appendChild(i),t.appendChild(n),t.appendChild(a),s.appendChild(t),r.onclick=Ot,s.onclick=d=>{d.target===s&&Ot()},o.onclick=async()=>{o.disabled=!0,r.disabled=!0,o.textContent="Submitting...",o.style.background="#666";try{const d=i.value.trim()||void 0,p=await ho(d),m=await uo(p);m.success?(de(a,`Report saved to: ${m.path??"unknown"}`,!1),setTimeout(Ot,2e3)):(de(a,`Error: ${m.error??"Unknown error"}`,!0),o.disabled=!1,r.disabled=!1,o.textContent="Submit Report",o.style.background="#4CAF50")}catch(d){de(a,`Error: ${d instanceof Error?d.message:String(d)}`,!0),o.disabled=!1,r.disabled=!1,o.textContent="Submit Report",o.style.background="#4CAF50"}},document.body.appendChild(s),$t=s,i.focus()}const fs="debugConsole",vo=350,Oe=200,Be=30,So=36;function _o(){try{const s=localStorage.getItem(fs);if(s)return JSON.parse(s)}catch{}return{x:10,y:window.innerHeight-Oe-10,minimized:!1,visible:!0}}function Vt(s){try{localStorage.setItem(fs,JSON.stringify(s))}catch{}}function xo(s){const t=document.createElement("div");t.id="debug-console";const e=s.minimized?Be:Oe;return t.style.cssText=`
    position: fixed;
    left: ${String(s.x)}px;
    top: ${String(s.y)}px;
    width: ${String(vo)}px;
    height: ${String(e)}px;
    background: rgba(17, 17, 17, 0.95);
    border: 1px solid #333;
    border-radius: 6px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 11px;
    z-index: 9999;
    display: ${s.visible?"flex":"none"};
    flex-direction: column;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    overflow: hidden;
  `,t}function To(){const s=document.createElement("div");return s.style.cssText=`
    height: ${String(Be)}px;
    background: #222;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 8px;
    cursor: move;
    user-select: none;
    border-bottom: 1px solid #333;
    flex-shrink: 0;
  `,s}function Co(){const s=document.createElement("span");return s.textContent="Debug Console",s.style.cssText=`
    color: #888;
    font-size: 12px;
    font-weight: 500;
  `,s}function Eo(){const s=document.createElement("div");return s.style.cssText=`
    display: flex;
    gap: 6px;
  `,s}function gi(s,t,e){const i=document.createElement("button");return i.textContent=s,i.title=t,i.style.cssText=`
    width: 20px;
    height: 20px;
    background: #333;
    border: none;
    border-radius: 3px;
    color: #888;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
  `,i.onmouseenter=()=>{i.style.background="#444",i.style.color="#fff"},i.onmouseleave=()=>{i.style.background="#333",i.style.color="#888"},i.onclick=n=>{n.stopPropagation(),e()},i}function ko(){const s=document.createElement("div");return s.style.cssText=`
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding: 6px 8px;
    color: #0f0;
  `,s}function Ao(){const s=document.createElement("div");return s.style.cssText=`
    height: ${String(So)}px;
    background: #222;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0 8px;
    gap: 8px;
    border-top: 1px solid #333;
    flex-shrink: 0;
  `,s}function ue(s,t,e){const i=document.createElement("button");return i.textContent=s,i.style.cssText=`
    padding: 4px 10px;
    background: ${t?"#2a5a2a":"#333"};
    border: 1px solid ${t?"#3d7a3d":"#444"};
    border-radius: 4px;
    color: ${t?"#6f6":"#aaa"};
    font-family: inherit;
    font-size: 11px;
    cursor: pointer;
  `,i.onmouseenter=()=>{i.style.background=t?"#3d7a3d":"#444",i.style.color=t?"#8f8":"#fff"},i.onmouseleave=()=>{i.style.background=t?"#2a5a2a":"#333",i.style.color=t?"#6f6":"#aaa"},i.onclick=e,i}function Po(s,t){const e=document.createElement("div");e.style.cssText=`
    color: ${s==="error"?"#f66":s==="warn"?"#ff0":"#0f0"};
    word-wrap: break-word;
    white-space: pre-wrap;
    margin-bottom: 2px;
    line-height: 1.4;
  `;const i=s==="error"?"ERR":s==="warn"?"WRN":"LOG";return e.textContent=`[${i}] ${t}`,e}function Io(s,t,e){let i=!1,n=0,r=0;const o=(p,m)=>{i=!0,n=p-e.x,r=m-e.y,document.body.style.userSelect="none"},a=(p,m)=>{if(!i)return;const w=p-n,c=m-r,u=window.innerWidth-s.offsetWidth,l=window.innerHeight-s.offsetHeight;e.x=Math.max(0,Math.min(w,u)),e.y=Math.max(0,Math.min(c,l)),s.style.left=`${String(e.x)}px`,s.style.top=`${String(e.y)}px`},d=()=>{i&&(i=!1,document.body.style.userSelect="",Vt(e))};t.addEventListener("mousedown",p=>{p.target.tagName!=="BUTTON"&&(p.preventDefault(),o(p.clientX,p.clientY))}),document.addEventListener("mousemove",p=>{a(p.clientX,p.clientY)}),document.addEventListener("mouseup",d),t.addEventListener("touchstart",p=>{if(p.target.tagName==="BUTTON")return;const m=p.touches[0];m&&(p.preventDefault(),o(m.clientX,m.clientY))},{passive:!1}),document.addEventListener("touchmove",p=>{if(!i)return;const m=p.touches[0];m&&(p.preventDefault(),a(m.clientX,m.clientY))},{passive:!1}),document.addEventListener("touchend",d),document.addEventListener("touchcancel",d)}function Mo(s,t){document.addEventListener("keydown",e=>{if(e.key==="`"&&!e.ctrlKey&&!e.metaKey&&!e.altKey){const i=e.target;if(i.tagName==="INPUT"||i.tagName==="TEXTAREA")return;t.visible=!t.visible,s.style.display=t.visible?"flex":"none",Vt(t)}})}function Ro(s){const t=[];return{addLog(i,n){const r=Po(i,n);for(s.appendChild(r),t.push(r);t.length>500;)t.shift()?.remove();s.scrollTop=s.scrollHeight},clear(){s.innerHTML="",t.length=0},getLogText(){return t.map(i=>i.textContent??"").join(`
`)}}}function Do(s){so();const t=oo(),e=console.log,i=console.warn,n=console.error;console.log=(...r)=>{e(...r);const o=r.map(a=>pe(a)).join(" ");s.addLog("log",o)},console.warn=(...r)=>{i(...r);const o=r.map(a=>pe(a)).join(" ");s.addLog("warn",o)},console.error=(...r)=>{n(...r);const o=r.map(a=>pe(a)).join(" ");s.addLog("error",o)},t?.log("[DebugConsole] Initialized - Press ` to toggle")}function pe(s){try{return typeof s=="object"&&s!==null?JSON.stringify(s,null,2):String(s)}catch{return Object.prototype.toString.call(s)}}function Lo(){const s=_o(),t=xo(s),e=To(),i=Co(),n=Eo(),r=ko(),o=Ao(),a=Ro(r),d=gi(s.minimized?"+":"-","Minimize/Expand",()=>{s.minimized=!s.minimized,t.style.height=s.minimized?`${String(Be)}px`:`${String(Oe)}px`,d.textContent=s.minimized?"+":"-",r.style.display=s.minimized?"none":"block",o.style.display=s.minimized?"none":"flex",Vt(s)}),p=gi("x","Close (` to reopen)",()=>{s.visible=!1,t.style.display="none",Vt(s)}),m=ue("Copy",!1,()=>{const u=a.getLogText();navigator.clipboard.writeText(u).then(()=>{const l=m.textContent;m.textContent="Copied!",setTimeout(()=>{m.textContent=l},1e3)})}),w=ue("Clear",!1,()=>{a.clear(),ro()}),c=ue("Report Bug",!0,()=>{bo()});return n.appendChild(d),n.appendChild(p),e.appendChild(i),e.appendChild(n),o.appendChild(m),o.appendChild(w),o.appendChild(c),t.appendChild(e),t.appendChild(r),t.appendChild(o),s.minimized&&(r.style.display="none",o.style.display="none"),Io(t,e,s),Mo(t,s),Do(a),t}let Nt=null;function Oo(){return{get current(){return Nt?.current??0},reset(){Nt?.reset()},setLoggingEnabled(s){Nt?.setLoggingEnabled(s)}}}function Bo(s){Nt=s}function zo(s,t){const e=async i=>(i.type==="pause"?s.sceneState="paused":i.type==="resume"&&(s.sceneState="running"),t(i));return{act:e,async actMany(i){const n=[];for(const r of i)n.push(await e(r));return n}}}function Fo(s){return{captureError(t,e){s.errors.push({message:t instanceof Error?t.message:t,stack:t instanceof Error?t.stack:void 0,timestamp:performance.now(),source:e})},snapshot:()=>({ready:s.ready,scene:s.scene,errors:[...s.errors],bootTimeMs:s.bootEndTime?s.bootEndTime-s.bootStartTime:void 0})}}function $o(s,t){return{markReady(e){s.ready=!0,s.scene=e,s.sceneState="running",s.bootEndTime=performance.now()},...Fo(s),registerScene(e){t._setScene(e)}}}function No(s,t){Object.defineProperties(s,{ready:{get:()=>t.ready,enumerable:!0},scene:{get:()=>t.scene,enumerable:!0},bootStartTime:{get:()=>t.bootStartTime,enumerable:!0},bootEndTime:{get:()=>t.bootEndTime,enumerable:!0},errors:{get:()=>t.errors,enumerable:!0}})}function Ho(){return{errors:[],ready:!1,scene:"",bootStartTime:performance.now(),bootEndTime:void 0,sceneState:"stopped"}}function Uo(){const s=Ho(),t=Or(),e=to(()=>t.getScene(),()=>document.querySelector("canvas")),i={...zo(s,e),...$o(s,t),metrics:{},ecs:t,tick:Oo(),getRenderSignature:$r(()=>t.getEntities(),()=>s.sceneState,()=>t.getSystems()),ready:!1,scene:"",bootStartTime:0,bootEndTime:void 0,errors:[]};return No(i,s),i}function Wo(){if(cs()){console.log("[TestHarness] Initializing test harness..."),window.__gameTest=Uo(),Cr();const s=Le();console.log("[TestHarness] Test params:",s)}}function qo(s){window.__gameTest&&window.__gameTest.markReady(s)}class Go extends rt{static NAME="tick";registered=!1;update(t){this.registered||(Bo(E),this.registered=!0),E.update()}}class Yo{scene;isInitialized=!1;backgroundLayer;uiLayer;puzzleLayer;coloredTrayLayer;animationLayer;restartButton=null;restartInput=null;trayCovers=[];trayEntities=new Map;bufferTrayEntity=null;gameStateEntity=null;partEntities=[];screwEntities=[];currentLevel=null;currentRegionPath=null;currentLevelIndex=0;constructor(t){this.scene=new nn({stage:t.stage}),this.backgroundLayer=new M,this.uiLayer=new M,this.puzzleLayer=new M,this.coloredTrayLayer=new M,this.animationLayer=new M,t.stage.addChild(this.backgroundLayer),t.stage.addChild(this.puzzleLayer),t.stage.addChild(this.uiLayer)}async init(){this.isInitialized||(window.__gameTest&&window.__gameTest.registerScene(this.scene),await this.loadAssets(),await this.createBackground(),await this.createTrayArea(),await this.createBufferTray(),await this.createRestartButton(),this.fixLayerOrder(),this.registerSystems(),this.setupGameEvents(),this.isInitialized=!0)}registerSystems(){this.scene.addSystem(Go),this.scene.addSystem(Jt),this.scene.addSystem(_r),this.scene.addSystem(ur),this.scene.addSystem(xr),this.scene.addSystem(Tr),this.scene.addSystem(De)}setupGameEvents(){g.on("game:won",()=>{this.handleGameWon()}),g.on("game:stuck",()=>{this.handleGameStuck()})}handleGameWon(){E.log("WIN","Level complete! You won!")}handleGameStuck(){E.log("STUCK","No moves available. Tap restart to try again.")}fixLayerOrder(){const t=this.scene.view2d.stage,e=this.scene.view2d.innerContainer;t.removeChild(this.backgroundLayer),t.removeChild(this.puzzleLayer),t.removeChild(e),t.removeChild(this.uiLayer),t.addChild(this.backgroundLayer),t.addChild(this.puzzleLayer),t.addChild(e),t.addChild(this.uiLayer),t.addChild(this.animationLayer),ar(this.animationLayer),cr(this.coloredTrayLayer)}async loadAssets(){this.registerAssetBundles(),await x.loadBundle(["common","ui","trays","screws","placeholders"])}registerAssetBundles(){this.registerCommonBundle(),this.registerUIBundle(),this.registerPlaceholderBundle(),this.registerTrayBundle(),this.registerScrewBundle()}registerCommonBundle(){x.addBundle("common",[{alias:"scene-background",src:"images/backgrounds/scene-background.png"},{alias:"puzzle-base",src:"images/ui/puzzle-base.png"}])}registerUIBundle(){x.addBundle("ui",[{alias:"restart-button",src:"images/ui/restart-button.png"},{alias:"colored-tray-frame",src:"images/ui/colored-tray-frame.png"},{alias:"buffer-tray-frame",src:"images/ui/buffer-tray-frame.png"},{alias:"tray-cover",src:"images/ui/tray-cover.png"}])}registerPlaceholderBundle(){x.addBundle("placeholders",[{alias:"placeholder-red",src:"images/placeholders/placeholder-red.png"},{alias:"placeholder-yellow",src:"images/placeholders/placeholder-yellow.png"},{alias:"placeholder-green",src:"images/placeholders/placeholder-green.png"},{alias:"placeholder-blue",src:"images/placeholders/placeholder-blue.png"}])}registerTrayBundle(){x.addBundle("trays",[{alias:"tray-red",src:"images/trays/tray-red.png"},{alias:"tray-yellow",src:"images/trays/tray-yellow.png"},{alias:"tray-green",src:"images/trays/tray-green.png"},{alias:"tray-blue",src:"images/trays/tray-blue.png"}])}registerScrewBundle(){x.addBundle("screws",[{alias:"short-screw-red",src:"images/screws/short-screw-red.png"},{alias:"short-screw-yellow",src:"images/screws/short-screw-yellow.png"},{alias:"short-screw-green",src:"images/screws/short-screw-green.png"},{alias:"short-screw-blue",src:"images/screws/short-screw-blue.png"},{alias:"screw-red",src:"images/screws/screw-red.png"},{alias:"screw-yellow",src:"images/screws/screw-yellow.png"},{alias:"screw-green",src:"images/screws/screw-green.png"},{alias:"screw-blue",src:"images/screws/screw-blue.png"}])}async createBackground(){const t=await x.load("scene-background"),e=new $(t);e.position.set(L.background.x,L.background.y),this.backgroundLayer.addChild(e);const i=await x.load("puzzle-base"),n=new $(i);n.position.set(L.puzzleBase.x,L.puzzleBase.y),this.puzzleLayer.addChild(n)}async createTrayArea(){const t=new wi;t.rect(0,0,O.background.width,O.background.height),t.fill({color:O.background.color}),t.position.set(L.coloredTrayFrame.x+O.background.offsetX,L.coloredTrayFrame.y+O.background.offsetY),this.uiLayer.addChild(t),this.uiLayer.addChild(this.coloredTrayLayer);const e=await x.load("tray-cover");for(const r of L.trayCovers){const o=new $(e);o.position.set(r.x,r.y),this.uiLayer.addChild(o),this.trayCovers.push(o)}const i=await x.load("colored-tray-frame"),n=new $(i);n.position.set(L.coloredTrayFrame.x,L.coloredTrayFrame.y),this.uiLayer.addChild(n)}async createLevelTrays(t){const e=t.trays;for(let i=0;i<e.length;i++){const n=e[i];if(!n)continue;const r=i,o=r<2,a=Qt[r],d=o?{x:a?.x??40,y:a?.y??202}:{x:a?.x??40,y:ir},p=await Vn({color:n.color,position:d,capacity:n.capacity,displayOrder:r});this.scene.addChild(p),this.trayEntities.set(n.color,p),this.coloredTrayLayer.addChild(p.view)}}async createBufferTray(){const t=await x.load("buffer-tray-frame"),e=new $(t);e.position.set(L.bufferTrayFrame.x,L.bufferTrayFrame.y),this.uiLayer.addChild(e)}async createRestartButton(){const t=await x.load("restart-button");this.restartButton=new $(t),this.restartButton.position.set(L.restartButton.x,L.restartButton.y),this.restartButton.eventMode="static",this.restartButton.cursor="pointer",this.restartInput=new Te(this.restartButton),this.restartInput.onTap=()=>(this.handleRestartClick(),Promise.resolve()),this.uiLayer.addChild(this.restartButton)}handleRestartClick(){this.currentRegionPath&&this.currentLevel&&(E.log("RESTART","Restarting level..."),this.loadLevel(this.currentRegionPath,this.currentLevelIndex))}getTrayByColor(t){return this.trayEntities.get(t)}getAnimationLayer(){return this.animationLayer}getColoredTrayLayer(){return this.coloredTrayLayer}getCurrentLevel(){return this.currentLevel}async loadLevel(t,e){this.clearLevel(),this.currentRegionPath=t,this.currentLevelIndex=e;const i=await Dn(t),n=Ln(i,e);this.currentLevel=n,await this.loadPartAssets(n),await this.createLevelEntities(n)}async createLevelEntities(t){this.createGameStateEntity(t),await this.createLevelTrays(t),await this.createBufferTrayEntity(t),await this.createPartsAndScrews(t)}createGameStateEntity(t){const e=t.parts.reduce((i,n)=>i+n.screws.length,0);this.gameStateEntity=kt(er,{gameState:{phase:"playing",totalScrews:e,removedScrews:0,winConditionType:t.win.type}}),this.scene.addChild(this.gameStateEntity)}async createBufferTrayEntity(t){this.bufferTrayEntity=await tr({position:{x:L.bufferTrayFrame.x,y:L.bufferTrayFrame.y},capacity:t.bufferCapacity??5}),this.scene.addChild(this.bufferTrayEntity)}async createPartsAndScrews(t){const e=[...t.parts].sort((i,n)=>i.layer-n.layer);for(const i of e){const n=Yt(i.partId),r=wn(i.position),o=await Kn({assetAlias:n.id,partDefinitionId:n.id,position:r,layer:i.layer});this.scene.addChild(o),this.partEntities.push(o),await this.createScrewsForPart(i,n,r,o)}}async createScrewsForPart(t,e,i,n){const r=e.collision.type==="box"?e.collision.width:0,o=e.collision.type==="box"?e.collision.height:0;for(const a of t.screws){const d={x:i.x-r/2+a.position.x,y:i.y-o/2+a.position.y},p=await jn({color:a.color,position:d,partEntityId:String(n.UID)});this.scene.addChild(p),this.screwEntities.push(p)}}clearLevel(){E.reset(),this.gameStateEntity&&(this.scene.removeChild(this.gameStateEntity),this.gameStateEntity=null),this.bufferTrayEntity&&(this.scene.removeChild(this.bufferTrayEntity),this.bufferTrayEntity=null),this.coloredTrayLayer.removeChildren();for(const t of this.trayEntities.values())this.scene.removeChild(t);this.trayEntities.clear();for(const t of this.partEntities)this.scene.removeChild(t);for(const t of this.screwEntities)this.scene.removeChild(t);this.animationLayer.removeChildren(),this.partEntities=[],this.screwEntities=[],this.currentLevel=null}loadedPartBundles=new Set;async loadPartAssets(t){const e=new Set(t.parts.map(n=>n.partId)),i=[];for(const n of e){if(this.loadedPartBundles.has(n))continue;const r=Yt(n);r.asset&&(i.push({alias:r.id,src:r.asset}),this.loadedPartBundles.add(n))}if(i.length>0){const n=`level-parts-${String(Date.now())}`;x.addBundle(n,i),await x.loadBundle(n)}}start(){this.scene.start()}pause(){this.scene.paused=!0}resume(){this.scene.paused=!1}update(t){}destroy(){this.restartInput&&(this.restartInput.enabled=!1,this.restartInput=null),this.restartButton=null,this.trayEntities.clear(),this.backgroundLayer.removeChildren(),this.uiLayer.removeChildren(),this.puzzleLayer.removeChildren(),this.animationLayer.removeChildren(),dr(),this.scene.reset()}}class jo extends Gs{gameScene=null;async onPrepare(){this.gameScene=new Yo({stage:this.view}),await this.gameScene.init();const t=Le(),i=`regions/region-${t.region??"test"}.json`,n=t.level??0;await this.gameScene.loadLevel(i,n)}onShow(){this.gameScene?.start()}onUpdate(t){this.gameScene?.update(t)}onHide(){this.gameScene?.pause()}onHidden(){this.gameScene?.destroy(),this.gameScene=null}onPause(){this.gameScene?.pause()}onResume(){this.gameScene?.resume()}}const Bt={width:1080,height:1920,backgroundColor:1710638,antialias:!0};let X=null;async function ms(){return X!==null||(X=new Ci,Ko(X),await X.init(),Vo(X),await Xo(X)),X}function Ko(s){s.add(Y,{backgroundColor:Bt.backgroundColor,antialias:Bt.antialias,autoAddToDocument:!1}),s.add(Ce,{resizeFunction:Ki(Bt.width,Bt.height,!0)}),s.add(zi),s.add(Fi),s.add(Ee,{main:{loadBeforeTransition:!0},overlay:{loadBeforeTransition:!0}})}function Vo(s){const t=s.get(Y),e=document.getElementById("app");if(e===null)throw new Error("App container element not found");e.appendChild(t.view)}async function Xo(s){const t=s.get(Ee);t.main.add(jo,void 0,"game"),await t.main.show("game"),qo("game")}function Qo(){return X}const gs=Object.freeze(Object.defineProperty({__proto__:null,bootstrap:ms,getApp:Qo},Symbol.toStringTag,{value:"Module"}));Wo();if(cs()){const s=Lo();document.body.appendChild(s)}async function Jo(){try{console.log("Starting application..."),await ms(),console.log("Application started successfully")}catch(s){console.error("Failed to initialize application:",s),window.__gameTest&&window.__gameTest.captureError(s instanceof Error?s:new Error(String(s)),"main");const t=document.getElementById("app");t&&(t.innerHTML=`<pre style="color: red; padding: 20px;">${String(s)}

${s instanceof Error?s.stack??"":""}</pre>`)}}Jo();
//# sourceMappingURL=index-DRCygHPs.js.map
